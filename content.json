{"meta":{"title":"Eight Plus","subtitle":"èœé¸Ÿçš„ç‚¹æ»´è®°å½•","description":"Linux çˆ±å¥½è€…","author":"æç¿”","url":"https://eightplus.github.io"},"pages":[{"title":"","date":"2018-07-18T13:36:28.000Z","updated":"2018-07-31T11:44:44.738Z","comments":true,"path":"about/index.html","permalink":"https://eightplus.github.io/about/index.html","excerpt":"","text":"å…³äºæˆ‘ åœ¨è¿™ä¸ªæ— å¸¸çš„ä¸–ç•Œé‡Œï¼Œæ€»æœ‰ä¸€äº›äººï¼Œä¼šä¸ºè¿™ä¸ªä¸–ç•Œç•™ä¸‹äº›ä»€ä¹ˆã€‚è€Œè¿™ç•™ä¸‹çš„ï¼Œå¿…å°†æˆä¸ºæ°¸æ’ï¼ ä¸€ä¸ªLinuxçˆ±å¥½è€…ï¼Œ2011å¹´æœ¬ç§‘æ¯•ä¸šï¼Œå¼€å§‹ä»äº‹Linuxæ“ä½œç³»ç»Ÿå’Œè½¯ä»¶çš„ç ”å‘ï¼Œçˆ±å¥½å¼€æºè½¯ä»¶å¼€å‘ï¼Œå·¥ä½œä¸­ç¼–å†™çš„é—­æºè½¯ä»¶æœ‰ä¿å¯†ç®¡ç†è½¯ä»¶ã€å›½äº§å¾ä¿¡æŠ¥å‘ŠæŸ¥è¯¢ç³»ç»Ÿã€Androidå…¼å®¹ç­‰ï¼Œç†Ÿæ‚‰çš„è¯­è¨€å’Œæ¡†æ¶æœ‰C/C++ã€Pythonã€Shellã€Qt/QMLã€Gtkç­‰ã€‚ å…³äºæˆ‘çš„æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹ ğŸ‘‰Githubç äº‘"},{"title":"åˆ†ç±»","date":"2018-07-30T10:46:20.000Z","updated":"2018-07-31T02:28:12.068Z","comments":true,"path":"categories/index.html","permalink":"https://eightplus.github.io/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2018-07-18T13:36:55.000Z","updated":"2018-07-31T02:28:12.068Z","comments":false,"path":"tags/index.html","permalink":"https://eightplus.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"å®‰è£…Anbox","slug":"2019-08-14-install-anbox","date":"2019-08-14T13:44:03.000Z","updated":"2019-08-14T14:29:49.673Z","comments":true,"path":"2019/08/14/2019-08-14-install-anbox/","link":"","permalink":"https://eightplus.github.io/2019/08/14/2019-08-14-install-anbox/","excerpt":"","text":"Anboxæ˜¯ä¸€ç§åŸºäºå®¹å™¨åœ¨å¸¸è§„GNU/Linuxç³»ç»Ÿä¸Šå¯åŠ¨å®Œæ•´Androidç³»çµ±çš„æ–¹æ³•ï¼Œå¦‚Ubuntuã€‚Anbox ä½¿ç”¨ Linux å‘½åç©ºé—´æœºåˆ¶ï¼ˆuserï¼Œpidï¼Œutsï¼Œnetï¼Œmountï¼Œipcï¼‰ï¼Œåœ¨å®¹å™¨ä¸­è¿è¡Œå®Œæ•´çš„ Android ç³»ç»Ÿï¼Œå®¹å™¨å†…çš„ Android æ²¡æœ‰ç›´æ¥è®¿é—®ä»»ä½•ç¡¬ä»¶çš„æƒé™ï¼Œæ‰€æœ‰çš„ç¡¬ä»¶è®¿é—®é€šè¿‡ä¸»æœºä¸Šçš„ anbox å®ˆæŠ¤è¿›ç¨‹ã€‚Anboxå¤ç”¨åŸºäº QEMU çš„æ¨¡æ‹Ÿå™¨ä¸­ä¸º Android æ‰€åšçš„ OpenGL ES åŠ é€Ÿæ¸²æŸ“çš„å®ç°ã€‚å®¹å™¨å†…çš„ Android ç³»ç»Ÿä½¿ç”¨ä¸åŒçš„ç®¡é“ä¸ä¸»æœºç³»ç»Ÿé€šä¿¡ï¼Œå¹¶é€šè¿‡å®ƒä»¬å‘é€æ‰€æœ‰çš„ç¡¬ä»¶è®¿é—®å‘½ä»¤ã€‚ ä½¿ç”¨aptå®‰è£…Anbox å®‰è£…å†…æ ¸æ¨¡å— anbox-modules-dkmsåŒ…å«ashmemå’Œbinderå†…æ ¸æ¨¡å—ï¼Œå®‰è£…anbox-modules-dkmsåï¼Œå¿…é¡»æ‰‹åŠ¨åŠ è½½å†…æ ¸æ¨¡å—ã€‚ä¸‹æ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå®ƒä»¬å°†è‡ªåŠ¨åŠ è½½ã€‚ $ sudo add-apt-repository ppa:morphis/anbox-support $ sudo apt update $ sudo apt install linux-headers-generic anbox-modules-dkms $ sudo modprobe ashmem_linux $ sudo modprobe binder_linux $ ls -1 /dev/{ashmem,binder}12/dev/ashmem/dev/binder å®‰è£…å’Œæ›´æ–°Anbox snap $ sudo apt install snapd $ sudo snap install --devmode --beta anbox $ snap refresh --beta --devmode anbox æŸ¥çœ‹ç•¶å‰å¯ç”¨çš„Anboxä¿¡æ¯ $ snap info anbox å¯åŠ¨Anbox $ anbox.appmgr å®‰è£…å®‰å“åº”ç”¨ $ sudo apt install android-tools-adb $ adb install my-app.apk å¸è½½Anbox $ snap remove anbox $ sudo apt install ppa-purge $ sudo ppa-purge ppa:morphis/anbox-support å‚è€ƒæ–‡æ¡£Anboxä¸»é¡µ Anboxä»£ç æ‰˜ç®¡ Android ç¡¬ä»¶ OpenGL ES æ¨¡æ‹Ÿè®¾è®¡æ¦‚è¿° Android QEMU fast pipes The Android â€œqemudâ€ multiplexing daemon Android qemud services","categories":[{"name":"å®‰å“å¼€å‘","slug":"å®‰å“å¼€å‘","permalink":"https://eightplus.github.io/categories/å®‰å“å¼€å‘/"}],"tags":[{"name":"Android Anbox","slug":"Android-Anbox","permalink":"https://eightplus.github.io/tags/Android-Anbox/"}]},{"title":"Android Binder","slug":"2018-08-11-android-binder","date":"2018-08-11T01:38:43.000Z","updated":"2018-08-11T01:56:56.719Z","comments":true,"path":"2018/08/11/2018-08-11-android-binder/","link":"","permalink":"https://eightplus.github.io/2018/08/11/2018-08-11-android-binder/","excerpt":"","text":"åœ¨Binderåº“ä¸­ï¼ŒServiceç»„ä»¶å’ŒClientç»„ä»¶åˆ†åˆ«ä½¿ç”¨æ¨¡æ¿ç±»BnInterfaceå’ŒBpInterfaceæ¥æè¿°ï¼Œå‰è€…ç§°ä¸ºBinderæœ¬åœ°å¯¹è±¡ï¼Œåè€…ç§°ä¸ºBinderä»£ç†å¯¹è±¡ã€‚Binderåº“ä¸­çš„Binderæœ¬åœ°å¯¹è±¡å’ŒBinderä»£ç†å¯¹è±¡åˆ†åˆ«å¯¹åº”äºBinderé©±åŠ¨ç¨‹åºä¸­çš„Binderå®ä½“å¯¹è±¡å’ŒBinderå¼•ç”¨å¯¹è±¡ã€‚ä¸‹é¢å°†ç®€è¦ä»‹ç»Binderè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œä»£ç åŒ…å«Serverè¿›ç¨‹å’ŒClientè¿›ç¨‹ï¼ŒServerè¿›ç¨‹å®ç°äº†ä¸€ä¸ªServiceç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†å‰é¢ä»‹ç»çš„è™šæ‹Ÿç¡¬ä»¶è®¾å¤‡mydevçš„å¯„å­˜å™¨valï¼Œå¹¶ä¸”å‘Clientè¿›ç¨‹æä¾›è®¿é—®æœåŠ¡ã€‚ä»¥ä¸‹å°†å®ä¾‹åˆ’åˆ†ä¸ºcommonã€serverå’Œclientä¸‰ä¸ªæ¨¡å—ï¼Œå…¶ä¸­commonå®ç°äº†ç¡¬ä»¶è®¿é—®æœåŠ¡æ¥å£IMydevServiceï¼Œä»¥åŠBinderæœ¬åœ°å¯¹è±¡ç±»BnMydevServiceå’ŒBinderä»£ç†å¯¹è±¡ç±»BpMydevServiceï¼›serverå®ç°äº†ä¸€ä¸ªServerè¿›ç¨‹ï¼Œé‡Œé¢åŒ…å«ä¸€ä¸ªServiceç»„ä»¶MydevServiceï¼›clientå®ç°äº†ä¸€ä¸ªClientè¿›ç¨‹ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªBpMydevServiceä»£ç†å¯¹è±¡å»è®¿é—®è¿è¡Œåœ¨Serverè¿›ç¨‹ä¸­çš„Serviceç»„ä»¶MydevServiceæ‰€æä¾›çš„æœåŠ¡ã€‚ ç¨‹åºç›®å½•ç»“æ„12345678910~/Android/external/binder----common ----IMydevgService.h ----IMydevService.cpp----server ----MydevServer.cpp ----Android.mk----client ----MydevClient.cpp ----Android.mk Serverè¿›ç¨‹ common/IMydevService.h 123456789101112131415161718192021222324252627#ifndef IMYDEVSERVICE_H_#define IMYDEVSERVICE_H_#include &lt;utils/RefBase.h&gt;#include &lt;binder/IInterface.h&gt;#include &lt;binder/Parcel.h&gt;#define MYDEV_SERVICE \"com.eightplus.MydevService\" //MYDEV_SERVICEç”¨æ¥æè¿°Serviceç»„ä»¶MydevServiceæ³¨å†Œåˆ°Service Managerçš„åç§°using namespace android;//ç¡¬ä»¶è®¿é—®æœåŠ¡æ¥å£class IMydevService: public IInterface&#123;public: DECLARE_META_INTERFACE(MydevService); virtual int32_t getVal() = 0;//è¯»å–è™šæ‹Ÿç¡¬ä»¶è®¾å¤‡mydevä¸­å¯„å­˜å™¨valçš„å€¼ virtual void setVal(int32_t val) = 0;//å‘è™šæ‹Ÿç¡¬ä»¶è®¾å¤‡mydevä¸­å¯„å­˜å™¨valä¸­å†™å…¥å€¼&#125;;//Binderæœ¬åœ°å¯¹è±¡ç±»BnMydevServiceclass BnMydevService: public BnInterface&lt;IMydevService&gt;&#123;public: virtual status_t onTransact(uint32_t code, const Parcel &amp;data, Parcel *reply, uint32_t flags= 0);&#125;;#endif common/IMydevService.cpp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869#define LOG_TAG \"IMydevService\"#include &lt;utils/Log.h&gt;#include \"IMydevService.h\"using namespace android;enum&#123; GET_VAL = IBinder::First_CALL_TRANSACTION; SET_VAL = IBinder::First_CALL_TRANSACTION + 1;&#125;;class BpMydevService: public BpInterface&lt;IMydevService&gt;&#123;public: BpMydevService(const sp&lt;IBinder&gt;&amp; impl): BpInterface&lt;IMydevService&gt;(impl) &#123; &#125;public: int32_t getVal() &#123; Parcel data; data.writeInterfaceToken(IMydevService::getInterfaceDescriptor()); Parcel reply; remote()-&gt;transact(GET_VAL, data, &amp;reply); int32_t val = reply.readInt32(); return val; &#125; void setVal(int32_t val) &#123; Parcel data; data.writeInterfaceToken(IMydevService::getInterfaceDescriptor()); data.writeInt32(val); Parcel reply; remote-&gt;transact(SET_VAL, data, &amp;reply); &#125;&#125;;IMPLEMENT_META_INTERFACE(MydevService, \"com.eightplus.IMydevService\");status_t BnMydevService::onTransact(uint32_t code, const Parcel &amp;data, Parcel *reply, uint32_t flags)&#123; switch(code) &#123; case GET_VAL: &#123; CHECK_INTERFACE(IMydevService, data, reply); int32_t val = getVal(); reply-&gt;writeInt32(val); return NO_ERROR; &#125; case SET_VAL: &#123; CHECK_INTERFACE(IMydevService, data, reply); int32_t val = data.readInt32(); setVal(val); return NO_ERROR; &#125; default: &#123; return BBinder::onTransact(code, data, reply, flags); &#125; &#125;&#125; server/MydevServer.cpp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#define LOG_TAG \"MydevServer\"#include &lt;stdlib.h&gt;#include &lt;fcntl.h&gt;#include &lt;utils/Log.h&gt;#include &lt;binder/IServiceManager.h&gt;#include &lt;binder/IPCThreadState.h&gt;#include \"../common/IMydevService.h\"#define MYDEV_DEVICE_NAME \"/dev/mydev\"//Serviceç»„ä»¶ç±»MydevServiceclass MydevService: public BnMydevService&#123;public: MydevService() &#123; fd = open(MYDEV_DEVICE_NAME, O_RDWR); if(fd == -1) LOGE(\"Failed to open device %s.\\n\", MYDEV_DEVICE_NAME); &#125; virtual ~MydevService() &#123; if(fd != -1) close(fd); &#125;public: static void instantiate() &#123; defaultServiceManager()-&gt;addService(String16(MYDEV_SERVICE), new MydevService()); &#125; int32_t getVal() &#123; int32_t val = 0; if(fd != -1) read(fd, &amp;val, sizeof(val)); rerurn val; &#125; void setVal(int32_t val) &#123; if(fd != -1) write(fd, &amp;val, sizeof(val)); &#125;private: int fd;&#125;;int main(int argc, char** argv)&#123; MydevService::instantiate();//å°†MydevServiceç»„ä»¶æ³¨å†Œåˆ°Service Managerä¸­ ProcessState::self()-&gt;startThreadPool();//å¯åŠ¨ä¸€ä¸ªBinderçº¿ç¨‹æ±  IPCThreadState::self()-&gt;joinThreadPool();//å°†ä¸»çº¿ç¨‹æ·»åŠ åˆ°è¿›ç¨‹çš„Binderçº¿ç¨‹æ± ä¸­ï¼Œç”¨æ¥å¤„ç†æ¥è‡ªClientè¿›ç¨‹çš„é€šä¿¡è¯·æ±‚ return 0;&#125; server/Android.mk12345678LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_SRC_FILES := ../common/IMydevService.cpp \\ MydevServer.cppLOCAL_SHARED_LIBRARIES := libcutils libutils libbinderLOCAL_PACKAGE_NAME := MydevServerinclude $(BUILD_EXECUTABLE) Clientè¿›ç¨‹ client/MydevClient.cpp 1234567891011121314151617181920212223242526272829303132333435#define LOG_TAG \"MydevClient\"#include &lt;utils/Log.h&gt;#include &lt;binder/IServiceManager.h&gt;#include \"../common/IMydevService.h\"int main()&#123; sp&lt;IBinder&gt; binder = defaultServiceManager()-&gt;getService(String16(MYDEV_SERVICE)); if (binder == NULL) &#123; LOGE(\"Failed to get mydev service: %s.\\n\", MYDEV_SERVICE); return -1; &#125; sp&lt;IMydevService&gt; service = IMydevService::asInterface(binder); if (service == NULL) &#123; LOGE(\"Failed to get mydev service interface.\\n\"); return -2; &#125; printf(\"Read original value from MydevService:\\n\"); int32_t val = service-&gt;getVal(); printf(\" %d.\\n\", val);//0 printf(\"Add value 1 to MydevService.\\n\"); val += 1; service-&gt;setVal(val); printf(\"Read the value from MydevService again:\\n\"); val = service-&gt;getVal(); printf(\" %d.\\n\", val);//1 return 0;&#125; client/Android.mk12345678LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_SRC_FILES := ../common/IMydevService.cpp \\ MydevClient.cppLOCAL_SHARED_LIBRARIES := libcutils libutils libbinderLOCAL_PACKAGE_NAME := MydevClientinclude $(BUILD_EXECUTABLE) å•ç‹¬ç¼–è¯‘serverå’Œclient ~/Android$ mmm ./external/binder/server/ ~/Android$ mmm ./external/binder/client/ ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°±å¯ä»¥åœ¨out/target/product/generic/system/binç›®å½•ä¸‹çœ‹åˆ°ç¼–è¯‘ç»“æœçš„è¾“å‡ºæ–‡ä»¶MydevServerå’ŒMydevClientäº† é‡æ–°æ‰“åŒ…system.imgæ–‡ä»¶ ~/Android$make snod è¿è¡Œæ¨¡æ‹Ÿå™¨ï¼š ~/Android$emulator -kernel kernel/goldfish/arch/arm/boot/zImage &amp; ~/Android$ adb shell root@android:/ # cd system/bin root@android:/system/bin # ./MydevServer &amp; root@android:/system/bin # ./MydevXClient12345Read original value from MydevService:0.Add value 1 to MydevService.Read the value from MydevService again:1.","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Android","slug":"Android","permalink":"https://eightplus.github.io/tags/Android/"}]},{"title":"åœ¨Androidæºç ä¸­ä½¿ç”¨javaç¼–å†™è‡ªå·±çš„åº”ç”¨ç¨‹åº","slug":"2018-08-09-android-java-app","date":"2018-08-09T13:49:29.000Z","updated":"2018-08-09T14:18:39.241Z","comments":true,"path":"2018/08/09/2018-08-09-android-java-app/","link":"","permalink":"https://eightplus.github.io/2018/08/09/2018-08-09-android-java-app/","excerpt":"","text":"HelloWorld ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 12345678910111213~/Android/packages/experimental/HelloWorld----AndroidMainifest.xml----Android.mk----src ----com/eightplus/mydev ----HelloWorld.java----res ----layout ----main.xml ----values ----strings.xml ----drawable ----icon.png HelloWorld.java 12345678910111213141516package com.eightplus.helloimport android.app.Activity;import android.os.Bundle;import android.util.log;public class HelloWorld extends Activity &#123; private final static String LOG_TAG = \"HelloWorld\"; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.main); Log.i(LOG_TAG, \"HelloWorld, Welcome!!!\"); &#125;&#125; main.xml 12345678910111213&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:orientation=\"vertical\" android:layout_width=\"fill_parent\" android:layout_height=\"fill_parent\" android:gravity=\"center\"&gt; &lt;TextView android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/hello_world\" &gt; &lt;/TextView&gt;&lt;/LinearLayout&gt; strings.xml 12345&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;resources&gt; &lt;string name=\"app_name\"&gt;HellWorld&lt;/string&gt; &lt;string name=\"hello_world\"&gt;Hello World&lt;/string&gt;&lt;/resources&gt; icon.pngæ˜¯åº”ç”¨ç¨‹åºçš„å›¾æ ‡ AndroidMainifest.xml 12345678910111213141516&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;mainifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.eightplus.hello\" android:versionCode=\"1\" android:versionName=\"1.0\"&gt; &lt;application android:icon=\"@drawable/icon\" android:label=\"@string/app_name\"&gt; &lt;activity android:name=\".HelloWorld\" android:label=\"@string/app_name\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.MAIN\" /&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;/application&gt;&lt;/mainifest&gt; Android.mk 123456LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_SRC_FILES := $(call all-subdir-java-files)LOCAL_PACKAGE_NAME := HelloWorldinclude $(BUILD_PACKAGE) ä½¿ç”¨mmmå‘½ä»¤å•ç‹¬ç¼–è¯‘HelloWorkdç¨‹åº ~/Android$ mmm ./packages/experimental/HelloWorld/ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°±å¯ä»¥åœ¨out/target/product/generic/system/appç›®å½•ä¸‹çœ‹åˆ°ç¼–è¯‘ç»“æœçš„è¾“å‡ºæ–‡ä»¶HelloWorld.apkäº†ã€‚ é‡æ–°æ‰“åŒ…Androidç³»ç»Ÿæ–‡ä»¶system.img ~/Android$ make snod è¿è¡Œæ¨¡æ‹Ÿå™¨ ~/Android$ emulator Activityç»„ä»¶åº”ç”¨å®ä¾‹è¯¥å®ä¾‹ç”±ä¸‰ä¸ªAcitityç»„ä»¶ç»„æˆï¼šMainActivityã€SubActivityInProcesså’ŒSubActivityInNewProcessã€‚MainActivityæ˜¯æ ¹Acitityï¼ŒSubActivityInProcesså’ŒSubActivityInNewProcessæ˜¯å­Acitityã€‚MainActivityå’ŒSubActivityInProcessè¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€ŒSubActivityInNewProcessè¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ä¸­ã€‚ ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 12345678910111213141516~/Android/packages/experimental/Activity----AndroidMainifest.xml----Android.mk----src ----com/eightplus/activity ----MainActivity.java ----SubActivityInProcess.java ----SubActivityInNewProcess.java----res ----layout ----main.xml ----sub.xml ----values ----strings.xml ----drawable ----icon.png MainActivity.java SubActivityInProcesså’ŒSubActivityInNewProcessçš„ç»„ä»¶åå­—åˆ†åˆ«è¢«é…ç½®ä¸ºâ€com.eightplus.activity.subactivity.in.processâ€å’Œâ€com.eightplus.activity.subactivity.in.new.processâ€ï¼Œå› æ­¤è°ƒç”¨æˆå‘˜å’Œå‡½æ•°startActivityå¯åŠ¨å®ƒä»¬æ—¶ï¼Œåªéœ€è¦åˆ†åˆ«æŒ‡å®šè¿™ä¸¤ä¸ªåç§°å³å¯ï¼Œä¸éœ€è¦çŸ¥é“å®ƒä»¬æ˜¯å“ªä¸ªç±»æ¥å®ç°çš„ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041package com.eightplus.activity; import android.app.Activity; import android.content.Intent; import android.os.Bundle; import android.util.Log; import android.view.View; import android.view.View.OnClickListener; import android.widget.Button; public class MainActivity extends Activity implements OnClickListener &#123; private final static String LOG_TAG = \"com.eightplus.activity.MainActivity\"; private Button startInProcessButton = null; private Button startInNewProcessButton = null; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.main); startInProcessButton = (Button)findViewById(R.id.button_start_in_process); startInNewProcessButton = (Button)findViewById(R.id.button_start_in_new_process); startInProcessButton.setOnClickListener(this); startInNewProcessButton.setOnClickListener(this); Log.i(LOG_TAG, \"Main Activity Created.\"); &#125; @Override public void onClick(View v) &#123; if(v.equals(startInProcessButton)) &#123; Intent intent = new Intent(\"com.eightplus.activity.subactivity.in.process\"); startActivity(intent); &#125; else if(v.equals(startInNewProcessButton)) &#123; Intent intent = new Intent(\"com.eightplus.activity.subactivity.in.new.process\"); startActivity(intent); &#125; &#125; &#125; SubActivityInProcess.java 1234567891011121314151617181920212223242526272829303132package com.eightplus.activity; import android.app.Activity; import android.os.Bundle; import android.util.Log; import android.view.View; import android.view.View.OnClickListener; import android.widget.Button; public class SubActivityInProcess extends Activity implements OnClickListener &#123; private final static String LOG_TAG = \"com.eightplus.activity.SubActivityInProcess\"; private Button finishButton = null; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.sub); finishButton = (Button)findViewById(R.id.button_finish); finishButton.setOnClickListener(this); Log.i(LOG_TAG, \"Sub Activity In Process Created.\"); &#125; @Override public void onClick(View v) &#123; if(v.equals(finishButton)) &#123; finish(); &#125; &#125; &#125; SubActivityInNewProcess.java 1234567891011121314151617181920212223242526272829303132package com.eightplus.activity; import android.app.Activity; import android.os.Bundle; import android.util.Log; import android.view.View; import android.view.View.OnClickListener; import android.widget.Button; public class SubActivityInNewProcess extends Activity implements OnClickListener &#123; private final static String LOG_TAG = \"com.eightplus.activity.SubActivityInNewProcess\"; private Button finishButton = null; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.sub); finishButton = (Button)findViewById(R.id.button_finish); finishButton.setOnClickListener(this); Log.i(LOG_TAG, \"Sub Activity In New Process Created.\"); &#125; @Override public void onClick(View v) &#123; if(v.equals(finishButton)) &#123; finish(); &#125; &#125; &#125; main.xml 123456789101112131415161718192021&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:orientation=\"vertical\" android:layout_width=\"fill_parent\" android:layout_height=\"fill_parent\" android:gravity=\"center\"&gt; &lt;Button android:id=\"@+id/button_start_in_process\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/start_in_process\" &gt; &lt;/Button&gt; &lt;Button android:id=\"@+id/button_start_in_new_process\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/start_in_new_process\" &gt; &lt;/Button&gt;&lt;/LinearLayout&gt; sub.xml 1234567891011121314&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:orientation=\"vertical\" android:layout_width=\"fill_parent\" android:layout_height=\"fill_parent\" android:gravity=\"center\"&gt; &lt;Button android:id=\"@+id/button_finish\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/finish\" &gt; &lt;/Button&gt;&lt;/LinearLayout&gt; strings.xml 12345678&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;resources&gt; &lt;string name=\"app_name\"&gt;Activity&lt;/string&gt; &lt;string name=\"sub_activity\"&gt;Sub Activity&lt;/string&gt; &lt;string name=\"start_in_process\"&gt;Start sub-activity in process&lt;/string&gt; &lt;string name=\"start_in_new_process\"&gt;Start sub-activity in new process&lt;/string&gt; &lt;string name=\"finish\"&gt;Finish activity&lt;/string&gt;&lt;/resources&gt; icon.pngä¸ºåº”ç”¨ç¨‹åºçš„å›¾æ ‡ AndroidMainifest.xml 1234567891011121314151617181920212223242526272829303132&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.eightplus.activity\" android:versionCode=\"1\" android:versionName=\"1.0\"&gt; &lt;application android:icon=\"@drawable/icon\" android:label=\"@string/app_name\"&gt; &lt;activity android:name=\".MainActivity\" android:label=\"@string/app_name\" android:process=\"com.eightplus.activity.mainprocess\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.MAIN\" /&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;activity android:label=\"@string/sub_activity\" android:name=\".SubActivityInProcess\" android:process=\"com.eightplus.activity.mainprocess\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"com.eightplus.activity.subactivity.in.process\"/&gt; &lt;category android:name=\"android.intent.category.DEFAULT\"/&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;activity android:label=\"@string/sub_activity\" android:name=\".SubActivityInNewProcess\" android:process=\"com.eightplus.activity.newprocess\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"com.eightplus.activity.subactivity.in.new.process\"/&gt; &lt;category android:name=\"android.intent.category.DEFAULT\"/&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;/application&gt;&lt;/manifest&gt; Android.mk 123456LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_SRC_FILES := $(call all-subdir-java-files)LOCAL_PACKAGE_NAME := Activityinclude $(BUILD_PACKAGE) ç¼–è¯‘å’Œæ‰“åŒ… ~/Android$ mmm packages/experimental/Activity ~/Android$ make snod å¯åŠ¨æ¨¡æ‹Ÿå™¨ ~/Android$ emulator Serviceç»„ä»¶åº”ç”¨å®ä¾‹è¯¥å®ä¾‹ç”±ä¸€ä¸ªServiceç»„ä»¶CounterServiceå’Œä¸€ä¸ªActivityç»„ä»¶Counterç»„æˆã€‚CounterServiceç»„ä»¶å®ç°äº†ä¸€ä¸ªè®¡æ•°å™¨æœåŠ¡ï¼Œå®ƒæ˜¯ç”±Counterç»„ä»¶å¯åŠ¨èµ·æ¥çš„ï¼Œå¹¶ä¸”ä¸Counterç»„ä»¶ç»‘å®šåœ¨ä¸€èµ·ã€‚CounterServiceç»„ä»¶åœ¨å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡(AsyncTask)æ¥å®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯éš”ä¸€ç§’å°±å°†å†…éƒ¨çš„è®¡æ•°åŠ 1,å¹¶ä¸”å®æ—¶åœ°å°†è¿™ä¸ªè®¡æ•°æ˜¾ç¤ºåœ¨Counterç»„ä»¶çš„ç”¨æˆ·ç•Œé¢ä¸Šã€‚ç”±äºè®¡æ•°å™¨éœ€è¦ä¸åœåœ°æ‰§è¡ŒåŠ æ•°åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™é‡Œå°†å®ƒæ”¾åœ¨ä¸€ä¸ªåå°ç¨‹åºä¸­è¿è¡Œï¼Œé¿å…Counterç»„ä»¶ä¸èƒ½åŠæ—¶åœ°å“åº”ç”¨æˆ·ç•Œé¢äº‹ä»¶ã€‚ ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 1234567891011121314151617~/Android/packages/experimental/Counter----AndroidMainifest.xml----Android.mk----src ----com/eightplus/counter ----ICounterCallback.java ----ICounterService.java ----CounterService.java ----Counter.java----res ----layout ----main.xml ----sub.xml ----values ----strings.xml ----drawable ----icon.png ICounterCallback.java 12345package com.eightplus.counterpublicd interface ICounterCallback &#123; void count(int val);&#125; ICounterService.java 123456package com.eightplus.counterpublicd interface ICounterService &#123; public void startCounter(int initVal, ICounterCallback callback); public void stopCounter();&#125; CounterService.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273package com.eightplus.counterimport android.app.Service;import android.content.Intent;import android.os.AsyncTask;import android.os.Binder;import android.os.IBinder;import android.util.Log;public class CounterService extends Service implements ICounterService &#123; private final static String LOG_TAG = \"com.eightplus.activity.CounterService\"; private bool stop = false; private ICounterCallback counterCallback = null; private final IBinder binder = new CounterBinder(); public class CounterBinder extends Binder &#123; public CounterService getService() &#123; return CounterService.this; &#125; &#125; @Override public IBinder onBind(Intent intent) &#123; return binder; &#125; @Override public void onCreate() &#123; super.onCreate(); Log.i(LOG_TAG, \"Counter Service Created.\"); &#125; public void startCounter(int initVal, ICounterCallback callback) &#123; counterCallback = callback; AsyncTask&lt;Integer, Integer, Integer&gt; task = new AsyncTask&lt;Integer, Integer, Integer&gt;() &#123; @Override protected Integer doInBackground(Integer... vals) &#123; Integer initCounter = vals[0]; stop = false; while(!stop) &#123; publishProcess(initCounter); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; initCounter++; &#125; return initCounter; &#125; @Override protected void onProgressUpdate(Integer... values) &#123; super.onProgressUpdate(values); int val = values[0]; counterCallback.count(val); &#125; @Override protected void onPostExecute(Integer val) &#123; counterCallback.count(val); &#125; &#125;; task.execute(initVal); &#125; public void stopCounter() &#123; stop = true; &#125;&#125; Counter.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485package com.eightplus.counterimport android.app.Activity;import android.content.ComponentName;import android.content.Context;import android.content.Intent;import android.content.IntentFilter;import android.content.ServiceConnection;import android.os.Bundle;import android.os.IBinder;import android.util.Log;import android.view.View;import android.view.onClickListener;import android.widget.Button;import android.widget.TextView;public class Counter extends Activity implements OnClickListener, ICounterCallback &#123; private final static String LOG_TAG = \"com.eightplus.activity.Counter\"; private Button startButton = null; private Button stopButton = null; private TextView counterText = null; private ICounterService counterService = null; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.main); startButton = (Button)findViewById(R.id.button_start); stopButton = (Button)findViewById(R.id.button_stop); counterText = (TextView)findViewById(R.id.textview_counter); startButton.setOnClickListener(this); stopButton.setOnClickListener(this); startButton.setEnabled(true); stopButton.setEnabled(false); Intent bindIntent = new Intent(Counter.this, CounterService.class); bindService(bindIntent, serviceConnection, Context.BIND_AUTO_CREATE); Log.i(LOG_TAG, \"Counter Activity Created.\"); &#125; @Override public void onDestroy() &#123; super.onDestory(); unbindService(serviceConnection); &#125; @Override public void onClick(View v) &#123; if(v.equals(startButton)) &#123; if (counterService != null) &#123; counterService.startCounter(0, this); startButton.setEnabled(false); stopButton.setEnabled(true); &#125; &#125; else if(v.equals(stopButton)) &#123; if (counterService != null) &#123; counterService.stopCounter(); startButton.setEnabled(true); stopButton.setEnabled(false); &#125; &#125; &#125; @Override public void count(int val) &#123; String text = String.valueOf(val); counterText.setText(text); &#125; private ServiceConnection serviceConnection = new ServiceConnection() &#123; public void onServiceConnected(ComponentName className, IBinder service) &#123; counterService = ((CounterService.CounterBinder)service).getService(); Log.i(LOG_TAG, \"Counter Service Connected\"); &#125; public void onServiceDisconnected(ComponentName className) &#123; counterService = null; Log.i(LOG_TAG, \"Counter Service DisConnected\"); &#125;&#125; main.xml 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:orientation=\"vertical\" android:layout_width=\"fill_parent\" android:layout_height=\"fill_parent\" android:gravity=\"center\"&gt; &lt;LinearLayout android:layout_width=\"fill_parent\" android:layout_height=\"wrap_content\" android:layout_marginBottom=\"10px\" android:orientation=\"horizontal\" android:gravity=\"center\"&gt; &lt;TextView android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_marginBottom=\"4px\" android:gravity=\"center\" android:text=\"@string/counter\"&gt; &lt;/TextView&gt; &lt;TextView android:id=\"@+id/textview_counter\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/init_counter\"&gt; &lt;/TextView&gt; &lt;/LinearLayout&gt; &lt;LinearLayout android:layout_width=\"fill_parent\" android:layout_height=\"wrap_content\" android:orientation=\"horizontal\" android:gravity=\"center\"&gt; &lt;Button android:id=\"@+id/button_start\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/start\"&gt; &lt;/Button&gt; &lt;Button android:id=\"@+id/button_stop\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/stop\"&gt; &lt;/Button&gt; &lt;/LinearLayout&gt;&lt;/LinearLayout&gt; strings.xml 12345678&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;resources&gt; &lt;string name=\"app_name\"&gt;Counter&lt;/string&gt; &lt;string name=\"counter\"&gt;Counter:&lt;/string&gt; &lt;string name=\"init_counter\"&gt;0&lt;/string&gt; &lt;string name=\"start\"&gt;Start Counter&lt;/string&gt; &lt;string name=\"stop\"&gt;Stop Counter&lt;/string&gt;&lt;/resources&gt; icon.pngä¸ºåº”ç”¨ç¨‹åºçš„å›¾æ ‡ AndroidMainifest.xml 123456789101112131415161718&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.eightplus.counter\" android:versionCode=\"1\" android:versionName=\"1.0\"&gt; &lt;application android:icon=\"@drawable/icon\" android:label=\"@string/app_name\"&gt; &lt;activity android:name=\".Counter\" android:label=\"@string/app_name\" &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.MAIN\" /&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;service android:name=\".CounterService\" android:enabled=\"true\"&gt; &lt;/service&gt; &lt;/application&gt;&lt;/manifest&gt; Android.mk 123456LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_SRC_FILES := $(call all-subdir-java-files)LOCAL_PACKAGE_NAME := Counterinclude $(BUILD_PACKAGE) ç¼–è¯‘å’Œæ‰“åŒ… ~/Android$ mmm ./packages/experimental/Counter/ ~/Android$ make snod å¯åŠ¨æ¨¡æ‹Ÿå™¨ ~/Android$ emulator","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Android","slug":"Android","permalink":"https://eightplus.github.io/tags/Android/"}]},{"title":"åœ¨Androidæºç ä¸­ç¼–å†™Cç¨‹åºæµ‹è¯•Linuxå†…æ ¸é©±åŠ¨ç¨‹åº","slug":"2018-08-06-test-android-kernel-driver-program","date":"2018-08-06T14:33:11.000Z","updated":"2018-08-06T14:49:11.803Z","comments":true,"path":"2018/08/06/2018-08-06-test-android-kernel-driver-program/","link":"","permalink":"https://eightplus.github.io/2018/08/06/2018-08-06-test-android-kernel-driver-program/","excerpt":"","text":"åœ¨mydevçš„Linuxå†…æ ¸é©±åŠ¨ç¨‹åºä¸­ï¼Œåˆ›å»ºä¸‰ä¸ªä¸åŒçš„æ–‡ä»¶èŠ‚ç‚¹æ¥ä¾›ç”¨æˆ·ç©ºé—´è®¿é—®ï¼Œåˆ†åˆ«æ˜¯ä¼ ç»Ÿçš„è®¾å¤‡æ–‡ä»¶/dev/mydevã€procç³»ç»Ÿæ–‡ä»¶/proc/mydevå’Œdevfsç³»ç»Ÿå±æ€§æ–‡ä»¶/sys/class/mydev/mydev/valã€‚è¿™é‡Œé€šè¿‡ç¼–å†™çš„Cå¯æ‰§è¡Œç¨‹åºæ¥è®¿é—®è®¾å¤‡æ–‡ä»¶/dev/mydevã€‚ é©±åŠ¨ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 12345~/Android----external ----mydev ----mydev.c ----Android.mk ä½¿ç”¨Androidæ¨¡æ‹Ÿå™¨åŠ è½½åŒ…å«è¿™ä¸ªLinuxé©±åŠ¨ç¨‹åºçš„å†…æ ¸æ–‡ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨adb shellå‘½ä»¤è¿æ¥ä¸Šæ¨¡æ‹Ÿï¼ŒéªŒè¯åœ¨/devç›®å½•ä¸­å­˜åœ¨è®¾å¤‡æ–‡ä»¶mydevã€‚ è¿›å…¥åˆ°Androidæºä»£ç å·¥ç¨‹çš„externalç›®å½•ï¼Œåˆ›å»ºmydevç›®å½• ~/Android$ cd external ~/Android/external$ mkdir mydev åœ¨mydevç›®å½•ä¸­æ–°å»ºmydev.cæ–‡ä»¶ æ‰“å¼€/dev/mydevæ–‡ä»¶ï¼Œç„¶åå…ˆè¯»å‡º/dev/mydevæ–‡ä»¶ä¸­çš„å€¼ï¼Œæ¥ç€å†™å…¥å€¼5åˆ°/dev/mydevä¸­å»ï¼Œæœ€åå†æ¬¡è¯»å‡º/dev/mydevæ–‡ä»¶ä¸­çš„å€¼ï¼Œçœ‹çœ‹æ˜¯å¦æ˜¯æˆ‘ä»¬åˆšæ‰å†™å…¥çš„å€¼5ã€‚ä»/dev/mydevæ–‡ä»¶è¯»å†™çš„å€¼å®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬è™šæ‹Ÿçš„ç¡¬ä»¶çš„å¯„å­˜å™¨valçš„å€¼ã€‚ 12345678910111213141516171819202122232425262728293031#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;fcntl.h&gt;#define DEVICE_NAME \"/dev/mydev\"int main(int argc, char** argv)&#123; int fd = -1; int val = 0; fd = open(DEVICE_NAME, O_RDWR); if(fd == -1) &#123; printf(\"Failed to open device %s.\\n\", DEVICE_NAME); return -1; &#125; printf(\"Read original value:\\n\"); read(fd, &amp;val, sizeof(val)); printf(\"%d.\\n\\n\", val); val = 5; printf(\"Write value %d to %s.\\n\\n\", val, DEVICE_NAME); write(fd, &amp;val, sizeof(val)); printf(\"Read the value again:\\n\"); read(fd, &amp;val, sizeof(val)); printf(\"%d.\\n\\n\", val); close(fd); return 0;&#125; åœ¨mydevç›®å½•ä¸­æ–°å»ºAndroid.mkæ–‡ä»¶ï¼Œå…¶ä¸­â€œBUILD_EXECUTABLEâ€è¡¨ç¤ºç¼–è¯‘çš„æ˜¯å¯æ‰§è¡Œç¨‹åº 123456LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_MODULE := mydevLOCAL_SRC_FILES := $(call all-subdir-c-files)include $(BUILD_EXECUTABLE) ä½¿ç”¨mmmå‘½ä»¤è¿›è¡Œç¼–è¯‘ ~/Android$ mmm ./external/mydevè‹¥ç¼–è¯‘æˆåŠŸï¼Œåˆ™å¯ä»¥åœ¨out/target/product/gerneric/system/binç›®å½•ä¸‹çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶mydevã€‚ é‡æ–°æ‰“åŒ…Androidç³»ç»Ÿæ–‡ä»¶system.imgï¼Œé‡æ–°æ‰“åŒ…åçš„system.imgæ–‡ä»¶åŒ…å«äº†åˆšæ‰ç¼–è¯‘å¥½çš„mydevå¯æ‰§è¡Œæ–‡ä»¶ã€‚ ~/Android$ make snod è¿è¡Œæ¨¡æ‹Ÿå™¨ï¼Œä½¿ç”¨/system/bin/mydevå¯æ‰§è¡Œç¨‹åºæ¥è®¿é—®Linuxå†…æ ¸é©±åŠ¨ç¨‹åº ~/Android$ emulator -kernel ./kernel/goldfish/arch/arm/boot/zImage &amp; ~/Android$ adb shell root@android:/ # cd system/bin root@android:/system/bin # ./mydev12345Read the original value:0.Write value 5 to /dev/mydev.Read the value again:5.","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Android","slug":"Android","permalink":"https://eightplus.github.io/tags/Android/"}]},{"title":"ä¸ºAndroidç³»ç»Ÿç¼–å†™Linuxå†…æ ¸é©±åŠ¨ç¨‹åº","slug":"2018-08-02-android-kernel-driver","date":"2018-08-02T01:04:36.000Z","updated":"2018-08-06T14:37:24.543Z","comments":true,"path":"2018/08/02/2018-08-02-android-kernel-driver/","link":"","permalink":"https://eightplus.github.io/2018/08/02/2018-08-02-android-kernel-driver/","excerpt":"","text":"è¿™é‡Œä½¿ç”¨ä¸€ä¸ªè™šæ‹Ÿçš„ç¡¬ä»¶è®¾å¤‡ï¼Œè¿™ä¸ªè®¾å¤‡åªæœ‰ä¸€ä¸ª4å­—èŠ‚çš„å¯„å­˜å™¨ï¼Œå®ƒå¯è¯»å¯å†™ã€‚è¿™é‡ŒæŠŠè¿™ä¸ªè™šæ‹Ÿçš„è®¾å¤‡å‘½åä¸ºâ€œmydevâ€ï¼Œè€Œè¿™ä¸ªå†…æ ¸é©±åŠ¨ç¨‹åºä¹Ÿå‘½åä¸ºmydevé©±åŠ¨ç¨‹åºã€‚è¿™é‡Œé€šè¿‡catå‘½ä»¤ç›´æ¥è®¿é—®/proc/mydevå’Œ/sys/class/mydev/mydev/valæ–‡ä»¶éªŒè¯é©±åŠ¨ç¨‹åºçš„æ­£ç¡®æ€§ã€‚ é©±åŠ¨ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 1234567~/Android/kernel/goldfish----drivers ----mydev ----mydev.h ----mydev.c ----Kconfig ----Makefile æ–°å»ºmydevç›®å½• ~/Android$ cd kernel/goldfish/drivers ~/Android/kernel/goldfish/drivers$ mkdir mydev åœ¨mydevç›®å½•ä¸­å¢åŠ mydev.hæ–‡ä»¶ 123456789101112131415161718#ifndef _MYDEV_ANDROID_H_#define _MYDEV_ANDROID_Hpp#include &lt;linux/cdev.h&gt;#include &lt;linux/semaphore.h&gt;#define MYDEV_DEVICE_NODE_NAME \"helmydevlo\"#define MYDEV_DEVICE_FILE_NAME \"mydev\"#define MYDEV_DEVICE_PROC_NAME \"mydev\"#define MYDEV_DEVICE_CLASS_NAME \"mydev\"//å­—ç¬¦è®¾å¤‡ç»“æ„ä½“struct mydev_android_dev &#123; int val;//å¯„å­˜å™¨ struct semaphore sem;//ä¿¡å·é‡ struct cdev dev;//å†…åµŒçš„å­—ç¬¦è®¾å¤‡&#125;;#endif åœ¨mydevç›®å½•ä¸­å¢åŠ mydev.cæ–‡ä»¶ï¼Œè¿™æ˜¯é©±åŠ¨ç¨‹åºçš„å®ç°éƒ¨åˆ†ã€‚é©±åŠ¨ç¨‹åºçš„åŠŸèƒ½ä¸»è¦æ˜¯å‘ä¸Šå±‚æä¾›è®¿é—®è®¾å¤‡çš„å¯„å­˜å™¨çš„å€¼ï¼ŒåŒ…æ‹¬è¯»å’Œå†™ã€‚è¿™é‡Œï¼Œæä¾›äº†ä¸‰ç§è®¿é—®è®¾å¤‡å¯„å­˜å™¨çš„æ–¹æ³•ï¼Œä¸€æ˜¯é€šè¿‡procæ–‡ä»¶ç³»ç»Ÿæ¥è®¿é—®ï¼ŒäºŒæ˜¯é€šè¿‡ä¼ ç»Ÿçš„è®¾å¤‡æ–‡ä»¶çš„æ–¹æ³•æ¥è®¿é—®ï¼Œä¸‰æ˜¯é€šè¿‡devfsæ–‡ä»¶ç³»ç»Ÿæ¥è®¿é—®ã€‚ä¸‹é¢åˆ†æ®µæè¿°è¯¥é©±åŠ¨ç¨‹åºçš„å®ç°ã€‚ é¦–å…ˆæ˜¯åŒ…å«å¿…è¦çš„å¤´æ–‡ä»¶å’Œå®šä¹‰ä¸‰ç§è®¿é—®è®¾å¤‡çš„æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359#include &lt;linux/init.h&gt;#include &lt;linux/module.h&gt;#include &lt;linux/types.h&gt;#include &lt;linux/fs.h&gt;#include &lt;linux/proc_fs.h&gt;#include &lt;linux/device.h&gt;#include &lt;asm/uaccess.h&gt;#include \"mydev.h\"/*ä¸»è®¾å¤‡å’Œä»è®¾å¤‡å·å˜é‡*/static int mydev_major = 0;static int mydev_minor = 0;/*è®¾å¤‡ç±»åˆ«å’Œè®¾å¤‡å˜é‡*/static struct class* mydev_class = NULL;static struct mydev_android_dev* mydev_dev = NULL;/*ä¼ ç»Ÿçš„è®¾å¤‡æ–‡ä»¶æ“ä½œæ–¹æ³•*/static int mydev_open(struct inode* inode, struct file* filp);static int mydev_release(struct inode* inode, struct file* filp);static ssize_t mydev_read(struct file* filp, char __user *buf, size_t count, loff_t* f_pos);static ssize_t mydev_write(struct file* filp, const char __user *buf, size_t count, loff_t* f_pos);/**ä¼ ç»Ÿçš„è®¾å¤‡æ–‡ä»¶æ“ä½œæ–¹æ³•è¡¨*/static struct file_operations mydev_fops = &#123; .owner = THIS_MODULE, .open = mydev_open, .release = mydev_release, .read = mydev_read, .write = mydev_write,&#125;;/*devfsæ–‡ä»¶ç³»ç»Ÿçš„è®¾å¤‡å±æ€§æ“ä½œæ–¹æ³•*/static ssize_t mydev_val_show(struct device* dev, struct device_attribute* attr, char* buf);static ssize_t mydev_val_store(struct device* dev, struct device_attribute* attr, const char* buf, size_t count);/*devfsæ–‡ä»¶ç³»ç»Ÿçš„è®¾å¤‡å±æ€§*/static DEVICE_ATTR(val, S_IRUGO | S_IWUSR, mydev_val_show, mydev_val_store);//å®šä¹‰ä¼ ç»Ÿçš„è®¾å¤‡æ–‡ä»¶è®¿é—®æ–¹æ³•ï¼Œä¸»è¦æ˜¯å®šä¹‰mydev_openã€mydev_releaseã€mydev_readå’Œmydev_writeè¿™å››ä¸ªæ‰“å¼€ã€é‡Šæ”¾ã€è¯»å’Œå†™è®¾å¤‡æ–‡ä»¶çš„æ–¹æ³•ï¼š/*æ‰“å¼€è®¾å¤‡æ–¹æ³•*/static int mydev_open(struct inode* inode, struct file* filp) &#123; struct mydev_android_dev* dev; /*å°†è‡ªå®šä¹‰è®¾å¤‡ç»“æ„ä½“ä¿å­˜åœ¨æ–‡ä»¶æŒ‡é’ˆçš„ç§æœ‰æ•°æ®åŸŸä¸­ï¼Œä»¥ä¾¿è®¿é—®è®¾å¤‡æ—¶æ‹¿æ¥ç”¨*/ dev = container_of(inode-&gt;i_cdev, struct mydev_android_dev, dev); filp-&gt;private_data = dev; return 0;&#125;/*è®¾å¤‡æ–‡ä»¶é‡Šæ”¾æ—¶è°ƒç”¨ï¼Œç©ºå®ç°*/static int mydev_release(struct inode* inode, struct file* filp) &#123; return 0;&#125;/*è¯»å–è®¾å¤‡çš„å¯„å­˜å™¨valçš„å€¼*/static ssize_t mydev_read(struct file* filp, char __user *buf, size_t count, loff_t* f_pos) &#123; ssize_t err = 0; struct mydev_android_dev* dev = filp-&gt;private_data; /*åŒæ­¥è®¿é—®*/ if(down_interruptible(&amp;(dev-&gt;sem))) &#123; return -ERESTARTSYS; &#125; if(count &lt; sizeof(dev-&gt;val)) &#123; goto out; &#125; /*å°†å¯„å­˜å™¨valçš„å€¼æ‹·è´åˆ°ç”¨æˆ·æä¾›çš„ç¼“å†²åŒº*/ if(copy_to_user(buf, &amp;(dev-&gt;val), sizeof(dev-&gt;val))) &#123; err = -EFAULT; goto out; &#125; err = sizeof(dev-&gt;val);out: up(&amp;(dev-&gt;sem)); return err;&#125;/*å†™è®¾å¤‡çš„å¯„å­˜å™¨å€¼val*/static ssize_t mydev_write(struct file* filp, const char __user *buf, size_t count, loff_t* f_pos) &#123; struct mydev_android_dev* dev = filp-&gt;private_data; ssize_t err = 0; /*åŒæ­¥è®¿é—®*/ if(down_interruptible(&amp;(dev-&gt;sem))) &#123; return -ERESTARTSYS; &#125; if(count != sizeof(dev-&gt;val)) &#123; goto out; &#125; /*å°†ç”¨æˆ·æä¾›çš„ç¼“å†²åŒºçš„å€¼å†™åˆ°è®¾å¤‡å¯„å­˜å™¨å»*/ if(copy_from_user(&amp;(dev-&gt;val), buf, count)) &#123; err = -EFAULT; goto out; &#125; err = sizeof(dev-&gt;val);out: up(&amp;(dev-&gt;sem)); return err;&#125;//å®šä¹‰é€šè¿‡devfsæ–‡ä»¶ç³»ç»Ÿè®¿é—®æ–¹æ³•ï¼Œè¿™é‡ŒæŠŠè®¾å¤‡çš„å¯„å­˜å™¨valçœ‹æˆæ˜¯è®¾å¤‡çš„ä¸€ä¸ªå±æ€§ï¼Œé€šè¿‡è¯»å†™è¿™ä¸ªå±æ€§æ¥å¯¹è®¾å¤‡è¿›è¡Œè®¿é—®ï¼Œä¸»è¦æ˜¯å®ç°mydev_val_showå’Œmydev_val_storeä¸¤ä¸ªæ–¹æ³•ï¼ŒåŒæ—¶å®šä¹‰äº†ä¸¤ä¸ªå†…éƒ¨ä½¿ç”¨çš„è®¿é—®valå€¼çš„æ–¹æ³•__mydev_get_valå’Œ__mydev_set_valï¼š/*è¯»å–å¯„å­˜å™¨valçš„å€¼åˆ°ç¼“å†²åŒºbufä¸­ï¼Œå†…éƒ¨ä½¿ç”¨*/static ssize_t __mydev_get_val(struct mydev_android_dev* dev, char* buf) &#123; int val = 0; /*åŒæ­¥è®¿é—®*/ if(down_interruptible(&amp;(dev-&gt;sem))) &#123; return -ERESTARTSYS; &#125; val = dev-&gt;val; up(&amp;(dev-&gt;sem)); return snprintf(buf, PAGE_SIZE, \"%d\\n\", val);&#125;/*æŠŠç¼“å†²åŒºbufçš„å€¼å†™åˆ°è®¾å¤‡å¯„å­˜å™¨valä¸­å»ï¼Œå†…éƒ¨ä½¿ç”¨*/static ssize_t __mydev_set_val(struct mydev_android_dev* dev, const char* buf, size_t count) &#123; int val = 0; /*å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—*/ val = simple_strtol(buf, NULL, 10); /*åŒæ­¥è®¿é—®*/ if(down_interruptible(&amp;(dev-&gt;sem))) &#123; return -ERESTARTSYS; &#125; dev-&gt;val = val; up(&amp;(dev-&gt;sem)); return count;&#125;/*è¯»å–è®¾å¤‡å±æ€§val*/static ssize_t mydev_val_show(struct device* dev, struct device_attribute* attr, char* buf) &#123; struct mydev_android_dev* hdev = (struct mydev_android_dev*)dev_get_drvdata(dev); return __mydev_get_val(hdev, buf);&#125;/*å†™è®¾å¤‡å±æ€§val*/static ssize_t mydev_val_store(struct device* dev, struct device_attribute* attr, const char* buf, size_t count) &#123; struct mydev_android_dev* hdev = (struct mydev_android_dev*)dev_get_drvdata(dev); return __mydev_set_val(hdev, buf, count);&#125;//å®šä¹‰é€šè¿‡procæ–‡ä»¶ç³»ç»Ÿè®¿é—®æ–¹æ³•ï¼Œä¸»è¦å®ç°äº†mydev_proc_readå’Œmydev_proc_writeä¸¤ä¸ªæ–¹æ³•ï¼ŒåŒæ—¶å®šä¹‰äº†åœ¨procæ–‡ä»¶ç³»ç»Ÿåˆ›å»ºå’Œåˆ é™¤æ–‡ä»¶çš„æ–¹æ³•mydev_create_procå’Œmydev_remove_procï¼š/*è¯»å–è®¾å¤‡å¯„å­˜å™¨valçš„å€¼ï¼Œä¿å­˜åœ¨pageç¼“å†²åŒºä¸­*/static ssize_t mydev_proc_read(char* page, char** start, off_t off, int count, int* eof, void* data) &#123; if(off &gt; 0) &#123; *eof = 1; return 0; &#125; return __mydev_get_val(mydev_dev, page);&#125;/*æŠŠç¼“å†²åŒºçš„å€¼buffä¿å­˜åˆ°è®¾å¤‡å¯„å­˜å™¨valä¸­å»*/static ssize_t mydev_proc_write(struct file* filp, const char __user *buff, unsigned long len, void* data) &#123; int err = 0; char* page = NULL; if(len &gt; PAGE_SIZE) &#123; printk(KERN_ALERT\"The buff is too large: %lu.\\n\", len); return -EFAULT; &#125; page = (char*)__get_free_page(GFP_KERNEL); if(!page) &#123; printk(KERN_ALERT\"Failed to alloc page.\\n\"); return -ENOMEM; &#125; /*å…ˆæŠŠç”¨æˆ·æä¾›çš„ç¼“å†²åŒºå€¼æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºä¸­å»*/ if(copy_from_user(page, buff, len)) &#123; printk(KERN_ALERT\"Failed to copy buff from user.\\n\"); err = -EFAULT; goto out; &#125; err = __mydev_set_val(mydev_dev, page, len);out: free_page((unsigned long)page); return err;&#125;/*åˆ›å»º/proc/mydevæ–‡ä»¶*/static void mydev_create_proc(void) &#123; struct proc_dir_entry* entry; entry = create_proc_entry(MYDEV_DEVICE_PROC_NAME, 0, NULL); if(entry) &#123; entry-&gt;owner = THIS_MODULE; entry-&gt;read_proc = mydev_proc_read; entry-&gt;write_proc = mydev_proc_write; &#125;&#125;/*åˆ é™¤/proc/mydevæ–‡ä»¶*/static void mydev_remove_proc(void) &#123; remove_proc_entry(MYDEV_DEVICE_PROC_NAME, NULL);&#125;//æœ€åï¼Œå®šä¹‰æ¨¡å—åŠ è½½å’Œå¸è½½æ–¹æ³•ï¼Œè¿™é‡Œåªè¦æ˜¯æ‰§è¡Œè®¾å¤‡æ³¨å†Œå’Œåˆå§‹åŒ–æ“ä½œï¼š/*åˆå§‹åŒ–è®¾å¤‡*/static int __mydev_setup_dev(struct mydev_android_dev* dev) &#123; int err; dev_t devno = MKDEV(mydev_major, mydev_minor); memset(dev, 0, sizeof(struct mydev_android_dev)); cdev_init(&amp;(dev-&gt;dev), &amp;mydev_fops); dev-&gt;dev.owner = THIS_MODULE; dev-&gt;dev.ops = &amp;mydev_fops; /*æ³¨å†Œå­—ç¬¦è®¾å¤‡*/ err = cdev_add(&amp;(dev-&gt;dev),devno, 1); if(err) &#123; return err; &#125; /*åˆå§‹åŒ–ä¿¡å·é‡å’Œå¯„å­˜å™¨valçš„å€¼*/ init_MUTEX(&amp;(dev-&gt;sem)); dev-&gt;val = 0; return 0;&#125;/*æ¨¡å—åŠ è½½æ–¹æ³•*/static int __init mydev_init(void)&#123; int err = -1; dev_t dev = 0; struct device* temp = NULL; printk(KERN_ALERT\"Initializing mydev device.\\n\"); /*åŠ¨æ€åˆ†é…ä¸»è®¾å¤‡å’Œä»è®¾å¤‡å·*/ err = alloc_chrdev_region(&amp;dev, 0, 1, MYDEV_DEVICE_NODE_NAME); if(err &lt; 0) &#123; printk(KERN_ALERT\"Failed to alloc char dev region.\\n\"); goto fail; &#125; mydev_major = MAJOR(dev); mydev_minor = MINOR(dev); /*åˆ†é…heloè®¾å¤‡ç»“æ„ä½“å˜é‡*/ mydev_dev = kmalloc(sizeof(struct mydev_android_dev), GFP_KERNEL); if(!mydev_dev) &#123; err = -ENOMEM; printk(KERN_ALERT\"Failed to alloc mydev_dev.\\n\"); goto unregister; &#125; /*åˆå§‹åŒ–è®¾å¤‡*/ err = __mydev_setup_dev(mydev_dev); if(err) &#123; printk(KERN_ALERT\"Failed to setup dev: %d.\\n\", err); goto cleanup; &#125; /*åœ¨/sys/class/ç›®å½•ä¸‹åˆ›å»ºè®¾å¤‡ç±»åˆ«ç›®å½•mydev*/ mydev_class = class_create(THIS_MODULE, MYDEV_DEVICE_CLASS_NAME); if(IS_ERR(mydev_class)) &#123; err = PTR_ERR(mydev_class); printk(KERN_ALERT\"Failed to create mydev class.\\n\"); goto destroy_cdev; &#125; /*åœ¨/dev/ç›®å½•å’Œ/sys/class/mydevç›®å½•ä¸‹åˆ†åˆ«åˆ›å»ºè®¾å¤‡æ–‡ä»¶mydev*/ temp = device_create(mydev_class, NULL, dev, \"%s\", MYDEV_DEVICE_FILE_NAME); if(IS_ERR(temp)) &#123; err = PTR_ERR(temp); printk(KERN_ALERT\"Failed to create mydev device.\"); goto destroy_class; &#125; /*åœ¨/sys/class/mydev/mydevç›®å½•ä¸‹åˆ›å»ºå±æ€§æ–‡ä»¶val*/ err = device_create_file(temp, &amp;dev_attr_val); if(err &lt; 0) &#123; printk(KERN_ALERT\"Failed to create attribute val.\"); goto destroy_device; &#125; dev_set_drvdata(temp, mydev_dev); /*åˆ›å»º/proc/mydevæ–‡ä»¶*/ mydev_create_proc(); printk(KERN_ALERT\"Succedded to initialize mydev device.\\n\"); return 0;destroy_device: device_destroy(mydev_class, dev);destroy_class: class_destroy(mydev_class);destroy_cdev: cdev_del(&amp;(mydev_dev-&gt;dev));cleanup: kfree(mydev_dev);unregister: unregister_chrdev_region(MKDEV(mydev_major, mydev_minor), 1);fail: return err;&#125;/*æ¨¡å—å¸è½½æ–¹æ³•*/static void __exit mydev_exit(void) &#123; dev_t devno = MKDEV(mydev_major, mydev_minor); printk(KERN_ALERT\"Destroy mydev device.\\n\"); /*åˆ é™¤/proc/mydevæ–‡ä»¶*/ mydev_remove_proc(); /*é”€æ¯è®¾å¤‡ç±»åˆ«å’Œè®¾å¤‡*/ if(mydev_class) &#123; device_destroy(mydev_class, MKDEV(mydev_major, mydev_minor)); class_destroy(mydev_class); &#125; /*åˆ é™¤å­—ç¬¦è®¾å¤‡å’Œé‡Šæ”¾è®¾å¤‡å†…å­˜*/ if(mydev_dev) &#123; cdev_del(&amp;(mydev_dev-&gt;dev)); kfree(mydev_dev); &#125; /*é‡Šæ”¾è®¾å¤‡å·*/ unregister_chrdev_region(devno, 1);&#125;MODULE_LICENSE(\"GPL\");MODULE_DESCRIPTION(\"Fake Register Android Driver\");module_init(mydev_init);module_exit(mydev_exit); åœ¨mydevç›®å½•ä¸­æ–°å¢Kconfigå’ŒMakefileä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­Kconfigæ˜¯åœ¨ç¼–è¯‘å‰æ‰§è¡Œé…ç½®å‘½ä»¤make menuconfigæ—¶ç”¨åˆ°çš„ï¼Œè€ŒMakefileæ˜¯æ‰§è¡Œç¼–è¯‘å‘½ä»¤makeæ˜¯ç”¨åˆ°çš„ åœ¨Kconfigæ–‡ä»¶ä¸­ï¼Œtristateè¡¨ç¤ºç¼–è¯‘é€‰é¡¹MYDEVæ”¯æŒåœ¨ç¼–è¯‘å†…æ ¸æ—¶ï¼Œmydevæ¨¡å—æ”¯æŒä»¥æ¨¡å—ã€å†…å»ºå’Œä¸ç¼–è¯‘ä¸‰ç§ç¼–è¯‘æ–¹æ³•ï¼Œé»˜è®¤æ˜¯ä¸ç¼–è¯‘ï¼Œå› æ­¤ï¼Œåœ¨ç¼–è¯‘å†…æ ¸å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‰§è¡Œmake menuconfigå‘½ä»¤æ¥é…ç½®ç¼–è¯‘é€‰é¡¹ï¼Œä½¿å¾—mydevå¯ä»¥ä»¥æ¨¡å—æˆ–è€…å†…å»ºçš„æ–¹æ³•è¿›è¡Œç¼–è¯‘ã€‚åœ¨Makefileæ–‡ä»¶ä¸­ï¼Œæ ¹æ®é€‰é¡¹MYDEVçš„å€¼ï¼Œæ‰§è¡Œä¸åŒçš„ç¼–è¯‘æ–¹æ³•ã€‚ Kconfigæ–‡ä»¶çš„å†…å®¹(é»˜è®¤çš„ç¼–è¯‘æ–¹å¼ä¸ºnï¼Œå³ä¸ç¼–è¯‘åˆ°å†…æ ¸ä¸­ï¼Œæ•…åœ¨ç¼–è¯‘é©±åŠ¨ç¨‹åºä¹‹å‰ï¼Œéœ€è¦æ‰§è¡Œmake menuconfigå‘½ä»¤æ¥ä¿®æ”¹ç¼–è¯‘é€‰é¡¹)12345config MYDEV tristate &quot;Fake Register Android Driver&quot; default n help This is the mydev driver for android system. Makefile1obj-$(CONFIG_MYDEV) += mydev.o ä¿®æ”¹å†…æ ¸Kconfigæ–‡ä»¶ æ‰“å¼€arch/arm/Kconfigæ–‡ä»¶ï¼Œæ‰¾åˆ°ä»¥ä¸‹ä¸¤è¡Œå†…å®¹123menu &quot;Device Drivers&quot;......endmenu åœ¨è¿™ä¸¤è¡Œå†…å®¹ä¹‹é—´æ·»åŠ ä¸‹é¢ä¸€è¡Œå†…å®¹ï¼Œå°†é©±åŠ¨ç¨‹åºmydevå’ŒKconfigæ–‡ä»¶åŒ…å«å°½é‡ã€‚1234menu &quot;Device Drivers&quot;source &quot;drivers/mydev/Kconfig&quot;......endmenu è¿™æ ·ï¼Œæ‰§è¡Œmake menuconfigæ—¶ï¼Œå°±å¯ä»¥é…ç½®mydevæ¨¡å—çš„ç¼–è¯‘é€‰é¡¹äº†ã€‚ - æ‰“å¼€drivers/Kconfigï¼Œå’Œarch/arm/Kconfigä¸€æ ·ï¼Œå¢åŠ ä¸€è¡Œå†…å®¹ï¼šsource &quot;drivers/mydev/Kconfig&quot; ä¿®æ”¹drivers/Makefileæ–‡ä»¶ï¼Œæ·»åŠ ä¸€è¡Œï¼š 1obj-$(CONFIG_MYDEV) += mydev/ é…ç½®ç¼–è¯‘é€‰é¡¹ï¼š ~/Android/kernel/goldfish$ make menuconfigæ‰¾åˆ°â€Device Driversâ€ =&gt; â€œFake Register Android Driversâ€é€‰é¡¹ï¼Œè®¾ç½®ä¸ºyã€‚ æ³¨æ„ï¼Œå¦‚æœå†…æ ¸ä¸æ”¯æŒåŠ¨æ€åŠ è½½æ¨¡å—ï¼Œè¿™é‡Œä¸èƒ½é€‰æ‹©mï¼Œè™½ç„¶æˆ‘ä»¬åœ¨Kconfigæ–‡ä»¶ä¸­é…ç½®äº†MYDEVé€‰é¡¹ä¸ºtristateã€‚è¦æ”¯æŒåŠ¨æ€åŠ è½½æ¨¡å—é€‰é¡¹ï¼Œå¿…é¡»è¦åœ¨é…ç½®èœå•ä¸­é€‰æ‹©Enable loadable module supporté€‰é¡¹ï¼›åœ¨æ”¯æŒåŠ¨æ€å¸è½½æ¨¡å—é€‰é¡¹ï¼Œå¿…é¡»è¦åœ¨Enable loadable module supportèœå•é¡¹ä¸­ï¼Œé€‰æ‹©Module unloadingé€‰é¡¹ã€‚ ç¼–è¯‘ï¼š ~/Android/kernel/goldfish$ makeç¼–è¯‘æˆåŠŸåï¼Œå°±å¯ä»¥åœ¨mydevç›®å½•ä¸‹çœ‹åˆ°mydev.oæ–‡ä»¶äº†ï¼Œè¿™æ—¶å€™ç¼–è¯‘å‡ºæ¥çš„zImageå·²ç»åŒ…å«äº†mydevé©±åŠ¨ã€‚ è¿è¡Œæ–°ç¼–è¯‘çš„å†…æ ¸æ–‡ä»¶ï¼ŒéªŒè¯mydevé©±åŠ¨ç¨‹åºæ˜¯å¦å·²ç»æ­£å¸¸å®‰è£… ~/Android$ emulator -kernel ./kernel/goldfish/arch/arm/boot/zImage &amp; ~/Android$ adb shell è¿›å…¥åˆ°devç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°mydevè®¾å¤‡æ–‡ä»¶ root@android:/ # cd dev root@android:/dev # ls è¿›å…¥åˆ°procç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°mydevæ–‡ä»¶ï¼š root@android:/ # cd proc root@android:/proc # ls è®¿é—®mydevæ–‡ä»¶çš„å€¼ root@android:/proc # cat mydev0 root@android:/proc # echo â€˜5â€™ &gt; mydev root@android:/proc # cat mydev5 è¿›å…¥åˆ°sys/classç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°mydevç›®å½•ï¼š root@android:/ # cd sys/class root@android:/sys/class # ls è¿›å…¥åˆ°mydevç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°mydevç›®å½•ï¼š root@android:/sys/class # cd mydev root@android:/sys/class/mydev # ls è¿›å…¥åˆ°ä¸‹ä¸€å±‚mydevç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°valæ–‡ä»¶ root@android:/sys/class/mydev # cd mydev root@android:/sys/class/mydev/mydev # ls è®¿é—®å±æ€§æ–‡ä»¶valçš„å€¼ root@android:/sys/class/mydev/mydev # cat val5 root@android:/sys/class/mydev/mydev # echo â€˜0â€™ &gt; val root@android:/sys/class/mydev/mydev # cat val0 è‡³æ­¤ï¼Œmydevå†…æ ¸é©±åŠ¨ç¨‹åºå°±å®Œæˆäº†ã€‚è¿™é‡Œé‡‡ç”¨çš„æ˜¯ç³»ç»Ÿæä¾›çš„æ–¹æ³•å’Œé©±åŠ¨ç¨‹åºè¿›è¡Œäº¤äº’ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡procæ–‡ä»¶ç³»ç»Ÿå’Œdevfsæ–‡ä»¶ç³»ç»Ÿçš„æ–¹æ³•ã€‚","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Android","slug":"Android","permalink":"https://eightplus.github.io/tags/Android/"}]},{"title":"Hexo","slug":"2018-07-10-hexo","date":"2018-07-10T08:25:16.000Z","updated":"2018-07-31T09:54:19.214Z","comments":true,"path":"2018/07/10/2018-07-10-hexo/","link":"","permalink":"https://eightplus.github.io/2018/07/10/2018-07-10-hexo/","excerpt":"","text":"hexoæ˜¯ä¸€æ¬¾åŸºäºNode.jsçš„é™æ€åšå®¢æ¡†æ¶ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆé™æ€ç½‘é¡µæ‰˜ç®¡åœ¨githubä¸Šã€‚ ä¾èµ–åŒ…å’Œå·¥å…·å®‰è£… Git sudo apt-get install git (git-core) git --version ç”Ÿæˆ SSH key : ssh-keygen -t rsa -C &quot;349098792@qq.com&quot; é»˜è®¤æƒ…å†µä¸‹è¿ç»­æŒ‰ä¸‹ä¸‰ä¸ªå›è½¦ï¼Œç”Ÿæˆå¯†é’¥ï¼Œæœ€åå¾—åˆ°äº†ä¸¤ä¸ªæ–‡ä»¶ï¼šid_rsaå’Œid_rsa.pubã€‚å¦‚æœæ˜¯æƒ³ä¸€å°ç”µè„‘é…ç½®ä¸¤ä¸ªæˆ–å¤šä¸ªgithubå¸å·ï¼Œåˆ™æ­¤å¤„ä¸èƒ½å¤Ÿä¸€ç›´å›è½¦ï¼Œè¦æ³¨æ„åœ¨æç¤ºè¾“å…¥æ–‡ä»¶åç§°æ—¶è¾“å…¥ä¸€ä¸ªå’Œé»˜è®¤åç§°ä¸ä¸€æ ·çš„åç§°ï¼Œå¦åˆ™ä¼šå‘ç”Ÿè¦†ç›–ï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘ç”µè„‘ä¸Šä½¿ç”¨ä¸¤ä¸ªgithubå¸å·ï¼Œæ–°å»ºçš„ä¸€ä¸ªåä¸ºyudianrï¼Œåˆ™å¯ä»¥ç»™æ–‡ä»¶å–åå«id_rsa_yudianrï¼Œåˆ™ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆid_rsa_yudianrå’Œid_rsa_yudianr.pubä¸¤ä¸ªæ–‡ä»¶ã€‚åœ¨GitHubå¸å·è®¾ç½®é‚£é‡Œæ·»åŠ SSH Keyï¼Œæ‰“å¼€å…¬é’¥æ–‡ä»¶id_rsa_yudianr.pubï¼Œå¤åˆ¶é‡Œé¢çš„æ‰€æœ‰å­—ç¬¦ç²˜è´´åˆ°githubçš„SSHè®¾ç½®å¤„ï¼Œå¯ä½¿ç”¨ssh -T git@github.comæ¥æµ‹è¯•æ˜¯å¦å…³è”æˆåŠŸã€‚ - é…ç½®~/.ssh/configæ–‡ä»¶ 123456789101112131415161718192021222324 #è€å¸å· Host github.com HostName github.com PreferredAuthentications publickey IdentityFile ~/.ssh/id_rsa #æ–°å¸å· Host yudianr.github.com HostName github.com PreferredAuthentications publickey IdentityFile ~/.ssh/id_rsa_yudianræ³¨æ„ï¼šæ­¤æ—¶æäº¤ä»£ç ålogä¸­è®°å½•çš„ç”¨æˆ·åå’Œé‚®ç®±ä¿¡æ¯éƒ½ä¸ºå…¨å±€é…ç½®çš„gitå¸å·çš„ä¿¡æ¯ï¼Œå¦‚æœå¸Œæœ›ä¿®æ”¹æ˜¾ç¤ºçš„ä¿¡æ¯ï¼Œå¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œé…ç½®ï¼šgit config --global user.name &quot;ä½ çš„æ˜µç§°&quot;git config --global user.email &quot;ä½ çš„é‚®ç®±åœ°å€&quot;æˆ–è€…vim .gitconfigç›´æ¥è¿›è¡Œä¿®æ”¹[user] name = eightplus email = kobe24_lixiang@126.comæˆ–è€…[user] name = yudianr email = 349098792@qq.com npm sudo apt-get install npm npm -v Nodejs sudo apt-get install nodejs node -v Hexo sudo npm install -g hexo-cli hexo -v åˆå§‹åŒ–Hexo123hexo init &lt;folder&gt;cd &lt;folder&gt;npm install è‡ªåŠ¨éƒ¨ç½²å‘å¸ƒå·¥å…· hexo-deployer-git npm i hexo-generator-json-content â€“save (åœ¨ä¸Šé¢åˆå§‹åŒ–åçš„folderç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯æ‰§è¡Œï¼Œæ‰§è¡Œåä¼šå†™å…¥package.jsonæ–‡ä»¶ä¸­) å…¶ä»–æ’ä»¶å®‰è£… 123456npm i hexo-helper-qrcode --savenpm i hexo-generator-sitemap --savenpm i hexo-generator-json-feed --savenpm i hexo-generator-feed --savenpm i hexo-generator-baidu-sitemap --savenpm i hexo-deployer-rsync --save æäº¤æœç´ å¼•æ“ ç«™ç‚¹åœ°å›¾æ˜¯ä¸€ç§æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶åˆ—å‡ºæ‚¨ç½‘ç«™ä¸Šçš„ç½‘é¡µï¼Œä»è€Œå°†æ‚¨ç½‘ç«™å†…å®¹çš„ç»„ç»‡æ¶æ„å‘ŠçŸ¥Googleå’Œå…¶ä»–æœç´¢å¼•æ“ã€‚Googlebotç­‰æœç´¢å¼•æ“ç½‘é¡µæŠ“å–å·¥å…·ä¼šè¯»å–æ­¤æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´åŠ æ™ºèƒ½åœ°æŠ“å–æ‚¨çš„ç½‘ç«™ã€‚ç™¾åº¦ç«™é•¿å¹³å°ä¸ºæœªä½¿ç”¨ç™¾åº¦ç»Ÿè®¡çš„ç«™ç‚¹æä¾›ä¸‰ç§éªŒè¯æ–¹å¼ï¼šæ–‡ä»¶éªŒè¯ã€htmlæ ‡ç­¾éªŒè¯ã€CNAMEéªŒè¯ï¼Œå¦‚æœé€‰æ‹©æ–‡ä»¶éªŒè¯ï¼Œä¸‹è½½æ–‡ä»¶åå°†æ–‡ä»¶æ”¾åœ¨sourceè·Ÿç›®å½•ä¸‹ã€‚éªŒè¯å®Œæˆåï¼Œæˆ‘ä»¬å°†ä¼šè®¤ä¸ºæ‚¨æ˜¯ç½‘ç«™çš„æ‹¥æœ‰è€…ã€‚ä¸ºä½¿æ‚¨çš„ç½‘ç«™ä¸€ç›´ä¿æŒéªŒè¯é€šè¿‡çš„çŠ¶æ€ï¼Œè¯·ä¿ç•™éªŒè¯çš„æ–‡ä»¶ã€htmlæ ‡ç­¾æˆ–CNAMEè®°å½•ï¼Œæˆ‘ä»¬ä¼šå»å®šæœŸæ£€æŸ¥éªŒè¯è®°å½•ã€‚ å¯¹è°·æ­Œå’Œç™¾åº¦çš„æ’ä¸¾ä¾‹-&gt;æ‰“å¼€åšå®¢æ ¹ç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯æ‰§è¡Œæ‰§è¡Œå¦‚ä¸‹ä¸¤ä¸ªå®‰è£…æ’ä»¶ï¼šnpm install hexo-generator-sitemap --savenpm install hexo-generator-baidu-sitemap --save åœ¨åšå®¢æ ¹ç›®å½•çš„_config.ymlä¸­æ·»åŠ å¦‚ä¸‹ä»£ç  12345# è‡ªåŠ¨ç”Ÿæˆsitemapsitemap: path: sitemap.xmlbaidusitemap: path: baidusitemap.xml æ‰§è¡Œhexo generateç¼–è¯‘åšå®¢åï¼Œå¦‚æœåšå®¢æ ¹ç›®å½•çš„publicä¸‹ç”Ÿæˆäº†sitemap.xmlä»¥åŠbaidusitemap.xmlå°±è¡¨ç¤ºæˆåŠŸäº†ã€‚ ç”Ÿæˆé™æ€æ–‡ä»¶ hexo generate ç”Ÿæˆé™æ€æ–‡ä»¶æŸ¥çœ‹é»˜è®¤åšå®¢æ•ˆæœ hexo server ï¼ˆå¦‚æœé»˜è®¤çš„4000ç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ä½¿ç”¨-på‚æ•°æŒ‡å®šå…¶ä»–ç«¯å£ï¼Œå¦‚ï¼šhexo server -p 5000ï¼‰ ä¿®æ”¹é…ç½® åœ¨ç«™ç‚¹çš„é…ç½®æ–‡ä»¶_config.ymlä¸­è®¾ç½®éƒ¨ç½²ä¿¡æ¯(æ³¨æ„ï¼štype repo branch messageå‰æœ‰ä¸¤ä¸ªç©ºæ ¼)12345deploy: type: git repo: https://github.com/eightplus/eightplus.github.io.git branch: master message: &apos;ç«™ç‚¹æ›´æ–°:&#123;&#123;now(&quot;YYYY-MM-DD HH:mm:ss&quot;)&#125;&#125;&apos; éƒ¨ç½²åˆ°GitHubä¸Š12345hexo clean #æ¸…ç©ºhexo generate #ç”Ÿæˆé™æ€ç½‘é¡µhexo deploy #éƒ¨ç½²æµè§ˆå™¨ä¸­è¾“å…¥ http://eightplus.github.io ç»‘å®šåŸŸå åœ¨hexoçš„å·¥ä½œç©ºé—´ä¸‹çš„sourceç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªCNAMEçš„æ–‡ä»¶ï¼Œä¸è¦åç¼€ã€‚æ‰“å¼€CNAMEå†™ä¸Šè´­ä¹°çš„åŸŸåï¼Œå¦‚ï¼š eightplus.info æ‰©å±• ç½‘ç«™è®¿é—®é‡æ˜¾ç¤º ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç»Ÿè®¡æ’ä»¶ä¸è’œå­, åœ¨themes\\yilia\\layout_partialä¸‹çš„footer.ejsä¸­åŠ å…¥å¦‚ä¸‹ä»£ç å³å¯12345678&lt;script async src=&quot;//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js&quot;&gt;&lt;/script&gt;&lt;span id=&quot;busuanzi_container_site_pv&quot;&gt; æœ¬ç«™æ€»è®¿é—®é‡&lt;span id=&quot;busuanzi_value_site_pv&quot;&gt;&lt;/span&gt;æ¬¡&lt;/span&gt;&lt;span id=&quot;busuanzi_container_site_uv&quot;&gt;æ€»è®¿å®¢æ•°&lt;span id=&quot;busuanzi_value_site_uv&quot;&gt;&lt;/span&gt;äººæ¬¡&lt;/span&gt; å®ç°å•ç¯‡æ–‡ç« æµè§ˆç»Ÿè®¡å’Œè¯„è®ºç»Ÿè®¡(ä»ç½‘æ˜“äº‘è·Ÿå¸–ä¸­è·å–è¯„è®ºæ•°) å‚è€ƒæ–‡æ¡£ ä¿®æ”¹themes\\yilia\\layout_partialæ–‡ä»¶å¤¹ä¸‹çš„article.ejsæ–‡ä»¶ï¼Œåœ¨&lt;%- partial(â€˜post/titleâ€™, {class_name: â€˜article-titleâ€™}) %&gt;èŠ‚ç‚¹ä¸‹åŠ å…¥(æ³¨æ„è¿™é‡Œç½‘æ˜“äº‘è·Ÿå¸–è¿˜æ²¡è®¾ç½®ï¼Œè€Œè¯„è®ºæ•°ä¸­ä½¿ç”¨åˆ°äº†ï¼Œè¿™é‡Œè¿è¡Œä¼šæœ‰é—®é¢˜)æ˜¾ç¤ºé˜…è¯»å’Œè¯„è®ºæ•° -->1234567891011121314&lt;% if (!index &amp;&amp; post.comments &amp;&amp; config.wangYi)&#123; %&gt;&lt;br/&gt;&lt;a class=&quot;cloud-tie-join-count&quot; href=&quot;javascript:void(0);&quot; style=&quot;color:gray;font-size:14px;&quot;&gt;&lt;span class=&quot;icon-sort&quot;&gt;&lt;/span&gt;&lt;span id=&quot;busuanzi_container_page_pv&quot; style=&quot;color:#ef7522;font-size:14px;&quot;&gt; é˜…è¯»æ•°: &lt;span id=&quot;busuanzi_value_page_pv&quot;&gt;&lt;/span&gt;æ¬¡ &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/a&gt;&lt;a class=&quot;cloud-tie-join-count&quot; href=&quot;javascript:void(0);&quot; style=&quot;color:#ef7522;font-size:14px;&quot;&gt; &lt;span class=&quot;icon-comment&quot;&gt;&lt;/span&gt; &lt;span class=&quot;join-text&quot; style=&quot;color:#ef7522;font-size:14px;&quot;&gt;è¯„è®ºæ•°:&lt;/span&gt; &lt;span class=&quot;join-count&quot;&gt;0&lt;/span&gt;æ¬¡&lt;/a&gt;&lt;% &#125; %&gt;","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://eightplus.github.io/tags/Hexo/"}]},{"title":"Ubuntuä¸‹Androidå¼€å‘çš„åŸºç¡€çŸ¥è¯†","slug":"2018-07-03-build-android","date":"2018-07-03T03:01:16.000Z","updated":"2018-08-02T01:00:02.033Z","comments":true,"path":"2018/07/03/2018-07-03-build-android/","link":"","permalink":"https://eightplus.github.io/2018/07/03/2018-07-03-build-android/","excerpt":"","text":"è¿™é‡Œä½¿ç”¨Ubuntu 16.04çš„64ä½ç³»ç»Ÿä¸Šè¿›è¡ŒAndroidæºç çš„ç¼–è¯‘ã€‚ ä¸€ã€ç¯å¢ƒå‡†å¤‡ å®‰è£…ubuntu 16.04 amd64 ç³»ç»Ÿ å®‰è£…Git ~$ sudo apt-get install git-core gnupg å®‰è£…Java SDK(å®˜æ–¹JDKä¸‹è½½åœ°å€ï¼šhttp://www.oracle.com/technetwork/java/javase/downloads/index.html)ï¼š $ sudo add-apt-repository â€œdeb http://us.archive.ubuntu.com/ubuntu/ hardy multiverseâ€ $ sudo apt-get update $ sudo apt-get install sun-java6-jre sun-java6-plugin $ sudo apt-get install sun-java6-jdk å®‰è£…å…¶ä»–ä¾èµ–åŒ…(valgrindä¸ºè°ƒè¯•å·¥å…·) $ sudo apt-get install flex bison gperf libsdl-dev libesd0-dev libwxgtk2.6-dev build-essential zip curl valgrind äºŒã€ä¸‹è½½Androidæºç  ä¸‹è½½repoå·¥å…· $ wget https://dl-ssl.google.com/dl/googlesource/git-repo/repo $ chmod a+x repo $ sudo mv repo /bin/ ä¸‹è½½Androidæºç  $ mkdir Android $ cd Android Android$ repo init -u https://android.googlesource.com/platform/mainifest(å¦‚æœæƒ³ä¸‹è½½Android 2.3.1ï¼Œæ‰§è¡Œï¼šrepo init -u https://android.googlesource.com/platform/mainifest -b android-2.3.1_r1) Android$ repo sync ä¸‰ã€ç¼–è¯‘Androidæºç  Android$make (make -j18)ç¼–è¯‘ç»“æœçš„è¾“å‡ºç›®å½•ä¸ºout/target/product/$(TARGET_PRODUCT),TARGET_PRODUCTæ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œé»˜è®¤å€¼ä¸ºgeneric å››ã€ç¼–è¯‘SDK(å¯é€‰) Android$make sdkæ‰“åŒ…æˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡º($USER$è¡¨ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·å)ï¼š1Package SDK: out/host/linux-x86/sdk/android-sdk_eng.$USER$_linux-x86.zip äº”ã€å®‰è£…ç¼–è¯‘å¥½çš„Androidé•œåƒåˆ°æ¨¡æ‹Ÿå™¨ä¸Š è®¾ç½®ç¯å¢ƒå˜é‡(Androidæ¨¡æ‹Ÿå™¨å‘½ä»¤emulatorä½äºAndroid/out/host/linux-x86/binä¸­ï¼Œ~/Android/out/target/product/genericæ˜¯Androidé•œåƒå­˜æ”¾ç›®å½•) Android$export PATH=$PATH:~/Android/out/host/linux-x86/bin Android$export ANDROID_PRODUCT_OUT=~/Android/out/target/product/generic è¿è¡ŒAndroidæ¨¡æ‹Ÿå™¨ Android$emulator å¯åŠ¨Androidæ¨¡æ‹Ÿå™¨éœ€è¦å››ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºzImageã€system.imgã€userdata.imgå’Œramdisk.imgï¼Œå…¶ä¸­zImageä¸ºLinuxå†…æ ¸é•œåƒæ–‡ä»¶ï¼Œä¸‰ä¸ª.imgæ–‡ä»¶ä¸ºAndroidç³»ç»Ÿé•œåƒæ–‡ä»¶ã€‚å¦‚æœä¸å¸¦ä»»ä½•å‚æ•°æ¥è¿è¡Œemulatorå‘½ä»¤ï¼Œåˆ™Androidæ¨¡æ‹Ÿå™¨é»˜è®¤ä½¿ç”¨çš„zImageæ–‡ä»¶æ˜¯Android/out/host/linux-x86/binä¸­çš„kernel-qemuæ–‡ä»¶ï¼Œé»˜è®¤ä½¿ç”¨çš„ä¸‰ä¸ª.imgæ–‡ä»¶ä½äºANDROID_PRODUCT_OUTç›®å½•ä¸­ã€‚ANDROID_PRODUCT_OUTæ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œå°†å®ƒçš„å€¼è®¾ç½®ä¸ºAndroidæºç ç¼–è¯‘ç»“æœçš„è¾“å‡ºç›®å½•ï¼Œå¦‚æœä¸è®¾ç½®ANDROID_PRODUCT_OUTç¯å¢ƒå˜é‡ï¼Œå°±éœ€è¦æŒ‡å®šä¸Šè¿°å››ä¸ªæ–‡ä»¶æ¥å¯åŠ¨Androidæ¨¡æ‹Ÿå™¨ï¼Œå¦‚ä¸‹ï¼š Android$emulator - kernel ./prebuilt/android-arm/kernel/kernel-qemu -sysdir ./out/target/product/generic -system system.img -data userdata.img -ramdisk ramdisk.img å…­ã€ä¸‹è½½ã€ç¼–è¯‘å’Œå®‰è£…Androidæœ€æ–°å†…æ ¸æºä»£ç Androidæºä»£ç å·¥ç¨‹é»˜è®¤æ˜¯ä¸åŒ…æ‹¬å®ƒæ‰€ä½¿ç”¨çš„Linuxå†…æ ¸æºä»£ç çš„ï¼Œè€Œæ˜¯ä½¿ç”¨é¢„å…ˆç¼–è¯‘å¥½çš„å†…æ ¸ï¼Œå³prebuilt/android-arm/kernel/kernel-qemuæ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦è¿è¡Œå®šåˆ¶çš„Linuxå†…æ ¸ï¼Œåˆ™éœ€è¦ä¸‹è½½Linux kernelæºä»£ç è¿›è¡Œç¼–è¯‘ã€‚ Linux kernelæºä»£ç ä¸‹è½½ ~/Android$ mkdir kernel ~/Android$ cd kernel ~/Android/kernel$ git clone http://android.googlesource.com/kernel/goldfish.git æ”¯çº¿ä¸‹è½½ä¸‹è½½å®Œæˆåï¼Œåœ¨kernelç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç©ºçš„goldfishå­ç›®å½•ï¼Œæ­¤æ—¶éœ€è¦æ‰§è¡Œgit checkoutæ¥æŒ‡å®šéœ€è¦çš„æ”¯çº¿ä»£ç ï¼Œåœ¨æ‰§è¡Œgit checkoutä¹‹å‰ï¼Œå¯å…ˆæ‰§è¡Œgit branch -aæŸ¥çœ‹æœ‰å“ªäº›æ”¯çº¿ä»£ç ã€‚è¿™é‡Œé€‰æ‹©android-gldfish-2.6.29 ~/Android/kernel/goldfish$git branch -a ~/Android/kernel/goldfish$git checkout remotes/origin/archive/android-gldfish-2.6.29 ä¿®æ”¹Androidå†…æ ¸æºç ç›®å½•ä¸‹Makefileæ–‡ä»¶ä¸­çš„CROSS_COMPILEå˜é‡ 1234#ARCH ?= (SUBARCH)#CROSS_COMPILE ?=ARCH ?= arm #ä½“ç³»ç»“æ„ä¸ºarmCROSS_COMPILE ?= arm-eabi- #äº¤å‰ç¼–è¯‘å·¥å…·é“¾å‰ç¼€ å°†äº¤å‰ç¼–è¯‘å·¥å…·ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡PATHä¸­ ~/Android/kernel/goldfish$ export PATH=$PATH:~/Android/prebuilt/linux-x86/toolchain/arm-eabi-4.4.3/bin ä¿®æ”¹ç¡¬ä»¶é…ç½®æ–‡ä»¶goldfish_defconfig ~/Android/kernel/goldfish$ make goldfish_defconfig å¼€å§‹ç¼–è¯‘(åœ¨makeä¹‹å‰ï¼Œå¯ä»¥æ‰§è¡Œmake menuconfigå…ˆé…ç½®ä¸€ä¸‹ç¼–è¯‘é€‰é¡¹) ~/Android/kernel/goldfish$ makeç¼–è¯‘æˆåŠŸåï¼Œå¯çœ‹åˆ°ä¸‹é¢ä¸¤è¡Œï¼š12OBJCOPY arch/arm/boot/zImageKernel: arch/arm/boot/zImage is ready ä¸ƒã€åœ¨æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œç¼–è¯‘å¥½çš„å†…æ ¸ åœ¨å¯åŠ¨æ¨¡æ‹Ÿå™¨ä¹‹å‰ï¼Œå…ˆè®¾ç½®æ¨¡æ‹Ÿå™¨çš„ç›®å½•åˆ°ç¯å¢ƒå˜é‡$PATHä¸­å» ~/Android$export PATH=$PATH:~/Android/out/host/linux-x86/bin è®¾ç½®ANDROID_PRODUCT_OUTç¯å¢ƒå˜é‡ ~/Android$export ANDROID_PRODUCT_OUT=~/Android/out/target/product/generic åœ¨åå°ä¸­æŒ‡å®šå†…æ ¸æ–‡ä»¶å¯åŠ¨æ¨¡æ‹Ÿå™¨ ~/Android$emulator -kernel ./kernel/goldfish/arch/arm/boot/zImage &amp; ç”¨adbå·¥å…·è¿æ¥æ¨¡æ‹Ÿå™¨ï¼ŒæŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯ï¼Œçœ‹çœ‹æ¨¡æ‹Ÿå™¨ä¸Šè·‘çš„å†…æ ¸æ˜¯ä¸æ˜¯åˆšæ‰ç¼–è¯‘å‡ºæ¥çš„å†…æ ¸(adbä½äº~/Android/out/host/linux-x86/binç›®å½•ä¸­)123~/Android$ adb shellroot@android:/ # cd procroot@android:/proc # cat version å…«ã€å•ç‹¬ç¼–è¯‘Androidæºä»£ç ä¸­çš„æ¨¡å—Androidæºç ç¬¬ä¸€æ¬¡æ‰§è¡Œmakeä¼šè€—æ—¶å¾ˆä¹…ï¼Œä¹‹åå¦‚æœä¿®æ”¹äº†Androidæºç ä¸­çš„æŸä¸ªæ¨¡å—æˆ–è€…åœ¨Androidæºç å·¥ç¨‹æ–°å¢ä¸€ä¸ªè‡ªå·±çš„æ¨¡å—ï¼Œåˆ™å¯ä»¥å•ç‹¬ç¼–è¯‘è¯¥æ¨¡å—ï¼Œä»¥åŠé‡æ–°æ‰“åŒ…system.imgã€‚ åœ¨Androidæºç ç›®å½•ä¸‹çš„buildç›®å½•ä¸‹ï¼Œæœ‰ä¸ªè„šæœ¬æ–‡ä»¶envsetup.shï¼Œæ‰§è¡Œè¿™ä¸ªè„šæœ¬æ–‡ä»¶å¯ä»¥è·å¾—ä¸€äº›æœ‰ç”¨çš„å·¥å…·ï¼Œå…¶ä¸­å°±åŒ…æ‹¬mmmï¼Œè¯¥å‘½ä»¤ç”¨æ¥ç¼–è¯‘æŒ‡å®šç›®å½•çš„æ‰€æœ‰æ¨¡å—ï¼Œé€šå¸¸è¿™ä¸ªç›®å½•åªåŒ…å«ä¸€ä¸ªæ¨¡å—ã€‚ ä½¿ç”¨mmmå‘½ä»¤æ¥ç¼–è¯‘æŒ‡å®šçš„æ¨¡å—ï¼Œå¦‚Emailåº”ç”¨ç¨‹åº ~/Android$mmm packages/apps/Email/ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°±å¯ä»¥åœ¨out/target/product/generic/system/appç›®å½•ä¸‹çœ‹åˆ°Email.apkæ–‡ä»¶äº†ã€‚Androidç³»ç»Ÿè‡ªå¸¦çš„Appéƒ½æ”¾åœ¨è¿™å…·ç›®å½•ä¸‹ã€‚å¦å¤–ï¼ŒAndroidç³»ç»Ÿçš„ä¸€äº›å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚Cç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¾åœ¨out/target/product/generic/system/binç›®å½•ä¸‹ï¼ŒåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶æ”¾åœ¨out/target/product/generic/system/libç›®å½•ä¸‹ï¼Œout/target/product/generic/system/lib/hwç›®å½•å­˜æ”¾çš„æ˜¯ç¡¬ä»¶æŠ½è±¡å±‚ï¼ˆHALï¼‰æ¥å£æ–‡ä»¶. ç¼–è¯‘å¥½æ¨¡å—åï¼Œé‡æ–°æ‰“åŒ…system.imgæ–‡ä»¶ ~/Android$make snod è¿è¡Œæ¨¡æ‹Ÿå™¨ï¼š ~/Android$emulator ä¹ã€æ—¥å¿—ç³»ç»ŸAndroidç³»ç»Ÿåœ¨ç”¨æˆ·ç©ºé—´ä¸­æä¾›äº†è½»é‡çº§çš„loggeræ—¥å¿—ç³»ç»Ÿï¼Œå®ƒæ˜¯åœ¨å†…æ ¸ä¸­å®ç°çš„ä¸€ç§è®¾å¤‡é©±åŠ¨ï¼Œä¸ç”¨æˆ·ç©ºé—´çš„logcatå·¥å…·é…åˆä½¿ç”¨èƒ½å¤Ÿæ–¹ä¾¿åœ°è·Ÿè¸ªè°ƒè¯•ç¨‹åºã€‚åœ¨Androidç³»ç»Ÿä¸­ï¼Œåˆ†åˆ«ä¸ºC/C++ å’ŒJavaè¯­è¨€æä¾›ä¸¤ç§ä¸åŒçš„loggerè®¿é—®æ¥å£ã€‚C/C++æ—¥å¿—æ¥å£ä¸€èˆ¬æ˜¯åœ¨ç¼–å†™ç¡¬ä»¶æŠ½è±¡å±‚æ¨¡å—æˆ–è€…ç¼–å†™JNIæ–¹æ³•æ—¶ä½¿ç”¨ï¼Œè€ŒJavaæ¥å£ä¸€èˆ¬æ˜¯åœ¨åº”ç”¨å±‚ç¼–å†™APPæ—¶ä½¿ç”¨ã€‚ Androidç³»ç»Ÿä¸­çš„C/C++æ—¥å¿—æ¥å£æ˜¯é€šè¿‡å®æ¥ä½¿ç”¨çš„ã€‚åœ¨system/core/include/android/log.hå®šä¹‰äº†æ—¥å¿—çš„çº§åˆ«, åœ¨system/core/include/cutils/log.hä¸­ï¼Œå®šä¹‰äº†å¯¹åº”çš„å®ï¼Œå¦‚å¯¹åº”äºANDROID_LOG_VERBOSEçš„å®LOGVã€‚å¦‚æœä½¿ç”¨C/C++æ—¥å¿—æ¥å£ï¼Œåªè¦å®šä¹‰è‡ªå·±çš„LOG_TAGå®å’ŒåŒ…å«å¤´æ–‡ä»¶system/core/include/cutils/log.hå°±å¯ä»¥äº†ã€‚12#define LOG_TAG &quot;MY LOG TAG&quot;#include &lt;cutils/log.h&gt; å°±å¯ä»¥äº†ï¼Œä¾‹å¦‚ä½¿ç”¨LOGVï¼šLOGV(â€œThis is the log printed by LOGV in android user space.â€);//ALOGI Androidç³»ç»Ÿåœ¨Frameworkså±‚ä¸­å®šä¹‰äº†Javaæ—¥å¿—æ¥å£ï¼ˆframeworks/base/core/java/android/util/Log.javaï¼‰å¦‚æœä½¿ç”¨Javaæ—¥å¿—æ¥å£ï¼Œåªè¦åœ¨ç±»ä¸­å®šä¹‰çš„LOG_TAGå¸¸é‡å’Œå¼•ç”¨android.util.Logå°±å¯ä»¥äº†ã€‚12private static final String LOG_TAG = &quot;MY_LOG_TAG&quot;;Log.i(LOG_TAG, &quot;This is the log printed by Log.i in android user space.&quot;); è¦æŸ¥çœ‹è¿™äº›LOGçš„è¾“å‡ºï¼Œå¯ä»¥é…åˆlogcatå·¥å…· å¦‚æœæ˜¯åœ¨è‡ªå·±ç¼–è¯‘çš„Androidæºä»£ç å·¥ç¨‹ä¸­ä½¿ç”¨ï¼Œåˆ™åœ¨åå°ä¸­è¿è¡Œæ¨¡æ‹Ÿå™¨ ~/Android$ emulator &amp; å¯åŠ¨adb shellå·¥å…· ~/Android$ adb shell ä½¿ç”¨logcatå‘½ä»¤æŸ¥çœ‹æ—¥å¿— root@android:/ # logcat","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Android","slug":"Android","permalink":"https://eightplus.github.io/tags/Android/"}]},{"title":"ubuntu snap åº”ç”¨","slug":"2018-06-29-snap-qt-dbus","date":"2018-06-29T02:58:12.000Z","updated":"2018-07-31T09:54:47.030Z","comments":true,"path":"2018/06/29/2018-06-29-snap-qt-dbus/","link":"","permalink":"https://eightplus.github.io/2018/06/29/2018-06-29-snap-qt-dbus/","excerpt":"","text":"Ubuntu ä» 16.04å¼€å§‹ï¼Œæ”¯æŒä¸¤ç§æ ¼å¼çš„å®‰è£…åŒ…ï¼šdebian å’Œ snapï¼Œå…¶ä¸­ snap ä¸ä¾èµ–äºæ“ä½œç³»ç»ŸåŠå…¶å‘å¸ƒç‰ˆæœ¬ï¼Œ å…¶å¯ä»¥å®‰è£…åŒæ ·ä¸€ä¸ªè½¯ä»¶çš„ä¸åŒç‰ˆæœ¬ä¸”ä¸é€ æˆä»»ä½•çš„å¹²æ‰°ã€‚snap æ˜¯ä¸€ç§å…¨æ–°çš„è½¯ä»¶åŒ…ç®¡ç†æ–¹å¼ï¼Œå®ƒç±»ä¼¼ä¸€ä¸ªå®¹å™¨æ‹¥æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰€æœ‰çš„æ–‡ä»¶å’Œåº“ï¼Œå„ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œè§£å†³äº†åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¾èµ–é—®é¢˜ï¼Œä½†å› å…¶åŒ…å«åº”ç”¨éœ€è¦çš„æ–‡ä»¶å’Œåº“ï¼Œå¯¼è‡´snapåŒ…è¿‡å¤§ï¼Œå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ï¼ˆsnapåŒ…åŒ…å«ä¸€ä¸ªç§æœ‰çš„rootæ–‡ä»¶ç³»ç»Ÿï¼Œé‡Œé¢åŒ…å«äº†ä¾èµ–çš„è½¯ä»¶åŒ…ï¼‰ã€‚ Snapå‘½ä»¤ç®€ä»‹ å®‰è£…Snapçš„ç›¸å…³åŒ… sudo apt update sudo apt-get install snapd snapcraft build-essential åœ¨snap storeä¸­æŸ¥æ‰¾snapåŒ… snap find æ˜¾ç¤ºå·²å®‰è£…çš„snapåº”ç”¨åˆ—è¡¨ snap list å®‰è£…ä¸€ä¸ªsnapåŒ… sudo snap install &lt;snap_pkg_name&gt; æ›´æ–°ä¸€ä¸ªsnapåŒ… sudo snap refresh &lt;snap_pkg_name&gt; å°†snapåŒ…è¿˜åŸåˆ°ä»¥å‰å®‰è£…çš„ç‰ˆæœ¬ sudo snap revert &lt;snap_pkg_name&gt; å¸è½½ä¸€ä¸ªsnapåŒ… sudo snap remove &lt;snap_pkg_name&gt; æ‰“é€ Snapåº”ç”¨ æˆ‘è¿™é‡Œé…ç½®çš„system dbusç›¸å…³çš„.serviceå’Œ.confæ–‡ä»¶æ ¹æœ¬åœ¨snapåŒ…ä¸­æ²¡æœ‰èµ·åˆ°ä½œç”¨ï¼ŒdebianåŒ…ä¸­æ˜¯å¯ä»¥çš„ï¼ŒåŸå› æš‚æ—¶æ²¡æ‰¾åˆ°æ¯”è¾ƒå®˜æ–¹çš„ç­”æ¡ˆã€‚æœ€ç»ˆä½¿ç”¨plugå’Œslotçš„æ–¹å¼ï¼Œå¹¶ä¸”æ˜¯æ‰‹åŠ¨å¯åŠ¨system dbusçš„æ–¹æ³•æ‰è®©å›¾å½¢ç¨‹åºä»dbus daemonè·å–åˆ°æ•°æ®ï¼ˆè²Œä¼¼æ˜¯ç›®å‰snapè¿˜ä¸æ”¯æŒdbusçš„è‡ªåŠ¨å¯åŠ¨ï¼Ÿï¼Ÿï¼Ÿï¼‰ã€‚ 1ã€ç¼–ç ç¼–å†™å®Œæ¯•åï¼Œåœ¨æºç ç¬¬ä¸€çº§ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œï¼š$snapcraft initï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆsnapç›¸å…³æ–‡ä»¶ï¼Œå…¶ä¸­æ¨¡æ¿æ–‡ä»¶snapcraft.yamlå°†æè¿°snapåŒ…çš„æ•´ä¸ªæ„å»ºè¿‡ç¨‹ 2ã€ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶snapcraft.yamlï¼Œå…·ä½“è§æºç ä¸­çš„å†™æ³• 3ã€ç»ˆç«¯æ‰§è¡Œï¼š$snapcraft ï¼Œç”ŸæˆsnapåŒ… 4ã€å®‰è£…snapåŒ…ï¼š$sudo snap install system-tool_1.0.2_amd64.snap â€“devmode â€“dangerous 5ã€å®‰è£…å®Œæˆåï¼Œç»ˆç«¯è¿è¡Œ $snap interfaces å¯ä»¥æŸ¥çœ‹åˆ°plugå’Œslotã€‚æœ‰èµ„æ–™æ˜¾ç¤ºï¼Œå¦‚æœè¦è®©æˆ‘çš„dbusæœåŠ¡ç¨‹åºå’Œå›¾å½¢ç¨‹åºè¿›è¡Œé€šä¿¡ï¼Œè¿˜éœ€è¦ç»ˆç«¯æ‰§è¡Œï¼š$sudo snap connect system-tool:daemon-plug system-tool:daemon-slot ï¼Œå¯¹åº”çš„disconnectæ“ä½œæ˜¯ï¼š$sudo snap disconnect system-tool:daemon-plug system-tool:daemon-slotã€‚æ­¤å¤„ä¸æ‰§è¡Œä¸Šè¿°æ“ä½œä»å¯ä»¥ï¼Œæœ‰äº›ä¸çŸ¥æ‰€ä¾ç„¶ï¼Ÿï¼Ÿï¼Ÿå¯èƒ½æ˜¯æˆ‘è¿™é‡Œåœ¨snapå®¹å™¨ä¸­å…³äºdbusçš„ä½¿ç”¨æ–¹æ³•æ²¡æ‰¾åˆ°æ­£è§£çš„åŸå› ã€‚ 6ã€æ‰‹åŠ¨å¯åŠ¨dbusæœåŠ¡ï¼Œæ‰“å¼€ç»ˆç«¯æ‰§è¡Œï¼š$sudo system-tool.system-tool-daemon 7ã€å¯åŠ¨å›¾å½¢ç¨‹åºï¼š$system-toolå›¾å½¢ç¨‹åºè¿è¡Œç»“æœå›¾ 8ã€å¦‚æœæƒ³å°†è‡ªå·±å¼€å‘çš„snapå‘å¸ƒåˆ°snapå•†åº—ï¼Œé¦–å…ˆæ³¨å†Œä¸€ä¸ªUbuntu Oneå¸å·ï¼Œæ³¨å†Œåœ°å€ 9ã€æœ‰äº†å¸å·ä¹‹åï¼Œè‡ªç„¶æ˜¯ä¸€æ¡æµæ°´çº¿ç”Ÿäº§æ“ä½œæ­¥éª¤ï¼šç™»å½•-&gt;æ³¨å†Œåº”ç”¨å-&gt;ä¸Šä¼ snapåŒ…-&gt;é€€å‡º snapcraft login snapcraft register system-tool (åªæœ‰ç¬¬ä¸€æ¬¡ä¸Šä¼ è¯¥åº”ç”¨æ—¶æ‰éœ€è¦æ³¨å†Œåº”ç”¨å) snapcraft push system-tool_1.0.2_amd64.snap â€“release beta snapcraft logout 10ã€ä¸Šä¼ åï¼Œä½ å¯ä»¥åœ¨é‚®ç®±ç­‰ç€snapcraftç³»ç»Ÿç»™ä½ å›é‚®ä»¶å•¦ï¼å¾ˆé—æ†¾ï¼Œç”±äºæˆ‘ä½¿ç”¨äº†è‡ªå®šä¹‰çš„plugå’Œslotï¼Œè‡ªåŠ¨å®¡æ ¸å¤±è´¥äº†ï¼Œéœ€è¦äººå·¥å®¡æ ¸ï¼ˆä¹‹å‰éªŒè¯è¿‡æ²¡æœ‰è‡ªå®šä¹‰slotå’Œplugæ—¶ï¼Œä¸Šä¼ å¯ä»¥è‡ªåŠ¨å®¡æ ¸æˆåŠŸï¼‰ã€‚ å‚è€ƒæ–‡æ¡£https://forum.snapcraft.io/t/the-dbus-interface/2038 https://github.com/snapcore/snapd/wiki/Interfaces#dbus https://forum.snapcraft.io/t/how-do-i-connect-a-snap-to-dbus/1533 https://github.com/snapcore/snapd/pull/2592 https://blog.csdn.net/tq08g2z/article/details/78685011 https://www.2cto.com/kf/201607/528337.html https://blog.csdn.net/ubuntutouch/article/details/51886345 https://blog.csdn.net/ubuntutouch/article/details/51953272 https://www.msweet.org/blog/2018-01-23-snaps-and-gui-apps.html https://github.com/ubuntu/snappy-playpen https://code.launchpad.net/~dpm/ubuntu-calendar-app/snap-all-things","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Snap","slug":"Snap","permalink":"https://eightplus.github.io/tags/Snap/"}]},{"title":"ä½¿ç”¨Jekyll + Githubæ­å»ºåšå®¢","slug":"2018-06-27-welcome-to-jekyll","date":"2018-06-27T07:33:17.000Z","updated":"2018-08-02T01:37:44.162Z","comments":true,"path":"2018/06/27/2018-06-27-welcome-to-jekyll/","link":"","permalink":"https://eightplus.github.io/2018/06/27/2018-06-27-welcome-to-jekyll/","excerpt":"","text":"ä¸€ç›´æƒ³æŠŠè‡ªå·±å­¦ä¹ linuxçš„è¿‡ç¨‹è®°å½•ä¸‹æ¥ï¼Œåˆä¸æƒ³æ€»æ˜¯ä¾æ‰˜é‚£äº›ç°æˆçš„åšå®¢ç½‘ç«™ï¼Œåœ¨WordPresså’ŒGithubä¸­ï¼Œæˆ‘é€‰æ‹©äº†Githubï¼ŒåŸå› åªæœ‰ä¸€ä¸ªï¼Œç©·ï¼Œå“ˆå“ˆå“ˆã€‚è¿™é‡Œå…ˆç®€è¦æ¥æ”¶åšå®¢æ­å»ºçš„åˆæœŸå‡†å¤‡å·¥ä½œï¼Markdownç¼–è¾‘å™¨ä½¿ç”¨çš„æ˜¯Atomï¼Œå¿«æ·é”®åˆ—è¡¨å¦‚ä¸‹ï¼š å¿«æ·é”® è§£é‡Š Crtl+Shift+M å¼€å¯Markdownå®æ—¶é¢„è§ˆ Command+Shift+P æ‰“å¼€å‘½ä»¤çª—å£ï¼Œå¯ä»¥è¿è¡Œå„ç§èœå•åŠŸèƒ½ Command + T å¿«é€Ÿå¤šæ–‡ä»¶åˆ‡æ¢ Command + F æ–‡ä»¶å†…æŸ¥æ‰¾å’Œæ›¿æ¢ Command + Shift + F å¤šæ–‡ä»¶æŸ¥æ‰¾å’Œæ›¿æ¢ Command + [ å¯¹é€‰ä¸­å†…å®¹å‘å·¦ç¼©è¿› Command + ] å¯¹é€‰ä¸­å†…å®¹å‘å³ç¼©è¿› Command + \\ æ˜¾ç¤ºæˆ–éšè—ç›®å½•æ ‘ Crtl + m ç›¸åº”æ‹¬å·ä¹‹é—´ï¼Œhtml tagä¹‹é—´ç­‰è·³è½¬ Crtl + Alt + B æ ¼å¼åŒ–ä»£ç ï¼ˆéœ€è¦å®‰è£…atom-beautifyï¼‰ Crtl + ` è°ƒèµ·CLIå‘½ä»¤è¡Œç•Œé¢ï¼ˆéœ€è¦å®‰è£…terminal-panelï¼‰ Github githubå¸å·æ³¨å†Œå’Œåˆ›å»ºé¡µé¢ä»“åº“ æ³¨å†Œåœ°å€ï¼šhttps://github.com/ ä»“åº“çš„åå­—éœ€è¦å’Œä½ çš„è´¦å·å¯¹åº”ï¼Œæ ¼å¼ï¼šyourname.github.ioï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæ¼”ç¤ºçš„é¡µé¢ä»“åº“åä¸ºeightplus.github.io ç”Ÿæˆsshå¯†é’¥ï¼Œå¹¶å°†å¯†é’¥æ·»åŠ åˆ°githubä¸Š ç”Ÿæˆå¯†é’¥ï¼šssh-keygen -t rsa -C æ³¨å†Œå¸å·æ—¶çš„é‚®ç®±åœ°å€â€ å¯†é’¥ç”Ÿæˆåï¼Œåœ¨ ~/.sshç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€äº›æ–‡ä»¶ï¼ŒåŒ…æ‹¬id_rsaå’Œid_rsa.pub æ‰“å¼€id_rsa.pubï¼Œé€‰ä¸­æ‰€æœ‰å†…å®¹å¤åˆ¶ï¼Œç½‘é¡µè¿›å…¥ https://github.com/settings/ssh ï¼ŒAdd SSH keyï¼Œç²˜è´´ä¹‹å‰å¤åˆ¶çš„å†…å®¹ã€‚ Githubå®‰è£…å’Œå¸å·é…ç½® sudo apt-get install git git config --global user.name &quot;yourname&quot; git config --global user.email &quot;æ³¨å†Œå¸å·æ—¶çš„é‚®ç®±åœ°å€&quot; å®‰è£…rubyç¯å¢ƒsudo apt-get install ruby-all-devæˆ‘çš„ç³»ç»Ÿä¸ºUbuntu 16.04ï¼Œä½¿ç”¨çš„è½¯ä»¶æºé‡Œé¢å­˜åœ¨ruby2.3-devï¼Œåˆ™æ­¤ç§æ–¹å¼ä¼šå°†ruby2.3-devä¸€å¹¶å®‰è£…ï¼Œå½“ç„¶ï¼Œä¸Šè¿°æ“ä½œä¹Ÿå¯ä»¥æ›¿æ¢æˆå®‰è£…ruby2.3-devï¼Œ(sudo apt-get install ruby2.3-dev) å®‰è£…å®Œæˆåï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥ruby -vï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ï¼š å®Œæˆrubyç¯å¢ƒåï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥gem -vï¼Œå‡ºç°å¦‚ä¸‹ç»“æœï¼Œåˆ™è¯´æ˜rubyç¯å¢ƒå·²ç»å®Œå…¨é…ç½®æˆåŠŸäº†ï¼Œå¦‚æœå‡ºç°äº†æŠ¥é”™ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦å®‰è£…nodejs (sudo apt-get install nodejs)ã€‚ å®‰è£…JeKyllç¯å¢ƒ å…ˆå®‰è£…ä¾èµ–åŒ…bundlerï¼š sudo gem install bundler å†å®‰è£…å®‰è£…jekyllï¼š sudo gem install jekyll å®‰è£…å®Œæˆåï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥jekyll --versionï¼Œå‡ºç°å¦‚ä¸‹ç»“æœï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸ å·¥ç¨‹åˆ›å»ºæ˜¯å¦è¿«ä¸åŠå¾…çš„æƒ³çœ‹ä¸‹ç¬¬ä¸€ä¸ªåšå®¢çš„å…·ä½“å†…å®¹ ğŸ‘‰ åœ¨ä½ æ‰“ç®—å­˜æ”¾å·¥ç¨‹ä»£ç çš„ç›®å½•ä¸‹æ‰“å¼€ä¸€ä¸ªç»ˆç«¯åä½¿ç”¨jekyllåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œè¿™é‡Œæˆ‘çš„ç›®å½•ä¸ºï¼š~/work/git/ï¼šjekyll new blogæ“ä½œä¹‹åä¼šç”Ÿæˆå¾ˆå¤šæ–‡ä»¶/æ–‡ä»¶å¤¹ï¼Œè¯¦ç»†è¯´æ˜å¦‚ä¸‹ï¼š _config.ymlï¼šJekyllé…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨é…ç½®æ•°æ® _draftsï¼šè‰ç¨¿ç›®å½•ï¼Œå¯æ‰‹åŠ¨åˆ›å»º _includesï¼šåŒ…å«ä¸€äº›æ¨¡æ¿ï¼Œå¯ä»¥é‡å¤åˆ©ç”¨ _layoutsï¼šå­˜æ”¾é¡µé¢æ¨¡æ¿çš„åœ°æ–¹ _postsï¼šå­˜æ”¾æ–‡ç« çš„ç›®å½•ï¼Œæ–‡ç« æ ¼å¼ä¸º mardown æ ¼å¼ï¼ˆyear-month-title.markdownï¼‰æˆ–.mdï¼Œæ–‡ä»¶åç¡®å®šäº†å‘è¡¨çš„æ—¥æœŸå’Œæ ‡è®°è¯­è¨€ _dataï¼šå­˜æ”¾yamlæ ¼å¼çš„æ•°æ®æ–‡ä»¶ _siteï¼šä½¿ç”¨Jekyllç¼–è¯‘åçš„é™æ€ç«™ç‚¹å°†å­˜æ”¾äºè¿™ä¸ªç›®å½•ä¸‹ï¼Œå³jekyllç”Ÿæˆçš„ç½‘ç«™ä¼šæ”¾åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œè¯¥ç›®å½•ä¸éœ€è¦pushåˆ°githubï¼Œå¯åœ¨.gitignoreæ–‡ä»¶ä¸­åŠ å…¥è¿™ä¸ªç›®å½• index.htmlï¼šè¯¥æ–‡ä»¶å¸¦æœ‰ yaml å¤´ä¿¡æ¯ï¼Œå¤§æ¦‚å¦‚ä¸‹ï¼š123456---layout: posttitle: &quot;Welcome to Jekyll!&quot;date: 2018-06-27 15:33:17 +0800categories: jekyll update--- ä¸Šè¿°æ“ä½œä¼šç”Ÿæˆä¸ªé»˜è®¤æ–‡ç« ï¼Œä½äº_postsç›®å½•ä¸‹ï¼Œåå­—ç±»ä¼¼ä¸ºï¼š2018-06-27-welcome-to-jekyll.markdown å¯ä»¥å¤åˆ¶2018-06-27-welcome-to-jekyll.markdownåè¿›è¡Œä¿®æ”¹æ¥è¿›è¡Œæ–°çš„åšå®¢ç¼–å†™ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ gitçš„atomç¼–è¾‘å™¨ æ¥ç¼–è¾‘.markdownæ–‡ä»¶ï¼Œå¯ä»¥åœ¨atomå®˜ç½‘è¿›è¡ŒdebåŒ…çš„ä¸‹è½½ï¼Œæ–°é¡µé¢ç”Ÿæˆå’Œç¼–è¾‘å®Œæˆåï¼Œé‡å¯jekyllå†…ç½®æœåŠ¡å™¨ï¼ˆç»ˆç«¯æ‰§è¡Œï¼šjekyll serveï¼‰ï¼Œæ‰“å¼€æˆ–åˆ·æ–°é¡µé¢ï¼šhttp://localhost:4000ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨é¡µé¢çœ‹åˆ°è‡ªå·±æ·»åŠ çš„åšæ–‡äº†ã€‚ GitåŒæ­¥å°†å‰é¢åˆ›å»ºçš„ä»“åº“å…‹éš†åˆ°æœ¬åœ°ï¼Œç„¶åå°†blogç›®å½•ä¸­ç”Ÿæˆçš„æ–‡ä»¶å¤åˆ¶åˆ°githubé¡¹ç›®ç›®å½•ä¸‹ï¼Œæˆ‘è¿™é‡Œé¡¹ç›®åä¸º eightplus.github.ioã€‚ git clone https://github.com/yourname/yourname.github.io.git git add . git commit -m &quot;init&quot; git push -u origin master è‡³æ­¤ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥https://yourname.github.ioï¼Œæ¯”å¦‚ï¼šhttps://eightplus.github.io/ï¼Œå³å¯çœ‹åˆ°ä¸‹å›¾ï¼Œåšå®¢æ­å»ºå®Œæˆ ç½‘é¡µæµè§ˆæ•ˆæœå›¾","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Jekyll","slug":"Jekyll","permalink":"https://eightplus.github.io/tags/Jekyll/"}]}]}