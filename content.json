{"meta":{"title":"Eight Plus","subtitle":"èœé¸Ÿçš„ç‚¹æ»´è®°å½•","description":"Linux çˆ±å¥½è€…","author":"æç¿”","url":"https://eightplus.github.io"},"pages":[{"title":"","date":"2018-07-18T13:36:28.000Z","updated":"2020-02-04T02:23:22.176Z","comments":true,"path":"about/index.html","permalink":"https://eightplus.github.io/about/index.html","excerpt":"","text":"å…³äºæˆ‘ åœ¨è¿™ä¸ªæ— å¸¸çš„ä¸–ç•Œé‡Œï¼Œæ€»æœ‰ä¸€äº›äººï¼Œä¼šä¸ºè¿™ä¸ªä¸–ç•Œç•™ä¸‹äº›ä»€ä¹ˆã€‚è€Œè¿™ç•™ä¸‹çš„ï¼Œå¿…å°†æˆä¸ºæ°¸æ’ï¼æˆ‘æƒ³åŠªåŠ›æŒ£æ‰ç€è¦ç•™ä¸‹ç‚¹ä»€ä¹ˆç—•è¿¹ï¼Œè¯æ˜è¿™ä¸ªå¤±è´¥çš„æˆ‘ä¹Ÿæ›¾æ¥è¿‡Linuxè¿™ä¸ªä¸–ç•Œã€‚ æç¿”ï¼ŒLinuxçˆ±å¥½è€…ï¼Œçˆ±å¥½ä½“è‚²è¿åŠ¨å’Œæ‘„å½±ï¼Œ2007å¹´å…¥å…šï¼Œ2011å¹´æœ¬ç§‘æ¯•ä¸šï¼Œä»å°å­¦åˆ°å¤§å­¦ä¸€ç›´æ‹…ä»»ç­é•¿ï¼Œå…¶å®ä¸å–„è¨€è¾ï¼Œä½†ç»„ç»‡å¯èƒ½è¿˜æ˜¯æœ‰ä¸€å¥—ï¼ˆå¯èƒ½æ€§æ¯”è¾ƒå°ï¼‰ï¼Œæœ‰æ—¶å€™çœ‹åˆ°æˆ‘ä»¬å…¬å¸ç»„ç»‡çš„ä¸€äº›æ´»åŠ¨å•Šï¼ŒçœŸæ˜¯æ— åŠ›åæ§½ï¼Œå¤ªæ°´äº†ï¼Œä½†æ— èµ„æ ¼å’Œç²¾åŠ›å»è¯´æˆ–è€…å¸®äº›ä»€ä¹ˆï¼ˆå·¥ä½œèƒ½åŠ›å’Œæ°´å¹³æœ‰é™å¯¼è‡´çš„è‡ªå‘ï¼‰ï¼Œåªèƒ½å†™è‡ªå·±çš„ä»£ç ï¼Œè§£è‡ªå·±çš„bugã€‚æ›¾ç»è€ƒè¿‡èµ„æ ¼è¯ä¹¦ï¼ˆä¸­çº§è€Œå·²ï¼Œè¿˜æƒ³å“ªå¤©æœ‰ç©ºäº†å»è¯•è¯•é«˜çº§ï¼Œä¹Ÿå¥½å†åˆºæ¿€åˆºæ¿€è‡ªå·±é‚£é¢—å°†è€ä½†æ˜¯ä¸è‚¯è€çš„å¿ƒï¼‰ã€è€ƒè¿‡ç ”ï¼ˆå·¥ä½œäº†7å¹´å¤šå»è€ƒçš„ï¼ŒæŒ‚äº†ï¼Œé«˜æ•°æ•´çš„æˆ‘å¥½åƒæ²¡è¯»è¿‡ä¹¦ä¸€æ ·ï¼Œæ™ºå•†æ€ä¹ˆèƒ½è¿™ä¹ˆä½ï¼‰ã€è€ƒè¿‡é€‰è°ƒç”Ÿï¼ˆç¦»é‚£ä¸ªçº¿å·®0.05åˆ†ï¼Œå¿ƒé‡Œé‚£ä¸ªæ»´è¡€å•Šï¼‰ã€è€ƒè¿‡å…¬åŠ¡å‘˜ï¼ˆè¿‡äº†ç¬”è¯•ï¼Œé¢è¯•è£¸è€ƒæŒ‚äº†ï¼Œè¿›è€ƒåœºå‰è¿å…·ä½“æµç¨‹éƒ½ä¸æ¸…æ¥šï¼Œè¿˜æ˜¯å€Ÿçš„è¥¿æœè¿›å»çš„ï¼‰ã€è€ƒè¿‡2018å¹´å†›é˜Ÿæ–‡èŒè€ƒè¯•ï¼ˆç”¨å‡†è€ƒè¯å·çš„è§„åˆ™ä¸æ–­çš„æŸ¥è¯¢å²—ä½é‡Œé¢å…¶ä»–å…¥å›´è€…çš„æˆç»©ï¼Œæˆ‘å±…ç„¶ç¬”è¯•æˆç»©æ’åç¬¬ä¸€ï¼Œåœ¨çŸ¥é“ç¬¬ä¸€çš„æƒ…å†µä¸‹æˆ‘ç‰¹ä¹ˆæ²¡å»æˆéƒ½å‚åŠ èµ„æ ¼å®¡æŸ¥ï¼Œæ”¾å¼ƒäº†ï¼Œæœ€ç»ˆæˆ‘é‚£å²—ä½æ²¡äººå½•ç”¨ï¼Œå”‰ï¼Œè¥¿éƒ¨æˆ˜åŒºå•Šï¼Œæˆ‘ä»¬ç¼˜åˆ†æœªåˆ°å•Šï¼‰ï¼Œä¸­é€”æƒ³è¿‡æ¢å·¥ä½œå•ä½ï¼Œofferä¹Ÿæ‹¿åˆ°äº†ï¼Œæœ€ç»ˆä¹Ÿæ˜¯æ”¾å¼ƒäº†â€¦â€¦å”‰ï¼Œæˆ‘çš„äººç”Ÿï¼Œä¸€éƒ¨æ‚²å‚¬å²ï¼Œä»¥è‡´äºæˆ‘ä»æ¯•ä¸šåˆ°ç°åœ¨ä¸€ç›´ä»äº‹Linuxæ“ä½œç³»ç»Ÿå’Œè½¯ä»¶ç ”å‘ï¼Œè‡³ä»Šä¸€äº‹æ— æˆï¼Œè™šåº¦äº†å²æœˆï¼Œæˆ‘éƒ½æƒ³å®‰æ…°çš„æŠ±æŠ±æˆ‘è‡ªå·±ã€‚è™½è¯´æ‚²å‚¬ï¼Œè™½è¯´å¤±è´¥ï¼Œä½†æˆ‘å¥½åƒçœŸå¿ƒå–œæ¬¢Linuxï¼Œå¸Œæœ›æœ‰ä¸€å¤©èƒ½æœ‰ä¸€ç‚¹ç‚¹æˆå°±æ„Ÿã€‚ åœ¨æˆ‘ä¸Linuxçš„æ¯æ—¥æ¥è§¦ä¸­ï¼Œæ›¾ç»ç©è¿‡çš„è¯­è¨€å’Œæ¡†æ¶æœ‰C/C++ã€Pythonã€Shellã€Qt/QMLã€Gtkã€Valaç­‰ï¼ŒæŠ˜è…¾è¿‡çš„é¡¹ç›®æœ‰Linuxä¸‹çš„ä¿å¯†ç®¡ç†ç³»ç»Ÿã€Linuxä¸‹çš„ä¸­å›½äººæ°‘é“¶è¡Œä¸ªäººå¾ä¿¡æŸ¥è¯¢æœºç³»ç»Ÿã€Linuxä¸AndroidåŒç³»ç»Ÿçš„å…¼å®¹â€¦â€¦ è¯´åˆ°è¿™ä¹ˆæ‚²å‚¬çš„æˆ‘ï¼Œé‚£æ˜¯ä»€ä¹ˆè®©æˆ‘ç»§ç»­çˆ¬èµ·æ¥æŠ˜è…¾çš„å‘¢ï¼Ÿä¸å¦¨å¤§å£°çš„å‘Šè¯‰ä½ ï¼Œæˆ‘ç”¨æ•´ä¸ªé’æ˜¥çˆ±è¿‡çš„äººæ˜¯ç§‘æ¯”ï¼Œç°åœ¨æ‡‚äº†åŸå› ä¸ï¼Ÿé‚£ä¹ˆç°åœ¨ç§‘æ¯”é€€å½¹äº†å•Šï¼Œæˆ‘ä¹Ÿè€äº†å•Šï¼Œé‚£ä¹ˆæˆ‘ä¸ºå˜›è¿˜èƒ½æ‰“é¸¡è¡€ä¸€èˆ¬çš„çæŠ˜è…¾å‘¢ï¼Ÿä¸ºäº†æˆ‘çš„è€å©†å’Œå­©å­ï¼Œä»–ï¼ˆå¥¹ï¼‰ä»¬æ˜¯æˆ‘ç°åœ¨ç”Ÿå‘½ä¸­çš„ä¸€åˆ‡ï¼Œå¼¥è¶³çè´µã€‚ åŒ—äº¬æ—¶é—´2020å¹´1æœˆ27æ—¥ï¼Œç§‘æ¯”å’ŒäºŒå¥³å„¿Gigiåœ¨ä¸€èµ·ç›´å‡æœºäº‹æ•…ä¸­ä¸å¹¸å»ä¸–ï¼Œæ—¶å¹´41å²ã€‚æ„¿å¤©å ‚ä¹Ÿæœ‰ç¯®çƒç›¸ä¼´ï¼ŒRIPã€‚ å…³äºæˆ‘çš„æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹ ğŸ‘‰Githubç äº‘"},{"title":"åˆ†ç±»","date":"2018-07-30T10:46:20.000Z","updated":"2018-07-31T02:28:12.068Z","comments":true,"path":"categories/index.html","permalink":"https://eightplus.github.io/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2018-07-18T13:36:55.000Z","updated":"2018-07-31T02:28:12.068Z","comments":false,"path":"tags/index.html","permalink":"https://eightplus.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"stdin è¾“å…¥","slug":"2020-05-05-stdin","date":"2020-05-05T13:38:59.000Z","updated":"2020-05-20T07:02:25.756Z","comments":true,"path":"2020/05/05/2020-05-05-stdin/","link":"","permalink":"https://eightplus.github.io/2020/05/05/2020-05-05-stdin/","excerpt":"","text":"ä½¿ç”¨ C å’Œ Qt ç›‘æ§ç”¨æˆ·çš„ç»ˆç«¯è¾“å…¥(stdin)ã€‚ ç¤ºä¾‹æºç  c-stdin qt-stdin ç¤ºä¾‹ä»£ç ç‰‡æ®µ112345678910111213141516171819// Read message from stdinvoid test_stdin_method1()&#123; char buf[256]; printf(&quot;# please input your command!!!\\n&quot;); while (fscanf(stdin, &quot;%s&quot;, buf) &gt; 0) &#123; int op = 0; if (!strcmp(buf, &quot;q&quot;)) &#123; printf(&quot;Exit......\\n&quot;); op = 1; &#125; else &#123; printf(&quot;input command `%s&apos;\\n&quot;, buf); &#125; if(op == 1) break; &#125;&#125; ç¤ºä¾‹ä»£ç ç‰‡æ®µ21234567891011121314151617181920212223242526272829// Read message from stdinvoid test_stdin_method2()&#123; char buf[256]; printf(&quot;# please input your command(number)!!!\\n&quot;); while (fgets(buf, sizeof(buf), stdin) != NULL) &#123; int iCmdType = 0; if(sscanf(buf, &quot;%d&quot;, &amp;iCmdType) == -1) &#123; fprintf(stderr, &quot;Input error: %s(errno: %d) And please input again\\n&quot;, strerror(errno), errno); continue; &#125; int op = 0; switch(iCmdType) &#123; case 0: printf(&quot;Exit......\\n&quot;); op = 1; break; default: printf(&quot;Command Type : %d\\n&quot;, iCmdType); break; &#125; if(op == 1) break; &#125;&#125; ç¤ºä¾‹ä»£ç ç‰‡æ®µ3iochannelæ˜¯glibä¸­æŠŠIOäº‹ä»¶é›†æˆåˆ°äº‹ä»¶çš„ä¸€ç§æ–¹æ³•ï¼Œiochannelå¯ä»¥æŠŠå‘ç”Ÿåœ¨æ–‡ä»¶æè¿°ç¬¦ã€ç®¡é“å’Œsocketä¹‹ä¸Šçš„äº‹ä»¶è½¬æ¢ä¸ºglibçš„å†…éƒ¨äº‹ä»¶ï¼Œä»è€Œå¯ä»¥åœ¨ç¨‹åºä¸­ç”¨ç»Ÿä¸€çš„æ–¹æ³•æ¥å¤„ç†IOäº‹ä»¶å’Œç”¨æˆ·äº¤äº’ã€‚ ä¸‹é¢è¡¨æ ¼åˆ—å‡ºçš„æ˜¯iochannelæ”¯æŒçš„IOäº‹ä»¶ï¼š IOäº‹ä»¶ æè¿° G_IO_IN å¯è¯» G_IO_OUT å¯å†™ G_IO_PRI æœ‰ç´§æ€¥æ•°æ®åˆ°è¾¾ G_IO_ERR å‡ºé”™ G_IO_HUP æŒ‚æ–­ G_IO_NVAL æ— æ•ˆè¯·æ±‚ã€‚æ–‡ä»¶æè¿°ç¬¦æœªæ‰“å¼€ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950typedef struct _MyData &#123; gint min_number; gint max_number;&#125; MyData;static gboolean io_watch_handle_keyboard(GIOChannel *channel, GIOCondition condition, gpointer data)&#123; gsize len = 0; gchar *buffer = NULL; MyData *m_data = (MyData *)data; if (g_io_channel_read_line(channel, &amp;buffer, &amp;len, NULL, NULL) == G_IO_STATUS_NORMAL) &#123; int number = atoi(buffer); if (number &lt; m_data-&gt;min_number || number &gt; m_data-&gt;max_number) &#123; g_printerr(&quot;Out of range\\n&quot;); &#125; else &#123; g_print(&quot;Input Number: %d\\n&quot;, number); &#125; &#125; if (len &gt; 0) &#123; g_print(&quot;Read data&apos;s length: %d\\n&quot;, len); &#125; g_free(buffer); return TRUE;&#125;int main(int argc, char *argv[])&#123; MyData data; data.min_number = 0; data.max_number = 100; GMainLoop *main_loop = g_main_loop_new(NULL, FALSE); GIOChannel *channel; channel = g_io_channel_unix_new(fileno(stdin));//å°†æ ‡å‡†è¾“å…¥æè¿°ç¬¦è½¬åŒ–æˆGIOChannel if (channel) &#123; g_io_add_watch(channel, G_IO_IN, (GIOFunc)io_watch_handle_keyboard, &amp;data); g_io_channel_unref(channel); &#125; g_main_loop_run(main_loop); g_main_context_unref(g_main_loop_get_context(main_loop)); g_main_loop_unref(main_loop); return 0;&#125; ç¤ºä¾‹ä»£ç ç‰‡æ®µ4123456789101112131415161718192021222324252627282930void start()&#123; QFile qstdin; qstdin.open(stdin, QIODevice::ReadOnly); qDebug() &lt;&lt; &quot;# please input your command!&quot;; while (true) &#123; //trimmed() å»æ‰å­—ç¬¦ä¸²é¦–å°¾çš„ç©ºæ ¼; simplified()ä¸ä»…å»æ‰é¦–å°¾çš„ç©ºæ ¼ï¼Œä¸­é—´è¿ç»­çš„ç©ºæ ¼ä¹Ÿç”¨ä¸€ä¸ªç©ºæ ¼æ›¿æ¢ QString line = QString::fromLocal8Bit(qstdin.readLine()).trimmed(); if (line.isEmpty()) &#123; continue; &#125; else if (line == &quot;quit&quot;) &#123; break; &#125; else &#123; qDebug() &lt;&lt; line; &#125; &#125; exit(0);&#125;int main(int argc, char *argv[])&#123; QCoreApplication a(argc, argv); start(); return a.exec();&#125;","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt C","slug":"Qt-C","permalink":"https://eightplus.github.io/tags/Qt-C/"}]},{"title":"GtkApplication ç¼–ç¨‹ç¤ºä¾‹","slug":"2020-04-13-GtkApplication","date":"2020-04-13T15:26:52.000Z","updated":"2020-05-06T07:27:50.975Z","comments":true,"path":"2020/04/13/2020-04-13-GtkApplication/","link":"","permalink":"https://eightplus.github.io/2020/04/13/2020-04-13-GtkApplication/","excerpt":"","text":"GtkApplicationå¯ä»¥è®©æˆ‘ä»¬çš„æ ¸å¿ƒç¨‹åºä»£ç ä¸main()å‡½æ•°åˆ†å¼€ï¼Œè¿™æ ·å¯ä»¥è®©main()ç®€å•åŒ–ï¼Œé‡Œé¢åªéœ€è¦åˆ›å»ºGtkApplicationå¯¹è±¡å¹¶è¿è¡Œå®ƒï¼Œè€Œå…¶ä»–å›¾å½¢ç›¸å…³çš„æ“ä½œåˆ™åœ¨GtkApplicationå‘å‡ºçš„ä¿¡å·ä¸­å®Œæˆã€‚GtkApplicationå¯¹è±¡é»˜è®¤æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œç¨‹åºå¯åŠ¨åçš„ç¬¬ä¸€ä¸ªå®ä¾‹ä¸ºä¸»å®ä¾‹ï¼Œè¿œç¨‹å®ä¾‹æ˜¯é™¤ä¸»å®ä¾‹å¤–çš„å…¶ä»–è¿è¡Œå®ä¾‹ã€‚å½“ç”¨æˆ·å¿è¯•æ‰“å¼€ç¬¬äºŒä¸ªGtkApplicationå¯¹è±¡å•ä¾‹æ—¶ï¼ŒGtkApplicationå°†å‘ä¿¡å·åˆ°ä¸»å®ä¾‹ï¼Œä¸»å®ä¾‹å°†å†æ¬¡æ”¶åˆ°activateæˆ–openä¿¡å·ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªå®ä¾‹å°†é©¬ä¸Šé€€å‡ºï¼Œä¸è°ƒç”¨startupæˆ–shutdownï¼Œè¿™ç§æœºåˆ¶æ˜¯æä¾›ä¸€ç§å®ç°GTKç¨‹åºå•å®ä¾‹çš„å¥½åŠæ³•ã€‚æœ¬åœ°å®ä¾‹å³å½“å‰å®ä¾‹ï¼Œå¦‚æœæœ¬åœ°å®ä¾‹æ˜¯ä¸»å®ä¾‹ï¼Œé‚£ä¹ˆå‡½æ•°è°ƒç”¨GtkApplicationå®ä¾‹äº§ç”Ÿçš„ä¿¡å·ï¼Œä¼šåœ¨æœ¬åœ°ä¸­è§¦å‘ï¼›å¦‚æœæœ¬åœ°å®ä¾‹æ˜¯ä¸€ä¸ªè¿œç¨‹å®ä¾‹ï¼Œé‚£ä¹ˆå‡½æ•°è°ƒç”¨äº§ç”Ÿçš„ä¿¡å·å°†è¢«å‘é€åˆ°ä¸»å®ä¾‹ä¸­ï¼Œå¹¶åœ¨ä¸»å®ä¾‹é‚£é‡Œè¢«è§¦å‘ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸»å®ä¾‹ä¸­ï¼Œè°ƒç”¨g_application_activate()ï¼Œå°†åœ¨ä¸»å®ä¾‹ä¸­è§¦å‘â€œactivateâ€ä¿¡å·ï¼›å¦‚æœåœ¨è¿œç¨‹å®ä¾‹ä¸­è°ƒç”¨å®ƒï¼Œåˆ™äº§ç”Ÿä¸€ä¸ªæ¶ˆæ¯å¹¶å‘é€åˆ°ä¸»å®ä¾‹ï¼Œç„¶åå°†åœ¨ä¸»å®ä¾‹ä¸­è§¦å‘â€œactivateâ€ä¿¡å·ã€‚ ç¤ºä¾‹æºç  gtkapplication-demo çŸ¥è¯†ç‚¹ç®€æçŸ¥è¯†ç‚¹1ä¹‹å‰çœ‹åˆ°å¾ˆå¤šGTKç¨‹åºéƒ½æ˜¯ä½¿ç”¨å¦‚ä¸‹æµç¨‹å®ç°çš„ï¼š1234567891011int main(int argc, char *argv[])&#123; GtkWidget *window; gtk_init(&amp;argc, &amp;argv); ...... gtk_main(); return 0;&#125; è¿™é‡Œä»‹ç»çš„GtkApplicationåï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¦‚ä¸‹æµç¨‹ï¼šmainå‡½æ•°é‡Œæ–°å»ºä¸€ä¸ªGtkApplicationç±»appï¼Œå¹¶ç»‘å®šstartupå’Œactivateè¿™ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼Œåº”ç”¨ç¨‹åºåœ¨app_startup_handlerå‡½æ•°ä¸­ç¼–å†™ï¼Œè€Œapp_activate_handleråˆ™å¤„ç†çª—å£ç½®é¡¶ï¼Œç¡®ä¿çª—å£åœ¨å±å¹•ä¸Šå¹¶ä¸”å¯¹ç”¨æˆ·æ˜¯å¯è§çš„ï¼Œmain()å‡½æ•°é‡Œçš„æ˜¯å¯åŠ¨ä»£ç ã€‚1234567891011121314151617int main(int argc, char **argv)&#123; GtkApplication *app; struct data_handle *handle; gint status; app = gtk_application_new(&quot;com.eightplus.application&quot;, G_APPLICATION_FLAGS_NONE); handle = g_malloc(sizeof(struct data_handle)); g_signal_connect(app, &quot;startup&quot;, G_CALLBACK(app_startup_handler), handle); g_signal_connect(app, &quot;activate&quot;, G_CALLBACK(app_activate_handler), handle); status = g_application_run(G_APPLICATION(app), argc, argv); g_object_unref(app); g_free(handle); return status;&#125; GtkApplicationè¿è¡Œæ—¶å¯èƒ½å‘å‡ºçš„ä¿¡å·å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š ä¿¡å· è¯´æ˜ startup å½“ç¨‹åºç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œstartupä¿¡å·å°±ä¼šè¢«è§¦å‘ï¼Œå¯ä»¥å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œä¸€äº›è®¾ç½® shutdown æ‰§è¡Œå…³é—­ä»»åŠ¡ï¼Œå¦‚ä¿å­˜æ–‡ä»¶åˆ°ç£ç›˜ç­‰ activate ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ˜¾ç¤ºåº”ç”¨ç¨‹åºé»˜è®¤çš„ç¬¬ä¸€ä¸ªçª—å£ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¡Œé¢ç¯å¢ƒä¸‹é¦–æ¬¡æ‰“å¼€åº”ç”¨ç¨‹åºçš„æƒ…å†µ open æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶åœ¨æ–°çª—å£æ˜¾ç¤ºã€‚ä½¿ç”¨åº”ç”¨ç¨‹åºä»æ–‡ä»¶æµè§ˆå™¨å°è¯•æ‰“å¼€æ–‡æ¡£çš„æƒ…å†µ çŸ¥è¯†ç‚¹2é‡‡ç”¨GtkBuilderè®¾è®¡Gtk+ç•Œé¢ï¼Œä½¿ç”¨gladeå¯ä»¥ç›´æ¥æ‹–æ‹½Gtk+å›¾åƒæ§ä»¶(sudo apt intsall glade)ï¼Œç®€å•æ˜“ç”¨ï¼Œçœå»äº†ä»£ç ç¼–å†™çš„éº»çƒ¦ï¼Œèƒ½æœ‰æ•ˆåœ°åŠ å¿«é¡¹ç›®è¿›åº¦å’Œæé«˜ç¨‹åºçš„å¯ç»´æŠ¤æ€§ã€‚ä¸é€‚ç”¨gladeçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬åˆ›å»ºçª—å£çš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š123456static void app_startup_handler(GApplication *app, gpointer data)&#123; GtkWidget *window; window = gtk_application_window_new(GTK_APPLICATION(app)); gtk_widget_show(window);&#125; è€Œåœ¨ä½¿ç”¨gladeåï¼Œæˆ‘ä»¬çš„ä»£ç å°†å˜å¾—æ›´åŠ ç®€å•ï¼Œç‰¹åˆ«æ˜¯çª—å£ä¸Šéœ€è¦åŠ å…¥å¾ˆå¤šå›¾å½¢æ§ä»¶çš„æ—¶å€™ï¼Œä½ å°†ä¼šå¯¹gladeè¡¨ç¤ºå‡ºæµ“çƒˆçš„å–œæ¬¢ã€‚12345678910111213141516171819202122232425262728static void app_startup_handler(GApplication *app, gpointer data)&#123; struct data_handle *handle = data; handle-&gt;app = GTK_APPLICATION(app); GtkWidget *main_window; guint retval; builder = gtk_builder_new(); retval = gtk_builder_add_from_file(builder, &quot;mainwindow.ui&quot;, &amp;error); if (retval == 0) &#123; return; &#125; main_window = GTK_WIDGET(gtk_builder_get_object(builder, &quot;mainwindow&quot;)); gtk_application_add_window(app , GTK_WINDOW(main_window)); handle-&gt;gui = main_window; gtk_window_set_title(GTK_WINDOW(main_window), &quot;Application Demo&quot;);//è®¾ç½®çª—å£æ ‡é¢˜ gtk_window_set_default_size(GTK_WINDOW(main_window), 500, 400);//è®¾ç½®çª—å£é»˜è®¤å¤§å° gtk_window_set_position(GTK_WINDOW(main_window), GTK_WIN_POS_CENTER_ALWAYS);//æ§åˆ¶çª—å£åœ¨å±å¹•ä¸Šçš„åˆå§‹ä½ç½®(å±…ä¸­) gtk_window_set_modal(GTK_WINDOW(main_window), TRUE); gtk_widget_realize(main_window); ...... gtk_widget_show_all(GTK_WIDGET(handle-&gt;gui));&#125; çŸ¥è¯†ç‚¹3åŠ ä¸Šä¸‹é¢è¿™è¡Œä»£ç åˆ™å¯å®ç°æ— è¾¹æ¡†çª—å£:1gtk_window_set_decorated(GTK_WINDOW(main_window), FALSE); åœ¨æ— è¾¹æ¡†çª—å£ä¸‹ï¼Œç•Œé¢æ²¡æœ‰äº†é»˜è®¤çš„æ ‡é¢˜æ ï¼Œå°†ä¼šå¯¼è‡´ç•Œé¢æ— æ³•æ‹–åŠ¨ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è‡ªå·±ç¼–å†™ç•Œé¢æ‹–åŠ¨åŠŸèƒ½å‡½æ•°ï¼Œä»¥ä¸‹ä»£ç å¯ä¾›å‚è€ƒä½¿ç”¨ï¼š123456789101112static gboolean handle_drag(GtkWidget *widget, GdkEventButton *event, GdkWindowEdge edge)&#123; if (event-&gt;button == 1) &#123;//å·¦é”®å•å‡» gtk_window_begin_move_drag(GTK_WINDOW(gtk_widget_get_toplevel(widget)), event-&gt;button, event-&gt;x_root, event-&gt;y_root, event-&gt;time); &#125; return FALSE;&#125;.....gtk_widget_add_events(main_window, GDK_BUTTON_PRESS_MASK);g_signal_connect(G_OBJECT(main_window), &quot;button-press-event&quot;, G_CALLBACK(handle_drag), NULL); çŸ¥è¯†ç‚¹4csså›¾å½¢æ ·å¼å¤„ç†ï¼Œå‚è€ƒä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627void set_gtk_css_style()&#123; GtkCssProvider *provider = NULL; GFile *file = NULL; GError *css_error = NULL; char cssPath[] = &quot;style.css&quot;; file = g_file_new_for_path(cssPath); if (file != NULL) &#123; if (provider == NULL) &#123; provider = gtk_css_provider_new(); &#125; gtk_css_provider_load_from_file(provider, file, NULL); gtk_style_context_add_provider_for_screen(screen, GTK_STYLE_PROVIDER(provider), GTK_STYLE_PROVIDER_PRIORITY_USER); gtk_style_context_reset_widgets(screen); gsize bytes_written, bytes_read; gtk_css_provider_load_from_path(provider, g_filename_to_utf8(cssPath, strlen(cssPath), &amp;bytes_read, &amp;bytes_written, &amp;css_error), NULL); &#125; if (NULL != css_error) &#123; g_clear_error(&amp;css_error); &#125; if (NULL != file) &#123; g_object_unref(file); file = NULL; &#125;&#125;","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"GTK","slug":"GTK","permalink":"https://eightplus.github.io/tags/GTK/"}]},{"title":"Qt ç¬”è®°","slug":"2020-02-03-Qt-notes","date":"2020-02-03T03:06:18.000Z","updated":"2020-02-08T04:53:01.524Z","comments":true,"path":"2020/02/03/2020-02-03-Qt-notes/","link":"","permalink":"https://eightplus.github.io/2020/02/03/2020-02-03-Qt-notes/","excerpt":"","text":"å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œè®°å½•ä¸€äº›Qtå­¦ä¹ è¿‡ç¨‹ä¸­çš„ç¬”è®°ã€‚ 1 éå†æ‰€æœ‰session dbusçš„æœåŠ¡åå’Œæ¥å£åçš„å‚è€ƒæ–¹æ³•123456789101112131415161718192021222324void testDbusInterface()&#123; if (!QDBusConnection::sessionBus().isConnected()) &#123; fprintf(stderr, &quot;Cannot connect to the D-Bus session bus.\\n&quot; &quot;To start it, run:\\n&quot; &quot;\\teval `dbus-launch --auto-syntax`\\n&quot;); return 1; &#125; QDBusReply&lt;QStringList&gt; reply = QDBusConnection::sessionBus().interface()-&gt;registeredServiceNames(); if (!reply.isValid()) &#123; qDebug() &lt;&lt; &quot;Error:&quot; &lt;&lt; reply.error().message(); exit(1); &#125; foreach (QString name, reply.value()) qDebug() &lt;&lt; name; QDBusConnection bus = QDBusConnection::sessionBus(); QDBusInterface dbus_iface(&quot;org.freedesktop.DBus&quot;, &quot;/org/freedesktop/DBus&quot;, &quot;org.freedesktop.DBus&quot;, bus); qDebug() &lt;&lt; dbus_iface.call(&quot;ListNames&quot;).arguments().at(0); qDebug() &lt;&lt; QDBusConnection::sessionBus().interface()-&gt;registeredServiceNames().value();&#125; 2 è§£å†³Qtè§†é¢‘é—ªçƒæˆ–é»‘å±ç™½å±é—®é¢˜ Qtè°ƒç”¨ç¬¬ä¸‰æ–¹åº“æ¸²æŸ“è§†é¢‘é€ æˆé—ªçƒæˆ–è€…ç™½å±é»‘å±ï¼Œä½¿ç”¨QtåµŒå…¥SDL2æˆ–XCBæˆ–OPenGLï¼ˆXCBä½¿ç”¨dri3æ¸²æŸ“å¼•æ“ï¼‰çª—å£è¿›è¡Œè§†é¢‘æ¸²æŸ“æ—¶ï¼ˆå³æŠŠQtçš„çª—å£å¥æŸ„ä¼ ç»™SDL2/XCB/openglï¼Œåœ¨Qtçš„QWidgetä¸Šæ˜¾ç¤ºè§†é¢‘ï¼‰ï¼Œå½“è§†é¢‘æµæ²¡æœ‰åˆ·æ–°æ—¶ï¼Œæ­¤æ—¶æ‹–åŠ¨Qtçª—å£ä¸»ç•Œé¢ï¼Œåˆ™è§†é¢‘æ˜¾ç¤ºåŒºåŸŸå˜ä¸ºé»‘æ¿æˆ–è€…ç™½æ¿ï¼Œè€Œå½“æœ‰è§†é¢‘æµåˆ·æ–°æ—¶ï¼Œåˆ™è§†é¢‘æ˜¾ç¤ºåŒºåŸŸæ¢å¤æ­£å¸¸ï¼Œå‡ºç°è¿™ç§æƒ…å†µçš„åŸå› æ˜¯Qtè‡ªèº«çš„æ¸²æŸ“å¼•æ“å’Œç¬¬ä¸‰æ–¹åº“æ¸²æŸ“å‘ç”Ÿå†²çªé€ æˆçš„ã€‚ä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œåªè¦å±è”½æ‰Qtè‡ªèº«æ¸²æŸ“å¼•æ“å³å¯è§£å†³é—®é¢˜ï¼Œå³åœ¨QWidget::winId()è¢«ä¼ ç»™SDL2æˆ–XCBæˆ–openglçš„é‚£ä¸ªç»§æ‰¿QWidgetçš„è‡ªå®šä¹‰ç±»ä¸­è¿›è¡Œå¤„ç†ï¼Œé‡å†™è¦è¢«ç¬¬ä¸‰æ–¹åº“æ¸²æŸ“çš„æ§ä»¶ï¼Œåœ¨å…¶æ„é€ å‡½æ•°ä¸­æ·»åŠ setAttribute(Qt::WA_PaintOnScreen,true)ï¼Œå¹¶é‡æ–°å®ç°çˆ¶ç±»çš„è™šå‡½æ•°QPaintEngine *paintEngine() constï¼Œå…·ä½“åšæ³•è§ä¸‹é¢çš„ä»£ç ã€‚ é‡å†™è‡ªå·±è¦è¢«ç¬¬ä¸‰æ–¹åº“æ¸²æŸ“çš„æ§ä»¶ï¼Œåœ¨å…¶æ„é€ å‡½æ•°ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950Widget::Widget(QWidget *parent) : QWidget(parent)&#123; this-&gt;setFixedSize(580, 800); XcbWidget *m_xcbWidget = new XcbWidget(this); m_xcbWidget-&gt;setFixedSize(480, 800); QHBoxLayout *mainLayout = new QHBoxLayout; mainLayout-&gt;setSpacing(10); mainLayout-&gt;setMargin(0); mainLayout-&gt;addWidget(m_xcbWidget); this-&gt;setLayout(mainLayout);&#125;int Widget::initXcbDri3()&#123; xcb_window_t win; xcb_connection_t *c; int ret; int drm_fd; c = QX11Info::connection(); win = (uintptr_t)m_xcbWidget-&gt;winId(); printf(&quot;win Id:%d\\n&quot;, win); //init and get drm fd from xcb-dri3 drm_fd = xcb_dri3_helper_open(c, win); if (drm_fd &lt; 0) &#123; fprintf(stderr, &quot;ERROR: DRI3 failed to initialize&quot;); goto fail; &#125; ret = xcb_dri3_helper_drawable_init(c, win, &amp;draw, drm_fd); if (ret) &#123; returun 1; &#125; return 0;&#125;XcbWidget::XcbWidget(QWidget *parent) : QWidget(parent)&#123; setFixedSize(480, 800); setAttribute(Qt::WA_PaintOnScreen, true);//é‡å†™è¦è¢«ç¬¬ä¸‰æ–¹åº“æ¸²æŸ“çš„æ§ä»¶ï¼Œåœ¨å…¶æ„é€ å‡½æ•°ä¸­æ·»åŠ setAttribute(Qt::WA_PaintOnScreen, true)&#125; é‡æ–°å®ç°çˆ¶ç±»è™šå‡½æ•° QPaintEngine *paintEngine() constï¼Œè¿™é‡Œéœ€è¦é…åˆsetAttribute(Qt::WA_PaintOnScreen, true)è¿›è¡Œä½¿ç”¨ï¼Œé¿å…Qtçš„æ¸²æŸ“å¼•æ“å’Œdri3çš„æ¸²æŸ“å¼•æ“å†²çªè€Œå¯¼è‡´æ— è§†é¢‘åˆ·æ–°æ—¶æ‹–åŠ¨ç•Œé¢æ—¶å‡ºç°çš„ç™½æ¿æˆ–é»‘æ¿ç°è±¡ 1234QPaintEngine *XcbWidget::paintEngine() const&#123; return 0;&#125; 3 è§£å†³Qtä¸­signalså’Œgio/gstä¸­signalså†²çªçš„é—®é¢˜ åœ¨Qtå·¥ç¨‹ä¸­ï¼Œä¸€ä¸ªç±»ä¸­ç”¨åˆ°gioæˆ–gstçš„å‡½æ•°ï¼Œä¸”åœ¨å¼•å…¥gioæˆ–gstçš„å¤´æ–‡ä»¶åï¼Œç¼–è¯‘æ—¶ä¼šé‡åˆ°ç±»ä¼¼å¦‚ä¸‹çš„æŠ¥é”™ï¼šerror: expected unqualified-id before â€˜publicâ€™ GDBusSignalInfo **signals;ã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œæœ‰å‡ ç§åŠæ³•å¯ä»¥è§£å†³ã€‚ æ‰€æœ‰glibçš„å¤´æ–‡ä»¶å¼•å…¥æ”¾åœ¨Qtçš„å¤´æ–‡ä»¶å¼•å…¥ä¹‹å‰ proæ–‡ä»¶ä¸­åŠ å…¥ï¼šCONFIG += no_keywordsï¼Œ å¹¶åœ¨ä»£ç ä¸­ä½¿ç”¨Q_SIGNALSæ›¿æ¢signals #undef signals â€¦â€¦ #define signals public åŸå› åˆ†æï¼šç»“æ„ä½“_GDBusInterfaceInfoä¸­çš„signalsä¸Qtä¸­çš„ä¿¡å·signalså…³é”®è¯å†²çªäº†ã€‚ 12345678910struct _GDBusInterfaceInfo&#123; /*&lt; public &gt;*/ volatile gint ref_count; gchar *name; GDBusMethodInfo **methods; GDBusSignalInfo **signals; GDBusPropertyInfo **properties; GDBusAnnotationInfo **annotations;&#125;; ä¸‹é¢ä»£ç æ®µæ¼”ç¤ºäº†ç¬¬ä¸‰ç§çš„ä½¿ç”¨æ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536utils.h#include &lt;QObject&gt;class Utils : public QObject&#123; Q_OBJECTpublic: explicit Utils(QObject *parent = 0); ~Utils();&#125;;utils.cpp#include &quot;utils.h&quot;#undef signalsextern &quot;C&quot; &#123; #include &lt;gio/gio.h&gt; #include &lt;gio/gunixmounts.h&gt; #include &lt;gio/gdesktopappinfo.h&gt; #include &lt;gio/gappinfo.h&gt;&#125;#define signals publicUtils::Utils(QObject *parent) : QObject(parent)&#123;&#125;Utils::~Utils()&#123;&#125; 4 Qt qDebugæ‰“å°ä¿¡æ¯å¤„ç† åœ¨è°ƒè¯•Qtç¨‹åºæ—¶ï¼Œç»å¸¸éœ€è¦qDebugæ‰“å°ä¿¡æ¯ï¼Œå°½å¿«å®šä½bugï¼Œåœ¨å‘å¸ƒQtç¨‹åºæ—¶ï¼Œå»æ‰debugæ‰“å°ï¼Œå¯ä»¥åŠ å¿«ç¨‹åºæ‰§è¡Œé€Ÿåº¦ï¼Œå‡å°ç¨‹åºä½“ç§¯ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¦‚æœæ‰‹åŠ¨æ³¨é‡ŠqDebugå°±å¤ªéº»çƒ¦äº†ï¼Œå¯ä»¥ä½¿ç”¨å®æ¥è§£å†³è¯¥é—®é¢˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š åœ¨proæ–‡ä»¶é‡ŒåŠ ä¸Šä¸€è¡Œé¢„å®šä¹‰å®å³å¯ã€‚ 12DEFINES += QT_NO_DEBUG_OUTPUT \\ QT_NO_WARNING_OUTPUT ä»£ç ä¸­çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š 123456789101112131415161718#ifndef QT_DEBUG return 1;#else return 0;#endif#ifndef QT_NO_DEBUG_STREAMQDebug operator&lt;&lt;(QDebug deg, const MyInfo &amp;info)&#123; QDebugStateSaver saver(deg); Q_UNUSED(saver) deg.space() &lt;&lt; &quot;name:&quot; &lt;&lt; info.name(); deg &lt;&lt; &quot;Address:&quot; &lt;&lt; info.addressList(); return deg;&#125;#endif 5 Qt Dbusè§£æ Dict of {String, Dict of {String, Variant}}ç±»å‹çš„æ•°æ® å‚è€ƒä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728QDBusInterface m_interface(&quot;org.freedesktop.NetworkManager&quot;, &quot;/org/freedesktop/NetworkManager/Settings&quot;, &quot;org.freedesktop.NetworkManager.Settings&quot;, QDBusConnection::systemBus() );QDBusReply&lt;QList&lt;QDBusObjectPath&gt;&gt; m_reply = m_interface.call(&quot;ListConnections&quot;);QList&lt;QDBusObjectPath&gt; m_objNets = m_reply.value();foreach (QDBusObjectPath objNet, m_objNets)&#123; qDebug()&lt;&lt;&quot;Setting path: &quot;&lt;&lt;objNet.path(); //åˆ—å‡ºæ¯ä¸€ä¸ªç½‘ç»œè®¾ç½®çš„å¯¹è±¡è·¯å¾„ QDBusInterface m_interface(&quot;org.freedesktop.NetworkManager&quot;, objNet.path(), &quot;org.freedesktop.NetworkManager.Settings.Connection&quot;, QDBusConnection::systemBus()); QDBusMessage reply = m_interface.call(&quot;GetSettings&quot;); const QDBusArgument &amp;dbusArg = reply.arguments().at( 0 ).value&lt;QDBusArgument&gt;(); //DBus type : a&#123;sa&#123;sv&#125;&#125;, a map with a key of QString, which maps to another map of QString,QVariant QMap&lt;QString,QMap&lt;QString,QVariant&gt;&gt; map; dbusArg &gt;&gt; map; //qDebug() &lt;&lt; &quot;Map is: &quot; &lt;&lt; map; for(QString key : map.keys() )&#123; QMap&lt;QString,QVariant&gt; innerMap = map.value(key); qDebug() &lt;&lt; &quot;Key: &quot; &lt;&lt; key; if (key == &quot;ipv4&quot;) &#123; for (QString inner_key : innerMap.keys())&#123; qDebug() &lt;&lt; &quot; &quot; &lt;&lt; inner_key &lt;&lt; &quot;:&quot; &lt;&lt; innerMap.value(inner_key); &#125; &#125; &#125;&#125;","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https://eightplus.github.io/tags/Qt/"}]},{"title":"X11è¿›è¡Œçª—å£çŠ¶æ€è®¾ç½®","slug":"2020-01-13-windowstate","date":"2020-01-13T13:49:40.000Z","updated":"2020-01-13T14:10:31.833Z","comments":true,"path":"2020/01/13/2020-01-13-windowstate/","link":"","permalink":"https://eightplus.github.io/2020/01/13/2020-01-13-windowstate/","excerpt":"","text":"åœ¨Qtçš„ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨QWidgetçš„ä¸€äº›å±æ€§å’Œæ§½å‡½æ•°æ¥è¿›è¡Œçª—å£çŠ¶æ€è®¾ç½®ï¼Œæ¯”å¦‚setWindowFlags(windowFlags() | Qt::WindowStaysOnTopHint)å¯ä»¥è®¾ç½®çª—å£ç½®é¡¶ï¼ŒshowMinimized()è®¾ç½®çª—å£æœ€å°åŒ–ï¼ŒshowMaximized()è®¾ç½®çª—å£æœ€å¤§åŒ–ï¼ŒshowFullScreen()è®¾ç½®çª—å£å…¨å±ï¼ŒshowNormal()æ¢å¤çª—å£çš„æ­£å¸¸å¤§å°çŠ¶æ€ã€‚ä½†æ˜¯åœ¨Linuxä¸åŒçš„æ¡Œé¢ç¯å¢ƒå’Œçª—å£ç®¡ç†å™¨ä¸‹ï¼Œè¿™äº›å±æ€§è®¾ç½®å’Œæ§½å‡½æ•°çš„ä½¿ç”¨ï¼Œå¾€å¾€ä¼šå‡ºç°ä¸€äº›é—®é¢˜æˆ–è€…è®¾ç½®æ— æ•ˆã€‚æˆ‘æ›¾ç»é‡åˆ°Qt4ç¼–å†™çš„ä»£ç åœ¨mateæ¡Œé¢ç¯å¢ƒä¸‹ï¼Œä¸ç®¡çª—å£ç®¡ç†å™¨æ˜¯marcoè¿˜æ˜¯mutterï¼Œç¨‹åºå¯åŠ¨çš„æ—¶å€™è®¾ç½®ç½®é¡¶æœ‰æ•ˆï¼Œä½†æ˜¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€åˆ‡æ¢åˆ°ç½®é¡¶æ— æ•ˆã€‚æˆ‘çš„æµ‹è¯•ä»£ç å°†çª—å£éšè—åå¼€å¯ä¸€ä¸ªå®šæ—¶å™¨æƒ³éš”æ®µæ—¶é—´åå†è‡ªåŠ¨å¼¹å‡ºè¯¥çª—å£ï¼Œå¹¶è®©è¯¥çª—å£å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œç»“æœä¸è¡Œï¼Œè€ŒåŒä¸€æ®µä»£ç ä½¿ç”¨Qt5ç¼–è¯‘è¿è¡Œï¼Œåˆ™æ­£å¸¸ã€‚åæ¥æˆ‘ç”¨libwnck-devä¸­x11çš„æ¥å£è§£å†³äº†è¯¥é—®é¢˜ï¼ˆlibwnck/window-action-menu.c:wnck_window_make_above (window)--&gt;libwnck/window.c:_wnck_change_stateï¼‰ã€‚ä¸Šç¯‡æ–‡ç« ä»‹ç»äº†ä½¿ç”¨x11åº“å‡½æ•°æ¥è®¾ç½®å’Œå–æ¶ˆé¼ æ ‡ç‚¹å‡»ç©¿é€ï¼Œæœ¬ç¯‡æ–‡ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨x11çš„åº“å‡½æ•°æ¥è®¾ç½®çª—å£çŠ¶æ€ã€‚ å¦‚ä¸‹æ˜¯æˆ‘å½“æ—¶æµ‹è¯•è®©éšè—çš„ä¸»ç•Œé¢é‡æ–°æ˜¾ç¤ºå¹¶å¤„äºæ¿€æ´»çŠ¶æ€çš„ä»£ç ï¼š 123456789101112//for marco window managerthis-&gt;setWindowState(Qt::WindowActive);this-&gt;activateWindow();this-&gt;show();this-&gt;raise();//for mutter window managerthis-&gt;hide();this-&gt;setWindowState(Qt::WindowActive);this-&gt;activateWindow();this-&gt;show();this-&gt;raise(); ç¤ºä¾‹æºç  windowstate å¼€å‘åº“çš„å®‰è£…$ sudo apt install qtbase5-dev qt5-qmake qtchooser qtscript5-dev qttools5-dev-tools qtbase5-dev-tools libqt5x11extras5-dev libx11-dev libxext-dev ç¤ºä¾‹æºç çš„ç¼–è¯‘å’Œè¿è¡Œ123$ qmake$ make$ ./windowstate ç¤ºä¾‹ä»£ç åˆ†æè¦ç‚¹ åœ¨Qtçš„.proæ–‡ä»¶ä¸­ï¼Œéœ€è¦æ³¨æ„å¦‚ä¸‹ä¸‰è¡Œï¼Œå³é“¾æ¥x11å’Œxextåº“ã€‚ 123QT += x11extrasCONFIG += link_pkgconfigPKGCONFIG += x11 xext è·å–å½“å‰æ¡Œé¢å±æ€§å€¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152#include &lt;QtX11Extras/QX11Info&gt;#include &lt;X11/extensions/shape.h&gt;#include &lt;X11/Xatom.h&gt;#include &lt;X11/Xlib.h&gt;unsigned char *getWindowProperty(Display *display, Window win, const char *prop)&#123; Atom reqAtom = XInternAtom(display, prop, true); if (reqAtom == None) &#123; return NULL; &#125; int retCheck = None; Atom retType = None; int retFormat = 0; unsigned long retItems = 0UL; unsigned long retMoreBytes = 0UL; unsigned char* retValue = NULL; retCheck = XGetWindowProperty(display, win, reqAtom, 0L, 0L, false, AnyPropertyType, &amp;retType, &amp;retFormat, &amp;retItems, &amp;retMoreBytes, &amp;retValue); if (retValue != NULL) &#123; XFree(retValue); retValue = NULL; &#125; if (retCheck != Success || retType == None || retMoreBytes == 0) &#123; return NULL; &#125; retCheck = None; retFormat = 0; retItems = 0UL; // Convert the byte length into 32bit multiples. if (retMoreBytes % 4 != 0) retMoreBytes += 4 - retMoreBytes % 4; retMoreBytes /= 4; // Request the actual property value with correct length and type. retCheck = XGetWindowProperty(display, win, reqAtom, 0L, retMoreBytes, false, retType, &amp;retType, &amp;retFormat, &amp;retItems, &amp;retMoreBytes, &amp;retValue); if (retCheck != Success || retMoreBytes != 0) &#123; if (retValue != NULL) XFree(retValue); return NULL; &#125; return retValue;&#125; è®¾ç½®çª—å£ç½®é¡¶/å–æ¶ˆçª—å£ç½®é¡¶ 12345678910111213141516171819202122232425262728293031void Utils::setStayOnTop(int wid, bool top)&#123; const auto display = QX11Info::display();//Display *display = QX11Info::display(); const auto wmState = XInternAtom(display, &quot;_NET_WM_STATE&quot;, false); const auto wmStateAbove = XInternAtom(display, &quot;_NET_WM_STATE_ABOVE&quot;, false); const auto wmStateStaysOnTop = XInternAtom(display, &quot;_NET_WM_STATE_STAYS_ON_TOP&quot;, false); XEvent xev; memset(&amp;xev, 0, sizeof(xev)); xev.xclient.type = ClientMessage; xev.xclient.display = display; xev.xclient.window = wid; xev.xclient.message_type = wmState; xev.xclient.format = 32; if (top) xev.xclient.data.l[0] = 1;// add/set property else xev.xclient.data.l[0] = 0;// remove/unset property xev.xclient.data.l[1] = wmStateAbove; xev.xclient.data.l[2] = wmStateStaysOnTop; xev.xclient.data.l[3] = 1; XSendEvent(display, QX11Info::appRootWindow(QX11Info::appScreen()), false, SubstructureRedirectMask | SubstructureNotifyMask, &amp;xev); XFlush(display);&#125; è®¾ç½®/å–æ¶ˆçª—å£å…¨å± 1234567891011121314151617181920212223242526272829303132void Utils::showFullscreenWindow(int wid, bool fullscreen)&#123; const auto display = QX11Info::display();//Display *display = QX11Info::display(); const auto screen = QX11Info::appScreen(); const Atom wmState = XInternAtom(display, &quot;_NET_WM_STATE&quot;, false); const Atom wmfullscreenState = XInternAtom(display, &quot;_NET_WM_STATE_FULLSCREEN&quot;, false); XEvent xev; memset(&amp;xev, 0, sizeof(xev)); xev.xclient.type = ClientMessage; xev.xclient.display = display; xev.xclient.window = wid; xev.xclient.message_type = wmState; xev.xclient.format = 32; if (fullscreen) &#123; xev.xclient.data.l[0] = 1;//add/set property &#125; else &#123; xev.xclient.data.l[0] = 0;//remove/unset property &#125; xev.xclient.data.l[1] = wmfullscreenState; xev.xclient.data.l[2] = 0; xev.xclient.data.l[3] = 1; XSendEvent(display, QX11Info::appRootWindow(screen), false, SubstructureRedirectMask | SubstructureNotifyMask, &amp;xev ); XFlush(display);&#125; è®¾ç½®/å–æ¶ˆçª—å£æœ€å¤§åŒ– 123456789101112131415161718192021222324252627282930313233void Utils::showMaximizedWindow(int wid, int state)&#123; // state: // 0: remove/unset property // 1: add/set property // 2: toggle property const auto display = QX11Info::display();//Display *display = QX11Info::display(); const auto screen = QX11Info::appScreen(); const Atom wmState = XInternAtom(display, &quot;_NET_WM_STATE&quot;, false); const Atom wmAddState = XInternAtom(display, &quot;_NET_WM_STATE_ADD&quot;, false); const Atom wmVMaximizedState = XInternAtom(display, &quot;_NET_WM_STATE_MAXIMIZED_VERT&quot;, false); const Atom wmHMaximizedState = XInternAtom(display, &quot;_NET_WM_STATE_MAXIMIZED_HORZ&quot;, false); XEvent xev; memset(&amp;xev, 0, sizeof(xev)); xev.xclient.type = ClientMessage; xev.xclient.display = display; xev.xclient.window = wid; xev.xclient.message_type = wmState; xev.xclient.format = 32; xev.xclient.data.l[0] = state;//xev.xclient.data.l[0] = wmAddState; xev.xclient.data.l[1] = wmVMaximizedState; xev.xclient.data.l[2] = wmHMaximizedState; xev.xclient.data.l[3] = 1; XSendEvent(display, QX11Info::appRootWindow(screen), false, SubstructureRedirectMask | SubstructureNotifyMask, &amp;xev); XFlush(display);&#125; è®¾ç½®/å–æ¶ˆçª—å£æœ€å°åŒ– 123456789101112131415161718192021222324252627282930313233void Utils::showMinimizedWindow(int wid, bool minimized)&#123; const auto display = QX11Info::display();//Display *display = QX11Info::display(); const auto screen = QX11Info::appScreen(); const Atom wmState = XInternAtom(display, &quot;_NET_WM_STATE&quot;, false); const Atom wmHiddenState = XInternAtom(display, &quot;_NET_WM_STATE_HIDDEN&quot;, false); XEvent xev; memset(&amp;xev, 0, sizeof(xev)); xev.xclient.type = ClientMessage; xev.xclient.display = display; xev.xclient.window = wid; xev.xclient.message_type = wmState; xev.xclient.format = 32; if (minimized) &#123; xev.xclient.data.l[0] = 1;//add/set property &#125; else &#123; xev.xclient.data.l[0] = 0;//remove/unset property &#125; xev.xclient.data.l[1] = wmHiddenState; xev.xclient.data.l[2] = 0; xev.xclient.data.l[3] = 1; XSendEvent(display, QX11Info::appRootWindow(screen), false, SubstructureRedirectMask | SubstructureNotifyMask, &amp;xev ); XIconifyWindow(display, wid, screen); XFlush(display);&#125; å‚è€ƒæ–‡æ¡£ https://tronche.com/gui/x/xlib/window-information/XInternAtom.html https://linux.die.net/man/3/xinternatom https://tronche.com/gui/x/xlib/event-handling/XSendEvent.html https://tronche.com/gui/x/xlib/events/structures.html https://tronche.com/gui/x/xlib/events/client-communication/client-message.html#XClientMessageEvent https://tronche.com/gui/x/xlib/window-information/properties-and-atoms.html","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt X11","slug":"Qt-X11","permalink":"https://eightplus.github.io/tags/Qt-X11/"}]},{"title":"é¼ æ ‡ç‚¹å‡»ç©¿é€","slug":"2020-01-12-inputpass","date":"2020-01-12T04:39:05.000Z","updated":"2020-01-13T13:51:25.537Z","comments":true,"path":"2020/01/12/2020-01-12-inputpass/","link":"","permalink":"https://eightplus.github.io/2020/01/12/2020-01-12-inputpass/","excerpt":"","text":"é¼ æ ‡ç‚¹å‡»ç©¿é€ï¼Œå³æ‰€æœ‰é¼ æ ‡é”®ç›˜æ“ä½œå…¨éƒ¨ä¼šç©¿é€çª—å£åˆ°ä¸‹æ–¹çª—å£ã€‚åœ¨Linuxä¸‹ï¼ŒQtçš„Qt::WA_TransparentForMouseEventså±æ€§å¯ä»¥å¯¹å­éƒ¨ä»¶å®ç°é¼ æ ‡ç©¿é€ï¼Œä½†æ˜¯å¯¹æ•´ä¸ªçª—å£ä¸è¡Œï¼Œè¦æƒ³åœ¨Linuxä¸‹å¯¹Qtçš„æ•´ä¸ªçª—å£è®¾ç½®é¼ æ ‡ç©¿é€ï¼Œè¿™æ—¶å€™å¯ä»¥ç”¨åˆ°X11ä¸­x11shapeçš„XShapeCombineRectangles()åº“å‡½æ•°ï¼Œå¾ˆå¤šçª—å£æŒ‚ä»¶éƒ½æ˜¯è¿™æ ·åšçš„ï¼Œå¦‚osdæ¡Œé¢æ­Œè¯ç¨‹åºç­‰ç­‰ã€‚ç¤ºä¾‹ä»£ç ç¼–å†™äº†ä¸€ä¸ªç®€å•çš„æ¡Œé¢æ°´å°ï¼Œåœ¨æ¡Œé¢çš„å³ä¸‹æ–¹æ˜¾ç¤ºäº†ä¸€å¼ å›¾ç‰‡å’Œä¸€æ®µæ–‡å­—æè¿°ï¼Œåœ¨è®¾ç½®äº†é¼ æ ‡ç‚¹å‡»ç©¿é€çš„æƒ…å†µä¸‹ç”¨é¼ æ ‡ç‚¹å‡»è¯¥æ°´å°ï¼Œæ˜¯å¯ä»¥ç›´æ¥ç©¿é€è¯¥æ°´å°çš„ã€‚ ç¤ºä¾‹æºç  inputpass å¼€å‘åº“çš„å®‰è£…$ sudo apt install qtbase5-dev qt5-qmake qtchooser qtscript5-dev qttools5-dev-tools qtbase5-dev-tools libqt5x11extras5-dev libx11-dev libxext-dev ç¤ºä¾‹æºç çš„ç¼–è¯‘å’Œè¿è¡Œ123$ qmake$ make$ ./inputpass XShapeCombineRectanglesåº“å‡½æ•°å‚æ•°åˆ†æ12345678910void XShapeCombineRectangles ( Display *dpy, XID dest, int destKind, int xOff, int yOff, XRectangle *rects, int n_rects, int op, int ordering); åœ¨è®¾ç½®é¼ æ ‡ç©¿é€çš„æ—¶å€™ç»™å‡½æ•°ä¼ çš„ç¬¬å…­ä¸ªå‚æ•°ä¸ºNULLï¼ˆå‚æ•°ä¸ºXRectangle*ç±»å‹ï¼‰ï¼Œé‚£æ•´ä¸ªçª—å£éƒ½å°†è¢«ç©¿é€ï¼Œç¬¬ä¸ƒä¸ªå‚æ•°å°±æ˜¯æ§åˆ¶è®¾ç½®ç©¿é€çš„ï¼Œä¸º0æ—¶è¡¨ç¤ºè®¾ç½®é¼ æ ‡ç©¿é€ï¼Œä¸º1æ—¶è¡¨ç¤ºå–æ¶ˆé¼ æ ‡ç©¿é€ï¼Œå½“å–æ¶ˆè®¾ç½®é¼ æ ‡ç©¿é€çš„æ—¶å€™ï¼Œå¿…é¡»è®¾ç½®åŒºåŸŸï¼Œå³ç¬¬å…­ä¸ªå‚æ•°ä¸å†ä¸ºNULL(å½“ç¬¬6ä¸ªå‚æ•°XRectangleçš„xï¼Œyï¼Œwidthå’Œheightéƒ½ä¸º0,ä¸”ç¬¬ä¸ƒä¸ªå‚æ•°è®¾ç½®ä¸º1æ—¶ï¼Œä¹Ÿè¡¨ç¤ºè®¾ç½®ä¸ºé¼ æ ‡ç©¿é€)ã€‚ ç¤ºä¾‹ä»£ç åˆ†æè¦ç‚¹ åœ¨Qtçš„.proæ–‡ä»¶ä¸­ï¼Œéœ€è¦æ³¨æ„å¦‚ä¸‹ä¸‰è¡Œï¼Œå³é“¾æ¥x11å’Œxextåº“ã€‚ 123QT += x11extrasCONFIG += link_pkgconfigPKGCONFIG += x11 xext è®¾ç½®é¼ æ ‡ç©¿é€ å¤´æ–‡ä»¶ X11/extensions/shape.h æ¥è‡ªäºlibxext-devåŒ…ã€‚ 12345678910111213141516#include &lt;QtX11Extras/QX11Info&gt;#include &lt;X11/extensions/shape.h&gt;void Utils::passInputEvent(int wid)&#123; XRectangle *reponseArea = new XRectangle; reponseArea-&gt;x = 0; reponseArea-&gt;y = 0; reponseArea-&gt;width = 0; reponseArea-&gt;height = 0; //XShapeCombineRectangles(QX11Info::display(), wid, ShapeInput, 0, 0, reponseArea ,1 ,ShapeSet, YXBanded); XShapeCombineRectangles(QX11Info::display(), wid, ShapeInput, 0, 0, NULL, 0, ShapeSet, YXBanded); delete reponseArea;&#125; å–æ¶ˆé¼ æ ‡ç©¿é€ 123456789101112void Utils::unPassInputEvent(int wid, QSize size)&#123; XRectangle *reponseArea = new XRectangle; reponseArea-&gt;x = 0; reponseArea-&gt;y = 0; reponseArea-&gt;width = size.width(); reponseArea-&gt;height = size.height(); XShapeCombineRectangles(QX11Info::display(), wid, ShapeInput, 0, 0, reponseArea ,1 ,ShapeSet, YXBanded); delete reponseArea;&#125;","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt X11","slug":"Qt-X11","permalink":"https://eightplus.github.io/tags/Qt-X11/"}]},{"title":"Desktop Notification æ¶ˆæ¯æ¡†","slug":"2019-12-26-notification","date":"2019-12-26T13:42:11.000Z","updated":"2020-04-13T15:45:14.522Z","comments":true,"path":"2019/12/26/2019-12-26-notification/","link":"","permalink":"https://eightplus.github.io/2019/12/26/2019-12-26-notification/","excerpt":"","text":"åœ¨Ubuntuç³»ç»Ÿä¸Šï¼Œæˆ‘ä»¬ç»å¸¸å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ¶ˆæ¯æ¡†(Desktop Notification)ï¼Œæ¯”å¦‚ç”µæ± ç”µé‡æé†’å’Œé‚®ä»¶æ¶ˆæ¯æé†’ï¼Œé€šè¿‡è°ƒç”¨org.freedesktop.Notificationsè¿™ä¸ªDBUSæœåŠ¡æä¾›çš„æ¥å£å³å¯åœ¨æ¡Œé¢ä¸Šå¼¹å‡ºè¯¥æ¶ˆæ¯æ¡†ã€‚æ¶ˆæ¯æ¡†è¯·æ±‚æ˜¯å¼‚æ­¥çš„ï¼Œé€šå¸¸æ„é€ æ¶ˆæ¯æ¡†è¯·æ±‚å¹¶å‘é€åï¼Œç”¨æˆ·å°±å¯ä»¥ä¸å†å…³å¿ƒåç»­çš„ä¿¡æ¯ï¼Œå¦‚æœæœ‰ç‰¹æ®Šéœ€è¦åˆ™å¯ä»¥è‡ªå®šä¹‰å¤„ç†org.freedesktop.Notificationså‘é€çš„ä¿¡å·ã€‚notificationçš„ä»‹ç»æ–‡æ¡£è§ï¼šhttps://developer.gnome.org/notification-spec/ ç¤ºä¾‹æºç  notification å¼€å‘åº“çš„å®‰è£…$ sudo apt install qtbase5-dev qt5-qmake qtchooser qtscript5-dev qttools5-dev-tools qtbase5-dev-tools ç¤ºä¾‹æºç çš„ç¼–è¯‘å’Œè¿è¡Œ123$ qmake$ make$ ./notification org.freedesktop.Notifications ç®€ä»‹ org.freedesktop.NotificationsæœåŠ¡çš„æ¶ˆæ¯æ¡†é€šå¸¸ä¼šåŒ…å«å¦‚ä¸‹çš„å±æ€§,å…¶ä¸­Iconå’ŒHintsä¸­çš„image_pathå¿…é¡»ä¸ºæœ¬åœ°ç»å¯¹è·¯å¾„æˆ–è€…file://å¼€å¤´çš„æ–‡ä»¶URLï¼Œä¹Ÿå¯ä»¥æ˜¯æ¡Œé¢ç¯å¢ƒé¢„å®šä¹‰å›¾æ ‡åç§°ï¼Œå¦‚dialog-informationã€‚ åç§° è¯´æ˜ Application Name æ ‡ç¤ºå‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œæœ€å¥½ä½¿ç”¨ç¨‹åºå…¨å Replaces ID å¯é€‰çš„æ¶ˆæ¯IDï¼ŒæœåŠ¡å™¨é€šè¿‡idæ§åˆ¶æ¶ˆæ¯æ¡†çš„æ¸²æŸ“ï¼Œé€šå¸¸ä¸ç”¨å…³æ³¨ Icon æ˜¾ç¤ºåœ¨æ°”æ³¡æ¡†ä¸Šçš„å›¾æ ‡ Summary æ ‡é¢˜ï¼Œåªèƒ½æ˜¾ç¤ºä¸€è¡Œï¼Œå«titleåº”è¯¥æ›´åˆé€‚ Body æ¶ˆæ¯ä½“ï¼Œæ”¯æŒéƒ¨åˆ†HTMLæ ‡ç­¾ï¼›&lt;b&gt;&lt;/b&gt;ï¼›&lt;i&gt;&lt;/i&gt;ï¼›&lt;u&gt;&lt;/u&gt;ï¼›&lt;a&gt;&lt;/a&gt;ï¼›&lt;img src=... alt=...&gt; Actions æ˜¾ç¤ºä¸€äº›æŒ‰é’®æˆ–è€…èœå•ï¼ˆQActionï¼‰ï¼Œä¸è¿‡è¿™ä¸€åŠŸèƒ½é€šå¸¸æœªè¢«å®ç° Hints ä¸ºæ¶ˆæ¯ä½“æä¾›çš„é¢å¤–æ•°æ®ï¼Œæ¯”å¦‚æ˜¾ç¤ºåœ¨å±å¹•çš„ä½ç½®ï¼ˆxï¼Œyåæ ‡ï¼‰ Expiration Timeout æ°”æ³¡æ¡†æ˜¾ç¤ºçš„æ—¶é•¿ï¼Œå•ä½æ¯«ç§’ï¼›æŒ‡å®šä¸º-1æ—¶è¡Œä¸ºå–å†³äºå®ç°ï¼›ä¸º0æ—¶æ°”æ³¡æ¡†å°†ä¸€ç›´æ˜¾ç¤ºåœ¨æ¡Œé¢ä¸Šç›´åˆ°ç”¨æˆ·ç‚¹å‡» æ¶ˆæ¯æ¡†è¿˜æœ‰ä¸‰ä¸ªç´§æ€¥ç¨‹åº¦å¯ä¾›é€‰æ‹©ï¼š åç§° å€¼ è¯´æ˜ Low 0 é»˜è®¤å€¼ï¼Œå¯ä»¥è®¾ç½®å¦‚ä½•æ˜¾ç¤ºï¼Œåº”è¯¥è®¾ç½®ä¸€ä¸ªåˆç†çš„æ˜¾ç¤ºæ—¶é—´ä»¥ä¾¿æ°”æ³¡æ¡†å¯ä»¥éšè—é€€å‡º Normal 1 åŒlow Critical 2 ä»£è¡¨é‡è¦é€šçŸ¥ï¼Œä¸åº”è¯¥è‡ªåŠ¨è¿‡æœŸéšè— ç¤ºä¾‹ä»£ç åˆ†æè¦ç‚¹ å¦‚ä¸‹ä»£ç æ®µæ¼”ç¤ºäº†Qtå¦‚ä½•å»è°ƒç”¨org.freedesktop.Notificationsè¿™ä¸ªdbusæœåŠ¡çš„Notifyæ–¹æ³•ï¼Œä¼ é€’çš„å‚æ•°æ˜¯QList&lt;QVariant&gt;`ç±»å‹ï¼Œå‚æ•°ä¸­åŒ…æ‹¬äº†ä¸Šé¢æåˆ°çš„ä¸€äº›å±æ€§ï¼Œå¦‚Application Nameï¼Œ Replaces IDå’ŒIconç­‰ã€‚ 12345678910111213141516QDBusInterface notification(&quot;org.freedesktop.Notifications&quot;, &quot;/org/freedesktop/Notifications&quot;, &quot;org.freedesktop.Notifications&quot;, QDBusConnection::sessionBus());QList&lt;QVariant&gt; args;args &lt;&lt; (QCoreApplication::applicationName()) // appname &lt;&lt; ((unsigned int) 0) // replaces id &lt;&lt; QString(&quot;dialog-information&quot;) // icon &lt;&lt; tr(&quot;Test notification&quot;) // summary (notification title) &lt;&lt; tr(&quot;Hello, My name is lixiang&quot;) // body &lt;&lt; QStringList() // actions &lt;&lt; QVariantMap() // hints &lt;&lt; (int) -1; // timeoutnotification.callWithArgumentList(QDBus::AutoDetect, &quot;Notify&quot;, args); å…¶ä»–è¯­è¨€å¼¹å‡ºæ¶ˆæ¯æ¡† é™¤äº†ç¤ºä¾‹ä»£ç ä½¿ç”¨Qtå¼¹å‡ºæ¶ˆæ¯æ¡†ä¹‹å¤–ï¼Œå…¶ä»–è¯­è¨€å’Œè„šæœ¬åŒæ ·å¯ä»¥å®ç°è¯¥åŠŸèƒ½ï¼Œå…·ä½“å‚è€ƒï¼šhttps://wiki.archlinux.org/index.php/Desktop_notifications#Usage_in_programmingï¼Œè¿™é‡Œè¿˜ç®€è¦æåŠä¸‹ä¸¤ç§æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š notify-send åœ¨Ubuntuä¸‹ä½¿ç”¨notify-sendï¼Œéœ€å®‰è£…libnotify-binåŒ…ï¼ˆsudo apt install libnotify-binï¼‰,notify-sendçš„æ–‡æ¡£è§ï¼šhttps://ss64.com/bash/notify-send.html) 12# notify-send title body [options]notify-send &quot;Hello&quot; &quot;My name is lixiang&quot; -i dialog-information -t 10000 pythonè°ƒç”¨ 1234567#!/usr/bin/pythonimport gigi.require_version(&apos;Notify&apos;, &apos;0.7&apos;)from gi.repository import NotifyNotify.init(&quot;demo&quot;)Hello = Notify.Notification.new(&quot;Hello&quot;, &quot;My name is lixiang.&quot;, &quot;dialog-information&quot;)Hello.show()","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https://eightplus.github.io/tags/Qt/"}]},{"title":"Qtå¤šçº¿ç¨‹ä¹‹QtConcurrent::map()","slug":"2019-11-15-qtconcurrent-map","date":"2019-11-15T07:53:10.000Z","updated":"2019-11-15T08:10:20.597Z","comments":true,"path":"2019/11/15/2019-11-15-qtconcurrent-map/","link":"","permalink":"https://eightplus.github.io/2019/11/15/2019-11-15-qtconcurrent-map/","excerpt":"","text":"QtConcurrent::map()ã€QtConcurrent::mapped()å’ŒQtConcurrent::mappedReduced()å‡½æ•°å¯ä»¥å¯¹ä¸€ä¸ªåºåˆ—ä¸­ï¼ˆå¦‚QListã€QVectorç­‰ï¼‰çš„é¡¹ç›®å¹¶è¡Œåœ°è¿›è¡Œè®¡ç®—ã€‚ ç¤ºä¾‹æºç  qtconcurrent-map å¼€å‘åº“çš„å®‰è£…$ sudo apt install qtbase5-dev qt5-qmake qtchooser qtscript5-dev qttools5-dev-tools qtbase5-dev-tools ç¤ºä¾‹æºç çš„ç¼–è¯‘å’Œè¿è¡Œ123$ qmake$ make$ ./qtconcurrent-map-demo ç¤ºä¾‹ä»£ç åˆ†æè¦ç‚¹QtConcurrent::map() å¦‚æœæƒ³ç›´æ¥ä¿®æ”¹ä¸€ä¸ªåºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨QtConcurrent::map()ã€‚è¿™ä¸ªå‡½æ•°ä¼šå°†ä½œä¸ºå‚æ•°ä¼ å…¥çš„å‡½æ•°åº”ç”¨åˆ°å®¹å™¨ä¸­çš„æ¯ä¸€é¡¹ï¼Œå¯¹è¿™äº›é¡¹è¿›è¡Œå°±åœ°ä¿®æ”¹ï¼Œå³QtConcurrent::map()çš„åºåˆ—è¢«ç›´æ¥ä¿®æ”¹ã€‚è™½ç„¶QtConcurrent::map()ä¸é€šè¿‡QFutureè¿”å›ä»»ä½•ç»“æœï¼ˆmapå‡½æ•°çš„è¿”å›å€¼ã€è¿”å›ç±»å‹æ²¡æœ‰è¢«ä½¿ç”¨ï¼‰ä½†ä»ç„¶å¯ä»¥ä½¿ç”¨QFutureå’ŒQFutureWatcherç›‘æ§mapçš„çŠ¶æ€ã€‚mapå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯åºåˆ—(å¦‚QList)ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯åŒæ—¶ç”¨ç¬¬äºŒä¸ªå‚æ•°æ¥è®¡ç®—ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œä¸”ç»“æœç›´æ¥è¦†ç›–åˆ°å…ƒç´ ä¸­ã€‚ç¤ºä¾‹ä»£ç ä¸­m_listçš„å€¼ç”±åŸæ¥çš„(1, 3, 5, 7, 9)å˜æˆäº†(2, 4, 6, 8, 10)ï¼Œå‡½æ•°my_fun1è¢«è°ƒç”¨äº†5æ¬¡ï¼Œä¸”æ ¹æ®æ‰“å°å¤„ç†çš„çº¿ç¨‹idå¯ä»¥åˆ¤æ–­è¿™5æ¬¡è°ƒç”¨éƒ½æ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œè€Œä¸”éƒ½å’Œä¸»è¿›ç¨‹çš„çº¿ç¨‹idä¸åŒï¼š 123456789101112131415void my_fun1(int &amp;value)&#123; qDebug() &lt;&lt; &quot;run my_fun1 thread id:&quot; &lt;&lt; QThread::currentThreadId(); value += 1;&#125;void MainWindow::onMapBtnClicked()&#123; QList&lt;int&gt; m_list; m_list &lt;&lt; 1 &lt;&lt; 3 &lt;&lt; 5 &lt;&lt; 7 &lt;&lt; 9; QFuture&lt;void&gt; future = QtConcurrent::map(m_list, my_fun1); future.waitForFinished(); qDebug() &lt;&lt; &quot;m_list: &quot;&lt;&lt; m_list;&#125; QtConcurrent::mapped() QtConcurrent::mapped()å‡½æ•°ä¸QtConcurrent::map()å‡½æ•°ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºQtConcurrent::mapped()å‡½æ•°æ¥å—ä¸€ä¸ªè¾“å…¥åºåˆ—å’Œä¸€ä¸ªmapå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«ä¿®æ”¹å†…å®¹çš„æ–°åºåˆ—ï¼ˆå³æŠŠè®¡ç®—ç»“æœæ”¾åˆ°äº†æ–°çš„å®¹å™¨ä¸­ï¼‰ï¼Œé€‚ç”¨äºè¿›è¡Œæ•°æ®å¤„ç†åéœ€è¦æ•´ç†ä¸ºæ–°çš„æ•°æ®ç»“æ„çš„æƒ…å†µã€‚ ä»å¦‚ä¸‹çš„ç¤ºä¾‹ä»£ç çš„è¿è¡Œç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŸå®¹å™¨çš„å€¼æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼ŒåŸå®¹å™¨çš„å€¼ä¸º (2, 4, 6, 8, 10)ï¼Œä¿®æ”¹åçš„æ–°å®¹å™¨çš„å€¼ä¸º(1, 3, 5, 7, 9)ï¼Œå‡½æ•°my_fun2è¢«è°ƒç”¨äº†5æ¬¡ï¼Œä¸”æ ¹æ®æ‰“å°å¤„ç†çš„çº¿ç¨‹idå¯ä»¥åˆ¤æ–­è¿™5æ¬¡è°ƒç”¨éƒ½æ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œè€Œä¸”éƒ½å’Œä¸»è¿›ç¨‹çš„çº¿ç¨‹idä¸åŒï¼š 12345678910111213141516int my_func2(int value)&#123; qDebug() &lt;&lt; &quot;run my_func2 thread id:&quot; &lt;&lt; QThread::currentThreadId(); return value - 1;&#125;void MainWindow::onMappedBtnClicked()&#123; QList&lt;int&gt; m_list; m_list &lt;&lt; 2 &lt;&lt; 4 &lt;&lt; 6 &lt;&lt; 8 &lt;&lt; 10; QFuture&lt;int&gt; future = QtConcurrent::mapped(m_list, my_func2); future.waitForFinished(); qDebug()&lt;&lt;&quot;m_list: &quot; &lt;&lt; m_list; qDebug()&lt;&lt;&quot;new list: &quot; &lt;&lt; future.results();&#125; ä¸‹é¢å†ä»‹ç»ä¸€æ®µç¨å¾®å¤æ‚ç‚¹çš„å…³äºQtConcurrent::mapped()çš„ä»£ç ç‰‡æ®µï¼Œåœ¨åŠ è½½å¤šå¼ ç…§ç‰‡çš„è¿‡ç¨‹ä¸­ï¼Œä½“ç°å¦‚ä½•è¿›è¡Œçº¿ç¨‹æ‰§è¡Œçš„è¿›åº¦ã€å–æ¶ˆ/æš‚åœ/æ¢å¤ç­‰ã€‚ç‚¹å‡»ç¤ºä¾‹ä»£ç ä¸­çš„â€œæ‰“å¼€â€æŒ‰é’®æ—¶ï¼Œè°ƒç”¨æ§½å‡½æ•°onOpenBtnClicked()ï¼Œé»˜è®¤æ‰“å¼€å›¾ç‰‡ç›®å½•è¿›è¡Œå›¾ç‰‡é€‰æ‹©ã€‚ç„¶åæ ¹æ®å›¾ç‰‡åˆ›å»ºå¯¹åº”æ•°é‡QLabelå»æ˜¾ç¤ºç¼©æ”¾çš„å›¾ç‰‡ï¼Œä¸ºäº†ä½“ç°å‡ºä¸€ä¸ªè€—æ—¶å¤„ç†è¿›åº¦ï¼Œæˆ‘åœ¨ä»£ç å›¾ç‰‡ç¼©æ”¾å¤„ç†çš„è¿‡ç¨‹ä¸­ç‰¹æ„æ·»åŠ äº†sleep()ï¼Œå¹¶æ·»åŠ äº†ä¸€ä¸ªè¿›åº¦æ¡ã€‚å›¾ç‰‡é€‰æ‹©å®Œæˆåï¼Œä½¿ç”¨mapped()è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œå¹¶æ·»åŠ è‡³QFutureWatcherä¸­ï¼Œè®©å…¶ä½¿ç”¨ä¿¡å·å’Œæ§½ç›‘è§†QFutureã€‚å½“QFutureWatcherçš„progressRangeChanged()çš„ä¿¡å·è§¦å‘æ—¶ï¼Œè¿›åº¦æ¡çš„èŒƒå›´ä¼šå‘ç”Ÿæ”¹å˜ï¼Œè€ŒprogressValueChanged()ä¿¡å·è§¦å‘æ—¶ï¼Œä¼šæ›´æ–°è¿›åº¦æ¡çš„å€¼ã€‚å¦‚æœåŠ è½½çš„å›¾ç‰‡è¾ƒå¤šï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»â€œå–æ¶ˆâ€æŒ‰é’®ï¼Œè¿™æ—¶ä¼šè°ƒç”¨QFutureWatcherçš„cancel()æ§½å‡½æ•°æ¥å–æ¶ˆè®¡ç®—ã€‚â€œæš‚åœ/æ¢å¤â€åˆ™è°ƒç”¨togglePaused()æ§½å‡½æ•°ï¼Œç”¨äºåˆ‡æ¢å¼‚æ­¥è®¡ç®—çš„æš‚åœçŠ¶æ€ï¼ˆå¦‚æœè®¡ç®—å½“å‰å·²æš‚åœï¼Œè°ƒç”¨æ­¤å‡½æ•°å°†è¿›è¡Œæ¢å¤ï¼›å¦‚æœè®¡ç®—æ­£åœ¨è¿è¡Œï¼Œåˆ™ä¼šæš‚åœï¼‰ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243void MainWindow::onOpenBtnClicked()&#123; if (m_watcher-&gt;isRunning()) &#123; m_watcher-&gt;cancel(); m_watcher-&gt;waitForFinished(); &#125; QStringList files = QFileDialog::getOpenFileNames(this, tr(&quot;Select Images&quot;), QStandardPaths::writableLocation(QStandardPaths::PicturesLocation), &quot;*.jpg *.png&quot;); if (files.isEmpty()) return; qDeleteAll(m_labels); m_labels.clear(); int dim = qSqrt(qreal(files.count())) + 1; for (int i = 0; i &lt; dim; ++i) &#123; for (int j = 0; j &lt; dim; ++j) &#123; QLabel *imageLabel = new QLabel; imageLabel-&gt;setFixedSize(imageSize,imageSize); m_imagesLayout-&gt;addWidget(imageLabel,i,j); m_labels.append(imageLabel); &#125; &#125; std::function&lt;QImage(const QString&amp;)&gt; image_scale = [imageSize](const QString &amp;imageName) &#123; //åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥çº¿ç¨‹idä¸ä¸»è¿›ç¨‹çš„ä¸ä¸€æ · static int count = 0; qDebug() &lt;&lt; &quot;run image_scale thread id:&quot; &lt;&lt; QThread::currentThreadId(); QImage image(imageName); count += 3; sleep(count); return image.scaled(QSize(imageSize, imageSize), Qt::IgnoreAspectRatio, Qt::SmoothTransformation); &#125;; auto future = QtConcurrent::mapped(files, image_scale); m_watcher-&gt;setFuture(future); m_openBtn-&gt;setEnabled(false); m_cancelBtn-&gt;setEnabled(true); m_pauseBtn-&gt;setEnabled(true);&#125; å½“ç„¶ï¼Œä¸Šé¢å‡ºç°çš„image_scale()å‡½æ•°ä¹Ÿå¯ä»¥å†™æˆå¦‚ä¸‹æ ¼å¼ï¼š 1234567891011QImage image_scale(const QString &amp;imageName)&#123; //åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥çº¿ç¨‹idä¸ä¸»è¿›ç¨‹çš„ä¸ä¸€æ · static int count = 0; qDebug() &lt;&lt; &quot;run image_scale thread id:&quot; &lt;&lt; QThread::currentThreadId(); QImage image(imageName); count += 3; sleep(count); return image.scaled(QSize(imageSize, imageSize), Qt::IgnoreAspectRatio, Qt::SmoothTransformation);&#125; QtConcurrent::mappedReduced() QtConcurrent::mappedReduced()åŠŸèƒ½ç±»ä¼¼äºmapped()ï¼Œä½†å®ƒä¸æ˜¯è¿”å›å…·æœ‰æ–°ç»“æœçš„åºåˆ—ï¼Œå®ƒæ¯”mapped()å¤šä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä¹Ÿæ˜¯ä¸ªå‡½æ•°ï¼Œå®ƒä¼šå°†ä¿®æ”¹è¿‡çš„æ¯ä¸€é¡¹å†ä¼ å…¥è¿™ä¸ªæ¯”mapped()å¤šçš„å‚æ•°å‡½æ•°ä¸­è¿›è¡Œç®€åŒ–ï¼Œå°†å¤šä¸ªç»“æœæŒ‰æŸç§è¦æ±‚ç®€åŒ–æˆä¸€ä¸ªã€‚mappedReducedå‡½æ•°éµå¾ªå¦‚ä¸‹æ ¼å¼ï¼š V function(T &amp;result, const U &amp;intermediate)ï¼Œ å…¶ä¸­resultå°±æ˜¯æœ€åçš„ç»“æœï¼Œintermediateå°±æ˜¯mappedå‡ºæ¥çš„ç»“æœã€‚ ä»å¦‚ä¸‹ç¤ºä¾‹ä»£ç çš„è¿è¡Œç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°resultçš„å€¼ä¸º30,å³å°†æ¯ä¸ªæ–°å€¼åŠ èµ·æ¥çš„æ€»å’Œï¼Œå‡½æ•°my_sum(å³ç§°ä¸ºreduceçš„å‡½æ•°)å°†ç”±mapå‡½æ•°è¿”å›çš„æ¯ä¸ªç»“æœè°ƒç”¨ä¸€æ¬¡ï¼Œå¹¶ä¸”åº”è¯¥åˆå¹¶ä¸­é—´ä½“åˆ°ç»“æœå˜é‡ã€‚QtConcurrent::mappedReduced()å¯ä»¥ä¿è¯ä¿è¯ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨reduceï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦ç”¨ä¸€ä¸ªmutexé”å®šç»“æœå˜é‡ã€‚QtConcurrent::ReduceOptionsæšä¸¾æä¾›äº†ä¸€ç§æ–¹æ³•æ¥æ§åˆ¶reductionå®Œæˆçš„é¡ºåºã€‚å¦‚æœä½¿ç”¨äº†QtConcurrent::UnorderedReduceï¼ˆé»˜è®¤ï¼‰ï¼Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼›è€ŒQtConcurrent::OrderedReduceç¡®ä¿reductionæŒ‰ç…§åŸå§‹åºåˆ—çš„é¡ºåºå®Œæˆã€‚ç¤ºä¾‹ä¸­å‡½æ•°my_fun3()è¢«è°ƒç”¨äº†5æ¬¡ï¼Œä¸”æ ¹æ®æ‰“å°å¤„ç†çš„çº¿ç¨‹idå¯ä»¥åˆ¤æ–­è¿™5æ¬¡è°ƒç”¨éƒ½æ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œè€Œä¸”éƒ½å’Œä¸»è¿›ç¨‹çš„çº¿ç¨‹idä¸åŒï¼Œå¦å¤–å‡½æ•°my_sum()ä¹Ÿè¢«è°ƒç”¨äº†5æ¬¡ï¼Œä½†è¿™äº”æ¬¡çš„çº¿ç¨‹idä¸€æ ·ï¼Œä¸”å’Œä¸Šé¢ç¬¬ä¸€æ¬¡æ‰§è¡Œå‡½æ•°my_func3çš„çº¿ç¨‹idä¸€è‡´ã€‚ 12345678910111213141516171819202122int my_func3(int value)&#123; qDebug() &lt;&lt; &quot;run my_func3 thread id:&quot; &lt;&lt; QThread::currentThreadId(); return value * 2;&#125;void my_sum(int &amp;result, const int &amp;intermediate)&#123; qDebug() &lt;&lt; &quot;run my_sum thread id:&quot; &lt;&lt; QThread::currentThreadId(); result += intermediate;&#125;void MainWindow::onMappedReducedBtnClicked()&#123; QList&lt;int&gt; m_list; m_list&lt;&lt; 1 &lt;&lt; 2 &lt;&lt; 3 &lt;&lt; 4 &lt;&lt; 5; QFuture&lt;int&gt; future = QtConcurrent::mappedReduced(m_list, my_func3, my_sum); future.waitForFinished(); qDebug() &lt;&lt; &quot;result:&quot; &lt;&lt; future.result();//30&#125; ä¸‹é¢æ¥ç€ä½¿ç”¨QtConcurrent::mappedReduced()æ¥æ¯”è¾ƒä½¿ç”¨å¤šçº¿ç¨‹å’Œå•çº¿ç¨‹å¤„ç†çš„æ•ˆç‡ï¼Œç¤ºä¾‹ä»£ç ç‰‡æ®µçš„ä½œç”¨æ˜¯ç»Ÿè®¡ç”¨æˆ·ä¸»ç›®å½•ä¸‹æ‰€æœ‰çš„.cppå’Œ.hæ–‡ä»¶ä¸­çš„å•è¯æ•°ç›®ï¼Œæ¯”è¾ƒä½¿ç”¨ä¸»çº¿ç¨‹è®¡ç®—å’Œä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®—çš„è€—æ—¶ï¼Œå¦‚æœä½ çš„.cppå’Œ.hæ–‡ä»¶æ•°ç›®å¤Ÿå¤šï¼Œå¯ä»¥é€šè¿‡æ‰“å°çœ‹å‡ºä¸¤è€…è€—æ—¶çš„æ˜æ˜¾å·®è·ï¼Œå¹¶ä¸”åœ¨è®¡ç®—å¾ˆå¤šæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ä¸»çº¿ç¨‹è®¡ç®—å°†ä¼šå¯¼è‡´ç•Œé¢å¡é¡¿ï¼Œè€Œä½¿ç”¨å¤šçº¿ç¨‹å°†ä¸ä¼šå½±å“ç•Œé¢çš„eventäº‹ä»¶ã€‚ ä½¿ç”¨å•çº¿ç¨‹è®¡ç®— 12345678910111213141516WordCount countWordsWithSingleThread(const QStringList &amp;files)&#123; WordCount wordCount; for (const QString &amp;file : files) &#123; QFile f(file); f.open(QIODevice::ReadOnly); QTextStream textStream(&amp;f); while (!textStream.atEnd()) &#123; const auto words = textStream.readLine().split(&apos; &apos;); for (const QString &amp;word : words) wordCount[word] += 1; &#125; &#125; return wordCount;&#125; ä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œè®¡ç®— 123456789101112131415161718192021222324252627282930313233343536373839404142WordCount countWordsWithMultiThreads(const QString &amp;file)&#123; WordCount wordCount; QFile f(file); f.open(QIODevice::ReadOnly); QTextStream textStream(&amp;f); while (!textStream.atEnd()) &#123; const auto words = textStream.readLine().split(&apos; &apos;); for (const QString &amp;word : words) wordCount[word] += 1; &#125; return wordCount;&#125;void reduceWordCounts(WordCount &amp;result, const WordCount &amp;w)&#123; QMapIterator&lt;QString, int&gt; i(w); while (i.hasNext()) &#123; i.next(); result[i.key()] += i.value(); &#125;&#125;void MainWindow::onMappedReducedBtn2Clicked()&#123; QStringList files = findAllFiles(&quot;/home/lixiang/work&quot;, QStringList() &lt;&lt; &quot;*.cpp&quot; &lt;&lt; &quot;*.h&quot;); // Single thread QTime time1; time1.start(); WordCount total1 = countWordsWithSingleThread(files); qDebug() &lt;&lt; &quot;Single thread find&quot; &lt;&lt; total1.size() &lt;&lt; &quot;words, Using &quot; &lt;&lt; time1.elapsed() / 1000.0 &lt;&lt; &quot;seconds&quot;; // Multi thread QTime time2; time2.start(); WordCount total2 = QtConcurrent::mappedReduced(files, countWordsWithMultiThreads, reduceWordCounts); qDebug() &lt;&lt; &quot;Multi thread find &quot; &lt;&lt; total2.size() &lt;&lt; &quot;words, Using &quot; &lt;&lt; time2.elapsed() / 1000.0 &lt;&lt; &quot;seconds&quot;;&#125;","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https://eightplus.github.io/tags/Qt/"}]},{"title":"Qtå¤šçº¿ç¨‹ä¹‹QtConcurrent::run()","slug":"2019-11-13-qtconcurrent-run","date":"2019-11-13T12:14:36.000Z","updated":"2019-11-13T12:27:23.802Z","comments":true,"path":"2019/11/13/2019-11-13-qtconcurrent-run/","link":"","permalink":"https://eightplus.github.io/2019/11/13/2019-11-13-qtconcurrent-run/","excerpt":"","text":"å‰é¢ä¸¤ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä»‹ç»äº†QThreadå¤šçº¿ç¨‹çš„ä½¿ç”¨æ–¹æ³•ï¼Œä»Šå¤©å¼€å§‹ä»‹ç»QtConcurrentï¼ŒQtConcurrentæ˜¯ä¸€ä¸ªåå­—ç©ºé—´, åŒ…å«äº†ä¼—å¤šçš„é«˜çº§API, æ–¹ä¾¿ç”¨æˆ·ç¼–å†™å¤šçº¿ç¨‹ç¨‹åºï¼Œä¸”ä¸éœ€è¦ä½¿ç”¨ä½çº§çº¿ç¨‹åŸè¯­(å¦‚:äº’æ–¥ã€è¯»å†™é”ã€ç­‰å¾…æ¡ä»¶æˆ–ä¿¡å·é‡)ã€‚QtConcurrentè¿”å›ä¸€ä¸ªQFutureå¯¹è±¡ï¼ˆQFutureç±»æ²¡æœ‰ç»§æ‰¿QObjectï¼Œè¯¥ç±»ä»£è¡¨äº†ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨çš„ç»“æœï¼Œå®ƒä»‹äºQtConcurrentå’ŒQFutureWatcherä¹‹é—´è¿›è¡Œå·¥ä½œï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥ç”¨æ¥æŸ¥è¯¢ä»»åŠ¡å½“å‰çš„æ‰§è¡Œè¿›åº¦ã€æš‚åœã€æ¢å¤ã€å–æ¶ˆä»»åŠ¡ä»¥åŠè·å¾—è¿ç®—ç»“æœï¼Œä½†å¹¶éæ‰€æœ‰çš„QFutureå¯¹è±¡éƒ½æ”¯æŒæš‚åœæˆ–å–æ¶ˆçš„æ“ä½œï¼Œå¦‚æœ¬ç¯‡æ–‡ç« å°†è¦ä»‹ç»çš„ç”±QtConcurrent::run()è¿”å›çš„QFutureå¯¹è±¡åˆ™ä¸èƒ½å–æ¶ˆï¼Œè€Œç”±QtConcurrent::mappedReduced()è¿”å›çš„å¯¹è±¡åˆ™æ˜¯æ˜¯å¯ä»¥æ‰§è¡Œå–æ¶ˆçš„ã€‚QFutureWatcheré€šè¿‡ä¿¡å·æ§½æ¥è·Ÿå¼‚æ­¥è°ƒç”¨å®ç°äº¤äº’ï¼Œå³å¯ä»¥é€šè¿‡ä¿¡å·æ§½æ¥ç›‘è§†çº¿ç¨‹çš„å®Œæˆæƒ…å†µï¼ˆQFutureçš„è¿›åº¦ï¼‰, å¹¶è·å–çº¿ç¨‹çš„è¿”å›å€¼ã€‚QFutureè®©çº¿ç¨‹å¯ä»¥é€šè¿‡æŸä¸ªåæœŸäº§ç”Ÿçš„ç»“æœæ¥å®ç°åŒæ­¥ï¼Œè¿™ä¸ªç»“æœå¯ä»¥æ˜¯ä»»ä½•æ‹¥æœ‰é»˜è®¤æ„é€ å‡½æ•°å’Œæ‹·è´æ„é€ å‡½æ•°çš„ç±»å‹ï¼Œå¦‚æœè¿™ä¸ªç»“æœåœ¨è°ƒç”¨å…¶result(), resultAt(), æˆ–è€…results()æ–¹æ³•æ—¶è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼ŒQFutureå°†ä¼šä¸€ç›´ç­‰ï¼Œç›´åˆ°ç»“æœå‡†å¤‡å¥½ä¸ºæ­¢ã€‚åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œå¯ä»¥é€šè¿‡isResultReadyAt()æ–¹æ³•æ¥æ£€æµ‹ç»“æœæ˜¯å¦å‡†å¤‡å¥½ï¼Œå¯ä»¥ç”¨ç»‘å®šä¿¡å·resultReadyAtæ¥è·å–çº¿ç¨‹çš„ç»“æœã€‚å¯¹äºQFutureå¯¹è±¡éœ€è¦å‡†å¤‡å¤šä¸ªç»“æœçš„æƒ…å†µï¼Œè°ƒç”¨resultCount()æ–¹æ³•å¯ä»¥è¿”å›è¿ç»­ç»“æœçš„æ•°é‡å³æˆ‘ä»¬å¯ä»¥ä»0åˆ°resultCount()è¿›è¡Œéå†æ“ä½œã€‚ ç¤ºä¾‹æºç  qtconcurrent-run å¼€å‘åº“çš„å®‰è£…$ sudo apt install qtbase5-dev qt5-qmake qtchooser qtscript5-dev qttools5-dev-tools qtbase5-dev-tools ç¤ºä¾‹æºç çš„ç¼–è¯‘å’Œè¿è¡Œ123$ qmake$ make$ ./qtconcurrent-run-demo ç¤ºä¾‹ä»£ç åˆ†æè¦ç‚¹ ç¤ºä¾‹ä»£ç ä¸­æ¨¡æ‹Ÿè€—æ—¶æ“ä½œçš„doLongTimeWork()å‡½æ•°æœ‰ä¸¤ç§å†™æ³•ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼ŒQFuture&lt;QList&gt;è¡¨ç¤ºè¿”å›å¼‚æ­¥è°ƒç”¨çš„ç»“æœï¼Œç±»å‹ä¸ºQListï¼Œè€ŒQFutureæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒè¡¨ç¤ºä¸è¿”å›å¼‚æ­¥è°ƒç”¨çš„ç»“æœã€‚ä»»ä½•QFutureå¯¹è±¡éƒ½å¯ä»¥èµ‹å€¼æˆ–è€…æ‹·è´ç»™QFutureå¯¹è±¡ï¼ŒQFutureå¯¹äºç»“æœæ•°æ®ä¸éœ€è¦è€Œåªéœ€è¦çŠ¶æ€æˆ–è€…è¿›åº¦ä¿¡æ¯çš„æƒ…å†µæ¯”è¾ƒæœ‰ç”¨ã€‚ å†™æ³•ä¸€ï¼š 12345678void Worker::doLongTimeWork()&#123; QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt; *watcher = new QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt;(/*this*/); QFuture&lt;QList&lt;CityInfo&gt;&gt; future = QtConcurrent::run(this, &amp;Worker::loadDataFromFile);//å¼€å§‹å¼‚æ­¥è°ƒç”¨ï¼ŒQtConcurrent::run()ç”¨äºåœ¨å¦å¤–çš„çº¿ç¨‹è¿è¡Œä¸€ä¸ªå‡½æ•° connect(watcher, &amp;QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt;::finished, this, &amp;Worker::onInitFinished); connect(watcher, &amp;QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt;::resultReadyAt, this, &amp;Worker::onResultReadyAt); watcher-&gt;setFuture(future);&#125; å†™æ³•äºŒï¼š 12345678void Worker::doLongTimeWork()&#123; QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt; *watcher = new QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt;(/*this*/); QFuture&lt;QList&lt;CityInfo&gt;&gt; future = QtConcurrent::run(load_data_from_file);//å¼€å§‹å¼‚æ­¥è°ƒç”¨ï¼ŒQtConcurrent::run()ç”¨äºåœ¨å¦å¤–çš„çº¿ç¨‹è¿è¡Œä¸€ä¸ªå‡½æ•° connect(watcher, &amp;QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt;::finished, this, &amp;Worker::onInitFinished); connect(watcher, &amp;QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt;::resultReadyAt, this, &amp;Worker::onResultReadyAt); watcher-&gt;setFuture(future);&#125; é€šè¿‡QFutureWatcherçš„resultReadyAtä¿¡å·ç»‘å®šæ§½å‡½æ•°çš„onResultReadyAtï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“çº¿ç¨‹å·²ç»å°†ä»€ä¹ˆæ ·çš„ç»“æœå·²ç»å‡†å¤‡å¥½äº†ï¼Œè€Œé€šè¿‡QFutureWatcherçš„finishedä¿¡å·ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“çº¿ç¨‹æ‰§è¡Œå®Œæ¯•äº†ï¼Œå¹¶å¯ä»¥é€šè¿‡watheræ¥è·å–çº¿ç¨‹çš„ç»“æœï¼Œå¦‚ä¸‹ä¸¤ä¸ªå‡½æ•°ï¼š 12345678910111213141516171819202122232425262728void Worker::onResultReadyAt(int index)&#123; QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt; *watcher = static_cast&lt;QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt; *&gt;(sender()); if (!watcher) return; QList&lt;CityInfo&gt; info_list = watcher-&gt;resultAt(index); qDebug() &lt;&lt; &quot;length: &quot;&lt;&lt; info_list.length() &lt;&lt; &quot;, index: &quot; &lt;&lt; index &lt;&lt; &quot;, region:&quot; &lt;&lt; info_list.at(0).region;&#125;void Worker::onInitFinished()&#123; static int count = 0; qDebug() &lt;&lt; &quot;Worker::onInitFinished&quot;; QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt; *watcher = static_cast&lt;QFutureWatcher&lt;QList&lt;CityInfo&gt;&gt; *&gt;(sender()); if (!watcher) return; m_cityInfos = watcher-&gt;result(); for (const auto &amp;info : m_cityInfos) &#123; //qDebug() &lt;&lt; &quot;region:&quot; &lt;&lt; info.region; &#125; watcher-&gt;deleteLater(); emit scanFinished(count++);&#125;","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https://eightplus.github.io/tags/Qt/"}]},{"title":"Qtå¤šçº¿ç¨‹ä¹‹å­ç±»åŒ–QObject","slug":"2019-11-11-qthread-object","date":"2019-11-11T08:43:21.000Z","updated":"2019-11-11T08:44:36.171Z","comments":true,"path":"2019/11/11/2019-11-11-qthread-object/","link":"","permalink":"https://eightplus.github.io/2019/11/11/2019-11-11-qthread-object/","excerpt":"","text":"ä¸Šä¸€ç¯‡æ–‡ç« è®²è¿°äº†å­ç±»åŒ–QThreadï¼Œå¹¶é‡æ–°å®ç°run()å‡½æ•°ï¼Œè¿™ç¯‡æ–‡ç« å°†è®²è¿°å¤šçº¿ç¨‹ä¹‹å®šä¹‰å·¥ä½œå¯¹è±¡ç»§æ‰¿è‡ªQObjectï¼Œç„¶åæŠŠè¿™ä¸ªå·¥ä½œå¯¹è±¡moveåˆ°QThreadçš„ä¸€ä¸ªå¯¹è±¡ä¸­ï¼ˆmoveToThread(QThread * thread)å‡½æ•°å°†å·¥ä½œç±»å¯¹è±¡ç§»åˆ°æ‰€åˆ›å»ºçš„QThreadå¯¹è±¡ä¸­å»æ‰§è¡Œï¼‰ï¼Œæœ¬æ–¹æ³•å·§å¦™çš„åˆ©ç”¨äº†Qtä¿¡å·å’Œæ§½æœºåˆ¶ï¼Œæ¯”å¦‚åœ¨UIä¸»è¿›ç¨‹ä¸­æƒ³è®©çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªè€—æ—¶æ“ä½œï¼Œè¿™æ—¶å€™ä¸æ˜¯é€šè¿‡çº¿ç¨‹å¯¹è±¡å»ç›´æ¥è°ƒç”¨ç»§æ‰¿äºQObjectçš„é‚£ä¸ªç±»çš„æ–¹æ³•ï¼Œè€Œæ˜¯é€šè¿‡ä¿¡å·æ§½ç»‘å®šï¼ŒUIä¸»è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·signalï¼Œç»§æ‰¿äºQObjectçš„é‚£ä¸ªç±»çš„æ§½å‡½æ•°åˆ™æ˜¯åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œäº†ã€‚åŒæ ·ï¼Œåœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡æ‰“å°çš„çº¿ç¨‹ID(QThread::currentThreadId())å¯ä»¥çœ‹å‡ºå“ªäº›ä»£ç åœ¨åŸçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå“ªäº›ä»£ç åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ ç¤ºä¾‹æºç  qthread-object å¼€å‘åº“çš„å®‰è£…$ sudo apt install qtbase5-dev qt5-qmake qtchooser qtscript5-dev qttools5-dev-tools qtbase5-dev-tools ç¤ºä¾‹æºç çš„ç¼–è¯‘å’Œè¿è¡Œ123$ qmake$ make$ ./thread-object-demo å¤§æ¦‚æ­¥éª¤1. åœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªQThreadå®ä¾‹ 2. å­ç±»åŒ–QObjectï¼ŒæŠŠè€—æ—¶æ“ä½œå°è£…åˆ°å­ç±»(ç¤ºä¾‹ä»£ç çš„Workerç±»)æ§½å‡½æ•°ä¸­ 3. åˆ›å»ºWorkerå®ä¾‹ï¼Œå»ºç«‹QThreadå®ä¾‹ä¸Workerå®ä¾‹ä¹‹é—´çš„ä¿¡å·å’Œæ§½å…³ç³» 4. è°ƒç”¨Workerå®ä¾‹çš„moveToThread(QThread * thread)å‡½æ•°ï¼Œå°†å®ƒç§»åŠ¨åˆ°åˆ›å»ºçš„QThreadçº¿ç¨‹ä¸­å» 5. æ‰§è¡ŒQThreadçº¿ç¨‹çš„start()æ–¹æ³• ç¤ºä¾‹ä»£ç åˆ†æè¦ç‚¹ ç¤ºä¾‹ä»£ç å’Œä¸Šä¸€ç¯‡æ–‡ç« çš„ç¤ºä¾‹ä»£ç åŒºåˆ«ä¸å¤§ï¼Œä»£ç å¾ˆçŸ­ï¼Œå®¹æ˜“çœ‹æ‡‚ï¼ŒæŒ‰é’®ç‚¹å‡»åï¼Œå‘é€äº†ä¸€ä¸ªåä¸ºrequestDoWorkçš„ä¿¡å·ï¼Œè¿™ä¸ªä¿¡å·ç»‘å®šåˆ°äº†Workerç±»çš„æ§½å‡½æ•°doLongTimeWorkï¼Œé‚£ä¹ˆdoLongTimeWork()å‡½æ•°å°±æ˜¯åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œäº†ã€‚ç¤ºä¾‹ä»£ç ä¸­ä½“ç°çº¿ç¨‹åˆ›å»ºå’Œmoveçš„ä»£ç å¦‚ä¸‹ï¼š 12345678m_worker = new Worker();m_thread = new QThread();m_worker-&gt;moveToThread(m_thread);//ç§»åŠ¨workerå¯¹è±¡å®ä¾‹åˆ°çº¿ç¨‹ä¸­connect(m_worker, SIGNAL(destroyed(QObject*)), m_thread, SLOT(quit()));//å½“workerå¯¹è±¡å®ä¾‹é”€æ¯æ—¶ï¼Œé€€å‡ºçº¿ç¨‹connect(m_thread, SIGNAL(finished()), m_thread, SLOT(deleteLater()));//å½“çº¿ç¨‹ç»“æŸæ—¶ï¼Œé”€æ¯çº¿ç¨‹å¯¹è±¡å®ä¾‹connect(m_worker, &amp;Worker::sendCount, this, &amp;MainWindow::onResponseCount);connect(this, SIGNAL(requestDoWork()), m_worker, SLOT(doLongTimeWork()));m_thread-&gt;start();//å¯åŠ¨çº¿ç¨‹","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https://eightplus.github.io/tags/Qt/"}]},{"title":"Qtå¤šçº¿ç¨‹ä¹‹å­ç±»åŒ–QThread","slug":"2019-11-10-qthread-run","date":"2019-11-10T07:28:40.000Z","updated":"2019-11-10T08:09:32.154Z","comments":true,"path":"2019/11/10/2019-11-10-qthread-run/","link":"","permalink":"https://eightplus.github.io/2019/11/10/2019-11-10-qthread-run/","excerpt":"","text":"Qtä¸­æä¾›äº†å¯¹äºçº¿ç¨‹çš„æ”¯æŒï¼Œå®ƒæä¾›äº†ä¸€äº›ç‹¬ç«‹äºå¹³å°çš„çº¿ç¨‹ç±»QThreadï¼Œè¦ä½¿ç”¨QThreadè¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œæœ‰ä¸¤ç§æ–¹å¼ã€‚ä¸€æ˜¯å­ç±»åŒ–QThreadï¼Œå¹¶é‡æ–°å®ç°run()å‡½æ•°ï¼›äºŒæ˜¯å®šä¹‰å·¥ä½œå¯¹è±¡ç»§æ‰¿è‡ªQObjectï¼Œç„¶åæŠŠè¿™ä¸ªå·¥ä½œå¯¹è±¡moveåˆ°QThreadçš„ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚æœ¬æ–‡ä»‹ç»ç¬¬ä¸€ç§æ–¹æ³•ï¼Œåœ¨ä½¿ç”¨è¿™ç§æ–¹æ³•æ—¶ï¼Œæ„é€ å‡½æ•°è¿˜æ˜¯åœ¨åŸæ¥çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œrun()å‡½æ•°æ‰åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œåœ¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡æ‰“å°çš„çº¿ç¨‹ID(QThread::currentThreadId())å¯ä»¥çœ‹å‡ºå“ªäº›ä»£ç åœ¨åŸçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå“ªäº›ä»£ç åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ ç¤ºä¾‹æºç  qthread-run å¼€å‘åº“çš„å®‰è£…$ sudo apt install qtbase5-dev qt5-qmake qtchooser qtscript5-dev qttools5-dev-tools qtbase5-dev-tools ç¤ºä¾‹æºç çš„ç¼–è¯‘å’Œè¿è¡Œ123$ qmake$ make$ ./qthread-demo å¤§æ¦‚æ­¥éª¤1. å­ç±»åŒ–QThread 2. é‡è½½runå‡½æ•°ï¼Œrunå‡½æ•°å†…æœ‰ä¸€ä¸ªforeveræˆ–whileæˆ–forçš„æ­»å¾ªç¯ï¼ˆæ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼‰ 3. è®¾ç½®ä¸€ä¸ªæ ‡è®°ä¸ºæ¥æ§åˆ¶æ­»å¾ªç¯çš„é€€å‡º è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§- é€šè¿‡start()è®¾ç½®ï¼Œå¦‚ï¼šstart(QThread::LowPriority)ï¼› - é€šè¿‡setPriority(Priority priority)å‡½æ•°è®¾ç½®ï¼Œè¿™ä¸ªå‡½æ•°è®¾ç½®æ­£åœ¨è¿è¡Œçº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå¦‚æœçº¿ç¨‹æ²¡æœ‰è¿è¡Œï¼Œæ­¤åŠŸèƒ½ä¸æ‰§è¡Œä»»ä½•æ“ä½œå¹¶ç«‹å³è¿”å›ã€‚ QThread::Priorityæšä¸¾ å€¼ æè¿° QThread::IdlePriority 0 æ²¡æœ‰å…¶å®ƒçº¿ç¨‹è¿è¡Œæ—¶æ‰è°ƒåº¦ QThread::LowestPriority 1 æ¯”LowPriorityè°ƒåº¦é¢‘ç‡ä½ QThread::LowPriority 2 æ¯”NormalPriorityè°ƒåº¦é¢‘ç‡ä½ QThread::NormalPriority 3 æ“ä½œç³»ç»Ÿé»˜è®¤çš„é»˜è®¤ä¼˜å…ˆçº§ QThread::HighPriority 4 æ¯”NormalPriorityè°ƒåº¦é¢‘ç¹ QThread::HighestPriority 5 æ¯”HighPriorityè°ƒåº¦é¢‘ç¹ QThread::TimeCriticalPriority 6 å°½å¯èƒ½é¢‘ç¹çš„è°ƒåº¦ QThread::InheritPriority 7 ä½¿ç”¨å’Œåˆ›å»ºçº¿ç¨‹åŒæ ·çš„ä¼˜å…ˆçº§ï¼ˆé»˜è®¤å€¼ï¼‰ ç¤ºä¾‹ä»£ç åˆ†æè¦ç‚¹ ç¤ºä¾‹ä»£ç ä¸»è¦ä¸ºæ¼”ç¤ºåœ¨runä¸­æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œå¦‚æœæƒ³è¦è€—æ—¶å‡½æ•°æ‰§è¡Œå®Œæˆåå‘å‡ºé€šçŸ¥ï¼Œå¯ä»¥é€šè¿‡ä¿¡å·æ§½æœºåˆ¶é€šçŸ¥çº¿ç¨‹ç»“æŸäº†ï¼Œå³å‘é€ä¸€ä¸ªä¿¡å·ã€‚ä»£ç ç”¨åˆ°äº†QMutexå’ŒQWaitConditionã€‚QMutexæ˜¯å¼ºåˆ¶æ‰§è¡Œäº’æ–¥çš„åŸºæœ¬ç±»ï¼Œä¸€ä¸ªçº¿ç¨‹é”å®šä¸€ä¸ªäº’æ–¥é‡ï¼ˆmutexï¼‰ï¼Œä»¥è·å¾—å…±äº«èµ„æºçš„è®¿é—®æƒé™ï¼Œå½“äº’æ–¥é‡å·²è¢«é”å®šæ—¶ï¼Œæ­¤æ—¶å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹è¯•å›¾é”å®šäº’æ–¥é‡ï¼Œåˆ™å®ƒå°†è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹å®Œæˆå…¶ä»»åŠ¡å¹¶è§£é”äº’æ–¥é‡ã€‚QWaitConditionåŒæ­¥çº¿ç¨‹ï¼Œä¸é€šè¿‡æ‰§è¡Œäº’æ–¥ï¼Œè€Œé€šè¿‡æä¾›ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼ŒQWaitCondition ä½¿çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°æ»¡è¶³ä¸€ä¸ªç‰¹å®šçš„æ¡ä»¶æ‰è®©ç­‰å¾…ä¸­çš„çº¿ç¨‹ç»§ç»­è¿›è¡Œï¼ˆå…¶ä¸­QWaitCondition::wakeAll()å”¤é†’æ‰€æœ‰åœ¨ç­‰å¾…waitConditionçš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹è¢«å”¤é†’çš„é¡ºåºä¾èµ–äºæ“ç»„ç³»ç»Ÿçš„è°ƒåº¦ç­–ç•¥ï¼Œå¹¶ä¸”ä¸èƒ½è¢«æ§åˆ¶æˆ–é¢„çŸ¥ï¼›QWaitCondition::wakeOne()å”¤é†’ä¸€ä¸ªéšæœºçš„ç­‰å¾…waitConditionçš„çº¿ç¨‹ï¼Œçº¿ç¨‹çš„å”¤é†’å–å†³äºæ“ä½œç³»ç»Ÿçš„æ”¿ç­–ï¼Œä¸èƒ½è¢«æ§åˆ¶ã€‚ï¼‰ å¦‚ä¸‹å‡½æ•°doLongTimeWork()ï¼Œé‡Œé¢æ„é€ äº†ä¸€ä¸ªå±€éƒ¨çš„QMutexLockerå¯¹è±¡å¹¶é”ä½äº’æ–¥é‡ï¼Œå½“QMutexLockerè¢«é”€æ¯çš„æ—¶å€™ï¼Œäº’æ–¥é‡å°†è¢«è‡ªåŠ¨è§£é”(å› ä¸ºQMutexLockeræ˜¯ä¸ªå±€éƒ¨å˜é‡ï¼Œå½“å‡½æ•°è¿”å›æ—¶å®ƒå°±è¢«é”€æ¯)ï¼Œå½“æ‰§è¡Œå‡½æ•°doLongTimeWork()æ—¶ï¼Œå¦‚æœçº¿ç¨‹æœªè¿è¡Œï¼Œåˆ™è°ƒç”¨start()å¼€å¯çº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹å·²ç»åœ¨è¿è¡Œäº†ï¼Œåˆ™è°ƒç”¨condition.wakeOne()å”¤é†’çº¿ç¨‹ã€‚ 1234567891011void WorkerThread::doLongTimeWork()&#123; QMutexLocker locker(&amp;mutex); if (!isRunning()) &#123; start(QThread::LowPriority); &#125; else &#123; condition.wakeOne(); &#125;&#125; run()ä¸­çš„condition.wait(&amp;mutex)ä¼šè®©mutexä¼šè¢«æš‚æ—¶é‡Šæ”¾(ä¼šè‡ªåŠ¨è°ƒç”¨unlockè§£é”ä¹‹å‰é”ä½çš„èµ„æºï¼Œé¿å…é€ æˆæ­»é”)ï¼Œå¹¶é˜»å¡åœ¨è¿™ä¸ªåœ°æ–¹ï¼Œå½“çº¿ç¨‹è¢«cond.wakeOne()ç­‰å”¤é†’æ—¶ï¼Œmutexåˆä¼šè¢«é‡æ–°é”å®šï¼Œå¹¶ç»§ç»­è¿è¡Œã€‚ 1234567891011121314void WorkerThread::run()&#123; static int count = 0; forever &#123; if (abort) return; mutex.lock(); //å½“å¤„äºwaitçŠ¶æ€æ—¶mutexä¼šè¢«æš‚æ—¶é‡Šæ”¾(ä¼šè‡ªåŠ¨è°ƒç”¨unlockè§£é”ä¹‹å‰é”ä½çš„èµ„æºï¼Œé¿å…é€ æˆæ­»é”)ï¼Œå¹¶é˜»å¡åœ¨è¿™ä¸ªåœ°æ–¹ï¼›å½“çº¿ç¨‹è¢«cond.wakeOne()ç­‰å”¤é†’æ—¶ï¼Œmutexåˆä¼šè¢«é‡æ–°é”å®šï¼Œå¹¶ç»§ç»­è¿è¡Œ this-&gt;loadDataFromFile(); emit sendCount(count++); condition.wait(&amp;mutex);//QWaitCondition ç”¨äºå¤šçº¿ç¨‹çš„åŒæ­¥ï¼Œä¸€ä¸ªçº¿ç¨‹è°ƒç”¨QWaitCondition::wait() é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨QWaitCondition::wake() å”¤é†’æ‰ç»§ç»­å¾€ä¸‹æ‰§è¡Œ mutex.unlock(); &#125;&#125; æ³¨æ„QMutexä¸QWaitConditionåŒºåˆ«ï¼š QMutex::lockç›¸å½“äºä¸´ç•ŒåŒºé”ï¼Œè®©å¤„äºé”ä¸­çš„èµ„æºä¸èƒ½è¢«åˆ«çš„çº¿ç¨‹è®¿é—®ï¼Œå³è‡ªå·±éœ¸ç€ä¸è®©åˆ«äººç”¨ã€‚ QWaitCondition::waitç›¸å½“äºäº’æ–¥é‡é”ï¼Œè®©çº¿ç¨‹ç­‰ç€ï¼Œå½“åˆ«çš„çº¿ç¨‹è®¿é—®å®Œäº†ï¼Œè‡ªå·±æ‰èƒ½è®¿é—®ï¼Œå³è‡ªå·±æ’é˜Ÿç­‰ç€åˆ«äººç”¨å®Œè‡ªå·±å†ç”¨ã€‚","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https://eightplus.github.io/tags/Qt/"}]},{"title":"Qté…ç½®æ–‡ä»¶ä¹‹QGSettings","slug":"2019-11-07-qgsettings","date":"2019-11-07T08:05:18.000Z","updated":"2020-04-13T15:45:06.410Z","comments":true,"path":"2019/11/07/2019-11-07-qgsettings/","link":"","permalink":"https://eightplus.github.io/2019/11/07/2019-11-07-qgsettings/","excerpt":"","text":"æœ¬æ–‡ä»‹ç»ä½¿ç”¨dconfä½œä¸ºåç«¯çš„GSettingç”¨æ³•ï¼Œdconfæ˜¯ä¸€ä¸ªç®€å•çš„åº•å±‚é…ç½®å­˜å‚¨ç®¡ç†ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨å›¾å½¢åŒ–çš„dconf-editoræ ¹æ®pathæ¥æ£€ç´¢GSettingså¹¶ç®¡ç†keyï¼Œè€Œä¸”æ”¯æŒåœ¨keyå‘ç”Ÿæ”¹å˜æ—¶å‘å‡ºé€šçŸ¥(changedä¿¡å·)ã€‚å‘½ä»¤è¡Œå·¥å…·gsettingsæä¾›äº†å¯¹GSetingsçš„å‘½ä»¤è¡Œæ“ä½œï¼Œå¯ä»¥æŸ¥è¯¢ã€è¯»å–å’Œè®¾ç½®é”®å€¼ã€‚å¦‚æœä½ è§‰å¾—glibã€gioå¤ªå¤æ‚(æŸ¥çœ‹GSettingsçš„APIæ–‡æ¡£å¯ä»¥ä½¿ç”¨å·¥å…·devhelp)ï¼Œé‚£ä¹ˆä½¿ç”¨Qtçš„QGSettingsæ¥æ“ä½œgsettingå°†ä¼šè®©ä½ å¤‡å¾ˆè½»æ¾ï¼Œè€Œä¸”ä»£ç çš„å¯è¯»æ€§å°†æå‡ï¼Œæœ¬æ–‡æä¾›çš„demoå°±æ˜¯ä½¿ç”¨QGSettingsæ¥æ“ä½œgsettingã€‚ ç¤ºä¾‹æºç  ç¤ºä¾‹ä»£ç ç®€è¦å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨QGSettingsè¿›è¡Œé…ç½®æ–‡ä»¶çš„è¯»å’Œå†™ï¼Œä»¥åŠç›‘æ§é…ç½®æ–‡ä»¶ä¸­keyçš„å˜åŒ–ï¼Œå¹¶å°†å…¶ä»–é€”å¾„å¯¼è‡´çš„keyçš„å˜åŒ–çš„valueæ›´æ–°åˆ°ä»£ç ä¸­ã€‚ qgsetting-demo å¼€å‘åº“çš„å®‰è£…$ sudo apt install qtbase5-dev qt5-qmake qtchooser qtscript5-dev qttools5-dev-tools qtbase5-dev-tools libgsettings-qt-dev ç¤ºä¾‹æºç çš„ç¼–è¯‘å’Œè¿è¡Œæ³¨æ„ï¼šåœ¨Qtçš„å·¥ç¨‹æ–‡ä»¶.proä¸­ï¼Œéœ€è¦åŠ å…¥å¦‚ä¸‹ä¸¤è¡Œï¼š12CONFIG += link_pkgconfigPKGCONFIG += gsettings-qt 12345$ sudo install -m 0644 qgsettings-demo.gschema.xml /usr/share/glib-2.0/schemas$ sudo glib-compile-schemas /usr/share/glib-2.0/schemas$ qmake$ make$ ./qsettings-demo é…ç½®æ–‡ä»¶GSettingsçš„é…ç½®æ–‡ä»¶æ˜¯xmlæ ¼å¼çš„ï¼Œæ–‡ä»¶éœ€ä»¥.gschema.xmlç»“å°¾ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªschemaï¼Œæ¯ä¸ªschemaå¯ç”±å¤šä¸ªkeyç»„æˆï¼ˆkeyæ˜¯æ— æ³•é€šè¿‡ä»£ç åŠ¨æ€åˆ›å»ºçš„ï¼‰ã€‚è¯¦ç»†è¯´æ˜å¦‚ä¸‹ï¼š å­—æ®µ è¯´æ˜ id schemaä¸­çš„idåœ¨æ•´ä¸ªé…ç½®ç³»ç»Ÿä¸­æ˜¯å”¯ä¸€çš„ï¼Œå¦åˆ™åœ¨æ‰§è¡Œglib-compile-schemasæ—¶ä¼šå¿½ç•¥é‡å¤çš„idçš„å¼€å¤´é€šå¸¸ä½¿ç”¨ä¸åº”ç”¨ç›¸å…³çš„åŸŸåã€‚ path schemaä¸­çš„pathå¿…é¡»æ˜¯ä»¥/å¼€å¤´å¹¶ä¸”ä»¥/ç»“å°¾ï¼Œä¸èƒ½åŒ…å«è¿ç»­çš„/ï¼Œpathç”¨äºæŒ‡å®šåœ¨storageä¸­å­˜å‚¨è·¯å¾„ï¼Œå¯ä»¥ä¸idä¸ä¸€è‡´ã€‚ name keyçš„åç§°ï¼Œéœ€è¦åœ¨æ­¤schemaä¸­å”¯ä¸€ï¼Œnameçš„å€¼ç”±å°å†™å­—æ¯ã€æ•°å­—å’Œ-ç»„æˆï¼Œå¹¶ä¸”å¼€å¤´å¿…é¡»æ˜¯å°å†™å­—æ¯ï¼Œä¸èƒ½ä»¥-ç»“å°¾ï¼Œä¹Ÿä¸èƒ½å‡ºç°è¿ç»­çš„-ã€‚ type keyçš„ç±»å‹ï¼Œéœ€è¦æ˜¯GVariantæ”¯æŒçš„ç±»å‹ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨åŸºæœ¬çš„ç±»å‹å¤–ï¼Œä¹Ÿå¯æŒ‰ç…§GVariantçš„æ–¹å¼ç»„åˆç±»å‹ã€‚ default keyçš„é»˜è®¤å€¼ summary keyçš„ç®€å•æè¿° description keyçš„è¯¦ç»†æè¿° åœ¨schemaæ–‡ä»¶ä¸­ï¼Œé€šå¸¸ä¸€ä¸ªidå¯¹åº”ä¸€ä¸ªå›ºå®šçš„pathï¼Œä½†ä¹Ÿå¯ä¸è®¾ç½®pathï¼Œè¿™æ ·å°±æ˜¯ä¸€ä¸ªå¯é‡å®šä½çš„schemaï¼Œpathä¸¤å¤´å¿…é¡»éƒ½æœ‰/ï¼Œå¦åˆ™ä¼šéªŒè¯å¤±è´¥ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„å¦‚æœæ²¡æœ‰æŒ‡å®špathå±æ€§ï¼Œåˆ™gsettingsæ— æ³•è¢«dconf-editorè¯»å–ã€‚è¦æƒ³schemaæ–‡ä»¶è¢«GSettingsä½¿ç”¨ï¼Œè¿˜éœ€è¦å€ŸåŠ©ç¼–è¯‘å™¨glib-compile-schemaså°†schemaæ–‡ä»¶ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚GSettingsè¯»å–XDG_DATA_DIRSä¸‹çš„glib-2.0/schemasè·¯å¾„ï¼Œéœ€è¦å°†schemaæ–‡ä»¶æ”¾åˆ°ç¯å¢ƒå˜é‡XDG_DATA_DIRS/glib-2.0/schemas/è·¯å¾„ä¸‹ï¼Œä¸€èˆ¬ä¸º/usr/share/glib-2.0/schemaså’Œ/usr/local/share/glib-2.0/schemasã€‚è¿™é‡Œæˆ‘ä»¬å°†qgsettings-demo.gschema.xmlæ–‡ä»¶æ‹·è´åˆ°/usr/share/glib-2.0/schemasè·¯å¾„ä¸‹ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹ä¸€æ¡å‘½ä»¤å°†å…¶ç¼–è¯‘åˆ·æ–°ç³»ç»Ÿçš„gsettingsä¸­ï¼Œå¦åˆ™ä½¿ç”¨çš„æ—¶å€™å°†æŠ¥é”™å¹¶å¯¼è‡´ç¨‹åºé€€å‡ºï¼ˆSettings schema â€˜apps.eightplus.qgsettings-demoâ€™ is not installedï¼‰ï¼š 1$ sudo glib-compile-schemas /usr/share/glib-2.0/schemas gsettingså‘½ä»¤ å‘½ä»¤ è¯´æ˜ gsettings list-schemas æ˜¾ç¤ºç³»ç»Ÿå·²å®‰è£…çš„ä¸å¯é‡å®šä½çš„schema(å·²å®‰è£…å¹¶å·²å®‰è£…å¹¶æœ‰å›ºå®špathçš„ schema)ã€‚ gsettings list-relocatable-schemas æ˜¾ç¤ºå·²å®‰è£…çš„å¯é‡å®šä½çš„schema(å·²å®‰è£…å´æ²¡æœ‰å›ºå®špathçš„ schema)ã€‚ gsettings list-children SCHEMA æ˜¾ç¤ºæŒ‡å®šschemaçš„childrenï¼Œå…¶ä¸­SCHEMAä¸ºxmlæ–‡ä»¶ä¸­schemaçš„idå±æ€§å€¼ï¼Œå¦‚ç¤ºä¾‹ä»£ç ä¸­daemonçš„â€apps.eightplus.qgsettings-demoâ€ã€‚ gsettings list-keys SCHEMA æ˜¾ç¤ºæŒ‡å®šschemaçš„æ‰€æœ‰é¡¹(key)ã€‚ gsettings range SCHEMA KEY æŸ¥è¯¢æŒ‡å®šschemaçš„æŒ‡å®šé¡¹KEYçš„æœ‰æ•ˆå–å€¼èŒƒå›´ã€‚ gsettings get SCHEMA KEY æ˜¾ç¤ºæŒ‡å®šschemaçš„æŒ‡å®šé¡¹KEYçš„å€¼ã€‚ gsettings set SCHEMA KEY VALUE è®¾ç½®æŒ‡å®šschemaçš„æŒ‡å®šé¡¹KEYçš„å€¼ä¸ºVALUEã€‚ gsettings reset SCHEMA KEY æ¢å¤æŒ‡å®šschemaçš„æŒ‡å®šé¡¹KEYçš„å€¼ä¸ºé»˜è®¤å€¼ã€‚ gsettings reset-recursively SCHEMA æ¢å¤æŒ‡å®šschemaçš„æ‰€æœ‰keyçš„å€¼ä¸ºé»˜è®¤å€¼ã€‚ gsettings list-recursively [SCHEMA] å¦‚æœæœ‰SCHEMAå‚æ•°ï¼Œåˆ™é€’å½’æ˜¾ç¤ºæŒ‡å®šschemaçš„æ‰€æœ‰é¡¹(key)å’Œå€¼(value)ï¼Œå¦‚æœæ²¡æœ‰SCHEMAå‚æ•°ï¼Œåˆ™é€’å½’æ˜¾ç¤ºæ‰€æœ‰schemaçš„æ‰€æœ‰é¡¹(key)å’Œå€¼(value)ã€‚ ä¸¾ä¾‹ æŸ¥çœ‹apps.eightplus.qgsettings-demoæ˜¯å¦å·²ç»å®‰è£… 12lixiang@lixiang-TM1701:~$ gsettings list-schemas |grep apps.eightplus.qgsettings-demoapps.eightplus.qgsettings-demo æŸ¥çœ‹apps.eightplus.qgsettings-demoçš„schemaä¸‹æ‰€æœ‰é¡¹çš„å–å€¼ 1234lixiang@lixiang-TM1701:~$ gsettings list-recursively apps.eightplus.qgsettings-demoapps.eightplus.qgsettings-demo male falseapps.eightplus.qgsettings-demo age 22apps.eightplus.qgsettings-demo name &apos;lixiang&apos; è·å–nameçš„å€¼ 1gsettings get apps.eightplus.qgsettings-demo name è®¾ç½®nameçš„å€¼ 1gsettings set apps.eightplus.qgsettings-demo name kobe æ¢å¤nameçš„é»˜è®¤å€¼ 1gsettings reset apps.eightplus.qgsettings-demo name æ¢å¤æ‰€æœ‰keyçš„é»˜è®¤å€¼ 1gsettings reset-recursively apps.eightplus.qgsettings-demo å‚è€ƒæ–‡æ¡£https://developer.gnome.org/GSettings/","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https://eightplus.github.io/tags/Qt/"}]},{"title":"Qté…ç½®æ–‡ä»¶ä¹‹QSettings","slug":"2019-11-06-qsettings","date":"2019-11-06T01:30:05.000Z","updated":"2019-11-10T07:55:27.043Z","comments":true,"path":"2019/11/06/2019-11-06-qsettings/","link":"","permalink":"https://eightplus.github.io/2019/11/06/2019-11-06-qsettings/","excerpt":"","text":"åœ¨ç”¨Qtç¼–ç¨‹æ—¶ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦åœ¨æœ¬åœ°ä¿ç•™ç”¨æˆ·çš„é…ç½®ï¼Œæ–¹ä¾¿ä¸‹æ¬¡å¯åŠ¨ç¨‹åºçš„æ—¶å€™ä½¿ç”¨ä¸Šæ¬¡çš„é…ç½®æ•°æ®ï¼Œè¿™é‡Œæ¨èä½¿ç”¨QSettingsè¯»å†™é…ç½®æ–‡ä»¶ï¼ˆQSettingså¯é‡å…¥ï¼Œå³å¯ä»¥åŒæ—¶åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä½¿ç”¨ä¸åŒçš„QSettingså¯¹è±¡ï¼‰ï¼Œè€Œä¸æ˜¯å»ç”¨æ•°æ®åº“å»è®°å½•å’Œè¯»å–è¿™äº›æ•°æ®ï¼ˆå¦‚è½»é‡çº§æ•°æ®åº“sqliteï¼‰ã€‚ ç¤ºä¾‹æºç  qsetting-demo å¼€å‘åº“çš„å®‰è£…$ sudo apt install qtbase5-dev qt5-qmake qtchooser qtscript5-dev qttools5-dev-tools qtbase5-dev-tools ç¤ºä¾‹æºç çš„ç¼–è¯‘å®‰è£…å’Œè¿è¡Œ123$ qmake$ make$ ./qsettings-demo QSettingså¯¹è±¡çš„åˆ›å»º QSettingså¯¹è±¡æ—¢å¯ä»¥åˆ›å»ºåœ¨æ ˆä¸Šï¼Œä¹Ÿå¯ä»¥åˆ›å»ºåœ¨å †ä¸Šï¼Œæ„å»ºå’Œé”€æ¯ä¹Ÿéå¸¸å¿«ã€‚QSettingsç±»çš„æ„é€ å‡½æ•°çš„é‡è½½å…è®¸æˆ‘ä»¬ç”¨å„ç§æ–¹æ³•æ¥åˆå§‹åŒ–QSettingså¯¹è±¡ï¼Œæ¯”å¦‚å¯ä»¥åœ¨å½“åˆ›å»ºQSettingså¯¹è±¡æ—¶ï¼Œé€šè¿‡æŒ‡å®šå…¬å¸æˆ–ç»„ç»‡åç§°ä»¥åŠäº§å“åç§°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šæ–‡ä»¶è·¯å¾„å’ŒFormatç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä»‹ç»ç”¨æŒ‡å®šæ–‡ä»¶è·¯å¾„å’ŒFormatç±»å‹çš„æ–¹å¼æ„é€ QSettingså¯¹è±¡ã€‚ - æ ˆä¸Šçš„å¯¹è±¡ 123QString filename = QDir::homePath() + &quot;/.config/eightplus/qsettings-demo.ini&quot;;QSettings m_settings(filename, QSettings::IniFormat);m_settings.setIniCodec(&quot;UTF-8&quot;); - å †ä¸Šçš„å¯¹è±¡ 123QString filename = QDir::homePath() + &quot;/.config/eightplus/qsettings-demo.ini&quot;;QSettings *m_settings = new QSettings(filename, QSettings::IniFormat);m_settings-&gt;setIniCodec(&quot;UTF-8&quot;); å…¶ä¸­ï¼Œæšä¸¾ç±»å‹Formatçš„å®šä¹‰å¦‚ä¸‹ï¼š 12345678910111213141516171819202122enum Format &#123; NativeFormat, IniFormat, InvalidFormat = 16, CustomFormat1, CustomFormat2, CustomFormat3, CustomFormat4, CustomFormat5, CustomFormat6, CustomFormat7, CustomFormat8, CustomFormat9, CustomFormat10, CustomFormat11, CustomFormat12, CustomFormat13, CustomFormat14, CustomFormat15, CustomFormat16&#125;; åœ¨Linuxä¸Šç¼–ç¨‹ï¼Œæˆ‘ä»¬ä»‹ç»NativeFormatå’ŒIniFormatï¼Œå¯¹äºæˆ‘ä¸ªäººè€Œå·²ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨çš„æ˜¯IniFormatã€‚ å¸¸é‡ å€¼ æè¿° QSettings::NativeFormat 0 ä½¿ç”¨å¹³å°æœ€åˆé€‚çš„å­˜å‚¨æ ¼å¼è®¾ç½®ã€‚åœ¨Unixä¸­ï¼Œä½¿ç”¨çš„æ˜¯INIæ ¼å¼çš„æ–‡æœ¬é…ç½®æ–‡ä»¶ã€‚ QSettings::IniFormat 1 å­˜å‚¨åœ¨INIæ–‡ä»¶ä¸­çš„è®¾ç½®ã€‚ QSettingså­˜å‚¨ QSettingsä½¿ç”¨setValue()å‡½æ•°å­˜å‚¨ä¸€ç³»åˆ—è®¾ç½®ï¼Œæ¯ä¸ªè®¾ç½®åŒ…æ‹¬keyï¼ˆå­—ç¬¦ä¸²ï¼‰å’Œä¸€ä¸ªä¸è¯¥keyå…³è”çš„valueï¼ˆQVariantï¼‰ï¼Œå¦‚ï¼š 123456m_settings-&gt;beginGroup(&quot;General&quot;);m_settings-&gt;setValue(&quot;name&quot;, m_name);m_settings-&gt;setValue(&quot;male&quot;, m_male);m_settings-&gt;setValue(&quot;age&quot;, m_age);m_settings-&gt;endGroup();m_settings-&gt;sync(); sync()ï¼šå¦‚æœå­˜åœ¨ç›¸åŒçš„keyï¼Œç°æœ‰çš„å€¼å°†è¢«æ–°å€¼è¦†ç›–ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œè¿™äº›å˜åŒ–å¯èƒ½ä¸ä¼šè¢«ç«‹å³ä¿å­˜åˆ°æ°¸ä¹…å­˜å‚¨ï¼ˆå¯ä»¥éšæ—¶è°ƒç”¨sync()æ¥æäº¤æ›´æ”¹ï¼‰ã€‚ QSettingsè¯»å– QSettingsä½¿ç”¨ä½¿ç”¨value()å‡½æ•°å¾—åˆ°ä¸€ä¸ªkeyçš„valueï¼Œå¦‚ï¼š 12345678m_settings-&gt;beginGroup(&quot;General&quot;);m_name = m_settings-&gt;value(&quot;name&quot;, m_name).toString();if (m_name.isEmpty()) &#123; m_name = &quot;lixiang&quot;;&#125;m_male = m_settings-&gt;value(&quot;male&quot;, m_male).toBool();m_age = m_settings-&gt;value(&quot;age&quot;, m_age).toInt();m_settings-&gt;endGroup(); QVariantç±»å‹ QSettingsçš„valueä¸ºQVariantç±»å‹ï¼ŒQvariantæ˜¯ä¸€ç§æ•°æ®ç±»å‹çš„é›†åˆï¼Œæ˜¯Qt Coreæ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ”¯æŒå¤§éƒ¨åˆ†é€šå¸¸çš„Qtæ•°æ®ç±»å‹è½¬æ¢ï¼Œå¦‚ï¼štoInt()ï¼ŒtoString(), toBool()ï¼ŒtoPoint()ï¼ŒtoSize()ç­‰ï¼Œä½†å®ƒä¸èƒ½æä¾›Qt GUIé‚£ä¸€éƒ¨åˆ†çš„Qtæ•°æ®ç±»å‹è½¬æ¢ï¼Œå¦‚ï¼šQColorã€QImageã€ QPixmapï¼Œå³QVariantä¸­æ²¡æœ‰toColor()ã€toImage()ã€toPixmap()ç­‰æ¥å£ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨QVariant::value()æˆ–qVariantValue()æ¨¡æ¿å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1QColor color = m_settings-&gt;value(&quot;color&quot;).value&lt;QColor&gt;(); æ—¢ç„¶ä¸Šé¢è¯´åˆ°QVariantä¸­æ²¡æœ‰toColor()ç­‰æ¥å£ï¼Œé‚£å¦‚æœæ˜¯QColorç­‰ç±»å‹ï¼Œæ˜¯å¦å¯ä»¥ç›´æ¥ç”¨setValue()å»å­˜å‚¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼ŒåŒ…æ‹¬Qt Coreå’ŒQt GUIåœ¨ç±»çš„ç›¸å…³ç±»å‹ï¼ŒQVariantéƒ½æ”¯æŒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12QColor color = palette().background().color();m_settings-&gt;setValue(&quot;color&quot;, color); å¦å¤–ï¼Œä½¿ç”¨qRegisterMetaType()å’ŒqRegisterMetaTypeStreamOperators()æ³¨å†Œçš„è‡ªå®šä¹‰ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨QSettingsè¿›è¡Œå­˜å‚¨ã€‚ inié…ç½®æ–‡ä»¶ç¤ºèŒƒ 1234[%General]age=18male=truename=lixiang","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https://eightplus.github.io/tags/Qt/"}]},{"title":"é€šè¿‡boost.pythonå°†c++å°è£…æˆåŠ¨æ€åº“ä¾›pythonè°ƒç”¨","slug":"2019-10-22-boost-python-cpp","date":"2019-10-22T15:10:10.000Z","updated":"2019-10-22T15:23:38.700Z","comments":true,"path":"2019/10/22/2019-10-22-boost-python-cpp/","link":"","permalink":"https://eightplus.github.io/2019/10/22/2019-10-22-boost-python-cpp/","excerpt":"","text":"è¿™é‡Œç®€è¦ä»‹ç»å¦‚ä½•é€šè¿‡boost.pythonå°†c++å°è£…åŠ¨æ€åº“ï¼Œè®©pythonç›´æ¥è°ƒç”¨åº“ä¸­çš„å‡½æ•°ï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è®©soä¸­å°†è¦åœ¨pythonä¸­ç›´æ¥è°ƒç”¨çš„å‡½æ•°ã€ç±»ã€ç»“æ„ä½“ç­‰ï¼Œé€šè¿‡boostä¸­ç‰¹å®šå‡½æ•°æš´éœ²ç»™pythonï¼Œè€Œä¸”soçš„ç›®æ ‡åå¿…é¡»å’ŒBOOST_PYTHON_MODULEä½¿ç”¨çš„moduleåä¸€è‡´ï¼ˆå³ç”Ÿæˆçš„åŠ¨æ€åº“å‘½åä¸ºå°è£…æ¨¡å—çš„åå­—ï¼‰ï¼Œè¿™æ ·ï¼Œåœ¨pythonå°±å¯ä»¥ç›´æ¥importè¯¥æ¨¡å—ï¼Œå¹¶åƒè°ƒç”¨å…¶ä»–æ¨¡å—çš„å‡½æ•°ã€ç±»ã€ç»“æ„ä½“ç­‰ä¸€æ ·ï¼Œç›´æ¥è°ƒç”¨é‡Œè¾¹çš„å‡½æ•°ã€ç±»ã€ç»“æ„ä½“â€¦â€¦ ç¤ºä¾‹æºç  boost-python-cpp å¼€å‘åº“çš„å®‰è£…$ sudo apt install libboost-dev libboost1.58-dev libboost-python-dev gcc g++ pkg-config python-dev build-essential ç¤ºä¾‹æºç çš„ç¼–è¯‘å®‰è£…å’Œè¿è¡Œ123$ make$ sudo make install$ python test.py C++å°è£…åŠ¨æ€åº“ å¦‚ç¤ºä¾‹ä»£ç ä¸­daemon.ccä¸­çš„ä»£ç æ‰€ç¤ºï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç±»Daemonï¼Œè¯¥ç±»çš„æ„é€ å‡½æ•°æœ‰ä¸€ä¸ªstringç±»å‹çš„å‚æ•°ï¼Œç±»ä¸­æœ‰ä¸¤ä¸ªæˆå‘˜å‡½æ•°detect_os_infoå’Œget_os_infoï¼Œè€Œä¸”è¿˜åœ¨Deamonç±»ä¹‹å¤–å®ç°äº†ä¸€ä¸ªæ™®é€šå‡½æ•°get_usernameã€‚å¦‚ä¸‹æ‰€ç¤ºçš„BOOST_PYTHON_MODULEä»£ç ï¼Œç›®çš„æ˜¯å¯¼å‡ºç±»åŠéƒ¨åˆ†æˆå‘˜ï¼Œä»¥åŠæ™®é€šå‡½æ•°ï¼Œè¿™äº›å¯¼å‡ºçš„ç±»å’Œå‡½æ•°ï¼Œå°†å¯ä»¥åœ¨pythonä¸­è°ƒç”¨ã€‚ 12345678BOOST_PYTHON_MODULE(boost_py_cpp_module)&#123; class_&lt;Daemon, boost::noncopyable &gt; (&quot;Daemon&quot;, &quot;This is the test daemon for python and C++&quot;, init&lt;std::string&gt;())//æ„é€ å‡½æ•° .def(&quot;detect_os_info&quot;, &amp;Daemon::detect_os_info)//æˆå‘˜å‡½æ•° .def(&quot;get_os_info&quot;, &amp;Daemon::get_os_info)//æˆå‘˜å‡½æ•° ; def(&quot;get_username&quot;, &amp;get_username);//æ™®é€šå‡½æ•°&#125; pythonè°ƒç”¨C++ ç¤ºä¾‹ä¸­çš„test.pyå±•ç¤ºäº†pythonæ˜¯å¦‚ä½•è°ƒç”¨C++ä¸­çš„ç±»å’Œå‡½æ•°ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼ˆå…¶ä¸­ import boost_py_cpp_moduleå°±æ˜¯å¯¼å…¥C++ç¼–å†™çš„æ¨¡å—ï¼Œè¯¥æ¨¡å—çš„åå­—ä¸C++ç”Ÿæˆçš„åº“çš„åå­—ä¸€è‡´ï¼‰ï¼š 1234567891011121314151617181920212223242526import osimport sysimport ctypestry: libc = ctypes.CDLL(&apos;libc.so.6&apos;) libc.prctl(15, &apos;ydaemon&apos;, 0, 0, 0)except: passimport boost_py_cpp_moduledef get_os(): iface = boost_py_cpp_module.Daemon(&quot;OS&quot;) iface.detect_os_info() data = iface.get_os_info() return datadef get_username(): try: import boost_py_cpp_module username = boost_py_cpp_module.get_username() return username except: return &quot;root&quot;if __name__ == &apos;__main__&apos;: print &quot;OS info: &quot;, get_os() print &quot;User name: &quot;, get_username()","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Boost Python C++","slug":"Boost-Python-C","permalink":"https://eightplus.github.io/tags/Boost-Python-C/"}]},{"title":"Boost åºåˆ—åŒ–","slug":"2019-09-18-boost-serialization","date":"2019-09-18T02:58:18.000Z","updated":"2019-09-18T03:37:16.703Z","comments":true,"path":"2019/09/18/2019-09-18-boost-serialization/","link":"","permalink":"https://eightplus.github.io/2019/09/18/2019-09-18-boost-serialization/","excerpt":"","text":"ä¸Šä¸€ç¯‡åšå®¢è®²è§£è¿‡ protobuf çš„åºåˆ—åŒ–ï¼ˆå°†å¯¹è±¡å˜æˆå­—èŠ‚æµçš„å½¢å¼ä¼ å‡ºå»ï¼‰å’Œååºåˆ—åŒ–ï¼ˆä»å­—èŠ‚æµæ¢å¤æˆåŸæ¥çš„å¯¹è±¡ï¼‰ï¼Œè¿™ç¯‡åšå®¢å°†ä»‹ç»å¦å¤–ä¸€ç§åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹æ¡ˆï¼šBoost.Serializationã€‚Boost.Serializationå¯ä»¥åˆ›å»ºæˆ–é‡å»ºç¨‹åºä¸­çš„ç­‰æ•ˆç»“æ„ï¼Œå¹¶ä¿å­˜ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€æ–‡æœ¬æ•°æ®ã€XMLæˆ–è€…æœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„å…¶ä»–æ–‡ä»¶ã€‚ ç¤ºä¾‹æºç  boost-serialization protobuf ä¸ Boost.Serialization çš„æ¯”è¾ƒ protobuf:è½»é‡çº§çš„ï¼Œæ”¯æŒçš„æ•°æ®ç±»å‹æœ‰é™ï¼Œä¸”æ•°æ®å¯¹è±¡å¿…é¡»é¢„å…ˆå®šä¹‰ï¼Œä½¿ç”¨ protoc ç¼–è¯‘ï¼Œä½†å…¶æ•ˆç‡è¾ƒé«˜ï¼Œé€‚åˆè¦æ±‚æ•ˆç‡ï¼Œå…è®¸è‡ªå®šä¹‰ç±»å‹çš„å†…éƒ¨åœºåˆä½¿ç”¨ã€‚ Boost.SerializationBoost åº“éå¸¸åºå¤§ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼ŒBoost.Serializationåºåˆ—åŒ–åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªå°åˆ†æ”¯ï¼Œä½†å°±ç®—åªä½¿ç”¨åºåˆ—åŒ–ï¼Œä¹Ÿéœ€è¦å®‰è£…æ•´ä¸ªBooståº“ï¼Œå…¶æ”¯æŒçš„åºåˆ—åŒ–åŠŸèƒ½å¼ºå¤§ï¼Œæ—¢æ”¯æŒäºŒç»´æ•°ç»„ï¼ˆæŒ‡é’ˆï¼‰ï¼Œä¹Ÿæ”¯æŒSTLå®¹å™¨ï¼Œåºåˆ—åŒ–ä½¿ç”¨çµæ´»ç®€ã€‚ Boost.Serialization çš„ä¸¤ç§æ¨¡å¼ä»‹ç» Booståºåˆ—åŒ–å¯ä»¥åˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼šä¾µå…¥å¼ï¼ˆintrusiveï¼‰å’Œéä¾µå…¥å¼ ï¼ˆnon-intrusiveï¼‰ ä¾µå…¥å¼ï¼ˆintrusiveï¼‰ ä¾µå…¥å¼åºåˆ—åŒ–æ—¶ï¼Œéœ€è¦åœ¨classé‡Œé¢åŠ å…¥åºåˆ—åŒ–çš„ä»£ç ï¼Œåºåˆ—åŒ–çš„æ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š å…ˆå¼•ç”¨ boost å¤´æ–‡ä»¶ åœ¨ç±»çš„å£°æ˜ä¸­, ç¼–å†™åºåˆ—åŒ–å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„æ ¼å¼å¦‚ä¸‹: 12345template&lt;class Archive&gt;void serialize(Archive &amp; ar, const unsigned int version)//versionæ˜¯ç‰ˆæœ¬å·&#123; ar&amp; m_str;&#125; ç±»çš„å®ä¾‹åŒ–å’Œèµ‹å€¼ å®šä¹‰ä¸€ä¸ªåºåˆ—åŒ–çš„å¯¹è±¡å’Œæ•°æ®æµçš„å†™å…¥(å…·ä½“åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ä»£ç è§ç¤ºä¾‹æºç )123boost::archive::text_oarchive text_oa(text_sstream);//æ–‡æœ¬æ–¹å¼boost::archive::binary_oarchive binary_oa(binary_sstream);//äºŒè¿›åˆ¶æ–¹å¼binary_oa &lt;&lt; info;//å°†å¯¹è±¡infoçš„åºåˆ—åŒ–æ•°æ®ä»¥äºŒè¿›åˆ¶å­˜å‚¨å½¢å¼å†™å…¥å†…å­˜ éä¾µå…¥å¼ï¼ˆnon-intrusiveï¼‰ å¦‚æœclassæ˜¯æ—©å·²å­˜åœ¨çš„ï¼Œä¸”æˆ‘ä»¬ä¸æƒ³å†æ”¹å˜classé‡Œé¢çš„ä»£ç æ—¶ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨éä¾µå…¥å¼çš„åºåˆ—åŒ–ã€‚éä¾µå…¥å¼åºåˆ—åŒ–æ—¶ï¼Œåºåˆ—åŒ–å‡½æ•°éœ€è¦è®¿é—®æ•°æ®æˆå‘˜ï¼Œè¿™å°±è¦æ±‚å°†classçš„æ•°æ®æˆå‘˜æš´éœ²å‡ºæ¥ï¼Œå³publicï¼Œè€Œä¸æ˜¯privateã€‚å…¶åºåˆ—åŒ–çš„æ­¥éª¤å’Œä¸Šé¢çš„ä¾µå…¥å¼åºåˆ—åŒ–æ­¥éª¤ä¸€è‡´ã€‚ Boost å¼€å‘åº“çš„å®‰è£…$ sudo apt install libboost-dev libboost1.58-dev libboost-serialization1.58-dev","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Boost","slug":"Boost","permalink":"https://eightplus.github.io/tags/Boost/"}]},{"title":"protobuf","slug":"2019-09-11-protobuf","date":"2019-09-11T13:07:14.000Z","updated":"2019-09-11T13:40:15.178Z","comments":true,"path":"2019/09/11/2019-09-11-protobuf/","link":"","permalink":"https://eightplus.github.io/2019/09/11/2019-09-11-protobuf/","excerpt":"","text":"Protobuf: Google Protocol Bufferï¼Œæ˜¯ Google å…¬å¸å†…éƒ¨çš„æ··åˆè¯­è¨€æ•°æ®æ ‡å‡†ï¼Œç”¨äº RPC ç³»ç»Ÿå’ŒæŒç»­æ•°æ®å­˜å‚¨ç³»ç»Ÿã€‚ proto3 ä¸ proto2 çš„åŒºåˆ« proto3 æ¯” proto2 æ”¯æŒæ›´å¤šè¯­è¨€ï¼ˆå¦‚Goã€Rubyã€JavaNanoç­‰ï¼‰ï¼Œå»æ‰äº†ä¸€äº›å¤æ‚çš„è¯­æ³•å’Œç‰¹æ€§ï¼Œæ›´å¼ºè°ƒçº¦å®šè€Œå¼±åŒ–è¯­æ³•ã€‚ä¸‹é¢åˆ—ä¸¾å‡ ç‚¹ proto3 ä¸ proto2 çš„ä¸åŒç‚¹ï¼š 1ã€proto æ–‡ä»¶å¼€å¤´ç¬¬ä¸€è¡Œå¿…é¡»æŒ‡å®šç‰ˆæœ¬ï¼šsyntax = &quot;proto3&quot;;ï¼Œè€Œåœ¨ proto2 ä¸­ï¼Œå¯ä»¥å†™æˆ syntax = &quot;proto2&quot;; æˆ–è€…ä¸å†™ï¼› 2ã€å­—æ®µè§„åˆ™ç§»é™¤äº† â€œrequiredâ€ï¼Œå°†å¹¶æŠŠ â€œoptionalâ€ æ”¹åä¸º â€œsingularâ€ï¼› 3ã€â€œrepeatedâ€ å­—æ®µé»˜è®¤é‡‡ç”¨ packed ç¼–ç ï¼Œè€Œåœ¨ proto2 ä¸­ï¼Œéœ€è¦æ˜ç¡®ä½¿ç”¨ [packed=true] æ¥ä¸ºå­—æ®µæŒ‡å®šæ¯”è¾ƒç´§å‡‘çš„ packed ç¼–ç æ–¹å¼ï¼› 4ã€ç§»é™¤äº† default é€‰é¡¹ï¼Œåœ¨ proto2 ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ default é€‰é¡¹ä¸ºæŸä¸€å­—æ®µæŒ‡å®šé»˜è®¤å€¼ï¼Œè€Œåœ¨ proto3 ä¸­ï¼Œå­—æ®µçš„é»˜è®¤å€¼åªèƒ½æ ¹æ®å­—æ®µç±»å‹ç”±ç³»ç»Ÿå†³å®šï¼› 5ã€å¢åŠ äº† JSON æ˜ å°„ç‰¹æ€§ â€¦â€¦ protobufç¼–ç¨‹ ç”±äºæˆ‘çš„å¼€å‘ç¯å¢ƒæ˜¯Ubuntu 1604, æ‰€ä»¥æˆ‘è¿™é‡Œç¼–å†™ç¤ºä¾‹ä»£ç å°†ä½¿ç”¨ proto2ã€‚protobufæ˜¯æ”¯æŒåµŒå¥—ç±»å‹çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºä¸º Protocol Buffers å®˜æ–¹æ–‡æ¡£æä¾›çš„åµŒå¥—ç±»å‹ç¤ºä¾‹ Protocol Buffers å®˜æ–¹æ–‡æ¡£ï¼ˆprotoæ–‡ä»¶æ·»åŠ æ³¨é‡Šå’ŒC/C++ä¸€æ ·ï¼Œä½¿ç”¨ // æˆ– /* ... */è¯­æ³•ï¼‰ 123456789101112131415161718message Person &#123; required string name = 1; required int32 id = 2; optional string email = 3; enum PhoneType &#123; MOBILE = 0; HOME = 1; WORK = 2; &#125; message PhoneNumber &#123; required string number = 1; optional PhoneType type = 2 [default = HOME]; &#125; repeated PhoneNumber phone = 4;&#125; ç¤ºä¾‹ä»£ç å°†ä»‹ç»ä¸¤ç§è¯­è¨€çš„ protobuf ä½¿ç”¨ï¼ŒC++å’ŒPythonï¼Œå¯¹äºC++ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®æ¯ä¸ª.protoæ–‡ä»¶ç”Ÿæˆä¸€ä¸ª.hå’Œä¸€ä¸ª.ccæ–‡ä»¶ï¼Œå¹¶ä¸ºæ–‡ä»¶ä¸­æè¿°çš„æ¯ç§æ¶ˆæ¯ç±»å‹æä¾›ä¸€ä¸ªç±»ã€‚è€Œå¯¹äºPythonåˆ™ä¸åŒï¼ŒPythonç¼–è¯‘å™¨ç”Ÿæˆä¸€ä¸ªæ¨¡å—ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªæ¶ˆæ¯ç±»å‹çš„é™æ€æè¿°ç¬¦ï¼Œ.protoç„¶åä¸å…ƒç±»ä¸€èµ·ä½¿ç”¨ï¼Œä»¥åœ¨è¿è¡Œæ—¶åˆ›å»ºå¿…è¦çš„Pythonæ•°æ®è®¿é—®ç±»ã€‚ C++ç¤ºä¾‹ æºç  åœ¨åŠ¨æ‰‹ç¼–å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…ç¼–è¯‘ä¾èµ–ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1$ sudo apt install libprotobuf-dev protobuf-compiler C++ ç¤ºä¾‹ä»£ç çš„myinfo.protoæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š 12345678syntax = &quot;proto2&quot;;package com.xiaoming.protobuf;message BufferMessage&#123; required int64 id = 1; required string name = 2; optional int32 opt = 3;&#125; ä½¿ç”¨ protoc å‘½ä»¤æ ¹æ® .proto æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„ .pb.cc å’Œ .pb.h æ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹: protoc -I=è¾“å…¥ç›®å½• --cpp_out=è¾“å‡ºç›®å½• xxx.proto æ¯”å¦‚æ‰§è¡Œprotoc -I=./ --cpp_out=./ myinfo.protoåˆ™ç”Ÿæˆ myinfo.pb.cc å’Œ myinfo.pb.hã€‚ æºç ä¸­ test_in.c çš„ä½œç”¨æ˜¯åºåˆ—åŒ–ï¼Œå¹¶å°†åºåˆ—åŒ–çš„å†…å®¹å†™å…¥æ–‡ä»¶ä¸­ï¼Œè€Œ test_out.c çš„ä½œç”¨åˆ™æ˜¯ååºåˆ—åŒ–ï¼Œè¯»å– test_in.c å†™å…¥æ–‡ä»¶ä¸­çš„å†…å®¹å¹¶ååºåˆ—åŒ–ã€‚ å…·ä½“ç¼–è¯‘æƒ…å†µè§Makefileæ–‡ä»¶ï¼Œç¼–è¯‘å’Œè¿è¡Œå¦‚ä¸‹ï¼š 123make./test_in./test_out Pythonç¤ºä¾‹ æºç  å®‰è£…ä¾èµ–ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1$ sudo apt install python-protobuf Python ç¤ºä¾‹ä»£ç çš„myinfo.protoæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼ˆè¯¥æ–‡ä»¶æ ¹æ®ä¸Šé¢æåˆ°çš„ Protocol Buffers å®˜æ–¹æ–‡æ¡£ä¸­æä¾›çš„åµŒå¥—ç±»å‹ç¤ºä¾‹æ”¹å†™è€Œæ¥ï¼‰ï¼š 12345678910111213141516171819202122232425syntax = &quot;proto2&quot;;package com.xiaoming.protobuf;message ClassMate&#123; required string name = 1; required int32 id = 2; optional string email = 3; enum PhoneType&#123; MOBILE = 0; HOME = 1; WORK = 2; &#125; message PhoneNumber&#123; required string number = 1; required PhoneType type = 2 [default = HOME]; &#125; repeated PhoneNumber phone = 4;&#125;message AlumniBook&#123; repeated ClassMate mate = 1;&#125; ä½¿ç”¨ protoc å‘½ä»¤æ ¹æ® .proto æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„ .py æ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹: protoc -I=è¾“å…¥ç›®å½• --python_out=è¾“å‡ºç›®å½• xxx.proto æ¯”å¦‚æ‰§è¡Œ protoc -I=./ --python_out=./ myinfo.proto åˆ™ç”Ÿæˆ myinfo_pb2.py æ–‡ä»¶ã€‚ æºç ä¸­ test_in.py çš„ä½œç”¨æ˜¯åºåˆ—åŒ–ï¼Œå¹¶å°†åºåˆ—åŒ–çš„å†…å®¹å†™å…¥æ–‡ä»¶ä¸­ï¼Œtest_out.py çš„ä½œç”¨åˆ™æ˜¯ååºåˆ—åŒ–ï¼Œè¯»å– test_in.py å†™å…¥æ–‡ä»¶ä¸­çš„å†…å®¹å¹¶ååºåˆ—åŒ–ã€‚ è¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š 12python test_in.py 1.logpython test_out.py 1.log","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"protobuf","slug":"protobuf","permalink":"https://eightplus.github.io/tags/protobuf/"}]},{"title":"å›è°ƒå‡½æ•°","slug":"2019-09-05-callback","date":"2019-09-05T11:18:07.000Z","updated":"2019-09-05T11:36:28.220Z","comments":true,"path":"2019/09/05/2019-09-05-callback/","link":"","permalink":"https://eightplus.github.io/2019/09/05/2019-09-05-callback/","excerpt":"","text":"ä¸ºä»€ä¹ˆå­¦ä¼šå†™å›è°ƒå‡½æ•°å¾ˆé‡è¦ï¼Ÿ å‡è®¾æœ‰ä¸¤ä¸ªç¨‹åºï¼Œç¨‹åºAä¸ºä¸Šå±‚åº”ç”¨ç¨‹åºï¼Œç¨‹åºBä¸ºåº•å±‚é©±åŠ¨æ¥å£ï¼Œå½“åº•å±‚é©±åŠ¨æ¥å£Bæœ‰æ•°æ®å˜åŒ–æ—¶éœ€è¦å°†å˜åŒ–çš„æ•°æ®ä¼ è¾“ç»™ä¸Šå±‚åº”ç”¨Aæ—¶ï¼Œæ­¤æ—¶æœ‰ä¸¤ç§æ–¹å¼ï¼š 1)åº•å±‚é©±åŠ¨æ¥å£Bå°†å˜åŒ–çš„æ•°æ®å­˜æ”¾åœ¨æ¥å£å‡½æ•°ä¸­ï¼Œä¸Šå±‚åº”ç”¨Aæƒ³è°ƒç”¨çš„æ—¶å€™è‡ªå·±å»è°ƒç”¨Bçš„æ¥å£è·å–å˜åŒ–çš„æ•°æ®ï¼Œå³å‡½æ•°è°ƒç”¨ï¼Œæ­¤æ—¶ä¸»åŠ¨æƒåœ¨ä¸Šå±‚åº”ç”¨Açš„æ‰‹ä¸­ã€‚ 2)åº•å±‚é©±åŠ¨æ¥å£Bå®ç°å›è°ƒæœºåˆ¶ï¼Œå½“æœ‰æ•°æ®å˜åŒ–éœ€è¦ä¼ è¾“ç»™ä¸Šå±‚åº”ç”¨Açš„æ—¶å€™é€šçŸ¥Aæ¥è¯»å–å˜åŒ–çš„æ•°æ®ï¼Œç„¶åä¸Šå±‚åº”ç”¨Aåœ¨ç”¨æˆ·å±‚çš„å›è°ƒå‡½æ•°ä¸­è¯»å–å˜åŒ–çš„æ•°æ®ã€‚æ­¤æ—¶ä¸»åŠ¨æƒåœ¨åº•å±‚é©±åŠ¨æ¥å£Bçš„æ‰‹ä¸­ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼ï¼Œé‚£ä¹ˆä¸Šå±‚åº”ç”¨Aæ ¹æœ¬å°±ä¸çŸ¥é“åº•å±‚é©±åŠ¨æ¥å£Bä¸­çš„æ•°æ®åœ¨ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå³ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™åº”è¯¥å»è°ƒç”¨åº•å±‚é©±åŠ¨æ¥å£Bçš„æ¥å£å‡½æ•°è¯»å–å˜åŒ–çš„æ•°æ®ï¼›è€Œä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œä¸Šå±‚åº”ç”¨Aè¯»å–å˜åŒ–çš„æ•°æ®çš„æ“ä½œä¾èµ–äºåº•å±‚é©±åŠ¨æ¥å£Bï¼Œåªæœ‰åº•å±‚é©±åŠ¨æ¥å£Bå‘¼å«ä¸Šå±‚åº”ç”¨Aè¯»è¯¥è¯»å–å˜åŒ–çš„æ•°æ®äº†ï¼Œä¸Šå±‚åº”ç”¨Aæ‰ä¼šå»è¯»æ•°æ®ï¼Œå³å®ç°äº†ä¸­æ–­è¯»å–ã€‚æ˜¾ç„¶ï¼Œåœ¨æˆ‘ä»¬å°è£…ä¸€äº›åº•å±‚æ¥å£ç»™åˆ«äººä½¿ç”¨çš„æ—¶å€™ï¼Œå®ç°å›è°ƒå‡½æ•°å°†ä¼šæ´¾ä¸Šå¾ˆå¤§çš„ç”¨åœºã€‚ å›è°ƒçš„å®šä¹‰å’Œå®ç°æ˜¯æ€æ ·çš„ï¼Ÿ å›è°ƒå‡½æ•°æ˜¯æŒ‡ä½¿ç”¨è€…è‡ªå·±å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ç°è¿™ä¸ªå‡½æ•°çš„ç¨‹åºå†…å®¹ï¼Œç„¶åæŠŠè¿™ä¸ªå‡½æ•°ï¼ˆå…¥å£åœ°å€ï¼‰ä½œä¸ºå‚æ•°ä¼ å…¥åˆ«äººçš„å‡½æ•°ä¸­ï¼Œç”±åˆ«äººçš„å‡½æ•°åœ¨è¿è¡Œæ—¶æ¥è°ƒç”¨çš„å‡½æ•°ã€‚å³å‡½æ•°æ˜¯ä½ å®ç°çš„ï¼Œä½†ç”±åˆ«äººçš„å‡½æ•°åœ¨è¿è¡Œæ—¶é€šè¿‡å‚æ•°ä¼ é€’çš„æ–¹å¼è°ƒç”¨ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„å›è°ƒå‡½æ•°ã€‚ æ‹¿ä¸Šé¢æåˆ°ä¸Šå±‚åº”ç”¨Aå’Œåº•å±‚é©±åŠ¨æ¥å£Bæ¥æ‰“æ¯”æ–¹ï¼Œä¹Ÿå°±æ˜¯è¯´å›è°ƒå‡½æ•°æ˜¯ä¸€ä¸ªé€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨çš„å‡½æ•°ã€‚ä¸Šå±‚åº”ç”¨AæŠŠå‡½æ•°çš„æŒ‡é’ˆï¼ˆå…¥å£åœ°å€ï¼‰ä½œä¸ºå‚æ•°ä¼ é€’ç»™åº•å±‚é©±åŠ¨æ¥å£Bï¼Œå½“è¿™ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å‡½æ•°åœ¨åº•å±‚é©±åŠ¨æ¥å£Bä¸­è¢«è°ƒç”¨æ—¶(å³ä¸Šå±‚åº”ç”¨Aä¸æ˜¯è‡ªå·±è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯å°†è¿™ä¸ªå‡½æ•°çš„å‡½æ•°æŒ‡é’ˆé€šè¿‡åº•å±‚é©±åŠ¨æ¥å£Bçš„æ¥å£å‡½æ•°ä¼ åˆ°åº•å±‚é©±åŠ¨æ¥å£Bä¸­ï¼Œç”±åº•å±‚é©±åŠ¨æ¥å£Bæ¥æ“æ§æ‰§è¡Œ)ã€‚ wikiä¸Šçš„ä»‹ç»æ˜¯è¿™æ ·çš„å›è°ƒå‡½æ•°Callback)çš„ï¼š In computer programming, a callback, also known as a â€œcall-afterâ€what-is-a-callback-function function, is any executable code that is passed as an argument to other code that is expected to call back (execute) the argument at a given time. This execution may be immediate as in a synchronous callback, or it might happen at a later time as in an asynchronous callback. Programming languages support callbacks in different ways, often implementing them with subroutines, lambda expressions, blocks, or function pointers. ç¤ºä¾‹ è¿™é‡Œæä¾›ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ test.cï¼Œæ¼”ç¤ºäº†å››ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°processFunctionçš„å‚æ•°ä¸ºä¸€ä¸ªç»“æ„ä½“ï¼Œå›è°ƒå‡½æ•°test1Functionçš„å‚æ•°ä¸ºä¸€ä¸ªæ•´å½¢å˜é‡ï¼Œå›è°ƒå‡½æ•°test2Functionå’Œtest3Functionçš„å‚æ•°éƒ½ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†è¿™ä¸¤ä¸ªå›è°ƒå‡½æ•°çš„ç”¨æ³•ä¸ä¸€æ ·ï¼Œä¸€ä¸ªä½¿ç”¨åˆ«åæ–¹å¼ï¼Œä¸€ä¸ªä½¿ç”¨æŒ‡é’ˆæ–¹å¼ã€‚ åç»­è®¡åˆ’å°†Githubä¸Šçš„callbackç¤ºä¾‹è¿›è¡Œæ›´æ–°ï¼Œå°†å…¶å°è£…æˆä¸€ä¸ªsoä¾›ç”¨æˆ·ç¨‹åºè°ƒç”¨ã€‚ æºç ï¼šmy-callback","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"callback","slug":"callback","permalink":"https://eightplus.github.io/tags/callback/"}]},{"title":"Gtk plugin ç¼–ç¨‹å¼€å‘","slug":"2019-09-01-gtk-plugins","date":"2019-09-01T04:02:13.000Z","updated":"2019-09-01T04:34:33.592Z","comments":true,"path":"2019/09/01/2019-09-01-gtk-plugins/","link":"","permalink":"https://eightplus.github.io/2019/09/01/2019-09-01-gtk-plugins/","excerpt":"","text":"å‰é¢ä»‹ç»è¿‡GLibã€GObjectå’ŒDbus-glibï¼Œè¿™é‡Œå°†åœ¨è¿™äº›çŸ¥è¯†çš„åŸºç¡€ä¸Šï¼Œç»“åˆGtkå›¾å½¢åº“ï¼Œå®Œæˆä¸€ä¸ªæ’ä»¶ï¼ˆpluginï¼‰æ¡†æ¶çš„æ­å»ºã€‚è¯¥æ€ä¹ˆé€šä¿—æ˜“æ‡‚çš„ä»‹ç»è¿™é‡Œçš„æ’ä»¶å‘¢ï¼Œå·¦æ€å³æƒ³ï¼Œè¿˜æ˜¯å†³å®šä»¥GStreamerä¸ºä¾‹æ¥ç®€å•ä»‹ç»ä¸‹æ’ä»¶ï¼ˆGStreameræ˜¯ä¸€ä¸ªåˆ›å»ºæµåª’ä½“åº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œè¿™å®¶ä¼™å¯¹äºLinuxä¸‹çš„éŸ³/è§†é¢‘æ’­æ”¾ã€æ‘„åƒå¤´ç­‰æ–¹é¢æœ‰ç€å¾ˆé‡è¦çš„åœ°ä½å’Œä½œç”¨ï¼Œå¦‚ GNOME æ¡Œé¢çš„é»˜è®¤æ’­æ”¾å™¨rhythmboxï¼Œcheeseæ‘„åƒå¤´ç­‰è½¯ä»¶éƒ½æ˜¯ç”¨çš„GStreamerã€‚æˆ‘æœ¬äººå•Šï¼Œå¯¹è¿™ä¸ªä¸œè¥¿çœŸçš„æ˜¯ç‰¹åˆ«æ„Ÿå…´è¶£ï¼Œå¯æƒœç›®å‰ä¸šä½™æ—¶é—´ææ€•éš¾ä»¥æ·±å…¥åˆ†æï¼Œé—æ†¾:cold_sweat:ï¼‰ã€‚ GStreamer æ’ä»¶çš„å·¥ä½œåŸç†åŒå…¶ä»–çš„åŸºäºæ’ä»¶çš„ç¨‹åºçš„å·¥ä½œåŸç†ç±»ä¼¼ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯é€šè¿‡è¯»å–åŠ¨æ€åº“å®ç°çš„ï¼Œåªéœ€è¦æ¯ä¸ªåŠ¨æ€åº“éƒ½å®ç°æŸä¸€ä¸ªç‰¹å®šçš„æ¥å£å°±å¯ä»¥äº†ï¼Œé‡Œé¢ä¼šæœ‰ä¸ªåƒæ³¨å†Œè¡¨ä¸€æ ·çš„æ•°æ®ç»“æ„ä¼šå­˜å‚¨æ‰€æœ‰çš„æ’ä»¶çš„ä¿¡æ¯ã€‚GStreamer æ¡†æ¶åŸºäºæ’ä»¶ï¼Œæœ‰äº›æ’ä»¶ä¸­æä¾›äº†å„ç§å„æ ·çš„å¤šåª’ä½“æ•°å­—ä¿¡å·ç¼–è§£ç å™¨,ä¹Ÿæœ‰äº›æä¾›äº†å…¶ä»–çš„åŠŸèƒ½ï¼Œæ‰€æœ‰çš„æ’ä»¶éƒ½èƒ½å¤Ÿè¢«é“¾æ¥åˆ°ä»»æ„çš„å·²ç»å®šä¹‰äº†çš„æ•°æ®æµç®¡é“ä¸­ã€‚å…ƒä»¶æ˜¯ GStreamerçš„æ ¸å¿ƒï¼Œåœ¨ GStreamer æ’ä»¶çš„å¼€å‘ä¸­ï¼Œä¸€ä¸ªå…ƒä»¶å°±æ˜¯ç»§æ‰¿äº GstElement çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå…ƒä»¶åœ¨ä¸å…¶ä»–å…ƒä»¶è¿æ¥æ—¶æä¾›äº†å¦‚ä¸‹ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼šä¸€ä¸ªæºå…ƒä»¶ä¸ºä¸€ä¸ªæµæä¾›æ•°æ®ï¼Œä¸€ä¸ªæ»¤é•œå…ƒä»¶å¯¹æµä¸­çš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰äº†å…ƒä»¶ï¼ŒGStreameråªæ˜¯ä¸€å †æ¦‚å¿µæ€§çš„ç®¡é“ï¼Œæ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä¾›è¿æ¥ ã€‚GStreamer è‡ªå¸¦äº†ä¸€å¤§å †å…ƒä»¶ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ç¼–å†™é¢å¤–çš„å…ƒä»¶ï¼Œä½†ä»…ä»…ç¼–å†™æ–°çš„å…ƒä»¶å¹¶ä¸å¤Ÿï¼Œä¸ºäº†ä½¿ GStreamer èƒ½å¤Ÿä½¿ç”¨å®ƒï¼Œå°±éœ€è¦å°†å…ƒä»¶å°è£…åˆ°æ’ä»¶ä¸­ã€‚ä¸€ä¸ªæ’ä»¶æ˜¯ä¸€å—å¯ä»¥åŠ è½½çš„ä»£ç ï¼Œé€šå¸¸è¢«ç§°ä¸ºå…±äº«å¯¹è±¡æ–‡ä»¶ï¼ˆshared object fileï¼‰æˆ–åŠ¨æ€é“¾æ¥åº“ï¼ˆdynamically linked libraryï¼‰ã€‚ è¯´åˆ°è¿™é‡Œï¼Œæƒ³å¿…å¤§å®¶åœ¨æ¦‚å¿µä¸Šå¯¹æ’ä»¶æœ‰äº†åˆæ­¥è®¤è¯†ã€‚åœ¨ç¼–ç¨‹æ–¹é¢ï¼Œè¯´åˆ°åº•å°±æ˜¯æ’ä»¶å¯ä»¥è®©å…¶ä»–å¼€å‘è€…åœ¨ä½ çš„ç¨‹åºæ¡†æ¶ä¸‹å¼€å‘æ›´å¤šçš„åŠŸèƒ½æ¨¡å—ï¼Œè€Œä»–ä»¬å¹¶ä¸éœ€è¦ä¿®æ”¹ä½ çš„ä¸»ç¨‹åºï¼Œç”šè‡³ä¸ç”¨æ€ä¹ˆèŠ±å¿ƒæ€å»åˆ†æä½ çš„ä¸»ç¨‹åºã€‚è¿™æ ·ï¼Œä½ åªéœ€è¦ç¼–å†™ä¸€ä¸ªæ¡†æ¶ï¼Œå¹¶æä¾›ä¸€ä¸ªæ’ä»¶ç¤ºä¾‹ï¼Œåˆ«äººå°±èƒ½æŒ‰ç…§ä½ çš„æ’ä»¶ç¤ºä¾‹æ¥ç¼–å†™å…¶ä»–æ’ä»¶ï¼Œå¸®ä½ çš„æ¡†æ¶ç¨‹åºæ·»ç –åŠ ç“¦ï¼Œæƒ³æƒ³éƒ½è½»æ¾å•Š:laughing::laughing::laughing: ç¤ºä¾‹æºç  my-plugin-daemon ç¤ºä¾‹ä»£ç ç¼–ç¨‹è¦ç‚¹ç®€æç¼–è¯‘ç›¸å…³ä»‹ç» å®‰è£…ç¼–è¯‘ä¾èµ– $ sudo apt install autotools-dev intltool libpolkit-agent-1-dev libpolkit-gobject-1-dev libdbus-glib-1-dev libdconf-dev libglib2.0-dev libgtk-3-dev mate-common ç¼–è¯‘å’Œè¿è¡Œ è¿™é‡Œä¸æ˜¯ç›´æ¥ä½¿ç”¨automakeï¼Œè€Œæ˜¯ä½¿ç”¨mate-commonæä¾›çš„mate-autogenï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œå…·ä½“è§ autogen.sh æ–‡ä»¶ï¼Œç¼–è¯‘å’Œè¿è¡Œå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š 123$ ./autogen.sh --prefix=/usr$ make$ ./src/my-plugin-daemon --debug debåŒ… å…·ä½“è§æºç ç›®å½•ä¸‹debianæ–‡ä»¶å¤¹é‡Œé¢çš„å†…å®¹ï¼Œè¿™é‡Œä¸åšè¿‡å¤šæè¿°ï¼Œæœ‰é—®é¢˜çš„è¯ï¼Œå¯ä»¥å‘æˆ‘å‘é‚®ä»¶å¯»æ±‚å¸®åŠ©ã€‚debåŒ…çš„æŒ‡é’ˆå¯ä»¥ä½¿ç”¨å‘½ä»¤ debuild æˆ–è€… dpkg-buildpackage -rfakerooot -bï¼Œç›¸å…³å‘½ä»¤æ‰§è¡Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123$ debuild$ sudo dpkg -i ../my-plugin-daemon_1.0.0_amd64.deb$ /usr/bin/my-plugin-daemon æŸ¥çœ‹åŒ…å®‰è£…çš„æ–‡ä»¶åˆ—è¡¨ 123456789101112131415161718192021$ dpkg -L my-plugin-daemon/./usr/usr/share/usr/share/doc/usr/share/doc/my-plugin-daemon/usr/share/doc/my-plugin-daemon/changelog.gz/usr/share/glib-2.0/usr/share/glib-2.0/schemas/usr/share/glib-2.0/schemas/org.freedesktop.MyPluginDaemon.plugins.diskmonitor.gschema.xml/usr/include/usr/include/my-plugin-daemon/usr/include/my-plugin-daemon/my_daemon_client.h/usr/include/my-plugin-daemon/my_plugin.h/usr/bin/usr/bin/my-plugin-daemon/usr/lib/usr/lib/x86_64-linux-gnu/usr/lib/x86_64-linux-gnu/my-plugin-daemon/usr/lib/x86_64-linux-gnu/my-plugin-daemon/libdiskmonitor.so/usr/lib/x86_64-linux-gnu/my-plugin-daemon/diskmonitor.my-plugin ä¸»æ¡†æ¶çš„æ­å»º ç›¸å…³ä»£ç è§æºç ç›®å½•ä¸‹srcï¼Œæ–‡ä»¶åˆ—è¡¨å¦‚ä¸‹ï¼š 1234567891011main.cMakefile.ammy_daemon.cmy_daemon.hmy_module.cmy_module.hmy_plugin.cmy_plugin.hmy_plugin_info.cmy_plugin_info.horg.freedesktop.myplugindaemon.xml dbus server åœ¨org.freedesktop.myplugindaemon.xmlæ–‡ä»¶ä¸­ï¼Œå†™äº†ä¸¤ä¸ªmethodå’Œä¸¤ä¸ªsignalï¼Œstartå’Œstopåˆ†åˆ«è¡¨ç¤ºå¯åŠ¨æ’ä»¶åŠ è½½å’Œåœæ­¢æ’ä»¶åŠŸèƒ½ã€‚PluginActivatedå’ŒPluginDeactivatedåˆ†åˆ«å‘é€æ’ä»¶æ¿€æ´»å’Œåœæ­¢çš„æ¶ˆæ¯ã€‚è¿™é‡Œæ³¨æ„ä¸‹&lt;annotation name=&quot;org.freedesktop.DBus.GLib.CSymbol&quot; value=&quot;my_daemon&quot;/&gt;çš„valueå€¼ï¼Œè¿™ä¸ªå€¼è¡¨ç¤ºé€šè¿‡å·¥å…·dbus-binding-toolç”Ÿæˆçš„ç»‘å®šæ–‡ä»¶ä¸­callbackç›¸å…³çš„dbus_glib_marshal_xxx_BOOLEAN__POINTERä¸­çš„xxxå³ä¸ºè¿™ä¸ªvalueå€¼ï¼Œä¸è¦å°†å…¶å’Œmethodçš„å‰ç¼€æ··æ·†äº†ï¼Œmethodçš„å‰ç¼€æ˜¯ç”±dbus-binding-toolå·¥å…·æ‰§è¡Œæ—¶â€â€“prefixâ€å‚æ•°æŒ‡å®šçš„ï¼Œç”Ÿæˆçš„ç»‘å®šæ–‡ä»¶ä¸­å’Œå‰ç¼€ç›¸å…³çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 1234static const DBusGMethodInfo dbus_glib_my_daemon_methods[] = &#123;&#123; (GCallback) my_daemon_start, dbus_glib_marshal_my_daemon_BOOLEAN__POINTER, 0 &#125;,&#123; (GCallback) my_daemon_stop, dbus_glib_marshal_my_daemon_BOOLEAN__POINTER, 40 &#125;,&#125;; è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªå­˜æ”¾ç§æœ‰å˜é‡çš„ç»“æ„ä½“ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªé…åˆè¿™ä¸ªç»“æ„ä½“çš„å®MY_DAEMON_GET_PRIVATE(o) ï¼Œè€Œä¸”åœ¨ç±»ç»“æ„çš„æ„é€ å‡½æ•°ä¸­å¢åŠ ä¸€å¥g_type_class_add_private(klass, sizeof(MyDaemonPrivate));ï¼Œç»“æ„ä½“å˜é‡å¦‚ä¸‹æ‰€ç¤ºï¼š 12345struct MyDaemonPrivate&#123; DBusGConnection *connection; GSList *plugins;&#125;; plugins manager åŠ è½½æ’ä»¶ ä»å­˜æ”¾æ’ä»¶soçš„è·¯å¾„ä¸‹è¯»å–soï¼Œè¯»å–æ’ä»¶å¯¹åº”çš„é…ç½®ä¿¡æ¯æ–‡ä»¶ï¼Œç»‘å®šæ’ä»¶çš„ä¿¡å·ï¼Œå¹¶å°†æ’ä»¶å˜é‡ä¿å­˜åˆ°ä¸Šé¢æåˆ°çš„å­˜æ”¾ç§æœ‰å˜é‡çš„ç»“æ„ä½“MyDaemonPrivateä¸­çš„pluginsä¸­ï¼Œæ–¹ä¾¿å¯¹æ’ä»¶è¿›è¡Œç®¡ç†ã€‚ å¸è½½æ’ä»¶ ä¸€æ˜¯è°ƒç”¨æ’ä»¶çš„åœæ­¢å·¥ä½œæ¨¡å—ï¼ŒäºŒæ˜¯æ¸…ç©ºå­˜æ”¾ç§æœ‰å˜é‡çš„ç»“æ„ä½“MyDaemonPrivateä¸­pluginsä¸­çš„æ’ä»¶å˜é‡ã€‚ ç¼–å†™æ’ä»¶ è¿™é‡Œå°±ä¸å¯¹ä»£ç è¿›è¡Œåˆ†æäº†ï¼Œåªç®€è¿°ä¸‹å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼Œç›¸å…³ä»£ç è§æºç ç›®å½•ä¸‹srcï¼Œæ–‡ä»¶åˆ—è¡¨å¦‚ä¸‹ï¼š 12345678diskmonitor.my-plugin.inmy_diskmonitor_dialog.cmy_diskmonitor_plugin.cmy_diskmonitor_space.cMakefile.ammy_diskmonitor_dialog.hmy_diskmonitor_plugin.hmy_diskmonitor_space.h è¿™é‡Œçš„è®¾æƒ³æ˜¯è¿™æ ·çš„ï¼Œå»ºç«‹äº†ä¸€ä¸ªpluginsç›®å½•ï¼Œé‡Œé¢å­˜æ”¾å„ä¸ªæ’ä»¶çš„ä»£ç ï¼Œæ¯ä¸€ä¸ªæ’ä»¶éƒ½ä½œä¸ºä¸€ä¸ªå­ç›®å½•å­˜åœ¨ã€‚æ‰€ä»¥ï¼Œåœ¨pluginsç›®å½•ä¸‹éœ€è¦ç¼–å†™Makefile.amæ–‡ä»¶ï¼Œæ–¹ä¾¿åœ¨æºç ç¼–è¯‘æ—¶ç®¡ç†æ——ä¸‹å„ä¸ªæ’ä»¶å­ç›®å½•ã€‚åŒæ ·ï¼Œå­ç›®å½•é‡Œé¢çš„æ’ä»¶è¦ç¼–è¯‘ï¼Œä¹Ÿéœ€è¦å„è‡ªå†™ä¸€é¥¿Makefile.amã€‚å½“ç„¶ï¼Œå†™äº†Makefile.amï¼Œå°±è¦å¯¹åº”çš„ç¼–å†™å…¶è¾“å‡ºçš„Makefileçš„è§„åˆ™ï¼Œå¦åˆ™ç¼–ä¸å‡ºMakefileæ–‡ä»¶ï¼Œæ‹¿ä»€ä¹ˆæ¥makeå‘¢ï¼Œæ˜¯å§ã€‚æˆ‘ä»¬åœ¨configure.acæ–‡ä»¶çš„ AC_OUTPUT ä¸‹å¢åŠ plugins/Makefileå’Œplugins/diskmonitor/Makefileï¼Œå…¶ä¸­diskmonitorå°±æ˜¯æˆ‘ç¤ºä¾‹ä»£ç çš„ä¸€ä¸ªæ’ä»¶ã€‚configure.acæ–‡ä»¶ä¸­AC_OUTPUTçš„å…·ä½“è¯¦æƒ…å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567AC_OUTPUT([Makefilesrc/Makefileplugins/Makefileplugins/diskmonitor/Makefilepo/Makefile.in]) åœ¨ç¼–è¯‘æ’ä»¶soçš„æ—¶å€™ï¼Œç»ˆç«¯ä¼šæ˜¾ç¤ºå‡ºä¸€ä¸ªè­¦å‘Šï¼Œå¤§è‡´å¦‚ä¸‹ï¼š 1dpkg-shlibdeps: è­¦å‘Š: debian/my-plugin-daemon/usr/lib/x86_64-linux-gnu/my-plugin-daemon/libdiskmonitor.so contains an unresolvable reference to symbol my_plugin_get_type: it&apos;s probably a plugin å‡ºç°äº†è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å¿…æ‹…å¿ƒæ’ä»¶é™¤äº†ä»€ä¹ˆé—®é¢˜ï¼Œè¿™ä»…ä»…æ˜¯dpkg shlibdepsåˆ†æäºŒè¿›åˆ¶ä½¿ç”¨ç¬¦å·é›†æ—¶çš„ä¸€ä¸ªè­¦å‘Šï¼Œå…·ä½“è¯¦æƒ…å¯ä»¥æŸ¥é˜… dpkg-shlibdepsã€‚ åœ¨dataç›®å½•ä¸‹ï¼Œæˆ‘å¯¹æ’ä»¶diskmonitorå¢åŠ äº†ä¸€ä¸ªorg.freedesktop.MyPluginDaemon.plugins.diskmonitor.gschema.xml.inæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯schemasé…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åœ¨å®‰è£…debåŒ…åå­˜æ”¾çš„æœ€ç»ˆè·¯å¾„ä¸ºï¼š/usr/share/glib-2.0/schemas/org.freedesktop.MyPluginDaemon.plugins.diskmonitor.gschema.xmlï¼Œé‡Œé¢æˆ‘åªæ”¾äº†ä¸€ä¸ªå‚æ•°activeï¼Œé»˜è®¤ä¸ºtrueï¼Œæ„æ€æ˜¯æ’ä»¶diskmonitoré»˜è®¤å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œæ’ä»¶ç®¡ç†æ¨¡å—åœ¨åŠ è½½æ’ä»¶çš„æ—¶å€™å°†ä¼šè¯»å–è¿™ä¸ªå€¼ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶æ›´æ”¹è¯¥å€¼ï¼Œå·²è¾¾åˆ°æ§åˆ¶è¯¥æ’ä»¶å¯ç”¨å’Œåœæ­¢çš„ç›®åœ°ã€‚ä¿®æ”¹schemasé…ç½®æ–‡ä»¶çš„å€¼æ—¶ï¼Œé™¤äº†å¯ä»¥ç”¨gsettings apiæä¾›çš„å‡½æ•°ï¼Œå¦‚g_settings_get_stringã€g_settings_set_stringå¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨gsettingså‘½ä»¤ï¼Œå…·ä½“å‚ç…§ gsettingsï¼Œå½“ç„¶è¿˜æœ‰æ›´ç®€å•æ–¹ä¾¿çš„åŠæ³•ï¼Œç”¨å›¾å½¢å·¥å…· dconf-editor æ¥æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1$ dconf-editor æœ€åå†æä¸€ä¸ªpluginæœ€é‡è¦çš„ç‚¹ï¼Œåœ¨æ’ä»¶ç®¡ç†æ¨¡å—ä¸­çš„å››ä¸ªæ–‡ä»¶my_plugin.cã€my_plugin.hã€my_module.cå’Œmy_module.héå¸¸å…³é”®ï¼Œè¿™å››ä¸ªæ–‡ä»¶å…³ç³»ç€æ’ä»¶çœŸåœ¨çš„åŠ è½½ã€å¸è½½å’Œå¯¼å…¥ã€‚ 1. my_plugin.hæ–‡ä»¶ä¸‹æœ‰ä¸€ä¸ªå®MY_PLUGIN_REGISTERï¼Œå…·ä½“å¦‚ä¸‹ï¼š 123456789101112#define MY_PLUGIN_REGISTER(PluginName, plugin_name) \\ G_DEFINE_DYNAMIC_TYPE (PluginName, \\ plugin_name, \\ MY_TYPE_PLUGIN) \\ \\G_MODULE_EXPORT GType \\register_my_plugin(GTypeModule *type_module) \\&#123; \\ plugin_name##_register_type(type_module); \\ \\ return plugin_name##_get_type(); \\&#125; 2. my_module.cä¸‹æœ‰çœŸåœ¨æ‰§è¡Œæ’ä»¶åŠ è½½å’Œå¸è½½çš„ä¸¤ä¸ªå‡½æ•° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849static gboolean my_module_load(GTypeModule *gmodule)&#123; MyModule *module; MyModuleRegisterFunc register_func; gboolean res; module = MY_MODULE(gmodule); g_debug(&quot;Loading %s&quot;, module-&gt;path); module-&gt;library = g_module_open(module-&gt;path, 0); if (module-&gt;library == NULL) &#123; g_warning (&quot;%s&quot;, g_module_error()); return FALSE; &#125; /* extract symbols from the lib */ res = g_module_symbol(module-&gt;library, &quot;register_my_plugin&quot;, (void *)&amp;register_func); if (!res) &#123; g_warning(&quot;%s&quot;, g_module_error()); g_module_close(module-&gt;library); return FALSE; &#125; g_assert(register_func); module-&gt;type = register_func(gmodule); if (module-&gt;type == 0) &#123; g_warning(&quot;Invalid my plugin in module %s&quot;, module-&gt;path); return FALSE; &#125; return TRUE;&#125;static void my_module_unload (GTypeModule *gmodule)&#123; MyModule *module = MY_MODULE(gmodule); g_debug(&quot;Unloading %s&quot;, module-&gt;path); g_module_close(module-&gt;library); module-&gt;library = NULL; module-&gt;type = 0;&#125; 3. åœ¨æ¯ä¸ªæ’ä»¶çš„ä»£ç ä¸­éƒ½éœ€è¦å°†my_plugin.hå¤´æ–‡ä»¶includeè¿›æ¥ï¼Œä¸”éœ€è¦ç¼–å†™ä¸Šé¢æåˆ°çš„æ’ä»¶å®MY_PLUGIN_REGISTERç›¸å…³çš„register_my_pluginä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1G_MODULE_EXPORT GType register_my_plugin(GTypeModule *module);","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Gtk GLib GObject","slug":"Gtk-GLib-GObject","permalink":"https://eightplus.github.io/tags/Gtk-GLib-GObject/"}]},{"title":"GObject ç¼–ç¨‹å…¥é—¨","slug":"2019-08-30-gobject-demo","date":"2019-08-30T12:50:27.000Z","updated":"2019-08-30T14:15:05.077Z","comments":true,"path":"2019/08/30/2019-08-30-gobject-demo/","link":"","permalink":"https://eightplus.github.io/2019/08/30/2019-08-30-gobject-demo/","excerpt":"","text":"Gobjectï¼Œä¹Ÿç§°Glibå¯¹è±¡ç³»ç»Ÿï¼Œæ˜¯ä¸€ä¸ªç¨‹åºåº“ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä½¿ç”¨Cè¯­è¨€ç¼–å†™é¢å‘å¯¹è±¡ç¨‹åºï¼Œå…¶æä¾›äº†ä¸€ä¸ªé€šç”¨çš„åŠ¨æ€ç±»å‹ç³»ç»Ÿï¼ˆGTypeï¼‰ã€ä¸€ä¸ªåŸºæœ¬ç±»å‹çš„å®ç°é›†ï¼ˆå¦‚æ•´å‹ã€æšä¸¾ç­‰ï¼‰ã€ä¸€ä¸ªåŸºæœ¬å¯¹è±¡ç±»å‹Gobjectã€ä¸€ä¸ªä¿¡å·ç³»ç»Ÿä»¥åŠä¸€ä¸ªå¯æ‰©å±•çš„å‚æ•°/å˜é‡ä½“ç³»ã€‚åœ¨ GObjectä¸–ç•Œé‡Œï¼Œç±»æ˜¯ä¸¤ä¸ªç»“æ„ä½“çš„ç»„åˆï¼Œä¸€ä¸ªæ˜¯å®ä¾‹ç»“æ„ä½“ï¼Œå¦ä¸€ä¸ªæ˜¯ç±»ç»“æ„ä½“ã€‚GOBJECTçš„ç»§æ‰¿éœ€è¦å®ç°å®ä¾‹ç»“æ„ä½“çš„ç»§æ‰¿å’Œç±»ç»“æ„ä½“çš„ç»§æ‰¿ï¼ŒGobjectå¯¹è±¡çš„åˆå§‹åŒ–å¯åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šç±»ç»“æ„ä½“åˆå§‹åŒ–å’Œå®ä¾‹ç»“æ„ä½“åˆå§‹åŒ–ã€‚ç±»ç»“æ„ä½“åˆå§‹åŒ–å‡½æ•°åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè€Œå®ä¾‹ç»“æ„ä½“çš„åˆå§‹åŒ–å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ç­‰äºå¯¹è±¡å®ä¾‹åŒ–çš„æ¬¡æ•°ã€‚è¿™æ„å‘³ç€ï¼Œæ‰€æœ‰å¯¹è±¡å…±äº«çš„æ•°æ®ï¼Œå¯ä¿å­˜åœ¨ç±»ç»“æ„ä½“ä¸­ï¼Œè€Œæ‰€æœ‰å¯¹è±¡ç§æœ‰çš„æ•°æ®ï¼Œåˆ™ä¿å­˜åœ¨å®ä¾‹ç»“æ„ä½“ä¸­ã€‚ ç¤ºä¾‹æºç  gobjectdemo GObjectç¼–ç¨‹è¦ç‚¹ç®€æ å® å¦‚æœä½ æµè§ˆè¿‡ä½¿ç”¨ gobject ç¼–å†™çš„è½¯ä»¶æºä»£ç ï¼Œä½ å¯¹ä¸‹é¢å‡ºç°çš„å®ä¸€å®šä¸ä¼šé™Œç”Ÿã€‚ 123456789#define MY_TYPE_DEMO (my_demo_get_type())#define MY_DEMO(object) G_TYPE_CHECK_INSTANCE_CAST((object), MY_TYPE_DEMO, MyDemo)#define MY_DEMO_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST((klass), MY_TYPE_DEMO, MyDemoClass))#define MY_IS_DEMO(object) G_TYPE_CHECK_INSTANCE_TYPE((object), MY_TYPE_DEMO))#define MY_IS_DEMO_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE((klass), MY_TYPE_DEMO))#define MY_DEMO_GET_CLASS(object) (G_TYPE_INSTANCE_GET_CLASS((object), MY_TYPE_DEMO, MyDemoClass))GType my_demo_get_type(void) G_GNUC_CONST;G_DEFINE_TYPE (MyDemo, my_demo, G_TYPE_OBJECT); è¿™é‡Œå¯¹ä¸Šé¢çš„å®ä¸ä½œè¿‡å¤šé˜è¿°ï¼Œç®€è¦ä»‹ç»ä¸‹ MY_DEMO å’Œ G_DEFINE_TYPEã€‚ MY_DEMO(object)å®çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªåŸºç±»æŒ‡é’ˆç±»å‹è½¬æ¢ä¸º MyDemo ç±»çš„æŒ‡é’ˆç±»å‹ï¼Œå®ƒéœ€è¦ GObject å­ç±»çš„è®¾è®¡è€…æä¾›ã€‚ my_demo_get_typeå°†ä¼šä½¿ç”¨å®G_DEFINE_TYPEå»å®ç°ï¼Œå…¶ä¸­çš„myé€šå¸¸è¡¨ç¤ºå‘½åç©ºé—´ï¼Œdemoè¡¨ç¤ºå¯¹è±¡åå­—ï¼Œget_typeä¸ºå›ºå®šå­—æ®µ(è¿™é‡Œæåˆ°çš„myå’Œdemoå­—æ®µéƒ½æ˜¯æˆ‘çš„ç¤ºä¾‹ä»£ç ä½¿ç”¨çš„ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰)ã€‚G_DEFINE_TYPE å¯ä»¥è®© GObject åº“çš„æ•°æ®ç±»å‹ç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«æˆ‘ä»¬æ‰€å®šä¹‰çš„ MyDemo ç±»ç±»å‹ï¼Œå®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»åï¼Œå³ MyDemoï¼Œç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯ç±»çš„æˆå‘˜å‡½æ•°åç§°çš„å‰ç¼€ï¼Œä¾‹å¦‚ my_demo_get_type å‡½æ•°å³ä¸º MyDemo ç±»çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œâ€my_demoâ€æ˜¯å®ƒçš„å‰ç¼€ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æŒ‡æ˜ MyDemo ç±»ç±»å‹çš„çˆ¶ç±»å‹ä¸ºG_TYPE_OBJECTã€‚G_DEFINE_TYPEä¸­ä¼šè°ƒç”¨ä¸€ä¸ª g_type_register_static_simple çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç±»å‹æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ï¼ŒG_DEFINE_TYPEè¿˜å®šä¹‰äº†2ä¸ªå‡½æ•°ï¼ˆmy_demo_init å’Œ my_demo_class_initï¼‰ï¼Œéœ€è¦è‡ªå·±å®ç°è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°æ˜¯å¯¹è±¡çš„åˆå§‹åŒ–å‡½æ•°ï¼Œç›¸å½“äºc++çš„æ„é€ å‡½æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‡½æ•°åœ¨æ¯ä¸ªå¯¹è±¡åˆ›å»ºçš„æ—¶å€™éƒ½ä¼šè¢«è°ƒç”¨ï¼Œç¬¬äºŒä¸ªå‡½æ•°åªæœ‰åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºå¯¹è±¡çš„æ—¶å€™è¢«è°ƒç”¨(æ¯”å¦‚åœ¨è°ƒç”¨g_type_class_refçš„æ—¶å€™ï¼Œå¦‚æœclassæ²¡æœ‰åˆå§‹åŒ–ï¼Œå°±ä¼šè°ƒç”¨my_demo_class_init)ã€‚å½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œæ˜¯ä½¿ç”¨çš„å®ç°ä»£ç ï¼Œè§ç¤ºä¾‹ä»£ç ä¸­è¢«æ³¨é‡Šçš„é‚£ä¸€å¤§æ®µä»£ç ã€‚åœ¨gobjectçš„æ‰‹å†Œä¸­ä¹Ÿæœ‰ç›¸å…³ä»£ç çš„ç¤ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ˆG-DEFINE-TYPEï¼‰ï¼š 123456789101112131415161718192021222324252627282930313233static void gtk_gadget_init (GtkGadget *self);static void gtk_gadget_class_init (GtkGadgetClass *klass);static gpointer gtk_gadget_parent_class = NULL;static void gtk_gadget_class_intern_init (gpointer klass)&#123; gtk_gadget_parent_class = g_type_class_peek_parent (klass); gtk_gadget_class_init ((GtkGadgetClass*) klass);&#125;GTypegtk_gadget_get_type (void)&#123; static volatile gsize g_define_type_id__volatile = 0; if (g_once_init_enter (&amp;g_define_type_id__volatile)) &#123; GType g_define_type_id = g_type_register_static_simple (GTK_TYPE_WIDGET, g_intern_static_string (&quot;GtkGadget&quot;), sizeof (GtkGadgetClass), (GClassInitFunc) gtk_gadget_class_intern_init, sizeof (GtkGadget), (GInstanceInitFunc) gtk_gadget_init, 0); &#123; const GInterfaceInfo g_implement_interface_info = &#123; (GInterfaceInitFunc) gtk_gadget_gizmo_init &#125;; g_type_add_interface_static (g_define_type_id, TYPE_GIZMO, &amp;g_implement_interface_info); &#125; g_once_init_leave (&amp;g_define_type_id__volatile, g_define_type_id); &#125; return g_define_type_id__volatile;&#125; å¯¹è±¡å®ä¾‹åŒ– 1234gpointerg_object_new (GType object_type, const gchar *first_property_name, ...); g_object_newè¿›è¡Œå¯¹è±¡çš„å®ä¾‹åŒ–ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯ä¸ªå¯å˜å‚æ•°çš„å‡½æ•°, ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªå®ï¼Œæ˜¯éœ€è¦åˆ›å»ºçš„å¯¹è±¡çš„ç±»å‹ï¼Œå½“ä½¿ç”¨ g_object_new æ¥åˆ›å»ºå¯¹è±¡çš„æ—¶å€™, è¿™ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„ï¼Œè€Œä¸”è¿™ä¸ªå‡½æ•°æ‰€åˆ›å»ºçš„å¯¹è±¡å¿…é¡»æ˜¯GObjectçš„å­å¯¹è±¡ï¼Œåœ¨æˆ‘ä»¬å®šä¹‰è‡ªå·±çš„å¯¹è±¡æ—¶, å¿…é¡»è¦åœ¨glibç³»ç»Ÿä¸­æ³¨å†Œè‡ªå·±çš„ç±»å‹ã€‚åé¢çš„å‚æ•°éƒ½æ˜¯ â€œå±æ€§å-å±æ€§å€¼â€ çš„é…å¯¹ï¼Œå³ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹, è¡¨ç¤ºçš„æ˜¯ object çš„å±æ€§, å®ƒä»¬éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå¦‚æœæ²¡æœ‰å±æ€§éœ€è¦åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™è®¾ç½®, åˆ™ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®æˆ NULLï¼ˆg_object_new(MY_TYPE_DEMO, NULL)ï¼‰ï¼Œå¦‚æœæœ‰å±æ€§è¦è®¾ç½®, é‚£ä¹ˆæœ€åä¸€ä¸ªå‚æ•°ä¹Ÿè¦è®¾ç½®æˆ NULLï¼ˆg_object_new(MY_TYPE_DEMO, &quot;name&quot;, &quot;kobe&quot;, &quot;age&quot;, 24, NULL)ï¼‰ã€‚ å±æ€§å¦‚æœæƒ³ è®©g_object_new å‡½æ•°ä¸­é€šè¿‡ â€œå±æ€§å-å±æ€§å€¼â€ ç»“æ„ä¸º Gobject å­ç±»å¯¹è±¡çš„å±æ€§è¿›è¡Œåˆå§‹åŒ–ï¼Œéœ€è¦å®Œæˆä»¥ä¸‹å·¥ä½œï¼š å®ç°xx_xx_set_propertyä¸xx_xx_get_propertyå‡½æ•°ï¼Œå¦‚ç¤ºä¾‹ä»£ç ä¸­çš„my_demo_set_propertyå’Œmy_demo_get_propertyï¼Œå®Œæˆ g_object_new å‡½æ•° â€œå±æ€§å-å±æ€§å€¼â€ ç»“æ„å‘Gobjectå­ç±»å±æ€§çš„æ˜ å°„ï¼› åœ¨Gobjectå­ç±»çš„ç±»ç»“æ„ä½“åˆå§‹åŒ–å‡½æ•°ä¸­ï¼Œè®©GobjectåŸºç±»çš„ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆset_propertyä¸get_propertyåˆ†åˆ«æŒ‡å‘xx_xx_set_propertyä¸xx_xx_get_property,å¦‚ç¤ºä¾‹ä»£ç ä¸­çš„object_class-&gt;set_property = my_demo_set_propertyå’Œobject_class-&gt;get_property = my_demo_get_property; åœ¨Gobjectå­ç±»çš„ç±»ç»“æ„ä½“åˆå§‹åŒ–å‡½æ•°ä¸­ï¼Œä¸ºGobjectå­ç±»å®‰è£…å…·ä½“å¯¹è±¡çš„ç§æœ‰å±æ€§ï¼Œg_object_class_install_property å‡½æ•°ç”¨äºå°† GParamSpec ç±»å‹å˜é‡æ‰€åŒ…å«çš„æ•°æ®æ’å…¥åˆ° GObject å­ç±»ä¸­ï¼Œè¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º GObject å­ç±»çš„ç±»ç»“æ„ä½“ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ GParamSpec å¯¹åº”çš„å±æ€§ IDï¼ŒGObject å­ç±»çš„å±æ€§ ID æ˜¯ GObject å­ç±»è®¾è®¡è€…å®šä¹‰çš„å®æˆ–æšä¸¾ç±»å‹ï¼Œä¸èƒ½ä¸º0ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æšä¸¾ç±»å‹æ¥å®šä¹‰ ID æ—¶ï¼Œä¸ºäº†é¿å… 0 çš„ä½¿ç”¨ï¼Œä¸€èˆ¬è®¾è®¡å¦‚ä¸‹æ‰€ç¤ºçš„ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå…¶ä¸­PROP_0ä¸º0,ä¸ä½¿ç”¨ã€‚ 1234567enum&#123; PROP_0, PROP_NAME, PROP_AGE, N_PROPERTIES&#125;; g_object_class_install_propertyçš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¦å®‰è£…å€¼å‘ GObject å­ç±»ä¸­çš„ GParamSpec ç±»å‹çš„å˜é‡æŒ‡é’ˆï¼Œç¤ºä¾‹ä»£ç ä¸­çš„å¦‚ä¸‹ï¼š 123456789101112131415g_object_class_install_property(object_class, PROP_NAME, g_param_spec_string(&quot;name&quot;, &quot;name&quot;, &quot;Specify the name of demo&quot;, &quot;Unknown&quot;, G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY));g_object_class_install_property(object_class, PROP_AGE, g_param_spec_int64 (&quot;age&quot;, &quot;age&quot;, &quot;Specify age number&quot;, G_MININT64, G_MAXINT64, 0, G_PARAM_WRITABLE | G_PARAM_CONSTRUCT_ONLY)); å…¶ä¸­è·å–å’Œè®¾ç½®å±æ€§çš„å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344static void my_demo_set_property(GObject *object, guint prop_id, const GValue *value, GParamSpec *pspec)&#123; MyDemo *self; g_return_if_fail(object != NULL); self = MY_DEMO (object); //self-&gt;priv = MY_DEMO_GET_PRIVATE(self); switch (prop_id) &#123; case PROP_NAME: self-&gt;priv-&gt;name = g_value_dup_string(value); break; case PROP_AGE: self-&gt;priv-&gt;age = g_value_get_int64(value); break; default: G_OBJECT_WARN_INVALID_PROPERTY_ID(object, prop_id, pspec); break; &#125;&#125;static void my_demo_get_property(GObject *object, guint prop_id, GValue *value, GParamSpec *pspec)&#123; MyDemo *self; g_return_if_fail(object != NULL); self = MY_DEMO(object); switch (prop_id) &#123; case PROP_NAME: g_value_set_string(value, self-&gt;priv-&gt;name); break; case PROP_AGE: g_value_set_int64(value, self-&gt;priv-&gt;age); break; default: G_OBJECT_WARN_INVALID_PROPERTY_ID(object, prop_id, pspec); break; &#125;&#125; å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡g_object_get_property å’Œ g_object_set_property è·å–å’Œè®¾ç½®å±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345GValue val = &#123;0&#125;; g_value_init(val, G_TYPE_POINTER);g_object_get_property(G_OBJECT(demo), &quot;name&quot;, val);g_object_set_property(G_OBJECT(demo), &quot;name&quot;, val);g_value_unset(val); ä¿¡å· ä½¿ç”¨ GObject ä¿¡å·æœºåˆ¶ï¼Œä¸€èˆ¬æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š ä¿¡å·æ³¨å†Œ g_signal_newï¼Œä¸»è¦è§£å†³ä¿¡å·ä¸æ•°æ®ç±»å‹çš„å…³è”é—®é¢˜ 1234567891011int signal_id = g_signal_new(&quot;broadcast_msg&quot;, my_demo_get_type(),/*G_OBJECT_CLASS_TYPE(kclass)*/ G_SIGNAL_RUN_LAST, 0, NULL, NULL, g_cclosure_marshal_VOID__STRING, G_TYPE_NONE,/*è¿”å›å€¼ï¼Œå› ä¸ºä¿¡å·æ²¡æœ‰è¿”å›ï¼Œæ‰€ä»¥ä¸ºNONE*/ 1,/*å‚æ•°æ•°ç›®*/ G_TYPE_STRING/*å‚æ•°ç±»å‹*/ ); ä¿¡å·è¿æ¥ 1234567void handler_receive_msg(GObject *sender, char *name, gpointer data)&#123; MyDemo *demo = G_TYPE_CHECK_INSTANCE_CAST(sender, my_demo_get_type(), MyDemo); printf(&quot;handler: [%s] from [%s: %ld]\\n&quot;, name, demo-&gt;priv-&gt;name, demo-&gt;priv-&gt;age);&#125;g_signal_connect(demos[i], &quot;broadcast_msg&quot;, G_CALLBACK(handler_receive_msg), NULL); ä¿¡å·å‘å°„ 1g_signal_emit_by_name(demos[i], &quot;broadcast_msg&quot;, &quot;lixiang&quot;);","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Glib GObject","slug":"Glib-GObject","permalink":"https://eightplus.github.io/tags/Glib-GObject/"}]},{"title":"Dbus-glib","slug":"2019-08-27-dbus-glib","date":"2019-08-27T00:19:31.000Z","updated":"2019-08-27T16:06:34.716Z","comments":true,"path":"2019/08/27/2019-08-27-dbus-glib/","link":"","permalink":"https://eightplus.github.io/2019/08/27/2019-08-27-dbus-glib/","excerpt":"","text":"å¦‚æœä½ æƒ³åœ¨Linuxç³»ç»Ÿä¸‹å¼€å‘è½¯ä»¶ï¼Œä¸”éœ€è¦ç”¨åˆ°è¿›ç¨‹é—´é€šä¿¡æ—¶ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ äº†è§£å’Œä½¿ç”¨Dbusã€‚Dbusæ˜¯å®è´¨ä¸Šä¸€ä¸ªé€‚ç”¨äºæ¡Œé¢åº”ç”¨çš„è¿›ç¨‹é—´çš„é€šè®¯æœºåˆ¶ï¼Œå³æ‰€è°“çš„IPCæœºåˆ¶ã€‚Dbusæ˜¯ä¸€ä¸ªè¿›ç¨‹é—´çš„é€šä¿¡æœºåˆ¶ï¼Œå¯ä»¥æ˜¯åº”ç”¨ä¸åº”ç”¨ä¹‹é—´çš„é€šä¿¡ï¼Œä¹Ÿå¯ä»¥æ˜¯åº”ç”¨ä¸ç³»ç»Ÿä¹‹é—´çš„é€šä¿¡ï¼Œå…¶æä¾›äº†ä¸€ä¸ªä½æ—¶å»¶ã€ä½æ¶ˆè€—çš„IPCé€šè®¯ï¼Œå› ä¸ºå®ƒé‡‡ç”¨äº†äºŒè¿›åˆ¶çš„æ•°æ®äº¤æ¢åè®®ï¼Œä¸éœ€è¦è½¬æ¢æˆæ–‡æœ¬åŒ–çš„æ•°æ®è¿›è¡Œäº¤æ¢ï¼ŒDBUSæä¾›äº†é¢å‘å¤šé‡å¯¹è±¡ç³»ç»Ÿçš„åŒ…è£…ï¼Œå¯ä»¥åœ¨åŸæœ‰çš„é¢å‘å¯¹è±¡çš„åº”ç”¨æ¡†æ¶ä¸‹ä½¿ç”¨DBUSï¼Œä¸éœ€è¦å­¦ä¹ æ–°çš„æ¦‚å¿µå’Œè§„èŒƒç­‰ã€‚DBUS_BUS_SYSTEMï¼ˆsystem Dbusï¼‰ç”¨äºç³»ç»Ÿé€šè®¯ã€ç›‘æ§ç³»ç»Ÿæ›´æ–°äº‹ä»¶ï¼ŒDBUS_BUS_SESSION ï¼ˆsession Dbusï¼‰ç”¨äºå¤šä¸ªæ¡Œé¢åº”ç”¨ä¹‹é—´ç›¸äº’é€šè®¯ã€‚ Dbus-glibæ˜¯GNUæ ‡å‡†åº“ï¼Œåœ¨Dbusæ¥å£ä¸Šå°è£…ï¼Œæ–¹ä¾¿ä¸Šå±‚æœåŠ¡ä¸åº”ç”¨æ›´å¥½çš„ä½¿ç”¨ã€‚å…¶å½¢å¦‚ä¸€ä¸ªDbusä»£ç†æœåŠ¡å™¨ï¼Œç”±å®ƒè¿›è¡Œæ‰€æœ‰Dbusæ¶ˆæ¯çš„éå†ä¸è½¬å‘ï¼ŒæœåŠ¡ç«¯ä¸æ¶ˆæ¯å‘é€ç«¯åªéœ€è¦å‘dbus deamonç”³è¯·æ³¨å†Œå”¯ä¸€çš„dbus name ã€ç»‘å®šGOBJECTåï¼Œdbus deamonå°±ä¼šå°†ç”³è¯·è¿åˆ°åˆ°è¯¥dbus nameçš„Dbusä¿¡æ¯è½¬å‘ç»™æŒ‡å®šåº”ç”¨ã€‚dbus daemonä¸å¯¹æ¶ˆæ¯é‡æ–°æ’åºï¼Œå¦‚æœå‘é€äº†ä¸¤æ¡æ¶ˆæ¯åˆ°åŒä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒä»¬å°†æŒ‰ç…§å‘é€é¡ºåºæ¥å—åˆ°ã€‚æ¥å—è¿›ç¨‹å¹¶éœ€è¦æŒ‰ç…§é¡ºåºå‘å‡ºåº”ç­”æ¶ˆæ¯ï¼Œä¾‹å¦‚åœ¨å¤šçº¿ç¨‹ä¸­å¤„ç†è¿™äº›æ¶ˆæ¯ï¼Œåº”ç­”æ¶ˆæ¯çš„å‘å‡ºæ˜¯æ²¡æœ‰é¡ºåºçš„ã€‚æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªåºåˆ—å·å¯ä»¥ä¸åº”ç­”æ¶ˆæ¯è¿›è¡Œé…å¯¹ã€‚ glibç»‘å®šæ¥å£åœ¨libdbus-glib-1-devä¸­å®šä¹‰ï¼Œè¯¦æƒ…è§ï¼š/usr/include/dbus-1.0/dbus/dbus-glib.hï¼Œdbusçš„æ¥å£æè¿°æ–‡ä»¶ç»Ÿä¸€é‡‡ç”¨utf-8ç¼–ç ã€‚ è¡¨ä¸€ dbuså’Œglibçš„æ•°æ®ç±»å‹æ˜ å°„è¡¨ D-Bus type Description GType C typedef Free function Notes a ï¼ˆARRAYï¼‰ æ•°ç»„ æ•°ç»„å…ƒç´ çš„ç±»å‹ç”±aåé¢çš„æ ‡è®°å†³å®šã€‚å¦‚ï¼šâ€asâ€æ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼Œå…·ä½“è§è¡¨äºŒè¡¨ä¸‰ b ï¼ˆBOOLEANï¼‰ å¸ƒå°”å€¼ G_TYPE_BOOLEAN d ï¼ˆDOUBLEï¼‰ IEEE 754åŒç²¾åº¦æµ®ç‚¹æ•° G_TYPE_DOUBLE g ï¼ˆSIGNATUREï¼‰ ç±»å‹ç­¾å i ï¼ˆINT32ï¼‰ 32ä½æœ‰ç¬¦å·æ•´æ•° G_TYPE_INT Will be changed to a G_TYPE_INT32 once GLib has it n ï¼ˆINT16ï¼‰ 16ä½æœ‰ç¬¦å·æ•´æ•° G_TYPE_INT Will be changed to a G_TYPE_INT16 once GLib has it o ï¼ˆOBJECT_PATH ï¼‰ å¯¹è±¡è·¯å¾„ DBUS_TYPE_G_PROXY g_object_unref The returned proxy does not have an interface set; use dbus_g_proxy_set_interface to invoke methods q ï¼ˆUINT16ï¼‰ 16ä½æ— ç¬¦å·æ•´æ•° G_TYPE_UINT Will be changed to a G_TYPE_UINT16 once GLib has it s ï¼ˆSTRINGï¼‰ é›¶ç»“å°¾çš„UTF-8å­—ç¬¦ä¸² G_TYPE_STRING char * g_free t ï¼ˆUINT64ï¼‰ 64ä½æ— ç¬¦å·æ•´æ•° G_TYPE_GUINT64 u ï¼ˆUINT32ï¼‰ 32ä½æ— ç¬¦å·æ•´æ•° G_TYPE_UINT Will be changed to a G_TYPE_UINT32 once GLib has it v ï¼ˆVARIANTï¼‰ å®¹å™¨ G_TYPE_VALUE GValue * g_value_unset å¯æ”¾ä»»æ„æ•°æ®ç±»å‹çš„å®¹å™¨ï¼Œæ•°æ®ä¸­åŒ…å«ç±»å‹ä¿¡æ¯ã€‚å¦‚glibä¸­çš„GValue x ï¼ˆINT64ï¼‰ 64ä½æœ‰ç¬¦å·æ•´æ•° G_TYPE_GINT64 y ï¼ˆBYTEï¼‰ 8ä½æ— ç¬¦å·æ•´æ•° G_TYPE_UCHAR t ï¼ˆUINT64ï¼‰ 64ä½æ— ç¬¦å·æ•´æ•° () å®šä¹‰ç»“æ„æ—¶ä½¿ç”¨ã€‚ä¾‹å¦‚â€(i(ii))â€ {} å®šä¹‰é”®ï¼å€¼å¯¹æ—¶ä½¿ç”¨ã€‚ä¾‹å¦‚â€a{us}â€ æ•°ç»„â€a(i(ii))â€çš„å…ƒç´ æ˜¯ä¸€ä¸ªç»“æ„ã€‚ç”¨æ‹¬å·å°†æˆå‘˜çš„ç±»å‹æ‹¬èµ·æ¥å°±è¡¨ç¤ºç»“æ„äº†ï¼Œç»“æ„å¯ä»¥åµŒå¥—ã€‚ æ•°ç»„â€a{sv}â€çš„å…ƒç´ æ˜¯ä¸€ä¸ªé”®ï¼å€¼å¯¹ã€‚â€{sv}â€è¡¨ç¤ºé”®ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼ç±»å‹æ˜¯VARIANTã€‚ dbusæ•°æ®ä¹Ÿæœ‰åŒ…å®¹å™¨ç±»å‹ï¼ŒåƒDBUS_TYPE_ARRAY å’Œ DBUS_TYPE_STRUCTï¼Œdbusçš„æ•°æ®ç±»å‹å¯ä»¥æ˜¯åµŒå¥—çš„ï¼Œå¦‚æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œå†…å®¹æ˜¯å­—ç¬¦ä¸²çš„æ•°ç»„é›†åˆã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»å‹éƒ½æœ‰æ™®é€šçš„ä½¿ç”¨ï¼ŒDBUS_TYPE_STRUCTåº”è¯¥å¯ä»¥åŒ…å®¹éåŸºæœ¬ç±»å‹çš„æ•°æ®ç±»å‹ã€‚glibç»‘å®šå°è¯•ä½¿ç”¨æ¯”è¾ƒæ˜æ˜¾çš„æ–¹å¼è¿›è¡Œå£°æ˜ã€‚ è¡¨äºŒ æ•°ç»„è¡¨ D-Bus type signature Description GType C typedef Free function ay Array of bytes DBUS_TYPE_G_BYTE_ARRAY GArray * g_array_free au Array of uint DBUS_TYPE_G_UINT_ARRAY GArray * g_array_free ai Array of int DBUS_TYPE_G_INT_ARRAY GArray * g_array_free ax Array of int64 DBUS_TYPE_G_INT64_ARRAY GArray * g_array_free at Array of uint64 DBUS_TYPE_G_UINT64_ARRAY GArray * g_array_free ad Array of double DBUS_TYPE_G_DOUBLE_ARRAY GArray * g_array_free ab Array of boolean DBUS_TYPE_G_BOOLEAN_ARRAY GArray * g_array_free as Array of strings G_TYPE_STRV char ** g_strfreev è¡¨ä¸‰ å­—å…¸(dict or hash)è¡¨ D-Bus type signature Description GType C typedef Free function a{ss} Dictionary mapping strings to strings DBUS_TYPE_G_STRING_STRING_HASHTABLE GHashTable * g_hash_table_destroy ç¤ºä¾‹æºç  myglibdbus ç¼–å†™session dbusæœåŠ¡ç«¯ xmlçš„ç¼–å†™åŠç»‘å®šæ–‡ä»¶çš„ç”Ÿæˆ åœ¨GLibä¸­ï¼Œé€šè¿‡dbusè¡¨ç°å‡ºGObjectï¼Œå¿…é¡»å†™XMLæ–‡ä»¶æè¿°è¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•ç­‰å±æ€§ã€‚é€šè¿‡XMLæ–‡ä»¶å’Œdbus-binding-toolå·¥å…·ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è‡ªåŠ¨åˆ›å»ºå‡ºæ˜“äºä½¿ç”¨çš„dbusä»£ç†å¯¹è±¡ã€‚ä¾‹å¦‚ä¸‹é¢çš„org.freedesktop.myglibdbus.xmlæ–‡ä»¶æè¿°äº†ä¸‰ä¸ªå‡½æ•°å’Œä¸€ä¸ªä¿¡å·ï¼Œå…¶ä¸­å‡½æ•°workæœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°msgï¼ˆcharï¼‰å’Œä¸€ä¸ªè¾“å‡ºå‚æ•°retï¼ˆgintï¼‰ï¼Œå‡½æ•°receiveæœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°msgï¼ˆcharï¼‰å’Œä¸€ä¸ªè¾“å‡ºå‚æ•°retï¼ˆchar*ï¼‰ï¼Œå‡½æ•°exitæœ‰ä¸€ä¸ªè¾“å‡ºå‚æ•°retï¼ˆgintï¼‰ï¼Œä¿¡å·info_alertä¼ é€’ä¸€ä¸ªå‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²çš„å˜é‡ã€‚ä¸€ä¸ªnodeå¯ä»¥æœ‰å¤šä¸ªinterface ,ä¸€ä¸ªinterfaceå¯ä»¥æœ‰å¤šä¸ªmethodï¼ˆå‡½æ•°ï¼‰æˆ–signalï¼ˆä¿¡å·ï¼‰ã€‚ org.freedesktop.myglibdbus.xmlçš„å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819202122&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;node name=&quot;/org/freedesktop/myglibdbus&quot;&gt; &lt;interface name=&quot;org.freedesktop.myglibdbus&quot;&gt; &lt;method name=&quot;work&quot;&gt; &lt;annotation name=&quot;org.freedesktop.DBus.GLib.Async&quot; value=&quot;&quot; /&gt; &lt;arg type=&quot;s&quot; name=&quot;msg&quot; direction=&quot;in&quot;/&gt; &lt;arg type=&quot;i&quot; name=&quot;ret&quot; direction=&quot;out&quot; /&gt; &lt;/method&gt; &lt;method name=&quot;receive&quot;&gt; &lt;annotation name=&quot;org.freedesktop.DBus.GLib.Async&quot; value=&quot;&quot; /&gt; &lt;arg type=&quot;s&quot; name=&quot;msg&quot; direction=&quot;in&quot;/&gt; &lt;arg type=&quot;s&quot; name=&quot;ret&quot; direction=&quot;out&quot; /&gt; &lt;/method&gt; &lt;method name=&quot;exit&quot;&gt; &lt;annotation name=&quot;org.freedesktop.DBus.GLib.Async&quot; value=&quot;&quot; /&gt; &lt;arg type=&quot;i&quot; name=&quot;ret&quot; direction=&quot;out&quot; /&gt; &lt;/method&gt; &lt;signal name=&quot;info_alert&quot;&gt; &lt;arg type=&quot;s&quot; name=&quot;value&quot; direction=&quot;out&quot; /&gt; &lt;/signal&gt; &lt;/interface&gt;&lt;/node&gt; åœ¨ä¸Šé¢çš„XMLä¸­å¯ä»¥çœ‹åˆ°ä¸€è¡Œ&lt;annotation name=&quot;org.freedesktop.DBus.GLib.Async&quot; value=&quot;&quot; /&gt;ï¼Œå…¶å®ï¼ŒAnnotationsçš„æ–¹å¼æœ‰å››ç§ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š1234org.freedesktop.DBus.GLib.CSymbolorg.freedesktop.DBus.GLib.Asyncorg.freedesktop.DBus.GLib.Constorg.freedesktop.DBus.GLib.ReturnVal é€šè¿‡dbus-binding-toolç”Ÿæˆç»‘å®šæ–‡ä»¶ åœ¨è¿›è¡Œä»£ç ç¼–å†™ä¹‹å‰ï¼Œå…ˆç¡®ä¿ç³»ç»Ÿå®‰è£…äº†dbusç›¸å…³çš„å¼€å‘åŒ…ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š $ sudo apt install libglib2.0-dev libdbus-glib-1-dev libdbus-1-dev è¿è¡Œdbus-binding-toolå·¥å…·ï¼ˆè¯¥å·¥å…·æ¥è‡ªåŒ…libdbus-glib-1-devï¼‰,å¦‚ä¸‹æ‰€ç¤ºï¼š 123$ dbus-binding-tool --mode=glib-server --prefix=myglibdbus org.freedesktop.myglibdbus.xml --output=myglibdbus-glue.hæˆ–è€…$ dbus-binding-tool --mode=glib-server --prefix=myglibdbus org.freedesktop.myglibdbus.xml &gt; myglibdbus-glue.h æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œåˆ™ç”Ÿæˆäº†ç»‘å®šæ–‡ä»¶myglibdbus-glue.hï¼Œè¯¥æ–‡ä»¶æ— éœ€ä¿®æ”¹ï¼Œç›´æ¥åœ¨æœ¬åœ°ä»£ç ä¸­includeä½¿ç”¨å³å¯ã€‚â€â€“prefixâ€å‚æ•°å®šä¹‰äº†å¯¹è±¡å‰ç¼€ã€‚è®¾å¯¹è±¡å‰ç¼€æ˜¯$(prefix)ï¼Œåˆ™ç”Ÿæˆçš„DBusGObjectInfoç»“æ„å˜é‡åå°±æ˜¯dbus_glib_$(prefix) _object_infoï¼Œå¦‚ï¼šdbus_glib_myglibdbus_object_infoã€‚ ç»‘å®šæ–‡ä»¶ä¼šä¸ºæ¥å£æ–¹æ³•å®šä¹‰å›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°çš„åç§°æ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆå°†xmlä¸­çš„æ–¹æ³•åç§°è½¬æ¢åˆ°å…¨éƒ¨å°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”çš„æ ¼å¼ï¼Œç„¶åå¢åŠ å‰ç¼€$(prefix)_ã€‚ä¾‹å¦‚xmlä¸­çš„å‡½æ•°workï¼Œç»‘å®šæ–‡ä»¶å°±ä¼šå¼•ç”¨ä¸€ä¸ªåç§°ä¸º$(prefix)_workçš„å‡½æ•°ï¼Œå³ï¼šmyglibdbus_workã€‚ åˆ›å»ºå¯¹è±¡ dbus-glibå®šä¹‰å‘dbus daemonç”³è¯·ä¸€ä¸ªæ³¨å†Œä¿¡æ¯çš„å½¢å¼ä¸ºGObjectï¼ˆCè¯­è¨€ï¼‰çš„å¯¹è±¡ã€‚dbus-glibç”¨GObjectå®ç°dbuså¯¹è±¡ï¼Œæ•…éœ€è¦å®ç°ä¸€ä¸ªå¯¹è±¡,ç»§æ‰¿äºGObjectã€‚ æ–°å»ºæ–‡ä»¶myglidbus.hå’Œmyglibdbus.cï¼Œåœ¨å¤´æ–‡ä»¶myglidbus.hä¸­å®šä¹‰å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567typedef struct _MyGlibDbus &#123; GObject parent;&#125; MyGlibDbus;typedef struct _MyGlibDbusClass &#123; GObjectClass parent_class;&#125; MyGlibDbusClass; åœ¨GObjectä¸­ï¼Œç±»æ˜¯ä¸¤ä¸ªç»“æ„ä½“çš„ç»„åˆï¼Œä¸€ä¸ªæ˜¯å®ä¾‹ç»“æ„ä½“ï¼Œå¦ä¸€ä¸ªæ˜¯ç±»ç»“æ„ä½“ï¼ŒMyGlibDbusæ˜¯å®ä¾‹ç»“æ„ä½“ï¼ŒMyGlibDbusClassæ˜¯ç±»ç»“æ„ä½“ã€‚ å®ç°ç±»ç±»å‹çš„å®šä¹‰ åœ¨myglibdbus.cæ–‡ä»¶ä¸­åŠ å…¥ G_DEFINE_TYPE(MyGlibDbus, myglibdbus, G_TYPE_OBJECT); G_DEFINE_TYPEå¯ä»¥è®©GObjectåº“çš„æ•°æ®ç±»å‹ç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«æˆ‘ä»¬æ‰€å®šä¹‰çš„MyGlibDbusç±»ç±»å‹ï¼Œå®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»åï¼Œå³MyGlibDbusï¼›ç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯ç±»çš„æˆå‘˜å‡½æ•°ï¼ˆé¢å‘å¯¹è±¡æœ¯è¯­ç§°ä¹‹ä¸ºâ€œæ–¹æ³•â€æˆ–â€œè¡Œä¸ºâ€ï¼‰åç§°çš„å‰ç¼€ï¼Œä¾‹å¦‚myglibdbus_get_typeå‡½æ•°å³ä¸ºMyGlibDbusç±»çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œâ€œmyglibdbusâ€ åœ¨myglibdbus.cæ–‡ä»¶ä¸­ï¼Œéœ€è¦includeä¸Šé¢ç”Ÿæˆçš„ç»‘å®šæ–‡ä»¶ï¼Œå³ä»£ç ä¸­åŠ å…¥ï¼š#include &quot;myglibdbus-glue.h&quot;ï¼Œè°ƒç”¨dbus_g_object_class_install_infoè¿›è¡Œç±»çš„åˆå§‹åŒ–ï¼Œä¼ é€’å¯¹è±¡å’Œå¯¹è±¡ä¿¡æ¯è¿›å»ï¼Œå¦‚ï¼šdbus_g_object_type_install_info(MYGLIBDBUS_TYPE_OBJECET, &amp;dbus_glib_myglibdbus_object_info); ä¸ºäº†æ‰§è¡ŒXMLä¸­çš„methodï¼Œè¿™é‡Œéœ€è¦å¯¹æ¯ä¸ªmethodå®šä¹‰ä¸€ä¸ªCå‡½æ•°ï¼Œè¿™é‡Œæ‹¿workå‡½æ•°è¿›è¡Œè¯´æ˜ï¼Œå®šä¹‰çš„Cå‡½æ•°ä¸ºï¼šgint myglibdbus_work(MyGlibDbus *dbus, gchar *msg, DBusGMethodInvocation *ret_value, GError **error) å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å¯¹è±¡å®ä¾‹çš„æŒ‡é’ˆï¼Œè·Ÿåœ¨å®ä¾‹æŒ‡é’ˆåé¢çš„å‚æ•° msg æ˜¯æ–¹æ³•çš„è¾“å…¥å‚æ•°ï¼Œret_valueä¸ºè¾“å‡ºå‚æ•°ï¼Œæœ€åä¸€ä¸ªå‚æ•°å¿…é¡»ä¸ºGError **ï¼Œå¦‚æœå‡½æ•°è¿”å›å¤±è´¥ï¼Œå¿…é¡»ä½¿ç”¨g_set_errorå¡«å……è¯¥é”™è¯¯å‚æ•°ã€‚ æœ€åå¯ä»¥ä½¿ç”¨dbus_g_connection_register_g_objectè¾“å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚ï¼šdbus_g_connection_register_g_object(connection, MYGLIBDBUS_PATH, G_OBJECT(dbus)); å£°æ˜ç±»çš„å‡½æ•° 123456789101112131415GType myglibdbus_get_type(void);//å‘GObjectåº“æ‰€æä¾›çš„ç±»å‹ç®¡ç†ç³»ç»Ÿæä¾›è¦æ³¨å†Œçš„MyGlibDbusç±»ç±»å‹çš„ç›¸å…³ä¿¡æ¯,å¯ä»¥ä¸å®ç°ï¼Œä½†å¿…é¡»è¦å£°æ˜#define MYGLIBDBUS_TYPE_OBJECET (myglibdbus_get_type())//å£°æ˜ç±»çš„å‡½æ•°ï¼ˆç±»æˆå‘˜çš„æ„é€ å‡½æ•°ï¼‰void myglibdbus_init(MyGlibDbus *dbus)&#123;&#125;//å£°æ˜ç±»çš„å‡½æ•°ï¼ˆç±»ç»“æ„çš„æ„é€ å‡½æ•°ï¼Œä¸ç±»æˆå‘˜æ„é€ å‡½æ•°åŒºåˆ«åœ¨äºï¼Œè¯¥æ„é€ å‡½æ•°åªåœ¨è¯¥ç±»å®šä¹‰æ—¶è¿è¡Œä¸€æ¬¡ï¼Œå¸¸ç”¨æ¥è¿›è¡Œæ¶ˆæ¯ä¿¡å·çš„åˆå§‹åŒ–ç­‰ã€‚è€Œmyglibdbus_initåˆ™åœ¨åˆ›å»ºæˆå‘˜æ—¶éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ï¼ˆå¦‚obj = g_object_newï¼‰ï¼‰void myglibdbus_class_init(MyGlibDbusClass * kclass)&#123;&#125; å‘dbus deamonç”³è¯·æ³¨å†Œ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849DBusGConnection * connection = NULL;DBusConnection *connect;DBusGProxy * dbus_proxy = NULL;GError * error = NULL;guint request_name_result;gint ret;dbus_g_thread_init();dbus = (MyGlibDbus*)myglibdbus_new();loop = g_main_loop_new(NULL, FALSE);connection = dbus_g_bus_get(DBUS_BUS_SESSION, &amp;error);if(connection == NULL)&#123; g_error(&quot;%s&quot;, error-&gt;message); goto out;&#125;//ç”³è¯·ä¸€ä¸ªä¼šè¯æ€»çº¿ DBUS_SERVICE_DBUS: org.freedesktop.DBus DBUS_PATH_DBUS: /org/freedesktop/DBus DBUS_INTERFACE_DBUS:org.freedesktop.DBusdbus_proxy = dbus_g_proxy_new_for_name(connection, DBUS_SERVICE_DBUS, DBUS_PATH_DBUS, DBUS_INTERFACE_DBUS);//è°ƒç”¨dbusdaemonçš„å‡½æ•°â€œRequestNameâ€ï¼Œç”³è¯·ä¸€ä¸ªDBUSåä¸ºorg.freedesktop.myglibdbusçš„æ³¨å†Œä¿¡æ¯ret = dbus_g_proxy_call(dbus_proxy, &quot;RequestName&quot;, &amp;error, G_TYPE_STRING, MYGLIBDBUS_NAME, G_TYPE_UINT, DBUS_NAME_FLAG_DO_NOT_QUEUE, G_TYPE_INVALID, G_TYPE_UINT, &amp;request_name_result, G_TYPE_INVALID);if(!ret)&#123; g_error(&quot;RequestName failed:%s&quot;, error-&gt;message); g_error_free(error); exit(EXIT_FAILURE);&#125;g_object_unref(G_OBJECT(dbus_proxy));//already runningif(request_name_result != DBUS_REQUEST_NAME_REPLY_PRIMARY_OWNER) exit(EXIT_FAILURE);dbus_g_object_type_install_info(MYGLIBDBUS_TYPE_OBJECET, &amp;dbus_glib_myglibdbus_object_info);//å‘dbus-glibç™»è®°å¯¹è±¡ä¿¡æ¯//ç”³è¯·ä¹‹å‰å®šä¹‰çš„ä¸€ä¸ªå¯¹è±¡MyGlibDbusï¼Œå°†è¯¥å¯¹è±¡ä¸busç»‘å®šdbus_g_connection_register_g_object(connection, MYGLIBDBUS_PATH, G_OBJECT(dbus));g_main_loop_run(loop);//ç”³è¯·åˆ›å»ºä¸€ä¸ªä¸»å¾ªç¯out: g_main_loop_unref(loop); g_object_unref(dbus); é€šè¿‡Dbus-glibç¼–å†™å®¢æˆ·ç«¯ ä½¿ç”¨dbus_g_proxy_callè°ƒç”¨dbusæœåŠ¡çš„æ–¹æ³• 12345678910111213141516GError *err = NULL;int ret = 0;if (!dbus_g_proxy_call(remote_object, &quot;work&quot;, &amp;err, G_TYPE_STRING, &quot;Hello world!&quot;, G_TYPE_INVALID, G_TYPE_INT, &amp;ret, G_TYPE_INVALID)) &#123;&#125;else &#123; if (err != NULL) &#123; if(err-&gt;domain == DBUS_GERROR &amp;&amp; err-&gt;code == DBUS_GERROR_REMOTE_EXCEPTION) printf(&quot;dbus send exception %s:%s&quot;,dbus_g_error_get_name(err), err-&gt;message); else printf(&quot;dbus send Error : %s\\n&quot;, err-&gt;message); g_clear_error(&amp;err); &#125;&#125; ä½¿ç”¨dbus-binding-tool â€“mode=glib-clientæ–¹å¼è°ƒç”¨dbusæœåŠ¡çš„æ–¹æ³• $ dbus-binding-tool --mode=glib-client --prefix=myglibdbus org.freedesktop.myglibdbus.xml &gt; myglibdbus_proxy.h æ‰“å¼€myglibdbus_proxy.hçœ‹åˆ°æœåŠ¡ç«¯æä¾›çš„workæ–¹æ³•å·²ç»è½¬ä¸ºï¼š 123456static inline gbooleanorg_freedesktop_myglibdbus_work (DBusGProxy *proxy, const char * IN_msg, gint* OUT_ret, GError **error)&#123; return dbus_g_proxy_call (proxy, &quot;work&quot;, error, G_TYPE_STRING, IN_msg, G_TYPE_INVALID, G_TYPE_INT, OUT_ret, G_TYPE_INVALID);&#125; å®¢æˆ·ç«¯å¯ä»¥ç›´æ¥è°ƒç”¨org_freedesktop_myglibdbus_workï¼Œè€Œä¸å†éœ€è¦ä½¿ç”¨ä¸Šé¢çš„dbus_g_proxy_callæ¥è°ƒç”¨workå‡½æ•°ã€‚ ç¤ºä¾‹ä»£ç å·¥ç¨‹åˆ›å»ºå’Œç¼–è¯‘æ¼”ç¤º ç¼–å†™org.freedesktop.myglibdbus.xmlæ–‡ä»¶ æ–°å»ºæ–‡ä»¶myglidbus.hã€myglibdbus.cã€server.cå’Œclient.cï¼Œå¹¶å®Œæˆä»£ç ç¼–å†™ï¼Œå…¶ä¸­myglidbus.hã€myglibdbus.cã€server.cä¸‰ä¸ªæ–‡ä»¶æ˜¯æœåŠ¡ç«¯ä»£ç æ–‡ä»¶ï¼Œclient.cæ˜¯å®¢æˆ·ç«¯ä»£ç æ–‡ä»¶ã€‚ æ‰§è¡Œautoscanï¼Œç”Ÿæˆ configure.scan å’Œ autoscan.logï¼Œå°†configure.scan ä¿®æ”¹ä¸º configure.ac, å¹¶ä¿®æ”¹configure.acçš„å†…å®¹ã€‚ $ autoscan configure.acçš„åˆå§‹å†…å®¹å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223# -*- Autoconf -*-# Process this file with autoconf to produce a configure script.AC_PREREQ([2.69])AC_INIT([FULL-PACKAGE-NAME], [VERSION], [BUG-REPORT-ADDRESS])AC_CONFIG_SRCDIR([src/server.c])AC_CONFIG_HEADERS([config.h])# Checks for programs.AC_PROG_CC# Checks for libraries.# Checks for header files.AC_CHECK_HEADERS([stdlib.h string.h])# Checks for typedefs, structures, and compiler characteristics.# Checks for library functions.AC_CONFIG_FILES([Makefile src/Makefile])AC_OUTPUT æ‰§è¡Œaclocalï¼Œç”Ÿæˆaclocal.m4(å¤„ç†æœ¬åœ°å®æ–‡ä»¶)å’Œ autom4te.cache $ aclocal æ‰§è¡Œautoheaderï¼Œç”Ÿæˆç”Ÿæˆconfig.h.in $ autoheader æ‰§è¡Œautoconfï¼Œæ ¹æ® configure.ac å’Œ aclocal.m4 ç”Ÿæˆ configure $ autoconf ç¼–å†™ Makefile.am å’Œ src/Makefile.am å¢åŠ  NEWSã€READMEã€AUTHORSã€ChangeLog æ‰§è¡Œautomakeï¼Œç”Ÿæˆ Makefile.inï¼Œsrc/Makefile.in, compile, COPYING, depcompï¼Œ INSTALL, install-sh å’Œ missing (æ ¹æ® Makefile.am å’Œ aclocal.m4) $ automake --add-missing æ‰§è¡Œconfigureï¼Œç”Ÿæˆ Makefile, src/Makefileï¼Œ config.log å’Œ config.status $ ./configure æ‰§è¡Œmakeï¼Œç”ŸæˆäºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ï¼ˆsrcä¸‹serverå’Œclientï¼‰ $ make æœªæ¥å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ å¤šçº¿ç¨‹é˜²å†²çª ä¸Šé¢ç¤ºä¾‹ä»£ç åªæ˜¯å•çº¿ç¨‹å®ç°dbusè°ƒç”¨ã€‚å¦‚æœå¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œä»¥åŠåº“å‡½æ•°æƒ…å†µä¸‹ï¼Œä¸ºç¡®ä¿ä¸åŒçº¿ç¨‹ä½¿ç”¨ä¸åŒçš„DBusConnectionï¼Œåœ¨åˆ›å»ºdbusæ€»çº¿æ—¶è¦æ³¨æ„ä½¿ç”¨å…³é”®å­—åˆ›å»ºå„è‡ªç§æœ‰çš„æ€»çº¿ã€‚ å®¢æˆ·ç«¯å®ç° 123456789101112GMainContext*main_context = NULL;main_context =g_main_context_new();//ç”³è¯·ç‹¬ç«‹çš„context/* is dbus_g_bus_get_privateï¼Œ not dbus_g_bus_get dbus_g_bus_get_privateç”³è¯·çš„ç§æœ‰æ€»çº¿è¿æ¥åœ¨ä½¿ç”¨å®Œæˆåï¼Œè¦ä½¿ç”¨dbus_g_connection_closeå…ˆå…³é—­è¿æ¥åå†é‡Šæ”¾èµ„æºdbus_g_connection_unref, å¦åˆ™åªè°ƒç”¨dbus_g_connection_unrefä¼šæŠ¥â€œç§æœ‰è¿æ¥æ— æ³•å…³é—­â€ï¼Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚*/bus = dbus_g_bus_get_private(DBUS_BUS_SESSION,main_context, &amp;error);â€¦dbus_g_connection_close(bus);//ç§æœ‰çš„æ€»çº¿è¿æ¥è¦å…ˆcloseæ‰èƒ½unrefdbus_g_connection_unref(bus);g_main_context_unref(main_context);//g_main_context_unref()è¦ä¸g_main_context_new() é…åˆä½¿ç”¨ï¼Œå¦‚æœç”³è¯·çš„èµ„æºæœªé‡Šæ”¾ï¼Œä¼šå¯¼è‡´æ–‡ä»¶å¥æŸ„æ³„éœ² æ¶ˆæ¯æ¥æ”¶ç«¯å®ç°ï¼š 12345GMainContext*main_context = NULL;main_context= g_main_context_new();//ç”³è¯·ç‹¬ç«‹çš„contextmainloop= g_main_loop_new (main_context, FALSE);g_main_loop_unref(mainloop);g_main_context_unref(main_context); ä»¥è¿™ç§æ–¹å¼å®ç°çš„æ¶ˆæ¯æ¥æ”¶ç«¯ï¼Œåœ¨å¤šè¿›ç¨‹æ¥æ”¶ç›¸åŒæ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½å¤Ÿæ¥æ”¶åˆ°è¯¥æ¶ˆæ¯ï¼Œå¦‚æœè¦å¤šè¿›ç¨‹éƒ½èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œå®ç°å¦‚ä¸‹(ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„contextä¸æ€»çº¿ç»‘å®š)ï¼š 12main_context = g_main_context_default();mainloop = g_main_loop_new (main_context,FALSE); æˆ– 1mainloop = g_main_loop_new (NULL, FALSE); dbus_g_connection_closeçš„å®ç°å¦‚ä¸‹ï¼š 123456#define _DBUS_POINTER_UNSHIFT(p) ((void*) (((char*)p)- sizeof (void*)))#define DBUS_CONNECTION_FROM_G_CONNECTION(x) ((DBusConnection*)_DBUS_POINTER_UNSHIFT(x))void dbus_g_connection_close(DBusConnection * connection)&#123; returndbus_connection_close(DBUS_CONNECTION_FROM_G_CONNECTION(connection));&#125;","categories":[{"name":"Linux ç¼–ç¨‹","slug":"Linux-ç¼–ç¨‹","permalink":"https://eightplus.github.io/categories/Linux-ç¼–ç¨‹/"}],"tags":[{"name":"Dbus","slug":"Dbus","permalink":"https://eightplus.github.io/tags/Dbus/"}]},{"title":"ä½¿ç”¨mpvç¼–å†™è‡ªå·±çš„æ’­æ”¾å™¨","slug":"2019-08-19-qt-mpv-player","date":"2019-08-19T07:32:08.000Z","updated":"2019-08-19T07:49:44.292Z","comments":true,"path":"2019/08/19/2019-08-19-qt-mpv-player/","link":"","permalink":"https://eightplus.github.io/2019/08/19/2019-08-19-qt-mpv-player/","excerpt":"","text":"MPV æ˜¯ä¸€ä¸ªåŸºäº MPlayer å’Œ MPlayer2 çš„å¤šå¹³å°å¼€æºæ’­æ”¾å™¨ï¼Œå…¶åœ¨Linuxä¸Šæ‹¥æœ‰å¹¿æ³›çš„è¾“å‡ºè®¾å¤‡æ”¯æŒï¼Œå†…ç½®ffmpegè§£ç å™¨ï¼Œæ”¯æŒç»å¤§éƒ¨åˆ†çš„è§†é¢‘å’ŒéŸ³é¢‘æ ¼å¼ï¼Œæ”¯æŒæœ¬åœ°æ’­æ”¾å’Œç½‘ç»œæ’­æ”¾ï¼Œæ”¯æŒassç‰¹æ•ˆå­—å¹•ï¼ŒGPU è§£ç èƒ½åŠ›ååˆ†å‡ºè‰²ã€‚è™½ç„¶MPVåŠŸèƒ½å¼ºå¤§ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹ï¼ŒMPVæ— GUIå›¾å½¢ç•Œé¢ï¼Œç”¨æˆ·éœ€è¦é€šè¿‡å‘½ä»¤è¡Œæˆ–è€…æ‰‹åŠ¨ä¿®æ”¹å…¶é…ç½®æ–‡ä»¶è¾¾åˆ°é…ç½®MPVçš„ç›®çš„ï¼Œè¿™æ ·å°±ç»™æ™®é€šç”¨æˆ·å¸¦æ¥äº†è¯¸å¤šä¸ä¾¿ã€‚ä¸ºæ­¤ï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨Ubuntuç³»ç»Ÿä¸Šä½¿ç”¨Qtç¼–å†™å¸¦UIå›¾å½¢çš„MPVæ’­æ”¾å™¨ï¼Œä½¿ç”¨æˆ·å¯¹å¿«é€Ÿå®šåˆ¶å…·æœ‰å›¾å½¢ç•Œé¢çš„MPVæ’­æ”¾å™¨æœ‰ä¸€ä¸ªå¤§è‡´çš„äº†è§£ã€‚ ç¤ºä¾‹æºç  mympvplayer å¼€å‘å‰å‡†å¤‡å·¥ä½œ Ubuntuä¸ŠMPVçš„å®‰è£…ï¼š 12$ sudo apt-get update$ sudo install mpv ç¼–ç¨‹å¼€å‘ä¾èµ–åŒ…å®‰è£…ï¼š 1$ sudo install qtbase5-dev qt5-qmake qtscript5-dev qttools5-dev-tools è¦ç‚¹åˆ†æ ä¸ºäº†å®ç°ä¸€ä¸ªæ—¢å¯ä»¥åœ¨Qtç¨‹åºä¸­æ§åˆ¶MPVï¼Œåˆå¯ä»¥è®©Qtç¨‹åºå¾—åˆ°MPVçš„è¾“å‡ºä¿¡æ¯çš„æ’­æ”¾å™¨ï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»Qtçš„QProcessç±»ã€‚QProcessç±»å¯ç”¨æ¥è°ƒç”¨å¤–éƒ¨ç¨‹åºï¼Œå¹¶ä¸å¤–éƒ¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚å…¶æŠŠå¤–éƒ¨ç¨‹åºçš„è¿›ç¨‹å½“ä½œä¸€ä¸ªæœ‰åºçš„I/Oè®¾å¤‡ï¼Œé€šè¿‡å¯¹é€šè¿‡I/Oè®¾å¤‡çš„è¯»å†™æ¥å®Œæˆè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œå³ï¼šwrite()å‡½æ•°å®ç°å¯¹è¿›ç¨‹æ ‡å‡†è¾“å…¥çš„å†™æ“ä½œï¼Œé€šè¿‡read()ï¼ŒreadLine()å’ŒgetChar()å‡½æ•°å®ç°å¯¹æ ‡å‡†è¾“å‡ºçš„è¯»æ“ä½œã€‚åœ¨æ­£å¸¸æ¸ é“æ¨¡å¼ä¸‹ï¼ŒQProcessçš„æ— åç®¡é“stdinChannelpipeï¼ŒstdoutChannelpipeå’ŒstderrChannelpipeåˆ†åˆ«ä¸æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†å®¹é”™è¿›è¡Œç»‘å®šï¼Œå®ç°ä¸å¤–éƒ¨ç¨‹åºçš„é€šä¿¡ï¼›è€Œåœ¨èåˆæ¨¡å¼ä¸‹ï¼Œæ²¡æœ‰å®¹é”™ç®¡é“ï¼Œæ­¤æ—¶ï¼Œæ ‡å‡†å®¹é”™ç«¯å’Œæ ‡å‡†è¾“å‡ºç«¯å°†å…±åŒæŒ‚æ¥åˆ°å­è¿›ç¨‹çš„stdoutChannelpipeçš„å†™ç«¯æ¥å®ç°å†…å¤–è¿›ç¨‹çš„é€šä¿¡ï¼Œå³æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†å®¹é”™ç»‘å®šåˆ°åŒä¸€ä¸ªç®¡é“çš„å†™ç«¯ã€‚æœ¬æ–‡ä»‹ç»é€šè¿‡QProcessç±»è°ƒç”¨MPVï¼Œå¹¶è®¾ç½®ä¸€ç³»åˆ—æ’­æ”¾å‚æ•°ï¼Œå¦‚è§†é¢‘é©±åŠ¨ã€éŸ³é¢‘é©±åŠ¨ã€è½¯è§£/ç¡¬è§£ã€ç¼“å­˜ç­‰ã€‚è‡³äºQtå›¾å½¢å’ŒMPVè§†é¢‘çª—å£çš„å…³è”ï¼Œåˆ™æ˜¯ä½¿ç”¨â€œâ€“wid widget-&gt;winId()â€è¿›è¡Œç»‘å®šï¼Œé€šè¿‡winId()å¯ä»¥è·å¾—ä¸€ä¸ªæ•°å­—ï¼Œå…¶ä¸­widgetæ˜¯ä¸€ä¸ªQWidgetå¯¹è±¡ï¼Œè¿™æ ·å°†ç•Œé¢ä¸Šä¸€ä¸ªçª—å£çš„å¥æŸ„ç»™äº†MPVï¼Œå³è§†é¢‘è¾“å‡ºå®šä½åˆ°äº†widgetçª—ä½“éƒ¨ä»¶ä¸­ï¼ˆwidä¸ºMPVæŒ‡å®šäº†è¾“å…¥çª—å£ï¼Œ-widå‚æ•°åªåœ¨X11ã€directXå’ŒOpenGLä¸­é€‚ç”¨ï¼‰ã€‚æœ¬æ–‡æ¨èä½¿ç”¨èåˆæ¨¡å¼ï¼Œä»£ç ä¸ºï¼šsetProcessChannelMode(QProcess::MergedChannels)ã€‚ é…ç½®ä»‹ç» æŸ¥çœ‹MPVçš„å¸®åŠ©ä¿¡æ¯å¯åœ¨ç»ˆç«¯æ‰§è¡Œâ€mpv â€“helpâ€ï¼Œ æŸ¥çœ‹MPVå¯é…ç½®ä¿¡æ¯å¯åœ¨ç»ˆç«¯æ‰§è¡Œâ€mpv â€“list-optionsâ€ï¼ŒæŸ¥çœ‹å¿«æ·é”®åˆ—è¡¨å¯åœ¨ç»ˆç«¯æ‰§è¡Œâ€mpv â€”input-keylistâ€ã€‚MPVå‚æ•°è°ƒç”¨éœ€è¦åŠ â€â€“â€ï¼Œå¦‚æœå‚æ•°æ˜¯ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°ï¼Œåˆ™é…ç½®æ–‡ä»¶ä¸­æ— éœ€åœ¨å‚æ•°å‰åŠ â€â€“â€ã€‚MPVçš„é…ç½®æ–‡ä»¶ç›®å½•ä¸ºï¼š~/.config/mpv/ï¼Œæœ¬æ–‡ä»‹ç»çš„æ’­æ”¾å™¨å®šåˆ¶å°†ä¸ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œåªç®€è¦ä»‹ç»ä¸‹mpv.confå’Œinput.confè¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶çš„æ ¼å¼ï¼Œmpv.conf æ˜¯ä¸»é…ç½®æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«ä¸€äº›åŸºæœ¬çš„é…ç½®ï¼Œinput.conf æŒ‰é”®é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æ’­æ”¾è¿‡ç¨‹ä¸­ä¸€äº›æ“ä½œå¿«æ·é”®çš„è®¾ç½®ã€‚ mpv.conf 123456789# Disable the On Screen Controller (OSC).osc=no# Keep the player window on top of all other windows.ontop=yes# Enable hardware decoding if available. Often, this does not work with all# video outputs, but should work well with default settings on most systems.# If performance or energy usage is an issue, forcing the vdpau or vaapi VOs# may or may not help.hwdec=auto input.conf 123456789101112# Mouse wheels, touchpad or other input devices that have axes# if the input devices supports precise scrolling it will also scale the# numeric value accordinglyWHEEL_UP seek 10WHEEL_DOWN seek -10WHEEL_LEFT add volume -2WHEEL_RIGHT add volume 2## Seek units are in seconds, but note that these are limited by keyframesRIGHT seek 5LEFT seek -5UP seek 60DOWN seek -60 ä¸‹é¢è¯¦ç»†ä»‹ç»å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„é…ç½®é¡¹ quiet è¿™ä¸ªå‚æ•°ä¼šé˜»æ­¢çŠ¶æ€è¡Œä¿¡æ¯çš„æ˜¾ç¤ºï¼Œå³ä½¿å¾—æ§åˆ¶å°æ¶ˆæ¯å°½é‡å°‘è¾“å‡ºã€‚ä½¿ç”¨QtåµŒå…¥MPVæ—¶ï¼Œéœ€è¦ä½¿ç”¨noquietè€Œä¸æ˜¯quietï¼Œå¦åˆ™Qtç¨‹åºæ— æ³•è·å¾—MPVçš„çŠ¶æ€ä¿¡æ¯ï¼Œè‡´ä½¿Qtç¨‹åºæ— æ³•å°†MPVçš„çŠ¶æ€å‡†ç¡®çš„å±•ç¤ºç»™ç”¨æˆ·ï¼Œå¦‚æ’­æ”¾è¿›åº¦ã€å‡ºé”™ä¿¡æ¯ç­‰ã€‚å½“ç„¶ï¼Œå¦‚æœä½ çš„æœºå™¨æ€§èƒ½å·®ï¼Œé‚£è¿˜æ˜¯å»ºè®®ä½ ç›´æ¥ä½¿ç”¨mpvï¼Œä¸”å‚æ•°ä½¿ç”¨quietï¼Œè€Œä¸æ˜¯åƒæœ¬æ–‡ä»‹ç»çš„è¿™æ ·å¯¹MPVè¿›è¡ŒUIå°è£…ã€‚MPVä½¿ç”¨noquietçš„æ ¼å¼ä¸ºï¼šmpv â€“no-quietã€‚ config å¯è®©Qtç¨‹åºå°†ä¸€äº›åŸºæœ¬çš„é…ç½®é€šè¿‡ä»MPVå‘½ä»¤è·å–å„å‚æ•°æ”¯æŒå¯é€‰å€¼ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä¸”å¯é€šè¿‡å›¾å½¢å±•ç¤ºç»™ç”¨æˆ·å»é€‰æ‹©ã€‚æ‰€ä»¥æ­¤å¤„ä½¿ç”¨no-configï¼Œå³ä¸ä»MPVçš„é…ç½®æ–‡ä»¶è¯»å–å‚æ•°ã€‚mpvä½¿ç”¨no-configçš„æ ¼å¼ä¸ºï¼šmpv â€“no-configã€‚ input-file è¿™é‡Œå°†ä¸ä½¿ç”¨MPVçš„input.confé…ç½®æ–‡ä»¶ï¼Œè€Œæ˜¯é€šè¿‡æ ‡å‡†è¾“å…¥stdinç»™MPVå‘é€å‘½ä»¤ï¼Œå‘½ä»¤åé¢å¸¦ä¸Šæ¢è¡Œâ€\\nâ€å†™å…¥stdinå³å¯ã€‚å¦å¤–ï¼Œåœ¨ç›´æ¥ä½¿ç”¨MPVçš„è¿‡ç¨‹ä¸­ï¼Œâ€“no-input-default-bindingså°†ä½¿å¾—MPVæ— æ³•å“åº”æŒ‰é”®çš„äº‹ä»¶ï¼Œè€Œâ€“input-default-bindingså‚æ•°é»˜è®¤ä¸ºyesï¼Œåˆ™å¯ä»¥è®©MPVå“åº”æŒ‰é”®äº‹ä»¶ã€‚MPVä½¿ç”¨input-fileçš„æ ¼å¼ä¸ºï¼šmpv â€“input-file=/dev/stdinã€‚ term-status-msg è¯¥å‚æ•°å¯ä»¥è®©MPVè¾“å‡ºä¸€äº›è§†é¢‘ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ â€“term-status-msg å‚æ•°ç»™å®ƒä¸€ä¸ªè¾“å‡ºæ ¼å¼ï¼Œå¦‚ï¼šâ€â€“term-status-msg=STATUS: ${=time-pos} / ${=duration:${=length:0}} P: ${=pause} B: ${=paused-for-cache} I: ${=core-idle} VB: ${=video-bitrate:0} AB: ${=audio-bitrate:0}â€ vo é€šè¿‡å‘½ä»¤â€œmpv â€“vo helpâ€å¯æŸ¥çœ‹MPVæ”¯æŒçš„è§†é¢‘é©±åŠ¨åˆ—è¡¨ï¼ŒQtå›¾å½¢ç¨‹åºå¯ä»¥å°†åˆ—è¡¨å±•ç¤ºå‡ºæ¥ä¾›ç”¨æˆ·é€‰æ‹©ï¼Œå¹¶å°†é€‰æ‹©çš„voåŠ å…¥MPVçš„å‚æ•°åˆ—è¡¨ä¸­ï¼ŒåŠ å…¥æ–¹å¼ä¸ºï¼šmpv â€“vo xxxï¼Œå¦‚ï¼šmpv â€“vo=xvã€‚ ao é€šè¿‡å‘½ä»¤â€œmpv â€“ao helpâ€å¯æŸ¥çœ‹mpvæ”¯æŒçš„éŸ³é¢‘é©±åŠ¨åˆ—è¡¨ï¼ŒQtå›¾å½¢ç¨‹åºå¯ä»¥å°†åˆ—è¡¨å±•ç¤ºå‡ºæ¥ä¾›ç”¨æˆ·é€‰æ‹©ï¼Œå¹¶å°†é€‰æ‹©çš„aoåŠ å…¥mpvçš„å‚æ•°åˆ—è¡¨ä¸­ï¼ŒåŠ å…¥æ–¹å¼ä¸ºï¼šmpv â€“ao xxxï¼Œå¦‚ï¼šmpv â€“ao=pulseã€‚ hwdec hwdecä¸ºç¡¬ä»¶è§£ç é…ç½®ï¼Œå…¶å¯ç”¨é…ç½®åˆ—è¡¨å’ŒGPUæœ‰å…³ï¼Œè¿™é‡Œæš‚åˆ†æå…¶ä¸­5ç§é…ç½®ï¼šnoï¼ˆè½¯è§£ï¼‰ï¼Œautoï¼ˆè‡ªåŠ¨å°è¯•ä½¿ç”¨ç¬¬ä¸€ç§å¯ç”¨çš„ç¡¬è§£æ–¹å¼ï¼‰ï¼Œvdpauï¼ˆç”¨äºvdpauå’Œopenglçš„æ˜¾ç¤ºè¾“å‡ºï¼Œå³æ­¤æ—¶éœ€è¦ä¿è¯voå‚æ•°ä¸ºgpuæˆ–è€…vdpauï¼‰ï¼Œvaapiï¼ˆç”¨äºvaapiå’Œopenglçš„è§†é¢‘è¾“å‡ºï¼Œå³æ­¤æ—¶éœ€è¦ä¿è¯voå‚æ•°ä¸ºgpuæˆ–è€…vdapiï¼Œä»…æ”¯æŒIntel GPUï¼‰å’Œvaapi-copyï¼ˆå°†è§†é¢‘æ‹·è´å›ç³»ç»Ÿå†…å­˜ä¸­ï¼Œä»…æ”¯æŒIntel GPUï¼‰ã€‚å‚æ•°ä½¿ç”¨æ ¼å¼ä¸ºï¼šâ€“hwdec=vaapi-copyã€‚hwdecå…·ä½“å‚æ•°è§æ–‡æ¡£ï¼šhttps://mpv.io/manual/stable/ã€‚ vd-lavc-threads ç¡¬ä»¶è§£ç çº¿ç¨‹æ•°ç›®ï¼Œä»…é€‚ç”¨äºMPEG-1/2å’ŒH.264ï¼Œå–å€¼èŒƒå›´ä¸º0 - anyï¼Œé»˜è®¤ä¸º0ã€‚ä½¿ç”¨æ ¼å¼å¦‚ä¸‹ï¼šâ€“vd-lavc-threads=4ã€‚ MPVæ”¯æŒçš„éŸ³/è§†é¢‘ã€å­—å¹•å’Œæ’­æ”¾åˆ—è¡¨æ ¼å¼çš„å¤§éƒ¨åˆ†åˆ—è¡¨ MPVæ”¯æŒçš„è§†é¢‘æ ¼å¼ï¼šavi ã€vfwã€divxã€mpgã€mpegã€m1vã€m2vã€mpvã€dvã€3gpã€movã€mp4ã€m4vã€mqvã€datã€vcdã€oggã€ogmã€ogvã€ogxã€asfã€wmvã€binã€isoã€vobã€mkvã€nsvã€ramã€flvã€rmã€swfã€tsã€rmvbã€dvr-msã€m2tã€m2tsã€mtsã€recã€wtvã€f4vã€hdmovã€webmã€vp8ã€bikã€smkã€m4bã€wtvã€part MPVæ”¯æŒçš„éŸ³é¢‘æ ¼å¼ï¼šmp3ã€oggã€ogaã€wavã€wmaã€aacã€ac3ã€dtsã€raã€apeã€flacã€thdã€mkaã€m4aã€opus MPVæ”¯æŒçš„å­—å¹•æ ¼å¼ï¼šsrtã€subã€ssaã€assã€idxã€txtã€smiã€rtã€utfã€aqtã€vtt MPVæ”¯æŒçš„åˆ—è¡¨æ ¼å¼ï¼šm3uã€m3u8ã€plsã€xspf Qtå¯¹MPVçš„æ§åˆ¶ å‰é¢æåŠè¿‡Qtçš„QProcessç±»ï¼Œè¿™é‡Œæè¿°ä¸‹è¯¥ç±»æ˜¯å¦‚æœè®¾ç½®MPVçš„å‚æ•°å’Œå¯åŠ¨MPVçš„ï¼Œå³å¦‚ä½•ä½¿ç”¨ç»™æ ‡å‡†è¾“å…¥æ§åˆ¶MPVã€‚MPVè‡ªåŠ¨ä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ä¿¡æ¯å¹¶æ‰§è¡Œï¼Œè¯¥ç±»æŒ‡ä»¤ä¿¡æ¯éƒ½éœ€è¦ä»¥â€œ\\nâ€ç»“å°¾ã€‚ç®¡é“çš„è¯»ç«¯æè¿°ç¬¦stdinChannelpipe[0]å¤åˆ¶ç»™äº†æ ‡å‡†è¾“å…¥ï¼Œå³æ ‡å‡†è¾“å…¥çš„æè¿°ç¬¦ä¹Ÿä¸ºstdinChannelpipe[0]ï¼Œéšè—æŒ‰ç…§æ ‡å‡†è¾“å…¥çš„æè¿°ç¬¦å»è¯»ä¿¡æ¯å°±æ˜¯åˆ°stdinChannelpipeæ‰€å¯¹åº”çš„ç®¡é“ä¸­è¯»å–ä¿¡æ¯ã€‚QProcessçš„start()å‡½æ•°å°†å¼€å¯è¿›ç¨‹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å³ä¸ºmpväºŒè¿›åˆ¶ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç»™mpvçš„å‚æ•°åˆ—è¡¨ï¼Œæ‰§è¡Œstart()å‡½æ•°åï¼Œå°†å®Œæˆå†…æ ¸ä¸­ç®¡é“ä»¥åŠé€šä¿¡ç¯å¢ƒçš„å»ºç«‹ã€‚QProcessçš„æˆå‘˜å‡½æ•°write()å‘stdinChannelpipe[1]ç«¯å†™å…¥ä¿¡æ¯ï¼Œæ¯”å¦‚æƒ³è®©mpvé€€å‡ºï¼Œåˆ™é€šè¿‡writeå‡½æ•°å†™å…¥â€œquit \\nâ€å³å¯ï¼ˆwrite()å‡½æ•°å°†å‘stdinChannelpipe[1]ç«¯å†™å…¥å‘½ä»¤ï¼‰ã€‚å‚è€ƒä»£ç å¦‚ä¸‹ï¼š 123456789QString mpvCmd = &quot;/usr/bin/mpv&quot;; QStringList args;args &lt;&lt; &quot;-- no-quiet&quot;;args &lt;&lt; &quot;--wid=100663330&quot;;args &lt;&lt; xxx.avi;process-&gt;start(mpvCmd, args);//å¯åŠ¨æ’­æ”¾waitForStarted();QString cmd = &quot;set pause yes&quot;;process-&gt;write(cmd.toLocal8Bit() + &quot;\\n&quot;);//è®¾ç½®æš‚åœ Qtè·å–MPVçš„ä¿¡æ¯ ä½¿ç”¨QProcessçš„èåˆæ¨¡å¼ï¼Œä»æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†å®¹é”™å¾—åˆ°mpv çš„ä¿¡æ¯ã€‚ç»‘å®šQProcessçš„ä¿¡å·readyReadStandardOutputï¼Œå½“è¯¥ä¿¡å·å‡ºå‘æ—¶ï¼Œå†é€šè¿‡QProcessçš„readAllStandardOutput()å‡½æ•°è·å–ä¿¡æ¯ï¼ˆå½“ç„¶ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥whileå¾ªç¯æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥è¯»å–ä¸€è¡Œæ•°æ®ï¼šwhile(process-&gt;canReadLine())ï¼Œå¦‚æœå¯ä»¥ï¼Œåˆ™è¯»å–ä¸€è¡Œï¼šQString line(process-&gt;readLine());ï¼‰ï¼ŒreadAllStandardOutputè·å–çš„æ•°æ®ç±»å‹ä¸ºQByteArrayï¼Œå¯¹æ•°æ®è¿›è¡Œè§£ææ—¶é€šè¿‡â€œ\\nâ€ å’Œâ€œ\\râ€ åˆ‡åˆ†åä¸€è¡Œä¸€è¡Œè§£æï¼Œé€šè¿‡å¯¹æ¯è¡Œçš„QByteArrayæ•°æ®è¿›è¡Œè¯¦ç»†è§£æå¯ä»¥å¾—å‡ºMPVçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†ä¸€äº›çŠ¶æ€åœ¨Qtçš„å›¾å½¢ç¨‹åºä¸ŠåŠ¨æ€å±•ç¤ºå¤„ç†ï¼Œæ¯”å¦‚MPVæ’­æ”¾æˆåŠŸï¼Œåˆ™æ ¹æ®æ’­æ”¾æˆåŠŸçš„ä¿¡æ¯å°†Qtå›¾å½¢çš„æ’­æ”¾æŒ‰é’®è®¾ç½®ä¸ºå¯æš‚åœçŠ¶æ€ï¼Œæ­¤æ—¶ç‚¹å‡»è¯¥æŒ‰é’®ç»™MPVå‘é€çš„æŒ‡ä»¤åº”è¯¥æ˜¯æš‚åœè€Œéå¯åŠ¨ã€‚å¦å¤–ï¼Œå¯ä»¥ç»‘å®šQProcessçš„ä¿¡å·finished(int, QProcess::ExitStatus)ï¼Œå½“è¯¥ä¿¡å·è¢«è§¦å‘æ—¶ï¼Œé€šè¿‡åˆ¤æ–­QProcessçš„bytesAvailable()å€¼ï¼Œå¦‚æœ&gt;0ï¼Œåˆ™é€šè¿‡QProcessçš„readAllStandardOutput()å‡½æ•°è·å–ä¿¡æ¯ã€‚ è·å–MPVçš„ä¿¡æ¯è¿›è¡Œè§£æçš„éš¾ç‚¹æ˜¯å¯¹ç¹æ‚å†—ä½™çš„ä¿¡æ¯è¿›è¡Œè¿‡æ»¤ï¼Œé’ˆå¯¹å…³é”®å­—å®šä½ä¿¡æ¯è¡¨ç¤ºçš„æ„æ€ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨Qtçš„å¯¹è·å–çš„QRegExpæ¥è¿›è¡ŒåŒ¹é…ã€‚ ä¸‹è¿°æ­£åˆ™è¡¨è¾¾å¼å¯ç”¨äºåˆ†æå‡ºæ­£åœ¨å¯åŠ¨ä¸­ï¼š 12QRegExp rx_playing;rx_playing.setPattern(&quot;^Playing:.*|^\\\\[ytdl_hook\\\\].*&quot;); ä¸‹è¿°æ­£åˆ™è¡¨è¾¾å¼å¯å¯è§£æå‡ºæš‚åœã€ç¼“å­˜ä¸­ç­‰å„ç§çŠ¶æ€ä¿¡æ¯ï¼š 12QRegExp rx_av;rx_av.setPattern(&quot;^STATUS: ([0-9\\\\.-]+) / ([0-9\\\\.-]+) P: (yes|no) B: (yes|no) I: (yes|no) VB: ([0-9\\\\.-]+) AB: ([0-9\\\\.-]+)&quot;); å‚è€ƒæ–‡æ¡£éº’éºŸå½±éŸ³ mpvé…ç½® mpvä¸»é¡µ mpv.conf input.conf","categories":[{"name":"Linux Qt å¼€å‘","slug":"Linux-Qt-å¼€å‘","permalink":"https://eightplus.github.io/categories/Linux-Qt-å¼€å‘/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https://eightplus.github.io/tags/Qt/"}]},{"title":"å®‰è£…Anbox","slug":"2019-08-14-install-anbox","date":"2019-08-14T13:44:03.000Z","updated":"2019-11-14T01:56:25.667Z","comments":true,"path":"2019/08/14/2019-08-14-install-anbox/","link":"","permalink":"https://eightplus.github.io/2019/08/14/2019-08-14-install-anbox/","excerpt":"","text":"Anboxæ˜¯ä¸€ç§åŸºäºå®¹å™¨åœ¨å¸¸è§„GNU/Linuxç³»ç»Ÿä¸Šå¯åŠ¨å®Œæ•´Androidç³»çµ±çš„æ–¹æ³•ï¼Œå¦‚Ubuntuã€‚Anbox ä½¿ç”¨ Linux å‘½åç©ºé—´æœºåˆ¶ï¼ˆuserï¼Œpidï¼Œutsï¼Œnetï¼Œmountï¼Œipcï¼‰ï¼Œåœ¨å®¹å™¨ä¸­è¿è¡Œå®Œæ•´çš„ Android ç³»ç»Ÿï¼Œå®¹å™¨å†…çš„ Android æ²¡æœ‰ç›´æ¥è®¿é—®ä»»ä½•ç¡¬ä»¶çš„æƒé™ï¼Œæ‰€æœ‰çš„ç¡¬ä»¶è®¿é—®é€šè¿‡ä¸»æœºä¸Šçš„ anbox å®ˆæŠ¤è¿›ç¨‹ã€‚Anboxå¤ç”¨åŸºäº QEMU çš„æ¨¡æ‹Ÿå™¨ä¸­ä¸º Android æ‰€åšçš„ OpenGL ES åŠ é€Ÿæ¸²æŸ“çš„å®ç°ã€‚å®¹å™¨å†…çš„ Android ç³»ç»Ÿä½¿ç”¨ä¸åŒçš„ç®¡é“ä¸ä¸»æœºç³»ç»Ÿé€šä¿¡ï¼Œå¹¶é€šè¿‡å®ƒä»¬å‘é€æ‰€æœ‰çš„ç¡¬ä»¶è®¿é—®å‘½ä»¤ã€‚ ä½¿ç”¨aptå’Œsnapå®‰è£…Anbox å®‰è£…å†…æ ¸æ¨¡å— anbox-modules-dkmsåŒ…å«ashmemå’Œbinderå†…æ ¸æ¨¡å—ï¼Œå®‰è£…anbox-modules-dkmsåï¼Œå¿…é¡»æ‰‹åŠ¨åŠ è½½å†…æ ¸æ¨¡å—ã€‚ä¸‹æ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå®ƒä»¬å°†è‡ªåŠ¨åŠ è½½ã€‚ 12345678$ sudo add-apt-repository ppa:morphis/anbox-support$ sudo apt update$ sudo apt install linux-headers-generic anbox-modules-dkms$ sudo modprobe ashmem_linux$ sudo modprobe binder_linux$ ls -1 /dev/&#123;ashmem,binder&#125;/dev/ashmem/dev/binder å®‰è£…å’Œæ›´æ–°Anbox snap 123$ sudo apt install snapd$ sudo snap install --devmode --beta anbox$ snap refresh --beta --devmode anbox æŸ¥çœ‹å½“å‰å¯ç”¨çš„Anboxä¿¡æ¯ $ snap info anbox å¯åŠ¨Anbox $ anbox.appmgr Anboxå¯åŠ¨åï¼Œåº”ç”¨ç®¡ç†å™¨ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š ç‚¹å‡»åº”ç”¨ç®¡ç†å™¨ä¸­çš„Settingsçš„å›¾æ ‡ï¼Œå¯åŠ¨Settingsï¼Œç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š å®‰è£…å®‰å“åº”ç”¨ 1234$ sudo apt install android-tools-adb$ adb install qq.apk37616 KB/s (71677112 bytes in 1.860s)Failure [INSTALL_FAILED_NO_MATCHING_ABIS: Failed to extract native libraries, res=-113] ä¸Šé¢æ‰§è¡Œadb install qq.apkæŠ¥é”™äº†ï¼ŒåŸå› æ˜¯å½“å‰æœºå™¨ä¸ºx86ç»“æ„ï¼Œå¦‚æœæ˜¯åœ¨arm64ä¸Šï¼Œåˆ™ä¸ä¼šå‡ºç°è¯¥é—®é¢˜ã€‚å¦‚æœæƒ³åœ¨x86ä¸‹å®‰è£…apkï¼Œéœ€è¦æ‰¾x86çš„åŒ…ï¼Œå¯ä»¥ä»apk mirrorä¸‹è½½ï¼Œå½“ç„¶ï¼Œè¿™é‡Œçš„åŒ…æ ¹æœ¬æ— æ³•æ»¡è¶³æˆ‘çš„éœ€è¦ï¼Œå¾ˆå¯èƒ½ä¹Ÿæ»¡è¶³ä¸äº†ä½ çš„éœ€è¦ã€‚é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼Œæƒ³åœ¨x86ä¸‹ä½¿ç”¨åº”ç”¨å•†åº—çš„é‚£äº›apkï¼ˆarmç‰ˆæœ¬ï¼‰ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å‘¢ï¼Ÿ åŠæ³•æ€»æ¯”å›°éš¾å¤šï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ libhoudiniã€‚å½“ç„¶ï¼Œåœ¨é›†æˆ libhoudini æ¥æ”¯æŒ ARM åï¼Œä¹Ÿå¹¶éæ‰€æœ‰ Android åº”ç”¨å’Œæ¸¸æˆéƒ½èƒ½åœ¨ Anbox ä¸­è¿è¡Œã€‚æŸäº› Android åº”ç”¨å’Œæ¸¸æˆå¯èƒ½æ ¹æœ¬ä¸ä¼šå‡ºç°åœ¨ Google Play å•†åº—ä¸­ï¼Œè€Œä¸€äº›åº”ç”¨å’Œæ¸¸æˆå¯èƒ½å¯ä»¥å®‰è£…ä½†æ— æ³•ä½¿ç”¨ã€‚æ­¤å¤–ï¼ŒæŸäº›åº”ç”¨å¯èƒ½æ— æ³•ä½¿ç”¨æŸäº›åŠŸèƒ½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒAnbox æ²¡æœ‰ Google Play å•†åº—æˆ– ARM åº”ç”¨æ”¯æŒã€‚è¦å®‰è£…åº”ç”¨ï¼Œå¿…é¡»ä¸‹è½½æ¯ä¸ªåº”ç”¨çš„ APK å¹¶ä½¿ç”¨ adb æ‰‹åŠ¨å®‰è£…ã€‚å¦‚ä¸Šé¢æåŠçš„å®‰è£…æŠ¥é”™ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸èƒ½ä½¿ç”¨ Anbox å®‰è£… ARM åº”ç”¨æˆ–æ¸¸æˆï¼Œå¯ä»¥åœ¨ Anbox ä¸­æ‰‹åŠ¨è®¾ç½® Google Play å•†åº—å’Œ ARM åº”ç”¨æ”¯æŒï¼ˆä½¿ç”¨ libhoudiniï¼‰ï¼Œä½†è¯¥è¿‡ç¨‹è¾ƒå¤æ‚ã€‚ä¸ºäº†æ›´å®¹æ˜“åœ°åœ¨ Anbox ä¸Šå®‰è£… Google Play å•†åº—å’Œ Google Play æœåŠ¡ï¼Œå¹¶è®©å®ƒæ”¯æŒ ARM åº”ç”¨ç¨‹åºå’Œæ¸¸æˆï¼ˆä½¿ç”¨ libhoudiniï¼‰ï¼Œ geeks-r-us.deä¸Šæœ‰äººåˆ›å»ºäº†ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œè¿™äº›ä»»åŠ¡çš„è„šæœ¬ã€‚ å®‰è£… Google Play å•†åº—å¹¶åœ¨ Anbox ä¸Šå¯ç”¨ ARM åº”ç”¨/æ¸¸æˆæ”¯æŒ 1ã€ å®‰è£…æ‰€éœ€çš„ä¾èµ–é¡¹ï¼ˆwgetã€lzipã€unzip å’Œ squashfs-toolsï¼‰ sudo apt install wget lzip unzip squashfs-tools dnsmasq 2ã€ ä¸‹è½½å¹¶è¿è¡Œè„šæœ¬ï¼Œåœ¨ Anbox ä¸Šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£… Google Play å•†åº—ï¼ˆå’Œ Google Play æœåŠ¡ï¼‰å’Œ libhoudiniï¼ˆç”¨äº ARM åº”ç”¨/æ¸¸æˆæ”¯æŒï¼‰ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»æˆ‘çš„gitä¸Šä¸‹è½½è¯¥è„šæœ¬install-playstore.sh 123wget https://raw.githubusercontent.com/geeks-r-us/anbox-playstore-installer/master/install-playstore.shchmod +x install-playstore.shsudo ./install-playstore.sh 3ã€è¦è®© Google Play å•†åº—åœ¨ Anbox ä¸­è¿è¡Œï¼Œä½ éœ€è¦å¯ç”¨ Google Play å•†åº—å’Œ Google Play æœåŠ¡çš„æ‰€æœ‰æƒé™ï¼Œè¿è¡ŒAnbox $ anbox.appmgr ç„¶åè¿›å…¥â€œè®¾ç½® &gt; åº”ç”¨ &gt; Google Play æœåŠ¡ &gt; æƒé™â€å¹¶å¯ç”¨æ‰€æœ‰å¯ç”¨æƒé™ã€‚å¯¹ Google Play å•†åº—ä¹Ÿä¸€æ ·ã€‚è‡³æ­¤ï¼Œåº”è¯¥å¯ä»¥ä½¿ç”¨ Google å¸æˆ·ç™»å½• Google Play å•†åº—äº†ã€‚ å¦‚æœæœªå¯ç”¨ Google Play å•†åº—å’Œ Google Play æœåŠ¡çš„æ‰€æœ‰æƒé™ï¼Œä½ å¯èƒ½ä¼šåœ¨å°è¯•ç™»å½• Google å¸æˆ·æ—¶å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ï¼Œå¹¶æ˜¾ç¤ºä»¥ä¸‹é”™è¯¯æ¶ˆæ¯ï¼šâ€œCouldnâ€™t sign in. There was a problem communicating with Google servers. Try again laterâ€œï¼Œå¦‚ä½ åœ¨ä¸‹é¢çš„æˆªå›¾ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼š ç™»å½•åï¼Œä½ å¯ä»¥åœç”¨éƒ¨åˆ† Google Play å•†åº—/Google Play æœåŠ¡æƒé™ã€‚å¦‚æœåœ¨ Anbox ä¸Šç™»å½• Google å¸æˆ·æ—¶é‡åˆ°ä¸€äº›è¿æ¥é—®é¢˜ï¼Œè¯·ç¡®ä¿ anbox-bride.sh æ­£åœ¨è¿è¡Œï¼š å¯åŠ¨ï¼š$ sudo /snap/anbox/current/bin/anbox-bridge.sh start é‡å¯ï¼š$ sudo /snap/anbox/current/bin/anbox-bridge.sh restart å¸è½½Anbox 123$ snap remove anbox$ sudo apt install ppa-purge$ sudo ppa-purge ppa:morphis/anbox-support å‚è€ƒæ–‡æ¡£Anboxä¸»é¡µ Anboxä»£ç æ‰˜ç®¡ Android ç¡¬ä»¶ OpenGL ES æ¨¡æ‹Ÿè®¾è®¡æ¦‚è¿° Android QEMU fast pipes The Android â€œqemudâ€ multiplexing daemon Android qemud services","categories":[{"name":"å®‰å“å¼€å‘","slug":"å®‰å“å¼€å‘","permalink":"https://eightplus.github.io/categories/å®‰å“å¼€å‘/"}],"tags":[{"name":"Android Anbox","slug":"Android-Anbox","permalink":"https://eightplus.github.io/tags/Android-Anbox/"}]},{"title":"Android Binder","slug":"2018-08-11-android-binder","date":"2018-08-11T01:38:43.000Z","updated":"2019-11-14T01:51:52.601Z","comments":true,"path":"2018/08/11/2018-08-11-android-binder/","link":"","permalink":"https://eightplus.github.io/2018/08/11/2018-08-11-android-binder/","excerpt":"","text":"åœ¨Binderåº“ä¸­ï¼ŒServiceç»„ä»¶å’ŒClientç»„ä»¶åˆ†åˆ«ä½¿ç”¨æ¨¡æ¿ç±»BnInterfaceå’ŒBpInterfaceæ¥æè¿°ï¼Œå‰è€…ç§°ä¸ºBinderæœ¬åœ°å¯¹è±¡ï¼Œåè€…ç§°ä¸ºBinderä»£ç†å¯¹è±¡ã€‚Binderåº“ä¸­çš„Binderæœ¬åœ°å¯¹è±¡å’ŒBinderä»£ç†å¯¹è±¡åˆ†åˆ«å¯¹åº”äºBinderé©±åŠ¨ç¨‹åºä¸­çš„Binderå®ä½“å¯¹è±¡å’ŒBinderå¼•ç”¨å¯¹è±¡ã€‚ä¸‹é¢å°†ç®€è¦ä»‹ç»Binderè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œä»£ç åŒ…å«Serverè¿›ç¨‹å’ŒClientè¿›ç¨‹ï¼ŒServerè¿›ç¨‹å®ç°äº†ä¸€ä¸ªServiceç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†å‰é¢ä»‹ç»çš„è™šæ‹Ÿç¡¬ä»¶è®¾å¤‡mydevçš„å¯„å­˜å™¨valï¼Œå¹¶ä¸”å‘Clientè¿›ç¨‹æä¾›è®¿é—®æœåŠ¡ã€‚ä»¥ä¸‹å°†å®ä¾‹åˆ’åˆ†ä¸ºcommonã€serverå’Œclientä¸‰ä¸ªæ¨¡å—ï¼Œå…¶ä¸­commonå®ç°äº†ç¡¬ä»¶è®¿é—®æœåŠ¡æ¥å£IMydevServiceï¼Œä»¥åŠBinderæœ¬åœ°å¯¹è±¡ç±»BnMydevServiceå’ŒBinderä»£ç†å¯¹è±¡ç±»BpMydevServiceï¼›serverå®ç°äº†ä¸€ä¸ªServerè¿›ç¨‹ï¼Œé‡Œé¢åŒ…å«ä¸€ä¸ªServiceç»„ä»¶MydevServiceï¼›clientå®ç°äº†ä¸€ä¸ªClientè¿›ç¨‹ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªBpMydevServiceä»£ç†å¯¹è±¡å»è®¿é—®è¿è¡Œåœ¨Serverè¿›ç¨‹ä¸­çš„Serviceç»„ä»¶MydevServiceæ‰€æä¾›çš„æœåŠ¡ã€‚ ç¨‹åºç›®å½•ç»“æ„12345678910~/Android/external/binder----common ----IMydevgService.h ----IMydevService.cpp----server ----MydevServer.cpp ----Android.mk----client ----MydevClient.cpp ----Android.mk Serverè¿›ç¨‹ common/IMydevService.h 123456789101112131415161718192021222324252627#ifndef IMYDEVSERVICE_H_#define IMYDEVSERVICE_H_#include &lt;utils/RefBase.h&gt;#include &lt;binder/IInterface.h&gt;#include &lt;binder/Parcel.h&gt;#define MYDEV_SERVICE \"com.eightplus.MydevService\" //MYDEV_SERVICEç”¨æ¥æè¿°Serviceç»„ä»¶MydevServiceæ³¨å†Œåˆ°Service Managerçš„åç§°using namespace android;//ç¡¬ä»¶è®¿é—®æœåŠ¡æ¥å£class IMydevService: public IInterface&#123;public: DECLARE_META_INTERFACE(MydevService); virtual int32_t getVal() = 0;//è¯»å–è™šæ‹Ÿç¡¬ä»¶è®¾å¤‡mydevä¸­å¯„å­˜å™¨valçš„å€¼ virtual void setVal(int32_t val) = 0;//å‘è™šæ‹Ÿç¡¬ä»¶è®¾å¤‡mydevä¸­å¯„å­˜å™¨valä¸­å†™å…¥å€¼&#125;;//Binderæœ¬åœ°å¯¹è±¡ç±»BnMydevServiceclass BnMydevService: public BnInterface&lt;IMydevService&gt;&#123;public: virtual status_t onTransact(uint32_t code, const Parcel &amp;data, Parcel *reply, uint32_t flags= 0);&#125;;#endif common/IMydevService.cpp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869#define LOG_TAG \"IMydevService\"#include &lt;utils/Log.h&gt;#include \"IMydevService.h\"using namespace android;enum&#123; GET_VAL = IBinder::First_CALL_TRANSACTION; SET_VAL = IBinder::First_CALL_TRANSACTION + 1;&#125;;class BpMydevService: public BpInterface&lt;IMydevService&gt;&#123;public: BpMydevService(const sp&lt;IBinder&gt;&amp; impl): BpInterface&lt;IMydevService&gt;(impl) &#123; &#125;public: int32_t getVal() &#123; Parcel data; data.writeInterfaceToken(IMydevService::getInterfaceDescriptor()); Parcel reply; remote()-&gt;transact(GET_VAL, data, &amp;reply); int32_t val = reply.readInt32(); return val; &#125; void setVal(int32_t val) &#123; Parcel data; data.writeInterfaceToken(IMydevService::getInterfaceDescriptor()); data.writeInt32(val); Parcel reply; remote-&gt;transact(SET_VAL, data, &amp;reply); &#125;&#125;;IMPLEMENT_META_INTERFACE(MydevService, \"com.eightplus.IMydevService\");status_t BnMydevService::onTransact(uint32_t code, const Parcel &amp;data, Parcel *reply, uint32_t flags)&#123; switch(code) &#123; case GET_VAL: &#123; CHECK_INTERFACE(IMydevService, data, reply); int32_t val = getVal(); reply-&gt;writeInt32(val); return NO_ERROR; &#125; case SET_VAL: &#123; CHECK_INTERFACE(IMydevService, data, reply); int32_t val = data.readInt32(); setVal(val); return NO_ERROR; &#125; default: &#123; return BBinder::onTransact(code, data, reply, flags); &#125; &#125;&#125; server/MydevServer.cpp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#define LOG_TAG \"MydevServer\"#include &lt;stdlib.h&gt;#include &lt;fcntl.h&gt;#include &lt;utils/Log.h&gt;#include &lt;binder/IServiceManager.h&gt;#include &lt;binder/IPCThreadState.h&gt;#include \"../common/IMydevService.h\"#define MYDEV_DEVICE_NAME \"/dev/mydev\"//Serviceç»„ä»¶ç±»MydevServiceclass MydevService: public BnMydevService&#123;public: MydevService() &#123; fd = open(MYDEV_DEVICE_NAME, O_RDWR); if(fd == -1) LOGE(\"Failed to open device %s.\\n\", MYDEV_DEVICE_NAME); &#125; virtual ~MydevService() &#123; if(fd != -1) close(fd); &#125;public: static void instantiate() &#123; defaultServiceManager()-&gt;addService(String16(MYDEV_SERVICE), new MydevService()); &#125; int32_t getVal() &#123; int32_t val = 0; if(fd != -1) read(fd, &amp;val, sizeof(val)); rerurn val; &#125; void setVal(int32_t val) &#123; if(fd != -1) write(fd, &amp;val, sizeof(val)); &#125;private: int fd;&#125;;int main(int argc, char** argv)&#123; MydevService::instantiate();//å°†MydevServiceç»„ä»¶æ³¨å†Œåˆ°Service Managerä¸­ ProcessState::self()-&gt;startThreadPool();//å¯åŠ¨ä¸€ä¸ªBinderçº¿ç¨‹æ±  IPCThreadState::self()-&gt;joinThreadPool();//å°†ä¸»çº¿ç¨‹æ·»åŠ åˆ°è¿›ç¨‹çš„Binderçº¿ç¨‹æ± ä¸­ï¼Œç”¨æ¥å¤„ç†æ¥è‡ªClientè¿›ç¨‹çš„é€šä¿¡è¯·æ±‚ return 0;&#125; server/Android.mk12345678LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_SRC_FILES := ../common/IMydevService.cpp \\ MydevServer.cppLOCAL_SHARED_LIBRARIES := libcutils libutils libbinderLOCAL_PACKAGE_NAME := MydevServerinclude $(BUILD_EXECUTABLE) Clientè¿›ç¨‹ client/MydevClient.cpp 1234567891011121314151617181920212223242526272829303132333435#define LOG_TAG \"MydevClient\"#include &lt;utils/Log.h&gt;#include &lt;binder/IServiceManager.h&gt;#include \"../common/IMydevService.h\"int main()&#123; sp&lt;IBinder&gt; binder = defaultServiceManager()-&gt;getService(String16(MYDEV_SERVICE)); if (binder == NULL) &#123; LOGE(\"Failed to get mydev service: %s.\\n\", MYDEV_SERVICE); return -1; &#125; sp&lt;IMydevService&gt; service = IMydevService::asInterface(binder); if (service == NULL) &#123; LOGE(\"Failed to get mydev service interface.\\n\"); return -2; &#125; printf(\"Read original value from MydevService:\\n\"); int32_t val = service-&gt;getVal(); printf(\" %d.\\n\", val);//0 printf(\"Add value 1 to MydevService.\\n\"); val += 1; service-&gt;setVal(val); printf(\"Read the value from MydevService again:\\n\"); val = service-&gt;getVal(); printf(\" %d.\\n\", val);//1 return 0;&#125; client/Android.mk12345678LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_SRC_FILES := ../common/IMydevService.cpp \\ MydevClient.cppLOCAL_SHARED_LIBRARIES := libcutils libutils libbinderLOCAL_PACKAGE_NAME := MydevClientinclude $(BUILD_EXECUTABLE) å•ç‹¬ç¼–è¯‘serverå’Œclient ~/Android$ mmm ./external/binder/server/ ~/Android$ mmm ./external/binder/client/ ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°±å¯ä»¥åœ¨out/target/product/generic/system/binç›®å½•ä¸‹çœ‹åˆ°ç¼–è¯‘ç»“æœçš„è¾“å‡ºæ–‡ä»¶MydevServerå’ŒMydevClientäº† é‡æ–°æ‰“åŒ…system.imgæ–‡ä»¶ ~/Android$make snod è¿è¡Œæ¨¡æ‹Ÿå™¨ï¼š ~/Android$emulator -kernel kernel/goldfish/arch/arm/boot/zImage &amp; ~/Android$ adb shell root@android:/ # cd system/bin root@android:/system/bin # ./MydevServer &amp; root@android:/system/bin # ./MydevXClient12345Read original value from MydevService:0.Add value 1 to MydevService.Read the value from MydevService again:1.","categories":[{"name":"å®‰å“å¼€å‘","slug":"å®‰å“å¼€å‘","permalink":"https://eightplus.github.io/categories/å®‰å“å¼€å‘/"}],"tags":[{"name":"Android","slug":"Android","permalink":"https://eightplus.github.io/tags/Android/"}]},{"title":"åœ¨Androidæºç ä¸­ä½¿ç”¨javaç¼–å†™è‡ªå·±çš„åº”ç”¨ç¨‹åº","slug":"2018-08-09-android-java-app","date":"2018-08-09T13:49:29.000Z","updated":"2019-11-14T01:56:22.775Z","comments":true,"path":"2018/08/09/2018-08-09-android-java-app/","link":"","permalink":"https://eightplus.github.io/2018/08/09/2018-08-09-android-java-app/","excerpt":"","text":"HelloWorld ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 12345678910111213~/Android/packages/experimental/HelloWorld----AndroidMainifest.xml----Android.mk----src ----com/eightplus/mydev ----HelloWorld.java----res ----layout ----main.xml ----values ----strings.xml ----drawable ----icon.png HelloWorld.java 12345678910111213141516package com.eightplus.helloimport android.app.Activity;import android.os.Bundle;import android.util.log;public class HelloWorld extends Activity &#123; private final static String LOG_TAG = \"HelloWorld\"; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.main); Log.i(LOG_TAG, \"HelloWorld, Welcome!!!\"); &#125;&#125; main.xml 12345678910111213&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:orientation=\"vertical\" android:layout_width=\"fill_parent\" android:layout_height=\"fill_parent\" android:gravity=\"center\"&gt; &lt;TextView android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/hello_world\" &gt; &lt;/TextView&gt;&lt;/LinearLayout&gt; strings.xml 12345&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;resources&gt; &lt;string name=\"app_name\"&gt;HellWorld&lt;/string&gt; &lt;string name=\"hello_world\"&gt;Hello World&lt;/string&gt;&lt;/resources&gt; icon.pngæ˜¯åº”ç”¨ç¨‹åºçš„å›¾æ ‡ AndroidMainifest.xml 12345678910111213141516&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;mainifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.eightplus.hello\" android:versionCode=\"1\" android:versionName=\"1.0\"&gt; &lt;application android:icon=\"@drawable/icon\" android:label=\"@string/app_name\"&gt; &lt;activity android:name=\".HelloWorld\" android:label=\"@string/app_name\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.MAIN\" /&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;/application&gt;&lt;/mainifest&gt; Android.mk 123456LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_SRC_FILES := $(call all-subdir-java-files)LOCAL_PACKAGE_NAME := HelloWorldinclude $(BUILD_PACKAGE) ä½¿ç”¨mmmå‘½ä»¤å•ç‹¬ç¼–è¯‘HelloWorkdç¨‹åº ~/Android$ mmm ./packages/experimental/HelloWorld/ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°±å¯ä»¥åœ¨out/target/product/generic/system/appç›®å½•ä¸‹çœ‹åˆ°ç¼–è¯‘ç»“æœçš„è¾“å‡ºæ–‡ä»¶HelloWorld.apkäº†ã€‚ é‡æ–°æ‰“åŒ…Androidç³»ç»Ÿæ–‡ä»¶system.img ~/Android$ make snod è¿è¡Œæ¨¡æ‹Ÿå™¨ ~/Android$ emulator Activityç»„ä»¶åº”ç”¨å®ä¾‹è¯¥å®ä¾‹ç”±ä¸‰ä¸ªAcitityç»„ä»¶ç»„æˆï¼šMainActivityã€SubActivityInProcesså’ŒSubActivityInNewProcessã€‚MainActivityæ˜¯æ ¹Acitityï¼ŒSubActivityInProcesså’ŒSubActivityInNewProcessæ˜¯å­Acitityã€‚MainActivityå’ŒSubActivityInProcessè¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€ŒSubActivityInNewProcessè¿è¡Œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ä¸­ã€‚ ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 12345678910111213141516~/Android/packages/experimental/Activity----AndroidMainifest.xml----Android.mk----src ----com/eightplus/activity ----MainActivity.java ----SubActivityInProcess.java ----SubActivityInNewProcess.java----res ----layout ----main.xml ----sub.xml ----values ----strings.xml ----drawable ----icon.png MainActivity.java SubActivityInProcesså’ŒSubActivityInNewProcessçš„ç»„ä»¶åå­—åˆ†åˆ«è¢«é…ç½®ä¸ºâ€com.eightplus.activity.subactivity.in.processâ€å’Œâ€com.eightplus.activity.subactivity.in.new.processâ€ï¼Œå› æ­¤è°ƒç”¨æˆå‘˜å’Œå‡½æ•°startActivityå¯åŠ¨å®ƒä»¬æ—¶ï¼Œåªéœ€è¦åˆ†åˆ«æŒ‡å®šè¿™ä¸¤ä¸ªåç§°å³å¯ï¼Œä¸éœ€è¦çŸ¥é“å®ƒä»¬æ˜¯å“ªä¸ªç±»æ¥å®ç°çš„ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041package com.eightplus.activity; import android.app.Activity; import android.content.Intent; import android.os.Bundle; import android.util.Log; import android.view.View; import android.view.View.OnClickListener; import android.widget.Button; public class MainActivity extends Activity implements OnClickListener &#123; private final static String LOG_TAG = \"com.eightplus.activity.MainActivity\"; private Button startInProcessButton = null; private Button startInNewProcessButton = null; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.main); startInProcessButton = (Button)findViewById(R.id.button_start_in_process); startInNewProcessButton = (Button)findViewById(R.id.button_start_in_new_process); startInProcessButton.setOnClickListener(this); startInNewProcessButton.setOnClickListener(this); Log.i(LOG_TAG, \"Main Activity Created.\"); &#125; @Override public void onClick(View v) &#123; if(v.equals(startInProcessButton)) &#123; Intent intent = new Intent(\"com.eightplus.activity.subactivity.in.process\"); startActivity(intent); &#125; else if(v.equals(startInNewProcessButton)) &#123; Intent intent = new Intent(\"com.eightplus.activity.subactivity.in.new.process\"); startActivity(intent); &#125; &#125; &#125; SubActivityInProcess.java 1234567891011121314151617181920212223242526272829303132package com.eightplus.activity; import android.app.Activity; import android.os.Bundle; import android.util.Log; import android.view.View; import android.view.View.OnClickListener; import android.widget.Button; public class SubActivityInProcess extends Activity implements OnClickListener &#123; private final static String LOG_TAG = \"com.eightplus.activity.SubActivityInProcess\"; private Button finishButton = null; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.sub); finishButton = (Button)findViewById(R.id.button_finish); finishButton.setOnClickListener(this); Log.i(LOG_TAG, \"Sub Activity In Process Created.\"); &#125; @Override public void onClick(View v) &#123; if(v.equals(finishButton)) &#123; finish(); &#125; &#125; &#125; SubActivityInNewProcess.java 1234567891011121314151617181920212223242526272829303132package com.eightplus.activity; import android.app.Activity; import android.os.Bundle; import android.util.Log; import android.view.View; import android.view.View.OnClickListener; import android.widget.Button; public class SubActivityInNewProcess extends Activity implements OnClickListener &#123; private final static String LOG_TAG = \"com.eightplus.activity.SubActivityInNewProcess\"; private Button finishButton = null; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.sub); finishButton = (Button)findViewById(R.id.button_finish); finishButton.setOnClickListener(this); Log.i(LOG_TAG, \"Sub Activity In New Process Created.\"); &#125; @Override public void onClick(View v) &#123; if(v.equals(finishButton)) &#123; finish(); &#125; &#125; &#125; main.xml 123456789101112131415161718192021&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:orientation=\"vertical\" android:layout_width=\"fill_parent\" android:layout_height=\"fill_parent\" android:gravity=\"center\"&gt; &lt;Button android:id=\"@+id/button_start_in_process\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/start_in_process\" &gt; &lt;/Button&gt; &lt;Button android:id=\"@+id/button_start_in_new_process\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/start_in_new_process\" &gt; &lt;/Button&gt;&lt;/LinearLayout&gt; sub.xml 1234567891011121314&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:orientation=\"vertical\" android:layout_width=\"fill_parent\" android:layout_height=\"fill_parent\" android:gravity=\"center\"&gt; &lt;Button android:id=\"@+id/button_finish\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/finish\" &gt; &lt;/Button&gt;&lt;/LinearLayout&gt; strings.xml 12345678&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;resources&gt; &lt;string name=\"app_name\"&gt;Activity&lt;/string&gt; &lt;string name=\"sub_activity\"&gt;Sub Activity&lt;/string&gt; &lt;string name=\"start_in_process\"&gt;Start sub-activity in process&lt;/string&gt; &lt;string name=\"start_in_new_process\"&gt;Start sub-activity in new process&lt;/string&gt; &lt;string name=\"finish\"&gt;Finish activity&lt;/string&gt;&lt;/resources&gt; icon.pngä¸ºåº”ç”¨ç¨‹åºçš„å›¾æ ‡ AndroidMainifest.xml 1234567891011121314151617181920212223242526272829303132&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.eightplus.activity\" android:versionCode=\"1\" android:versionName=\"1.0\"&gt; &lt;application android:icon=\"@drawable/icon\" android:label=\"@string/app_name\"&gt; &lt;activity android:name=\".MainActivity\" android:label=\"@string/app_name\" android:process=\"com.eightplus.activity.mainprocess\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.MAIN\" /&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;activity android:label=\"@string/sub_activity\" android:name=\".SubActivityInProcess\" android:process=\"com.eightplus.activity.mainprocess\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"com.eightplus.activity.subactivity.in.process\"/&gt; &lt;category android:name=\"android.intent.category.DEFAULT\"/&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;activity android:label=\"@string/sub_activity\" android:name=\".SubActivityInNewProcess\" android:process=\"com.eightplus.activity.newprocess\"&gt; &lt;intent-filter&gt; &lt;action android:name=\"com.eightplus.activity.subactivity.in.new.process\"/&gt; &lt;category android:name=\"android.intent.category.DEFAULT\"/&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;/application&gt;&lt;/manifest&gt; Android.mk 123456LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_SRC_FILES := $(call all-subdir-java-files)LOCAL_PACKAGE_NAME := Activityinclude $(BUILD_PACKAGE) ç¼–è¯‘å’Œæ‰“åŒ… ~/Android$ mmm packages/experimental/Activity ~/Android$ make snod å¯åŠ¨æ¨¡æ‹Ÿå™¨ ~/Android$ emulator Serviceç»„ä»¶åº”ç”¨å®ä¾‹è¯¥å®ä¾‹ç”±ä¸€ä¸ªServiceç»„ä»¶CounterServiceå’Œä¸€ä¸ªActivityç»„ä»¶Counterç»„æˆã€‚CounterServiceç»„ä»¶å®ç°äº†ä¸€ä¸ªè®¡æ•°å™¨æœåŠ¡ï¼Œå®ƒæ˜¯ç”±Counterç»„ä»¶å¯åŠ¨èµ·æ¥çš„ï¼Œå¹¶ä¸”ä¸Counterç»„ä»¶ç»‘å®šåœ¨ä¸€èµ·ã€‚CounterServiceç»„ä»¶åœ¨å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡(AsyncTask)æ¥å®ç°ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯éš”ä¸€ç§’å°±å°†å†…éƒ¨çš„è®¡æ•°åŠ 1,å¹¶ä¸”å®æ—¶åœ°å°†è¿™ä¸ªè®¡æ•°æ˜¾ç¤ºåœ¨Counterç»„ä»¶çš„ç”¨æˆ·ç•Œé¢ä¸Šã€‚ç”±äºè®¡æ•°å™¨éœ€è¦ä¸åœåœ°æ‰§è¡ŒåŠ æ•°åŠŸèƒ½ï¼Œæ‰€ä»¥è¿™é‡Œå°†å®ƒæ”¾åœ¨ä¸€ä¸ªåå°ç¨‹åºä¸­è¿è¡Œï¼Œé¿å…Counterç»„ä»¶ä¸èƒ½åŠæ—¶åœ°å“åº”ç”¨æˆ·ç•Œé¢äº‹ä»¶ã€‚ ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 1234567891011121314151617~/Android/packages/experimental/Counter----AndroidMainifest.xml----Android.mk----src ----com/eightplus/counter ----ICounterCallback.java ----ICounterService.java ----CounterService.java ----Counter.java----res ----layout ----main.xml ----sub.xml ----values ----strings.xml ----drawable ----icon.png ICounterCallback.java 12345package com.eightplus.counterpublicd interface ICounterCallback &#123; void count(int val);&#125; ICounterService.java 123456package com.eightplus.counterpublicd interface ICounterService &#123; public void startCounter(int initVal, ICounterCallback callback); public void stopCounter();&#125; CounterService.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273package com.eightplus.counterimport android.app.Service;import android.content.Intent;import android.os.AsyncTask;import android.os.Binder;import android.os.IBinder;import android.util.Log;public class CounterService extends Service implements ICounterService &#123; private final static String LOG_TAG = \"com.eightplus.activity.CounterService\"; private bool stop = false; private ICounterCallback counterCallback = null; private final IBinder binder = new CounterBinder(); public class CounterBinder extends Binder &#123; public CounterService getService() &#123; return CounterService.this; &#125; &#125; @Override public IBinder onBind(Intent intent) &#123; return binder; &#125; @Override public void onCreate() &#123; super.onCreate(); Log.i(LOG_TAG, \"Counter Service Created.\"); &#125; public void startCounter(int initVal, ICounterCallback callback) &#123; counterCallback = callback; AsyncTask&lt;Integer, Integer, Integer&gt; task = new AsyncTask&lt;Integer, Integer, Integer&gt;() &#123; @Override protected Integer doInBackground(Integer... vals) &#123; Integer initCounter = vals[0]; stop = false; while(!stop) &#123; publishProcess(initCounter); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; initCounter++; &#125; return initCounter; &#125; @Override protected void onProgressUpdate(Integer... values) &#123; super.onProgressUpdate(values); int val = values[0]; counterCallback.count(val); &#125; @Override protected void onPostExecute(Integer val) &#123; counterCallback.count(val); &#125; &#125;; task.execute(initVal); &#125; public void stopCounter() &#123; stop = true; &#125;&#125; Counter.java 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485package com.eightplus.counterimport android.app.Activity;import android.content.ComponentName;import android.content.Context;import android.content.Intent;import android.content.IntentFilter;import android.content.ServiceConnection;import android.os.Bundle;import android.os.IBinder;import android.util.Log;import android.view.View;import android.view.onClickListener;import android.widget.Button;import android.widget.TextView;public class Counter extends Activity implements OnClickListener, ICounterCallback &#123; private final static String LOG_TAG = \"com.eightplus.activity.Counter\"; private Button startButton = null; private Button stopButton = null; private TextView counterText = null; private ICounterService counterService = null; @Override public void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.main); startButton = (Button)findViewById(R.id.button_start); stopButton = (Button)findViewById(R.id.button_stop); counterText = (TextView)findViewById(R.id.textview_counter); startButton.setOnClickListener(this); stopButton.setOnClickListener(this); startButton.setEnabled(true); stopButton.setEnabled(false); Intent bindIntent = new Intent(Counter.this, CounterService.class); bindService(bindIntent, serviceConnection, Context.BIND_AUTO_CREATE); Log.i(LOG_TAG, \"Counter Activity Created.\"); &#125; @Override public void onDestroy() &#123; super.onDestory(); unbindService(serviceConnection); &#125; @Override public void onClick(View v) &#123; if(v.equals(startButton)) &#123; if (counterService != null) &#123; counterService.startCounter(0, this); startButton.setEnabled(false); stopButton.setEnabled(true); &#125; &#125; else if(v.equals(stopButton)) &#123; if (counterService != null) &#123; counterService.stopCounter(); startButton.setEnabled(true); stopButton.setEnabled(false); &#125; &#125; &#125; @Override public void count(int val) &#123; String text = String.valueOf(val); counterText.setText(text); &#125; private ServiceConnection serviceConnection = new ServiceConnection() &#123; public void onServiceConnected(ComponentName className, IBinder service) &#123; counterService = ((CounterService.CounterBinder)service).getService(); Log.i(LOG_TAG, \"Counter Service Connected\"); &#125; public void onServiceDisconnected(ComponentName className) &#123; counterService = null; Log.i(LOG_TAG, \"Counter Service DisConnected\"); &#125;&#125; main.xml 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\" android:orientation=\"vertical\" android:layout_width=\"fill_parent\" android:layout_height=\"fill_parent\" android:gravity=\"center\"&gt; &lt;LinearLayout android:layout_width=\"fill_parent\" android:layout_height=\"wrap_content\" android:layout_marginBottom=\"10px\" android:orientation=\"horizontal\" android:gravity=\"center\"&gt; &lt;TextView android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:layout_marginBottom=\"4px\" android:gravity=\"center\" android:text=\"@string/counter\"&gt; &lt;/TextView&gt; &lt;TextView android:id=\"@+id/textview_counter\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/init_counter\"&gt; &lt;/TextView&gt; &lt;/LinearLayout&gt; &lt;LinearLayout android:layout_width=\"fill_parent\" android:layout_height=\"wrap_content\" android:orientation=\"horizontal\" android:gravity=\"center\"&gt; &lt;Button android:id=\"@+id/button_start\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/start\"&gt; &lt;/Button&gt; &lt;Button android:id=\"@+id/button_stop\" android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\" android:gravity=\"center\" android:text=\"@string/stop\"&gt; &lt;/Button&gt; &lt;/LinearLayout&gt;&lt;/LinearLayout&gt; strings.xml 12345678&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;resources&gt; &lt;string name=\"app_name\"&gt;Counter&lt;/string&gt; &lt;string name=\"counter\"&gt;Counter:&lt;/string&gt; &lt;string name=\"init_counter\"&gt;0&lt;/string&gt; &lt;string name=\"start\"&gt;Start Counter&lt;/string&gt; &lt;string name=\"stop\"&gt;Stop Counter&lt;/string&gt;&lt;/resources&gt; icon.pngä¸ºåº”ç”¨ç¨‹åºçš„å›¾æ ‡ AndroidMainifest.xml 123456789101112131415161718&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" package=\"com.eightplus.counter\" android:versionCode=\"1\" android:versionName=\"1.0\"&gt; &lt;application android:icon=\"@drawable/icon\" android:label=\"@string/app_name\"&gt; &lt;activity android:name=\".Counter\" android:label=\"@string/app_name\" &lt;intent-filter&gt; &lt;action android:name=\"android.intent.action.MAIN\" /&gt; &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt; &lt;/intent-filter&gt; &lt;/activity&gt; &lt;service android:name=\".CounterService\" android:enabled=\"true\"&gt; &lt;/service&gt; &lt;/application&gt;&lt;/manifest&gt; Android.mk 123456LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_SRC_FILES := $(call all-subdir-java-files)LOCAL_PACKAGE_NAME := Counterinclude $(BUILD_PACKAGE) ç¼–è¯‘å’Œæ‰“åŒ… ~/Android$ mmm ./packages/experimental/Counter/ ~/Android$ make snod å¯åŠ¨æ¨¡æ‹Ÿå™¨ ~/Android$ emulator","categories":[{"name":"å®‰å“å¼€å‘","slug":"å®‰å“å¼€å‘","permalink":"https://eightplus.github.io/categories/å®‰å“å¼€å‘/"}],"tags":[{"name":"Android","slug":"Android","permalink":"https://eightplus.github.io/tags/Android/"}]},{"title":"åœ¨Androidæºç ä¸­ç¼–å†™Cç¨‹åºæµ‹è¯•Linuxå†…æ ¸é©±åŠ¨ç¨‹åº","slug":"2018-08-06-test-android-kernel-driver-program","date":"2018-08-06T14:33:11.000Z","updated":"2019-11-14T01:55:26.627Z","comments":true,"path":"2018/08/06/2018-08-06-test-android-kernel-driver-program/","link":"","permalink":"https://eightplus.github.io/2018/08/06/2018-08-06-test-android-kernel-driver-program/","excerpt":"","text":"åœ¨mydevçš„Linuxå†…æ ¸é©±åŠ¨ç¨‹åºä¸­ï¼Œåˆ›å»ºä¸‰ä¸ªä¸åŒçš„æ–‡ä»¶èŠ‚ç‚¹æ¥ä¾›ç”¨æˆ·ç©ºé—´è®¿é—®ï¼Œåˆ†åˆ«æ˜¯ä¼ ç»Ÿçš„è®¾å¤‡æ–‡ä»¶/dev/mydevã€procç³»ç»Ÿæ–‡ä»¶/proc/mydevå’Œdevfsç³»ç»Ÿå±æ€§æ–‡ä»¶/sys/class/mydev/mydev/valã€‚è¿™é‡Œé€šè¿‡ç¼–å†™çš„Cå¯æ‰§è¡Œç¨‹åºæ¥è®¿é—®è®¾å¤‡æ–‡ä»¶/dev/mydevã€‚ é©±åŠ¨ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 12345~/Android----external ----mydev ----mydev.c ----Android.mk ä½¿ç”¨Androidæ¨¡æ‹Ÿå™¨åŠ è½½åŒ…å«è¿™ä¸ªLinuxé©±åŠ¨ç¨‹åºçš„å†…æ ¸æ–‡ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨adb shellå‘½ä»¤è¿æ¥ä¸Šæ¨¡æ‹Ÿï¼ŒéªŒè¯åœ¨/devç›®å½•ä¸­å­˜åœ¨è®¾å¤‡æ–‡ä»¶mydevã€‚ è¿›å…¥åˆ°Androidæºä»£ç å·¥ç¨‹çš„externalç›®å½•ï¼Œåˆ›å»ºmydevç›®å½• ~/Android$ cd external ~/Android/external$ mkdir mydev åœ¨mydevç›®å½•ä¸­æ–°å»ºmydev.cæ–‡ä»¶ æ‰“å¼€/dev/mydevæ–‡ä»¶ï¼Œç„¶åå…ˆè¯»å‡º/dev/mydevæ–‡ä»¶ä¸­çš„å€¼ï¼Œæ¥ç€å†™å…¥å€¼5åˆ°/dev/mydevä¸­å»ï¼Œæœ€åå†æ¬¡è¯»å‡º/dev/mydevæ–‡ä»¶ä¸­çš„å€¼ï¼Œçœ‹çœ‹æ˜¯å¦æ˜¯æˆ‘ä»¬åˆšæ‰å†™å…¥çš„å€¼5ã€‚ä»/dev/mydevæ–‡ä»¶è¯»å†™çš„å€¼å®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬è™šæ‹Ÿçš„ç¡¬ä»¶çš„å¯„å­˜å™¨valçš„å€¼ã€‚ 12345678910111213141516171819202122232425262728293031#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;fcntl.h&gt;#define DEVICE_NAME \"/dev/mydev\"int main(int argc, char** argv)&#123; int fd = -1; int val = 0; fd = open(DEVICE_NAME, O_RDWR); if(fd == -1) &#123; printf(\"Failed to open device %s.\\n\", DEVICE_NAME); return -1; &#125; printf(\"Read original value:\\n\"); read(fd, &amp;val, sizeof(val)); printf(\"%d.\\n\\n\", val); val = 5; printf(\"Write value %d to %s.\\n\\n\", val, DEVICE_NAME); write(fd, &amp;val, sizeof(val)); printf(\"Read the value again:\\n\"); read(fd, &amp;val, sizeof(val)); printf(\"%d.\\n\\n\", val); close(fd); return 0;&#125; åœ¨mydevç›®å½•ä¸­æ–°å»ºAndroid.mkæ–‡ä»¶ï¼Œå…¶ä¸­â€œBUILD_EXECUTABLEâ€è¡¨ç¤ºç¼–è¯‘çš„æ˜¯å¯æ‰§è¡Œç¨‹åº 123456LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE_TAGS := optionalLOCAL_MODULE := mydevLOCAL_SRC_FILES := $(call all-subdir-c-files)include $(BUILD_EXECUTABLE) ä½¿ç”¨mmmå‘½ä»¤è¿›è¡Œç¼–è¯‘ ~/Android$ mmm ./external/mydevè‹¥ç¼–è¯‘æˆåŠŸï¼Œåˆ™å¯ä»¥åœ¨out/target/product/gerneric/system/binç›®å½•ä¸‹çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶mydevã€‚ é‡æ–°æ‰“åŒ…Androidç³»ç»Ÿæ–‡ä»¶system.imgï¼Œé‡æ–°æ‰“åŒ…åçš„system.imgæ–‡ä»¶åŒ…å«äº†åˆšæ‰ç¼–è¯‘å¥½çš„mydevå¯æ‰§è¡Œæ–‡ä»¶ã€‚ ~/Android$ make snod è¿è¡Œæ¨¡æ‹Ÿå™¨ï¼Œä½¿ç”¨/system/bin/mydevå¯æ‰§è¡Œç¨‹åºæ¥è®¿é—®Linuxå†…æ ¸é©±åŠ¨ç¨‹åº ~/Android$ emulator -kernel ./kernel/goldfish/arch/arm/boot/zImage &amp; ~/Android$ adb shell root@android:/ # cd system/bin root@android:/system/bin # ./mydev12345Read the original value:0.Write value 5 to /dev/mydev.Read the value again:5.","categories":[{"name":"å®‰å“å¼€å‘","slug":"å®‰å“å¼€å‘","permalink":"https://eightplus.github.io/categories/å®‰å“å¼€å‘/"}],"tags":[{"name":"Android","slug":"Android","permalink":"https://eightplus.github.io/tags/Android/"}]},{"title":"ä¸ºAndroidç³»ç»Ÿç¼–å†™Linuxå†…æ ¸é©±åŠ¨ç¨‹åº","slug":"2018-08-02-android-kernel-driver","date":"2018-08-02T01:04:36.000Z","updated":"2019-11-14T01:56:04.235Z","comments":true,"path":"2018/08/02/2018-08-02-android-kernel-driver/","link":"","permalink":"https://eightplus.github.io/2018/08/02/2018-08-02-android-kernel-driver/","excerpt":"","text":"è¿™é‡Œä½¿ç”¨ä¸€ä¸ªè™šæ‹Ÿçš„ç¡¬ä»¶è®¾å¤‡ï¼Œè¿™ä¸ªè®¾å¤‡åªæœ‰ä¸€ä¸ª4å­—èŠ‚çš„å¯„å­˜å™¨ï¼Œå®ƒå¯è¯»å¯å†™ã€‚è¿™é‡ŒæŠŠè¿™ä¸ªè™šæ‹Ÿçš„è®¾å¤‡å‘½åä¸ºâ€œmydevâ€ï¼Œè€Œè¿™ä¸ªå†…æ ¸é©±åŠ¨ç¨‹åºä¹Ÿå‘½åä¸ºmydevé©±åŠ¨ç¨‹åºã€‚è¿™é‡Œé€šè¿‡catå‘½ä»¤ç›´æ¥è®¿é—®/proc/mydevå’Œ/sys/class/mydev/mydev/valæ–‡ä»¶éªŒè¯é©±åŠ¨ç¨‹åºçš„æ­£ç¡®æ€§ã€‚ é©±åŠ¨ç¨‹åºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 1234567~/Android/kernel/goldfish----drivers ----mydev ----mydev.h ----mydev.c ----Kconfig ----Makefile æ–°å»ºmydevç›®å½• ~/Android$ cd kernel/goldfish/drivers ~/Android/kernel/goldfish/drivers$ mkdir mydev åœ¨mydevç›®å½•ä¸­å¢åŠ mydev.hæ–‡ä»¶ 123456789101112131415161718#ifndef _MYDEV_ANDROID_H_#define _MYDEV_ANDROID_Hpp#include &lt;linux/cdev.h&gt;#include &lt;linux/semaphore.h&gt;#define MYDEV_DEVICE_NODE_NAME \"helmydevlo\"#define MYDEV_DEVICE_FILE_NAME \"mydev\"#define MYDEV_DEVICE_PROC_NAME \"mydev\"#define MYDEV_DEVICE_CLASS_NAME \"mydev\"//å­—ç¬¦è®¾å¤‡ç»“æ„ä½“struct mydev_android_dev &#123; int val;//å¯„å­˜å™¨ struct semaphore sem;//ä¿¡å·é‡ struct cdev dev;//å†…åµŒçš„å­—ç¬¦è®¾å¤‡&#125;;#endif åœ¨mydevç›®å½•ä¸­å¢åŠ mydev.cæ–‡ä»¶ï¼Œè¿™æ˜¯é©±åŠ¨ç¨‹åºçš„å®ç°éƒ¨åˆ†ã€‚é©±åŠ¨ç¨‹åºçš„åŠŸèƒ½ä¸»è¦æ˜¯å‘ä¸Šå±‚æä¾›è®¿é—®è®¾å¤‡çš„å¯„å­˜å™¨çš„å€¼ï¼ŒåŒ…æ‹¬è¯»å’Œå†™ã€‚è¿™é‡Œï¼Œæä¾›äº†ä¸‰ç§è®¿é—®è®¾å¤‡å¯„å­˜å™¨çš„æ–¹æ³•ï¼Œä¸€æ˜¯é€šè¿‡procæ–‡ä»¶ç³»ç»Ÿæ¥è®¿é—®ï¼ŒäºŒæ˜¯é€šè¿‡ä¼ ç»Ÿçš„è®¾å¤‡æ–‡ä»¶çš„æ–¹æ³•æ¥è®¿é—®ï¼Œä¸‰æ˜¯é€šè¿‡devfsæ–‡ä»¶ç³»ç»Ÿæ¥è®¿é—®ã€‚ä¸‹é¢åˆ†æ®µæè¿°è¯¥é©±åŠ¨ç¨‹åºçš„å®ç°ã€‚ é¦–å…ˆæ˜¯åŒ…å«å¿…è¦çš„å¤´æ–‡ä»¶å’Œå®šä¹‰ä¸‰ç§è®¿é—®è®¾å¤‡çš„æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359#include &lt;linux/init.h&gt;#include &lt;linux/module.h&gt;#include &lt;linux/types.h&gt;#include &lt;linux/fs.h&gt;#include &lt;linux/proc_fs.h&gt;#include &lt;linux/device.h&gt;#include &lt;asm/uaccess.h&gt;#include \"mydev.h\"/*ä¸»è®¾å¤‡å’Œä»è®¾å¤‡å·å˜é‡*/static int mydev_major = 0;static int mydev_minor = 0;/*è®¾å¤‡ç±»åˆ«å’Œè®¾å¤‡å˜é‡*/static struct class* mydev_class = NULL;static struct mydev_android_dev* mydev_dev = NULL;/*ä¼ ç»Ÿçš„è®¾å¤‡æ–‡ä»¶æ“ä½œæ–¹æ³•*/static int mydev_open(struct inode* inode, struct file* filp);static int mydev_release(struct inode* inode, struct file* filp);static ssize_t mydev_read(struct file* filp, char __user *buf, size_t count, loff_t* f_pos);static ssize_t mydev_write(struct file* filp, const char __user *buf, size_t count, loff_t* f_pos);/**ä¼ ç»Ÿçš„è®¾å¤‡æ–‡ä»¶æ“ä½œæ–¹æ³•è¡¨*/static struct file_operations mydev_fops = &#123; .owner = THIS_MODULE, .open = mydev_open, .release = mydev_release, .read = mydev_read, .write = mydev_write,&#125;;/*devfsæ–‡ä»¶ç³»ç»Ÿçš„è®¾å¤‡å±æ€§æ“ä½œæ–¹æ³•*/static ssize_t mydev_val_show(struct device* dev, struct device_attribute* attr, char* buf);static ssize_t mydev_val_store(struct device* dev, struct device_attribute* attr, const char* buf, size_t count);/*devfsæ–‡ä»¶ç³»ç»Ÿçš„è®¾å¤‡å±æ€§*/static DEVICE_ATTR(val, S_IRUGO | S_IWUSR, mydev_val_show, mydev_val_store);//å®šä¹‰ä¼ ç»Ÿçš„è®¾å¤‡æ–‡ä»¶è®¿é—®æ–¹æ³•ï¼Œä¸»è¦æ˜¯å®šä¹‰mydev_openã€mydev_releaseã€mydev_readå’Œmydev_writeè¿™å››ä¸ªæ‰“å¼€ã€é‡Šæ”¾ã€è¯»å’Œå†™è®¾å¤‡æ–‡ä»¶çš„æ–¹æ³•ï¼š/*æ‰“å¼€è®¾å¤‡æ–¹æ³•*/static int mydev_open(struct inode* inode, struct file* filp) &#123; struct mydev_android_dev* dev; /*å°†è‡ªå®šä¹‰è®¾å¤‡ç»“æ„ä½“ä¿å­˜åœ¨æ–‡ä»¶æŒ‡é’ˆçš„ç§æœ‰æ•°æ®åŸŸä¸­ï¼Œä»¥ä¾¿è®¿é—®è®¾å¤‡æ—¶æ‹¿æ¥ç”¨*/ dev = container_of(inode-&gt;i_cdev, struct mydev_android_dev, dev); filp-&gt;private_data = dev; return 0;&#125;/*è®¾å¤‡æ–‡ä»¶é‡Šæ”¾æ—¶è°ƒç”¨ï¼Œç©ºå®ç°*/static int mydev_release(struct inode* inode, struct file* filp) &#123; return 0;&#125;/*è¯»å–è®¾å¤‡çš„å¯„å­˜å™¨valçš„å€¼*/static ssize_t mydev_read(struct file* filp, char __user *buf, size_t count, loff_t* f_pos) &#123; ssize_t err = 0; struct mydev_android_dev* dev = filp-&gt;private_data; /*åŒæ­¥è®¿é—®*/ if(down_interruptible(&amp;(dev-&gt;sem))) &#123; return -ERESTARTSYS; &#125; if(count &lt; sizeof(dev-&gt;val)) &#123; goto out; &#125; /*å°†å¯„å­˜å™¨valçš„å€¼æ‹·è´åˆ°ç”¨æˆ·æä¾›çš„ç¼“å†²åŒº*/ if(copy_to_user(buf, &amp;(dev-&gt;val), sizeof(dev-&gt;val))) &#123; err = -EFAULT; goto out; &#125; err = sizeof(dev-&gt;val);out: up(&amp;(dev-&gt;sem)); return err;&#125;/*å†™è®¾å¤‡çš„å¯„å­˜å™¨å€¼val*/static ssize_t mydev_write(struct file* filp, const char __user *buf, size_t count, loff_t* f_pos) &#123; struct mydev_android_dev* dev = filp-&gt;private_data; ssize_t err = 0; /*åŒæ­¥è®¿é—®*/ if(down_interruptible(&amp;(dev-&gt;sem))) &#123; return -ERESTARTSYS; &#125; if(count != sizeof(dev-&gt;val)) &#123; goto out; &#125; /*å°†ç”¨æˆ·æä¾›çš„ç¼“å†²åŒºçš„å€¼å†™åˆ°è®¾å¤‡å¯„å­˜å™¨å»*/ if(copy_from_user(&amp;(dev-&gt;val), buf, count)) &#123; err = -EFAULT; goto out; &#125; err = sizeof(dev-&gt;val);out: up(&amp;(dev-&gt;sem)); return err;&#125;//å®šä¹‰é€šè¿‡devfsæ–‡ä»¶ç³»ç»Ÿè®¿é—®æ–¹æ³•ï¼Œè¿™é‡ŒæŠŠè®¾å¤‡çš„å¯„å­˜å™¨valçœ‹æˆæ˜¯è®¾å¤‡çš„ä¸€ä¸ªå±æ€§ï¼Œé€šè¿‡è¯»å†™è¿™ä¸ªå±æ€§æ¥å¯¹è®¾å¤‡è¿›è¡Œè®¿é—®ï¼Œä¸»è¦æ˜¯å®ç°mydev_val_showå’Œmydev_val_storeä¸¤ä¸ªæ–¹æ³•ï¼ŒåŒæ—¶å®šä¹‰äº†ä¸¤ä¸ªå†…éƒ¨ä½¿ç”¨çš„è®¿é—®valå€¼çš„æ–¹æ³•__mydev_get_valå’Œ__mydev_set_valï¼š/*è¯»å–å¯„å­˜å™¨valçš„å€¼åˆ°ç¼“å†²åŒºbufä¸­ï¼Œå†…éƒ¨ä½¿ç”¨*/static ssize_t __mydev_get_val(struct mydev_android_dev* dev, char* buf) &#123; int val = 0; /*åŒæ­¥è®¿é—®*/ if(down_interruptible(&amp;(dev-&gt;sem))) &#123; return -ERESTARTSYS; &#125; val = dev-&gt;val; up(&amp;(dev-&gt;sem)); return snprintf(buf, PAGE_SIZE, \"%d\\n\", val);&#125;/*æŠŠç¼“å†²åŒºbufçš„å€¼å†™åˆ°è®¾å¤‡å¯„å­˜å™¨valä¸­å»ï¼Œå†…éƒ¨ä½¿ç”¨*/static ssize_t __mydev_set_val(struct mydev_android_dev* dev, const char* buf, size_t count) &#123; int val = 0; /*å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—*/ val = simple_strtol(buf, NULL, 10); /*åŒæ­¥è®¿é—®*/ if(down_interruptible(&amp;(dev-&gt;sem))) &#123; return -ERESTARTSYS; &#125; dev-&gt;val = val; up(&amp;(dev-&gt;sem)); return count;&#125;/*è¯»å–è®¾å¤‡å±æ€§val*/static ssize_t mydev_val_show(struct device* dev, struct device_attribute* attr, char* buf) &#123; struct mydev_android_dev* hdev = (struct mydev_android_dev*)dev_get_drvdata(dev); return __mydev_get_val(hdev, buf);&#125;/*å†™è®¾å¤‡å±æ€§val*/static ssize_t mydev_val_store(struct device* dev, struct device_attribute* attr, const char* buf, size_t count) &#123; struct mydev_android_dev* hdev = (struct mydev_android_dev*)dev_get_drvdata(dev); return __mydev_set_val(hdev, buf, count);&#125;//å®šä¹‰é€šè¿‡procæ–‡ä»¶ç³»ç»Ÿè®¿é—®æ–¹æ³•ï¼Œä¸»è¦å®ç°äº†mydev_proc_readå’Œmydev_proc_writeä¸¤ä¸ªæ–¹æ³•ï¼ŒåŒæ—¶å®šä¹‰äº†åœ¨procæ–‡ä»¶ç³»ç»Ÿåˆ›å»ºå’Œåˆ é™¤æ–‡ä»¶çš„æ–¹æ³•mydev_create_procå’Œmydev_remove_procï¼š/*è¯»å–è®¾å¤‡å¯„å­˜å™¨valçš„å€¼ï¼Œä¿å­˜åœ¨pageç¼“å†²åŒºä¸­*/static ssize_t mydev_proc_read(char* page, char** start, off_t off, int count, int* eof, void* data) &#123; if(off &gt; 0) &#123; *eof = 1; return 0; &#125; return __mydev_get_val(mydev_dev, page);&#125;/*æŠŠç¼“å†²åŒºçš„å€¼buffä¿å­˜åˆ°è®¾å¤‡å¯„å­˜å™¨valä¸­å»*/static ssize_t mydev_proc_write(struct file* filp, const char __user *buff, unsigned long len, void* data) &#123; int err = 0; char* page = NULL; if(len &gt; PAGE_SIZE) &#123; printk(KERN_ALERT\"The buff is too large: %lu.\\n\", len); return -EFAULT; &#125; page = (char*)__get_free_page(GFP_KERNEL); if(!page) &#123; printk(KERN_ALERT\"Failed to alloc page.\\n\"); return -ENOMEM; &#125; /*å…ˆæŠŠç”¨æˆ·æä¾›çš„ç¼“å†²åŒºå€¼æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºä¸­å»*/ if(copy_from_user(page, buff, len)) &#123; printk(KERN_ALERT\"Failed to copy buff from user.\\n\"); err = -EFAULT; goto out; &#125; err = __mydev_set_val(mydev_dev, page, len);out: free_page((unsigned long)page); return err;&#125;/*åˆ›å»º/proc/mydevæ–‡ä»¶*/static void mydev_create_proc(void) &#123; struct proc_dir_entry* entry; entry = create_proc_entry(MYDEV_DEVICE_PROC_NAME, 0, NULL); if(entry) &#123; entry-&gt;owner = THIS_MODULE; entry-&gt;read_proc = mydev_proc_read; entry-&gt;write_proc = mydev_proc_write; &#125;&#125;/*åˆ é™¤/proc/mydevæ–‡ä»¶*/static void mydev_remove_proc(void) &#123; remove_proc_entry(MYDEV_DEVICE_PROC_NAME, NULL);&#125;//æœ€åï¼Œå®šä¹‰æ¨¡å—åŠ è½½å’Œå¸è½½æ–¹æ³•ï¼Œè¿™é‡Œåªè¦æ˜¯æ‰§è¡Œè®¾å¤‡æ³¨å†Œå’Œåˆå§‹åŒ–æ“ä½œï¼š/*åˆå§‹åŒ–è®¾å¤‡*/static int __mydev_setup_dev(struct mydev_android_dev* dev) &#123; int err; dev_t devno = MKDEV(mydev_major, mydev_minor); memset(dev, 0, sizeof(struct mydev_android_dev)); cdev_init(&amp;(dev-&gt;dev), &amp;mydev_fops); dev-&gt;dev.owner = THIS_MODULE; dev-&gt;dev.ops = &amp;mydev_fops; /*æ³¨å†Œå­—ç¬¦è®¾å¤‡*/ err = cdev_add(&amp;(dev-&gt;dev),devno, 1); if(err) &#123; return err; &#125; /*åˆå§‹åŒ–ä¿¡å·é‡å’Œå¯„å­˜å™¨valçš„å€¼*/ init_MUTEX(&amp;(dev-&gt;sem)); dev-&gt;val = 0; return 0;&#125;/*æ¨¡å—åŠ è½½æ–¹æ³•*/static int __init mydev_init(void)&#123; int err = -1; dev_t dev = 0; struct device* temp = NULL; printk(KERN_ALERT\"Initializing mydev device.\\n\"); /*åŠ¨æ€åˆ†é…ä¸»è®¾å¤‡å’Œä»è®¾å¤‡å·*/ err = alloc_chrdev_region(&amp;dev, 0, 1, MYDEV_DEVICE_NODE_NAME); if(err &lt; 0) &#123; printk(KERN_ALERT\"Failed to alloc char dev region.\\n\"); goto fail; &#125; mydev_major = MAJOR(dev); mydev_minor = MINOR(dev); /*åˆ†é…heloè®¾å¤‡ç»“æ„ä½“å˜é‡*/ mydev_dev = kmalloc(sizeof(struct mydev_android_dev), GFP_KERNEL); if(!mydev_dev) &#123; err = -ENOMEM; printk(KERN_ALERT\"Failed to alloc mydev_dev.\\n\"); goto unregister; &#125; /*åˆå§‹åŒ–è®¾å¤‡*/ err = __mydev_setup_dev(mydev_dev); if(err) &#123; printk(KERN_ALERT\"Failed to setup dev: %d.\\n\", err); goto cleanup; &#125; /*åœ¨/sys/class/ç›®å½•ä¸‹åˆ›å»ºè®¾å¤‡ç±»åˆ«ç›®å½•mydev*/ mydev_class = class_create(THIS_MODULE, MYDEV_DEVICE_CLASS_NAME); if(IS_ERR(mydev_class)) &#123; err = PTR_ERR(mydev_class); printk(KERN_ALERT\"Failed to create mydev class.\\n\"); goto destroy_cdev; &#125; /*åœ¨/dev/ç›®å½•å’Œ/sys/class/mydevç›®å½•ä¸‹åˆ†åˆ«åˆ›å»ºè®¾å¤‡æ–‡ä»¶mydev*/ temp = device_create(mydev_class, NULL, dev, \"%s\", MYDEV_DEVICE_FILE_NAME); if(IS_ERR(temp)) &#123; err = PTR_ERR(temp); printk(KERN_ALERT\"Failed to create mydev device.\"); goto destroy_class; &#125; /*åœ¨/sys/class/mydev/mydevç›®å½•ä¸‹åˆ›å»ºå±æ€§æ–‡ä»¶val*/ err = device_create_file(temp, &amp;dev_attr_val); if(err &lt; 0) &#123; printk(KERN_ALERT\"Failed to create attribute val.\"); goto destroy_device; &#125; dev_set_drvdata(temp, mydev_dev); /*åˆ›å»º/proc/mydevæ–‡ä»¶*/ mydev_create_proc(); printk(KERN_ALERT\"Succedded to initialize mydev device.\\n\"); return 0;destroy_device: device_destroy(mydev_class, dev);destroy_class: class_destroy(mydev_class);destroy_cdev: cdev_del(&amp;(mydev_dev-&gt;dev));cleanup: kfree(mydev_dev);unregister: unregister_chrdev_region(MKDEV(mydev_major, mydev_minor), 1);fail: return err;&#125;/*æ¨¡å—å¸è½½æ–¹æ³•*/static void __exit mydev_exit(void) &#123; dev_t devno = MKDEV(mydev_major, mydev_minor); printk(KERN_ALERT\"Destroy mydev device.\\n\"); /*åˆ é™¤/proc/mydevæ–‡ä»¶*/ mydev_remove_proc(); /*é”€æ¯è®¾å¤‡ç±»åˆ«å’Œè®¾å¤‡*/ if(mydev_class) &#123; device_destroy(mydev_class, MKDEV(mydev_major, mydev_minor)); class_destroy(mydev_class); &#125; /*åˆ é™¤å­—ç¬¦è®¾å¤‡å’Œé‡Šæ”¾è®¾å¤‡å†…å­˜*/ if(mydev_dev) &#123; cdev_del(&amp;(mydev_dev-&gt;dev)); kfree(mydev_dev); &#125; /*é‡Šæ”¾è®¾å¤‡å·*/ unregister_chrdev_region(devno, 1);&#125;MODULE_LICENSE(\"GPL\");MODULE_DESCRIPTION(\"Fake Register Android Driver\");module_init(mydev_init);module_exit(mydev_exit); åœ¨mydevç›®å½•ä¸­æ–°å¢Kconfigå’ŒMakefileä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­Kconfigæ˜¯åœ¨ç¼–è¯‘å‰æ‰§è¡Œé…ç½®å‘½ä»¤make menuconfigæ—¶ç”¨åˆ°çš„ï¼Œè€ŒMakefileæ˜¯æ‰§è¡Œç¼–è¯‘å‘½ä»¤makeæ˜¯ç”¨åˆ°çš„ åœ¨Kconfigæ–‡ä»¶ä¸­ï¼Œtristateè¡¨ç¤ºç¼–è¯‘é€‰é¡¹MYDEVæ”¯æŒåœ¨ç¼–è¯‘å†…æ ¸æ—¶ï¼Œmydevæ¨¡å—æ”¯æŒä»¥æ¨¡å—ã€å†…å»ºå’Œä¸ç¼–è¯‘ä¸‰ç§ç¼–è¯‘æ–¹æ³•ï¼Œé»˜è®¤æ˜¯ä¸ç¼–è¯‘ï¼Œå› æ­¤ï¼Œåœ¨ç¼–è¯‘å†…æ ¸å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‰§è¡Œmake menuconfigå‘½ä»¤æ¥é…ç½®ç¼–è¯‘é€‰é¡¹ï¼Œä½¿å¾—mydevå¯ä»¥ä»¥æ¨¡å—æˆ–è€…å†…å»ºçš„æ–¹æ³•è¿›è¡Œç¼–è¯‘ã€‚åœ¨Makefileæ–‡ä»¶ä¸­ï¼Œæ ¹æ®é€‰é¡¹MYDEVçš„å€¼ï¼Œæ‰§è¡Œä¸åŒçš„ç¼–è¯‘æ–¹æ³•ã€‚ Kconfigæ–‡ä»¶çš„å†…å®¹(é»˜è®¤çš„ç¼–è¯‘æ–¹å¼ä¸ºnï¼Œå³ä¸ç¼–è¯‘åˆ°å†…æ ¸ä¸­ï¼Œæ•…åœ¨ç¼–è¯‘é©±åŠ¨ç¨‹åºä¹‹å‰ï¼Œéœ€è¦æ‰§è¡Œmake menuconfigå‘½ä»¤æ¥ä¿®æ”¹ç¼–è¯‘é€‰é¡¹)12345config MYDEV tristate &quot;Fake Register Android Driver&quot; default n help This is the mydev driver for android system. Makefile1obj-$(CONFIG_MYDEV) += mydev.o ä¿®æ”¹å†…æ ¸Kconfigæ–‡ä»¶ æ‰“å¼€arch/arm/Kconfigæ–‡ä»¶ï¼Œæ‰¾åˆ°ä»¥ä¸‹ä¸¤è¡Œå†…å®¹123menu &quot;Device Drivers&quot;......endmenu åœ¨è¿™ä¸¤è¡Œå†…å®¹ä¹‹é—´æ·»åŠ ä¸‹é¢ä¸€è¡Œå†…å®¹ï¼Œå°†é©±åŠ¨ç¨‹åºmydevå’ŒKconfigæ–‡ä»¶åŒ…å«å°½é‡ã€‚1234menu &quot;Device Drivers&quot;source &quot;drivers/mydev/Kconfig&quot;......endmenu è¿™æ ·ï¼Œæ‰§è¡Œmake menuconfigæ—¶ï¼Œå°±å¯ä»¥é…ç½®mydevæ¨¡å—çš„ç¼–è¯‘é€‰é¡¹äº†ã€‚ - æ‰“å¼€drivers/Kconfigï¼Œå’Œarch/arm/Kconfigä¸€æ ·ï¼Œå¢åŠ ä¸€è¡Œå†…å®¹ï¼šsource &quot;drivers/mydev/Kconfig&quot; ä¿®æ”¹drivers/Makefileæ–‡ä»¶ï¼Œæ·»åŠ ä¸€è¡Œï¼š 1obj-$(CONFIG_MYDEV) += mydev/ é…ç½®ç¼–è¯‘é€‰é¡¹ï¼š ~/Android/kernel/goldfish$ make menuconfigæ‰¾åˆ°â€Device Driversâ€ =&gt; â€œFake Register Android Driversâ€é€‰é¡¹ï¼Œè®¾ç½®ä¸ºyã€‚ æ³¨æ„ï¼Œå¦‚æœå†…æ ¸ä¸æ”¯æŒåŠ¨æ€åŠ è½½æ¨¡å—ï¼Œè¿™é‡Œä¸èƒ½é€‰æ‹©mï¼Œè™½ç„¶æˆ‘ä»¬åœ¨Kconfigæ–‡ä»¶ä¸­é…ç½®äº†MYDEVé€‰é¡¹ä¸ºtristateã€‚è¦æ”¯æŒåŠ¨æ€åŠ è½½æ¨¡å—é€‰é¡¹ï¼Œå¿…é¡»è¦åœ¨é…ç½®èœå•ä¸­é€‰æ‹©Enable loadable module supporté€‰é¡¹ï¼›åœ¨æ”¯æŒåŠ¨æ€å¸è½½æ¨¡å—é€‰é¡¹ï¼Œå¿…é¡»è¦åœ¨Enable loadable module supportèœå•é¡¹ä¸­ï¼Œé€‰æ‹©Module unloadingé€‰é¡¹ã€‚ ç¼–è¯‘ï¼š ~/Android/kernel/goldfish$ makeç¼–è¯‘æˆåŠŸåï¼Œå°±å¯ä»¥åœ¨mydevç›®å½•ä¸‹çœ‹åˆ°mydev.oæ–‡ä»¶äº†ï¼Œè¿™æ—¶å€™ç¼–è¯‘å‡ºæ¥çš„zImageå·²ç»åŒ…å«äº†mydevé©±åŠ¨ã€‚ è¿è¡Œæ–°ç¼–è¯‘çš„å†…æ ¸æ–‡ä»¶ï¼ŒéªŒè¯mydevé©±åŠ¨ç¨‹åºæ˜¯å¦å·²ç»æ­£å¸¸å®‰è£… ~/Android$ emulator -kernel ./kernel/goldfish/arch/arm/boot/zImage &amp; ~/Android$ adb shell è¿›å…¥åˆ°devç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°mydevè®¾å¤‡æ–‡ä»¶ root@android:/ # cd dev root@android:/dev # ls è¿›å…¥åˆ°procç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°mydevæ–‡ä»¶ï¼š root@android:/ # cd proc root@android:/proc # ls è®¿é—®mydevæ–‡ä»¶çš„å€¼ root@android:/proc # cat mydev0 root@android:/proc # echo â€˜5â€™ &gt; mydev root@android:/proc # cat mydev5 è¿›å…¥åˆ°sys/classç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°mydevç›®å½•ï¼š root@android:/ # cd sys/class root@android:/sys/class # ls è¿›å…¥åˆ°mydevç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°mydevç›®å½•ï¼š root@android:/sys/class # cd mydev root@android:/sys/class/mydev # ls è¿›å…¥åˆ°ä¸‹ä¸€å±‚mydevç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°valæ–‡ä»¶ root@android:/sys/class/mydev # cd mydev root@android:/sys/class/mydev/mydev # ls è®¿é—®å±æ€§æ–‡ä»¶valçš„å€¼ root@android:/sys/class/mydev/mydev # cat val5 root@android:/sys/class/mydev/mydev # echo â€˜0â€™ &gt; val root@android:/sys/class/mydev/mydev # cat val0 è‡³æ­¤ï¼Œmydevå†…æ ¸é©±åŠ¨ç¨‹åºå°±å®Œæˆäº†ã€‚è¿™é‡Œé‡‡ç”¨çš„æ˜¯ç³»ç»Ÿæä¾›çš„æ–¹æ³•å’Œé©±åŠ¨ç¨‹åºè¿›è¡Œäº¤äº’ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡procæ–‡ä»¶ç³»ç»Ÿå’Œdevfsæ–‡ä»¶ç³»ç»Ÿçš„æ–¹æ³•ã€‚","categories":[{"name":"å®‰å“å¼€å‘","slug":"å®‰å“å¼€å‘","permalink":"https://eightplus.github.io/categories/å®‰å“å¼€å‘/"}],"tags":[{"name":"Android","slug":"Android","permalink":"https://eightplus.github.io/tags/Android/"}]},{"title":"Hexo","slug":"2018-07-10-hexo","date":"2018-07-10T08:25:16.000Z","updated":"2018-07-31T09:54:19.214Z","comments":true,"path":"2018/07/10/2018-07-10-hexo/","link":"","permalink":"https://eightplus.github.io/2018/07/10/2018-07-10-hexo/","excerpt":"","text":"hexoæ˜¯ä¸€æ¬¾åŸºäºNode.jsçš„é™æ€åšå®¢æ¡†æ¶ï¼Œå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆé™æ€ç½‘é¡µæ‰˜ç®¡åœ¨githubä¸Šã€‚ ä¾èµ–åŒ…å’Œå·¥å…·å®‰è£… Git sudo apt-get install git (git-core) git --version ç”Ÿæˆ SSH key : ssh-keygen -t rsa -C &quot;349098792@qq.com&quot; é»˜è®¤æƒ…å†µä¸‹è¿ç»­æŒ‰ä¸‹ä¸‰ä¸ªå›è½¦ï¼Œç”Ÿæˆå¯†é’¥ï¼Œæœ€åå¾—åˆ°äº†ä¸¤ä¸ªæ–‡ä»¶ï¼šid_rsaå’Œid_rsa.pubã€‚å¦‚æœæ˜¯æƒ³ä¸€å°ç”µè„‘é…ç½®ä¸¤ä¸ªæˆ–å¤šä¸ªgithubå¸å·ï¼Œåˆ™æ­¤å¤„ä¸èƒ½å¤Ÿä¸€ç›´å›è½¦ï¼Œè¦æ³¨æ„åœ¨æç¤ºè¾“å…¥æ–‡ä»¶åç§°æ—¶è¾“å…¥ä¸€ä¸ªå’Œé»˜è®¤åç§°ä¸ä¸€æ ·çš„åç§°ï¼Œå¦åˆ™ä¼šå‘ç”Ÿè¦†ç›–ï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘ç”µè„‘ä¸Šä½¿ç”¨ä¸¤ä¸ªgithubå¸å·ï¼Œæ–°å»ºçš„ä¸€ä¸ªåä¸ºyudianrï¼Œåˆ™å¯ä»¥ç»™æ–‡ä»¶å–åå«id_rsa_yudianrï¼Œåˆ™ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆid_rsa_yudianrå’Œid_rsa_yudianr.pubä¸¤ä¸ªæ–‡ä»¶ã€‚åœ¨GitHubå¸å·è®¾ç½®é‚£é‡Œæ·»åŠ SSH Keyï¼Œæ‰“å¼€å…¬é’¥æ–‡ä»¶id_rsa_yudianr.pubï¼Œå¤åˆ¶é‡Œé¢çš„æ‰€æœ‰å­—ç¬¦ç²˜è´´åˆ°githubçš„SSHè®¾ç½®å¤„ï¼Œå¯ä½¿ç”¨ssh -T git@github.comæ¥æµ‹è¯•æ˜¯å¦å…³è”æˆåŠŸã€‚ - é…ç½®~/.ssh/configæ–‡ä»¶ 123456789101112131415161718192021222324 #è€å¸å· Host github.com HostName github.com PreferredAuthentications publickey IdentityFile ~/.ssh/id_rsa #æ–°å¸å· Host yudianr.github.com HostName github.com PreferredAuthentications publickey IdentityFile ~/.ssh/id_rsa_yudianræ³¨æ„ï¼šæ­¤æ—¶æäº¤ä»£ç ålogä¸­è®°å½•çš„ç”¨æˆ·åå’Œé‚®ç®±ä¿¡æ¯éƒ½ä¸ºå…¨å±€é…ç½®çš„gitå¸å·çš„ä¿¡æ¯ï¼Œå¦‚æœå¸Œæœ›ä¿®æ”¹æ˜¾ç¤ºçš„ä¿¡æ¯ï¼Œå¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œé…ç½®ï¼šgit config --global user.name &quot;ä½ çš„æ˜µç§°&quot;git config --global user.email &quot;ä½ çš„é‚®ç®±åœ°å€&quot;æˆ–è€…vim .gitconfigç›´æ¥è¿›è¡Œä¿®æ”¹[user] name = eightplus email = kobe24_lixiang@126.comæˆ–è€…[user] name = yudianr email = 349098792@qq.com npm sudo apt-get install npm npm -v Nodejs sudo apt-get install nodejs node -v Hexo sudo npm install -g hexo-cli hexo -v åˆå§‹åŒ–Hexo123hexo init &lt;folder&gt;cd &lt;folder&gt;npm install è‡ªåŠ¨éƒ¨ç½²å‘å¸ƒå·¥å…· hexo-deployer-git npm i hexo-generator-json-content â€“save (åœ¨ä¸Šé¢åˆå§‹åŒ–åçš„folderç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯æ‰§è¡Œï¼Œæ‰§è¡Œåä¼šå†™å…¥package.jsonæ–‡ä»¶ä¸­) å…¶ä»–æ’ä»¶å®‰è£… 123456npm i hexo-helper-qrcode --savenpm i hexo-generator-sitemap --savenpm i hexo-generator-json-feed --savenpm i hexo-generator-feed --savenpm i hexo-generator-baidu-sitemap --savenpm i hexo-deployer-rsync --save æäº¤æœç´ å¼•æ“ ç«™ç‚¹åœ°å›¾æ˜¯ä¸€ç§æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶åˆ—å‡ºæ‚¨ç½‘ç«™ä¸Šçš„ç½‘é¡µï¼Œä»è€Œå°†æ‚¨ç½‘ç«™å†…å®¹çš„ç»„ç»‡æ¶æ„å‘ŠçŸ¥Googleå’Œå…¶ä»–æœç´¢å¼•æ“ã€‚Googlebotç­‰æœç´¢å¼•æ“ç½‘é¡µæŠ“å–å·¥å…·ä¼šè¯»å–æ­¤æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´åŠ æ™ºèƒ½åœ°æŠ“å–æ‚¨çš„ç½‘ç«™ã€‚ç™¾åº¦ç«™é•¿å¹³å°ä¸ºæœªä½¿ç”¨ç™¾åº¦ç»Ÿè®¡çš„ç«™ç‚¹æä¾›ä¸‰ç§éªŒè¯æ–¹å¼ï¼šæ–‡ä»¶éªŒè¯ã€htmlæ ‡ç­¾éªŒè¯ã€CNAMEéªŒè¯ï¼Œå¦‚æœé€‰æ‹©æ–‡ä»¶éªŒè¯ï¼Œä¸‹è½½æ–‡ä»¶åå°†æ–‡ä»¶æ”¾åœ¨sourceè·Ÿç›®å½•ä¸‹ã€‚éªŒè¯å®Œæˆåï¼Œæˆ‘ä»¬å°†ä¼šè®¤ä¸ºæ‚¨æ˜¯ç½‘ç«™çš„æ‹¥æœ‰è€…ã€‚ä¸ºä½¿æ‚¨çš„ç½‘ç«™ä¸€ç›´ä¿æŒéªŒè¯é€šè¿‡çš„çŠ¶æ€ï¼Œè¯·ä¿ç•™éªŒè¯çš„æ–‡ä»¶ã€htmlæ ‡ç­¾æˆ–CNAMEè®°å½•ï¼Œæˆ‘ä»¬ä¼šå»å®šæœŸæ£€æŸ¥éªŒè¯è®°å½•ã€‚ å¯¹è°·æ­Œå’Œç™¾åº¦çš„æ’ä¸¾ä¾‹-&gt;æ‰“å¼€åšå®¢æ ¹ç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯æ‰§è¡Œæ‰§è¡Œå¦‚ä¸‹ä¸¤ä¸ªå®‰è£…æ’ä»¶ï¼šnpm install hexo-generator-sitemap --savenpm install hexo-generator-baidu-sitemap --save åœ¨åšå®¢æ ¹ç›®å½•çš„_config.ymlä¸­æ·»åŠ å¦‚ä¸‹ä»£ç  12345# è‡ªåŠ¨ç”Ÿæˆsitemapsitemap: path: sitemap.xmlbaidusitemap: path: baidusitemap.xml æ‰§è¡Œhexo generateç¼–è¯‘åšå®¢åï¼Œå¦‚æœåšå®¢æ ¹ç›®å½•çš„publicä¸‹ç”Ÿæˆäº†sitemap.xmlä»¥åŠbaidusitemap.xmlå°±è¡¨ç¤ºæˆåŠŸäº†ã€‚ ç”Ÿæˆé™æ€æ–‡ä»¶ hexo generate ç”Ÿæˆé™æ€æ–‡ä»¶æŸ¥çœ‹é»˜è®¤åšå®¢æ•ˆæœ hexo server ï¼ˆå¦‚æœé»˜è®¤çš„4000ç«¯å£è¢«å ç”¨ï¼Œå¯ä»¥ä½¿ç”¨-på‚æ•°æŒ‡å®šå…¶ä»–ç«¯å£ï¼Œå¦‚ï¼šhexo server -p 5000ï¼‰ ä¿®æ”¹é…ç½® åœ¨ç«™ç‚¹çš„é…ç½®æ–‡ä»¶_config.ymlä¸­è®¾ç½®éƒ¨ç½²ä¿¡æ¯(æ³¨æ„ï¼štype repo branch messageå‰æœ‰ä¸¤ä¸ªç©ºæ ¼)12345deploy: type: git repo: https://github.com/eightplus/eightplus.github.io.git branch: master message: &apos;ç«™ç‚¹æ›´æ–°:&#123;&#123;now(&quot;YYYY-MM-DD HH:mm:ss&quot;)&#125;&#125;&apos; éƒ¨ç½²åˆ°GitHubä¸Š12345hexo clean #æ¸…ç©ºhexo generate #ç”Ÿæˆé™æ€ç½‘é¡µhexo deploy #éƒ¨ç½²æµè§ˆå™¨ä¸­è¾“å…¥ http://eightplus.github.io ç»‘å®šåŸŸå åœ¨hexoçš„å·¥ä½œç©ºé—´ä¸‹çš„sourceç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªCNAMEçš„æ–‡ä»¶ï¼Œä¸è¦åç¼€ã€‚æ‰“å¼€CNAMEå†™ä¸Šè´­ä¹°çš„åŸŸåï¼Œå¦‚ï¼š eightplus.info æ‰©å±• ç½‘ç«™è®¿é—®é‡æ˜¾ç¤º ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ç»Ÿè®¡æ’ä»¶ä¸è’œå­, åœ¨themes\\yilia\\layout_partialä¸‹çš„footer.ejsä¸­åŠ å…¥å¦‚ä¸‹ä»£ç å³å¯12345678&lt;script async src=&quot;//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js&quot;&gt;&lt;/script&gt;&lt;span id=&quot;busuanzi_container_site_pv&quot;&gt; æœ¬ç«™æ€»è®¿é—®é‡&lt;span id=&quot;busuanzi_value_site_pv&quot;&gt;&lt;/span&gt;æ¬¡&lt;/span&gt;&lt;span id=&quot;busuanzi_container_site_uv&quot;&gt;æ€»è®¿å®¢æ•°&lt;span id=&quot;busuanzi_value_site_uv&quot;&gt;&lt;/span&gt;äººæ¬¡&lt;/span&gt; å®ç°å•ç¯‡æ–‡ç« æµè§ˆç»Ÿè®¡å’Œè¯„è®ºç»Ÿè®¡(ä»ç½‘æ˜“äº‘è·Ÿå¸–ä¸­è·å–è¯„è®ºæ•°) å‚è€ƒæ–‡æ¡£ ä¿®æ”¹themes\\yilia\\layout_partialæ–‡ä»¶å¤¹ä¸‹çš„article.ejsæ–‡ä»¶ï¼Œåœ¨&lt;%- partial(â€˜post/titleâ€™, {class_name: â€˜article-titleâ€™}) %&gt;èŠ‚ç‚¹ä¸‹åŠ å…¥(æ³¨æ„è¿™é‡Œç½‘æ˜“äº‘è·Ÿå¸–è¿˜æ²¡è®¾ç½®ï¼Œè€Œè¯„è®ºæ•°ä¸­ä½¿ç”¨åˆ°äº†ï¼Œè¿™é‡Œè¿è¡Œä¼šæœ‰é—®é¢˜)æ˜¾ç¤ºé˜…è¯»å’Œè¯„è®ºæ•° -->1234567891011121314&lt;% if (!index &amp;&amp; post.comments &amp;&amp; config.wangYi)&#123; %&gt;&lt;br/&gt;&lt;a class=&quot;cloud-tie-join-count&quot; href=&quot;javascript:void(0);&quot; style=&quot;color:gray;font-size:14px;&quot;&gt;&lt;span class=&quot;icon-sort&quot;&gt;&lt;/span&gt;&lt;span id=&quot;busuanzi_container_page_pv&quot; style=&quot;color:#ef7522;font-size:14px;&quot;&gt; é˜…è¯»æ•°: &lt;span id=&quot;busuanzi_value_page_pv&quot;&gt;&lt;/span&gt;æ¬¡ &amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/a&gt;&lt;a class=&quot;cloud-tie-join-count&quot; href=&quot;javascript:void(0);&quot; style=&quot;color:#ef7522;font-size:14px;&quot;&gt; &lt;span class=&quot;icon-comment&quot;&gt;&lt;/span&gt; &lt;span class=&quot;join-text&quot; style=&quot;color:#ef7522;font-size:14px;&quot;&gt;è¯„è®ºæ•°:&lt;/span&gt; &lt;span class=&quot;join-count&quot;&gt;0&lt;/span&gt;æ¬¡&lt;/a&gt;&lt;% &#125; %&gt;","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://eightplus.github.io/tags/Hexo/"}]},{"title":"Ubuntuä¸‹Androidå¼€å‘çš„åŸºç¡€çŸ¥è¯†","slug":"2018-07-03-build-android","date":"2018-07-03T03:01:16.000Z","updated":"2018-08-02T01:00:02.033Z","comments":true,"path":"2018/07/03/2018-07-03-build-android/","link":"","permalink":"https://eightplus.github.io/2018/07/03/2018-07-03-build-android/","excerpt":"","text":"è¿™é‡Œä½¿ç”¨Ubuntu 16.04çš„64ä½ç³»ç»Ÿä¸Šè¿›è¡ŒAndroidæºç çš„ç¼–è¯‘ã€‚ ä¸€ã€ç¯å¢ƒå‡†å¤‡ å®‰è£…ubuntu 16.04 amd64 ç³»ç»Ÿ å®‰è£…Git ~$ sudo apt-get install git-core gnupg å®‰è£…Java SDK(å®˜æ–¹JDKä¸‹è½½åœ°å€ï¼šhttp://www.oracle.com/technetwork/java/javase/downloads/index.html)ï¼š $ sudo add-apt-repository â€œdeb http://us.archive.ubuntu.com/ubuntu/ hardy multiverseâ€ $ sudo apt-get update $ sudo apt-get install sun-java6-jre sun-java6-plugin $ sudo apt-get install sun-java6-jdk å®‰è£…å…¶ä»–ä¾èµ–åŒ…(valgrindä¸ºè°ƒè¯•å·¥å…·) $ sudo apt-get install flex bison gperf libsdl-dev libesd0-dev libwxgtk2.6-dev build-essential zip curl valgrind äºŒã€ä¸‹è½½Androidæºç  ä¸‹è½½repoå·¥å…· $ wget https://dl-ssl.google.com/dl/googlesource/git-repo/repo $ chmod a+x repo $ sudo mv repo /bin/ ä¸‹è½½Androidæºç  $ mkdir Android $ cd Android Android$ repo init -u https://android.googlesource.com/platform/mainifest(å¦‚æœæƒ³ä¸‹è½½Android 2.3.1ï¼Œæ‰§è¡Œï¼šrepo init -u https://android.googlesource.com/platform/mainifest -b android-2.3.1_r1) Android$ repo sync ä¸‰ã€ç¼–è¯‘Androidæºç  Android$make (make -j18)ç¼–è¯‘ç»“æœçš„è¾“å‡ºç›®å½•ä¸ºout/target/product/$(TARGET_PRODUCT),TARGET_PRODUCTæ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œé»˜è®¤å€¼ä¸ºgeneric å››ã€ç¼–è¯‘SDK(å¯é€‰) Android$make sdkæ‰“åŒ…æˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡º($USER$è¡¨ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·å)ï¼š1Package SDK: out/host/linux-x86/sdk/android-sdk_eng.$USER$_linux-x86.zip äº”ã€å®‰è£…ç¼–è¯‘å¥½çš„Androidé•œåƒåˆ°æ¨¡æ‹Ÿå™¨ä¸Š è®¾ç½®ç¯å¢ƒå˜é‡(Androidæ¨¡æ‹Ÿå™¨å‘½ä»¤emulatorä½äºAndroid/out/host/linux-x86/binä¸­ï¼Œ~/Android/out/target/product/genericæ˜¯Androidé•œåƒå­˜æ”¾ç›®å½•) Android$export PATH=$PATH:~/Android/out/host/linux-x86/bin Android$export ANDROID_PRODUCT_OUT=~/Android/out/target/product/generic è¿è¡ŒAndroidæ¨¡æ‹Ÿå™¨ Android$emulator å¯åŠ¨Androidæ¨¡æ‹Ÿå™¨éœ€è¦å››ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºzImageã€system.imgã€userdata.imgå’Œramdisk.imgï¼Œå…¶ä¸­zImageä¸ºLinuxå†…æ ¸é•œåƒæ–‡ä»¶ï¼Œä¸‰ä¸ª.imgæ–‡ä»¶ä¸ºAndroidç³»ç»Ÿé•œåƒæ–‡ä»¶ã€‚å¦‚æœä¸å¸¦ä»»ä½•å‚æ•°æ¥è¿è¡Œemulatorå‘½ä»¤ï¼Œåˆ™Androidæ¨¡æ‹Ÿå™¨é»˜è®¤ä½¿ç”¨çš„zImageæ–‡ä»¶æ˜¯Android/out/host/linux-x86/binä¸­çš„kernel-qemuæ–‡ä»¶ï¼Œé»˜è®¤ä½¿ç”¨çš„ä¸‰ä¸ª.imgæ–‡ä»¶ä½äºANDROID_PRODUCT_OUTç›®å½•ä¸­ã€‚ANDROID_PRODUCT_OUTæ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œè¿™é‡Œå°†å®ƒçš„å€¼è®¾ç½®ä¸ºAndroidæºç ç¼–è¯‘ç»“æœçš„è¾“å‡ºç›®å½•ï¼Œå¦‚æœä¸è®¾ç½®ANDROID_PRODUCT_OUTç¯å¢ƒå˜é‡ï¼Œå°±éœ€è¦æŒ‡å®šä¸Šè¿°å››ä¸ªæ–‡ä»¶æ¥å¯åŠ¨Androidæ¨¡æ‹Ÿå™¨ï¼Œå¦‚ä¸‹ï¼š Android$emulator - kernel ./prebuilt/android-arm/kernel/kernel-qemu -sysdir ./out/target/product/generic -system system.img -data userdata.img -ramdisk ramdisk.img å…­ã€ä¸‹è½½ã€ç¼–è¯‘å’Œå®‰è£…Androidæœ€æ–°å†…æ ¸æºä»£ç Androidæºä»£ç å·¥ç¨‹é»˜è®¤æ˜¯ä¸åŒ…æ‹¬å®ƒæ‰€ä½¿ç”¨çš„Linuxå†…æ ¸æºä»£ç çš„ï¼Œè€Œæ˜¯ä½¿ç”¨é¢„å…ˆç¼–è¯‘å¥½çš„å†…æ ¸ï¼Œå³prebuilt/android-arm/kernel/kernel-qemuæ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦è¿è¡Œå®šåˆ¶çš„Linuxå†…æ ¸ï¼Œåˆ™éœ€è¦ä¸‹è½½Linux kernelæºä»£ç è¿›è¡Œç¼–è¯‘ã€‚ Linux kernelæºä»£ç ä¸‹è½½ ~/Android$ mkdir kernel ~/Android$ cd kernel ~/Android/kernel$ git clone http://android.googlesource.com/kernel/goldfish.git æ”¯çº¿ä¸‹è½½ä¸‹è½½å®Œæˆåï¼Œåœ¨kernelç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç©ºçš„goldfishå­ç›®å½•ï¼Œæ­¤æ—¶éœ€è¦æ‰§è¡Œgit checkoutæ¥æŒ‡å®šéœ€è¦çš„æ”¯çº¿ä»£ç ï¼Œåœ¨æ‰§è¡Œgit checkoutä¹‹å‰ï¼Œå¯å…ˆæ‰§è¡Œgit branch -aæŸ¥çœ‹æœ‰å“ªäº›æ”¯çº¿ä»£ç ã€‚è¿™é‡Œé€‰æ‹©android-gldfish-2.6.29 ~/Android/kernel/goldfish$git branch -a ~/Android/kernel/goldfish$git checkout remotes/origin/archive/android-gldfish-2.6.29 ä¿®æ”¹Androidå†…æ ¸æºç ç›®å½•ä¸‹Makefileæ–‡ä»¶ä¸­çš„CROSS_COMPILEå˜é‡ 1234#ARCH ?= (SUBARCH)#CROSS_COMPILE ?=ARCH ?= arm #ä½“ç³»ç»“æ„ä¸ºarmCROSS_COMPILE ?= arm-eabi- #äº¤å‰ç¼–è¯‘å·¥å…·é“¾å‰ç¼€ å°†äº¤å‰ç¼–è¯‘å·¥å…·ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡PATHä¸­ ~/Android/kernel/goldfish$ export PATH=$PATH:~/Android/prebuilt/linux-x86/toolchain/arm-eabi-4.4.3/bin ä¿®æ”¹ç¡¬ä»¶é…ç½®æ–‡ä»¶goldfish_defconfig ~/Android/kernel/goldfish$ make goldfish_defconfig å¼€å§‹ç¼–è¯‘(åœ¨makeä¹‹å‰ï¼Œå¯ä»¥æ‰§è¡Œmake menuconfigå…ˆé…ç½®ä¸€ä¸‹ç¼–è¯‘é€‰é¡¹) ~/Android/kernel/goldfish$ makeç¼–è¯‘æˆåŠŸåï¼Œå¯çœ‹åˆ°ä¸‹é¢ä¸¤è¡Œï¼š12OBJCOPY arch/arm/boot/zImageKernel: arch/arm/boot/zImage is ready ä¸ƒã€åœ¨æ¨¡æ‹Ÿå™¨ä¸­è¿è¡Œç¼–è¯‘å¥½çš„å†…æ ¸ åœ¨å¯åŠ¨æ¨¡æ‹Ÿå™¨ä¹‹å‰ï¼Œå…ˆè®¾ç½®æ¨¡æ‹Ÿå™¨çš„ç›®å½•åˆ°ç¯å¢ƒå˜é‡$PATHä¸­å» ~/Android$export PATH=$PATH:~/Android/out/host/linux-x86/bin è®¾ç½®ANDROID_PRODUCT_OUTç¯å¢ƒå˜é‡ ~/Android$export ANDROID_PRODUCT_OUT=~/Android/out/target/product/generic åœ¨åå°ä¸­æŒ‡å®šå†…æ ¸æ–‡ä»¶å¯åŠ¨æ¨¡æ‹Ÿå™¨ ~/Android$emulator -kernel ./kernel/goldfish/arch/arm/boot/zImage &amp; ç”¨adbå·¥å…·è¿æ¥æ¨¡æ‹Ÿå™¨ï¼ŒæŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯ï¼Œçœ‹çœ‹æ¨¡æ‹Ÿå™¨ä¸Šè·‘çš„å†…æ ¸æ˜¯ä¸æ˜¯åˆšæ‰ç¼–è¯‘å‡ºæ¥çš„å†…æ ¸(adbä½äº~/Android/out/host/linux-x86/binç›®å½•ä¸­)123~/Android$ adb shellroot@android:/ # cd procroot@android:/proc # cat version å…«ã€å•ç‹¬ç¼–è¯‘Androidæºä»£ç ä¸­çš„æ¨¡å—Androidæºç ç¬¬ä¸€æ¬¡æ‰§è¡Œmakeä¼šè€—æ—¶å¾ˆä¹…ï¼Œä¹‹åå¦‚æœä¿®æ”¹äº†Androidæºç ä¸­çš„æŸä¸ªæ¨¡å—æˆ–è€…åœ¨Androidæºç å·¥ç¨‹æ–°å¢ä¸€ä¸ªè‡ªå·±çš„æ¨¡å—ï¼Œåˆ™å¯ä»¥å•ç‹¬ç¼–è¯‘è¯¥æ¨¡å—ï¼Œä»¥åŠé‡æ–°æ‰“åŒ…system.imgã€‚ åœ¨Androidæºç ç›®å½•ä¸‹çš„buildç›®å½•ä¸‹ï¼Œæœ‰ä¸ªè„šæœ¬æ–‡ä»¶envsetup.shï¼Œæ‰§è¡Œè¿™ä¸ªè„šæœ¬æ–‡ä»¶å¯ä»¥è·å¾—ä¸€äº›æœ‰ç”¨çš„å·¥å…·ï¼Œå…¶ä¸­å°±åŒ…æ‹¬mmmï¼Œè¯¥å‘½ä»¤ç”¨æ¥ç¼–è¯‘æŒ‡å®šç›®å½•çš„æ‰€æœ‰æ¨¡å—ï¼Œé€šå¸¸è¿™ä¸ªç›®å½•åªåŒ…å«ä¸€ä¸ªæ¨¡å—ã€‚ ä½¿ç”¨mmmå‘½ä»¤æ¥ç¼–è¯‘æŒ‡å®šçš„æ¨¡å—ï¼Œå¦‚Emailåº”ç”¨ç¨‹åº ~/Android$mmm packages/apps/Email/ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°±å¯ä»¥åœ¨out/target/product/generic/system/appç›®å½•ä¸‹çœ‹åˆ°Email.apkæ–‡ä»¶äº†ã€‚Androidç³»ç»Ÿè‡ªå¸¦çš„Appéƒ½æ”¾åœ¨è¿™å…·ç›®å½•ä¸‹ã€‚å¦å¤–ï¼ŒAndroidç³»ç»Ÿçš„ä¸€äº›å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¾‹å¦‚Cç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ”¾åœ¨out/target/product/generic/system/binç›®å½•ä¸‹ï¼ŒåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶æ”¾åœ¨out/target/product/generic/system/libç›®å½•ä¸‹ï¼Œout/target/product/generic/system/lib/hwç›®å½•å­˜æ”¾çš„æ˜¯ç¡¬ä»¶æŠ½è±¡å±‚ï¼ˆHALï¼‰æ¥å£æ–‡ä»¶. ç¼–è¯‘å¥½æ¨¡å—åï¼Œé‡æ–°æ‰“åŒ…system.imgæ–‡ä»¶ ~/Android$make snod è¿è¡Œæ¨¡æ‹Ÿå™¨ï¼š ~/Android$emulator ä¹ã€æ—¥å¿—ç³»ç»ŸAndroidç³»ç»Ÿåœ¨ç”¨æˆ·ç©ºé—´ä¸­æä¾›äº†è½»é‡çº§çš„loggeræ—¥å¿—ç³»ç»Ÿï¼Œå®ƒæ˜¯åœ¨å†…æ ¸ä¸­å®ç°çš„ä¸€ç§è®¾å¤‡é©±åŠ¨ï¼Œä¸ç”¨æˆ·ç©ºé—´çš„logcatå·¥å…·é…åˆä½¿ç”¨èƒ½å¤Ÿæ–¹ä¾¿åœ°è·Ÿè¸ªè°ƒè¯•ç¨‹åºã€‚åœ¨Androidç³»ç»Ÿä¸­ï¼Œåˆ†åˆ«ä¸ºC/C++ å’ŒJavaè¯­è¨€æä¾›ä¸¤ç§ä¸åŒçš„loggerè®¿é—®æ¥å£ã€‚C/C++æ—¥å¿—æ¥å£ä¸€èˆ¬æ˜¯åœ¨ç¼–å†™ç¡¬ä»¶æŠ½è±¡å±‚æ¨¡å—æˆ–è€…ç¼–å†™JNIæ–¹æ³•æ—¶ä½¿ç”¨ï¼Œè€ŒJavaæ¥å£ä¸€èˆ¬æ˜¯åœ¨åº”ç”¨å±‚ç¼–å†™APPæ—¶ä½¿ç”¨ã€‚ Androidç³»ç»Ÿä¸­çš„C/C++æ—¥å¿—æ¥å£æ˜¯é€šè¿‡å®æ¥ä½¿ç”¨çš„ã€‚åœ¨system/core/include/android/log.hå®šä¹‰äº†æ—¥å¿—çš„çº§åˆ«, åœ¨system/core/include/cutils/log.hä¸­ï¼Œå®šä¹‰äº†å¯¹åº”çš„å®ï¼Œå¦‚å¯¹åº”äºANDROID_LOG_VERBOSEçš„å®LOGVã€‚å¦‚æœä½¿ç”¨C/C++æ—¥å¿—æ¥å£ï¼Œåªè¦å®šä¹‰è‡ªå·±çš„LOG_TAGå®å’ŒåŒ…å«å¤´æ–‡ä»¶system/core/include/cutils/log.hå°±å¯ä»¥äº†ã€‚12#define LOG_TAG &quot;MY LOG TAG&quot;#include &lt;cutils/log.h&gt; å°±å¯ä»¥äº†ï¼Œä¾‹å¦‚ä½¿ç”¨LOGVï¼šLOGV(â€œThis is the log printed by LOGV in android user space.â€);//ALOGI Androidç³»ç»Ÿåœ¨Frameworkså±‚ä¸­å®šä¹‰äº†Javaæ—¥å¿—æ¥å£ï¼ˆframeworks/base/core/java/android/util/Log.javaï¼‰å¦‚æœä½¿ç”¨Javaæ—¥å¿—æ¥å£ï¼Œåªè¦åœ¨ç±»ä¸­å®šä¹‰çš„LOG_TAGå¸¸é‡å’Œå¼•ç”¨android.util.Logå°±å¯ä»¥äº†ã€‚12private static final String LOG_TAG = &quot;MY_LOG_TAG&quot;;Log.i(LOG_TAG, &quot;This is the log printed by Log.i in android user space.&quot;); è¦æŸ¥çœ‹è¿™äº›LOGçš„è¾“å‡ºï¼Œå¯ä»¥é…åˆlogcatå·¥å…· å¦‚æœæ˜¯åœ¨è‡ªå·±ç¼–è¯‘çš„Androidæºä»£ç å·¥ç¨‹ä¸­ä½¿ç”¨ï¼Œåˆ™åœ¨åå°ä¸­è¿è¡Œæ¨¡æ‹Ÿå™¨ ~/Android$ emulator &amp; å¯åŠ¨adb shellå·¥å…· ~/Android$ adb shell ä½¿ç”¨logcatå‘½ä»¤æŸ¥çœ‹æ—¥å¿— root@android:/ # logcat","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Android","slug":"Android","permalink":"https://eightplus.github.io/tags/Android/"}]},{"title":"ubuntu snap åº”ç”¨","slug":"2018-06-29-snap-qt-dbus","date":"2018-06-29T02:58:12.000Z","updated":"2018-07-31T09:54:47.030Z","comments":true,"path":"2018/06/29/2018-06-29-snap-qt-dbus/","link":"","permalink":"https://eightplus.github.io/2018/06/29/2018-06-29-snap-qt-dbus/","excerpt":"","text":"Ubuntu ä» 16.04å¼€å§‹ï¼Œæ”¯æŒä¸¤ç§æ ¼å¼çš„å®‰è£…åŒ…ï¼šdebian å’Œ snapï¼Œå…¶ä¸­ snap ä¸ä¾èµ–äºæ“ä½œç³»ç»ŸåŠå…¶å‘å¸ƒç‰ˆæœ¬ï¼Œ å…¶å¯ä»¥å®‰è£…åŒæ ·ä¸€ä¸ªè½¯ä»¶çš„ä¸åŒç‰ˆæœ¬ä¸”ä¸é€ æˆä»»ä½•çš„å¹²æ‰°ã€‚snap æ˜¯ä¸€ç§å…¨æ–°çš„è½¯ä»¶åŒ…ç®¡ç†æ–¹å¼ï¼Œå®ƒç±»ä¼¼ä¸€ä¸ªå®¹å™¨æ‹¥æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰€æœ‰çš„æ–‡ä»¶å’Œåº“ï¼Œå„ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œè§£å†³äº†åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¾èµ–é—®é¢˜ï¼Œä½†å› å…¶åŒ…å«åº”ç”¨éœ€è¦çš„æ–‡ä»¶å’Œåº“ï¼Œå¯¼è‡´snapåŒ…è¿‡å¤§ï¼Œå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ï¼ˆsnapåŒ…åŒ…å«ä¸€ä¸ªç§æœ‰çš„rootæ–‡ä»¶ç³»ç»Ÿï¼Œé‡Œé¢åŒ…å«äº†ä¾èµ–çš„è½¯ä»¶åŒ…ï¼‰ã€‚ Snapå‘½ä»¤ç®€ä»‹ å®‰è£…Snapçš„ç›¸å…³åŒ… sudo apt update sudo apt-get install snapd snapcraft build-essential åœ¨snap storeä¸­æŸ¥æ‰¾snapåŒ… snap find æ˜¾ç¤ºå·²å®‰è£…çš„snapåº”ç”¨åˆ—è¡¨ snap list å®‰è£…ä¸€ä¸ªsnapåŒ… sudo snap install &lt;snap_pkg_name&gt; æ›´æ–°ä¸€ä¸ªsnapåŒ… sudo snap refresh &lt;snap_pkg_name&gt; å°†snapåŒ…è¿˜åŸåˆ°ä»¥å‰å®‰è£…çš„ç‰ˆæœ¬ sudo snap revert &lt;snap_pkg_name&gt; å¸è½½ä¸€ä¸ªsnapåŒ… sudo snap remove &lt;snap_pkg_name&gt; æ‰“é€ Snapåº”ç”¨ æˆ‘è¿™é‡Œé…ç½®çš„system dbusç›¸å…³çš„.serviceå’Œ.confæ–‡ä»¶æ ¹æœ¬åœ¨snapåŒ…ä¸­æ²¡æœ‰èµ·åˆ°ä½œç”¨ï¼ŒdebianåŒ…ä¸­æ˜¯å¯ä»¥çš„ï¼ŒåŸå› æš‚æ—¶æ²¡æ‰¾åˆ°æ¯”è¾ƒå®˜æ–¹çš„ç­”æ¡ˆã€‚æœ€ç»ˆä½¿ç”¨plugå’Œslotçš„æ–¹å¼ï¼Œå¹¶ä¸”æ˜¯æ‰‹åŠ¨å¯åŠ¨system dbusçš„æ–¹æ³•æ‰è®©å›¾å½¢ç¨‹åºä»dbus daemonè·å–åˆ°æ•°æ®ï¼ˆè²Œä¼¼æ˜¯ç›®å‰snapè¿˜ä¸æ”¯æŒdbusçš„è‡ªåŠ¨å¯åŠ¨ï¼Ÿï¼Ÿï¼Ÿï¼‰ã€‚ 1ã€ç¼–ç ç¼–å†™å®Œæ¯•åï¼Œåœ¨æºç ç¬¬ä¸€çº§ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œï¼š$snapcraft initï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆsnapç›¸å…³æ–‡ä»¶ï¼Œå…¶ä¸­æ¨¡æ¿æ–‡ä»¶snapcraft.yamlå°†æè¿°snapåŒ…çš„æ•´ä¸ªæ„å»ºè¿‡ç¨‹ 2ã€ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶snapcraft.yamlï¼Œå…·ä½“è§æºç ä¸­çš„å†™æ³• 3ã€ç»ˆç«¯æ‰§è¡Œï¼š$snapcraft ï¼Œç”ŸæˆsnapåŒ… 4ã€å®‰è£…snapåŒ…ï¼š$sudo snap install system-tool_1.0.2_amd64.snap â€“devmode â€“dangerous 5ã€å®‰è£…å®Œæˆåï¼Œç»ˆç«¯è¿è¡Œ $snap interfaces å¯ä»¥æŸ¥çœ‹åˆ°plugå’Œslotã€‚æœ‰èµ„æ–™æ˜¾ç¤ºï¼Œå¦‚æœè¦è®©æˆ‘çš„dbusæœåŠ¡ç¨‹åºå’Œå›¾å½¢ç¨‹åºè¿›è¡Œé€šä¿¡ï¼Œè¿˜éœ€è¦ç»ˆç«¯æ‰§è¡Œï¼š$sudo snap connect system-tool:daemon-plug system-tool:daemon-slot ï¼Œå¯¹åº”çš„disconnectæ“ä½œæ˜¯ï¼š$sudo snap disconnect system-tool:daemon-plug system-tool:daemon-slotã€‚æ­¤å¤„ä¸æ‰§è¡Œä¸Šè¿°æ“ä½œä»å¯ä»¥ï¼Œæœ‰äº›ä¸çŸ¥æ‰€ä¾ç„¶ï¼Ÿï¼Ÿï¼Ÿå¯èƒ½æ˜¯æˆ‘è¿™é‡Œåœ¨snapå®¹å™¨ä¸­å…³äºdbusçš„ä½¿ç”¨æ–¹æ³•æ²¡æ‰¾åˆ°æ­£è§£çš„åŸå› ã€‚ 6ã€æ‰‹åŠ¨å¯åŠ¨dbusæœåŠ¡ï¼Œæ‰“å¼€ç»ˆç«¯æ‰§è¡Œï¼š$sudo system-tool.system-tool-daemon 7ã€å¯åŠ¨å›¾å½¢ç¨‹åºï¼š$system-toolå›¾å½¢ç¨‹åºè¿è¡Œç»“æœå›¾ 8ã€å¦‚æœæƒ³å°†è‡ªå·±å¼€å‘çš„snapå‘å¸ƒåˆ°snapå•†åº—ï¼Œé¦–å…ˆæ³¨å†Œä¸€ä¸ªUbuntu Oneå¸å·ï¼Œæ³¨å†Œåœ°å€ 9ã€æœ‰äº†å¸å·ä¹‹åï¼Œè‡ªç„¶æ˜¯ä¸€æ¡æµæ°´çº¿ç”Ÿäº§æ“ä½œæ­¥éª¤ï¼šç™»å½•-&gt;æ³¨å†Œåº”ç”¨å-&gt;ä¸Šä¼ snapåŒ…-&gt;é€€å‡º snapcraft login snapcraft register system-tool (åªæœ‰ç¬¬ä¸€æ¬¡ä¸Šä¼ è¯¥åº”ç”¨æ—¶æ‰éœ€è¦æ³¨å†Œåº”ç”¨å) snapcraft push system-tool_1.0.2_amd64.snap â€“release beta snapcraft logout 10ã€ä¸Šä¼ åï¼Œä½ å¯ä»¥åœ¨é‚®ç®±ç­‰ç€snapcraftç³»ç»Ÿç»™ä½ å›é‚®ä»¶å•¦ï¼å¾ˆé—æ†¾ï¼Œç”±äºæˆ‘ä½¿ç”¨äº†è‡ªå®šä¹‰çš„plugå’Œslotï¼Œè‡ªåŠ¨å®¡æ ¸å¤±è´¥äº†ï¼Œéœ€è¦äººå·¥å®¡æ ¸ï¼ˆä¹‹å‰éªŒè¯è¿‡æ²¡æœ‰è‡ªå®šä¹‰slotå’Œplugæ—¶ï¼Œä¸Šä¼ å¯ä»¥è‡ªåŠ¨å®¡æ ¸æˆåŠŸï¼‰ã€‚ å‚è€ƒæ–‡æ¡£https://forum.snapcraft.io/t/the-dbus-interface/2038 https://github.com/snapcore/snapd/wiki/Interfaces#dbus https://forum.snapcraft.io/t/how-do-i-connect-a-snap-to-dbus/1533 https://github.com/snapcore/snapd/pull/2592 https://blog.csdn.net/tq08g2z/article/details/78685011 https://www.2cto.com/kf/201607/528337.html https://blog.csdn.net/ubuntutouch/article/details/51886345 https://blog.csdn.net/ubuntutouch/article/details/51953272 https://www.msweet.org/blog/2018-01-23-snaps-and-gui-apps.html https://github.com/ubuntu/snappy-playpen https://code.launchpad.net/~dpm/ubuntu-calendar-app/snap-all-things","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Snap","slug":"Snap","permalink":"https://eightplus.github.io/tags/Snap/"}]},{"title":"ä½¿ç”¨Jekyll + Githubæ­å»ºåšå®¢","slug":"2018-06-27-welcome-to-jekyll","date":"2018-06-27T07:33:17.000Z","updated":"2018-08-02T01:37:44.162Z","comments":true,"path":"2018/06/27/2018-06-27-welcome-to-jekyll/","link":"","permalink":"https://eightplus.github.io/2018/06/27/2018-06-27-welcome-to-jekyll/","excerpt":"","text":"ä¸€ç›´æƒ³æŠŠè‡ªå·±å­¦ä¹ linuxçš„è¿‡ç¨‹è®°å½•ä¸‹æ¥ï¼Œåˆä¸æƒ³æ€»æ˜¯ä¾æ‰˜é‚£äº›ç°æˆçš„åšå®¢ç½‘ç«™ï¼Œåœ¨WordPresså’ŒGithubä¸­ï¼Œæˆ‘é€‰æ‹©äº†Githubï¼ŒåŸå› åªæœ‰ä¸€ä¸ªï¼Œç©·ï¼Œå“ˆå“ˆå“ˆã€‚è¿™é‡Œå…ˆç®€è¦æ¥æ”¶åšå®¢æ­å»ºçš„åˆæœŸå‡†å¤‡å·¥ä½œï¼Markdownç¼–è¾‘å™¨ä½¿ç”¨çš„æ˜¯Atomï¼Œå¿«æ·é”®åˆ—è¡¨å¦‚ä¸‹ï¼š å¿«æ·é”® è§£é‡Š Crtl+Shift+M å¼€å¯Markdownå®æ—¶é¢„è§ˆ Command+Shift+P æ‰“å¼€å‘½ä»¤çª—å£ï¼Œå¯ä»¥è¿è¡Œå„ç§èœå•åŠŸèƒ½ Command + T å¿«é€Ÿå¤šæ–‡ä»¶åˆ‡æ¢ Command + F æ–‡ä»¶å†…æŸ¥æ‰¾å’Œæ›¿æ¢ Command + Shift + F å¤šæ–‡ä»¶æŸ¥æ‰¾å’Œæ›¿æ¢ Command + [ å¯¹é€‰ä¸­å†…å®¹å‘å·¦ç¼©è¿› Command + ] å¯¹é€‰ä¸­å†…å®¹å‘å³ç¼©è¿› Command + \\ æ˜¾ç¤ºæˆ–éšè—ç›®å½•æ ‘ Crtl + m ç›¸åº”æ‹¬å·ä¹‹é—´ï¼Œhtml tagä¹‹é—´ç­‰è·³è½¬ Crtl + Alt + B æ ¼å¼åŒ–ä»£ç ï¼ˆéœ€è¦å®‰è£…atom-beautifyï¼‰ Crtl + ` è°ƒèµ·CLIå‘½ä»¤è¡Œç•Œé¢ï¼ˆéœ€è¦å®‰è£…terminal-panelï¼‰ Github githubå¸å·æ³¨å†Œå’Œåˆ›å»ºé¡µé¢ä»“åº“ æ³¨å†Œåœ°å€ï¼šhttps://github.com/ ä»“åº“çš„åå­—éœ€è¦å’Œä½ çš„è´¦å·å¯¹åº”ï¼Œæ ¼å¼ï¼šyourname.github.ioï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæ¼”ç¤ºçš„é¡µé¢ä»“åº“åä¸ºeightplus.github.io ç”Ÿæˆsshå¯†é’¥ï¼Œå¹¶å°†å¯†é’¥æ·»åŠ åˆ°githubä¸Š ç”Ÿæˆå¯†é’¥ï¼šssh-keygen -t rsa -C æ³¨å†Œå¸å·æ—¶çš„é‚®ç®±åœ°å€â€ å¯†é’¥ç”Ÿæˆåï¼Œåœ¨ ~/.sshç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€äº›æ–‡ä»¶ï¼ŒåŒ…æ‹¬id_rsaå’Œid_rsa.pub æ‰“å¼€id_rsa.pubï¼Œé€‰ä¸­æ‰€æœ‰å†…å®¹å¤åˆ¶ï¼Œç½‘é¡µè¿›å…¥ https://github.com/settings/ssh ï¼ŒAdd SSH keyï¼Œç²˜è´´ä¹‹å‰å¤åˆ¶çš„å†…å®¹ã€‚ Githubå®‰è£…å’Œå¸å·é…ç½® sudo apt-get install git git config --global user.name &quot;yourname&quot; git config --global user.email &quot;æ³¨å†Œå¸å·æ—¶çš„é‚®ç®±åœ°å€&quot; å®‰è£…rubyç¯å¢ƒsudo apt-get install ruby-all-devæˆ‘çš„ç³»ç»Ÿä¸ºUbuntu 16.04ï¼Œä½¿ç”¨çš„è½¯ä»¶æºé‡Œé¢å­˜åœ¨ruby2.3-devï¼Œåˆ™æ­¤ç§æ–¹å¼ä¼šå°†ruby2.3-devä¸€å¹¶å®‰è£…ï¼Œå½“ç„¶ï¼Œä¸Šè¿°æ“ä½œä¹Ÿå¯ä»¥æ›¿æ¢æˆå®‰è£…ruby2.3-devï¼Œ(sudo apt-get install ruby2.3-dev) å®‰è£…å®Œæˆåï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥ruby -vï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ï¼š å®Œæˆrubyç¯å¢ƒåï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥gem -vï¼Œå‡ºç°å¦‚ä¸‹ç»“æœï¼Œåˆ™è¯´æ˜rubyç¯å¢ƒå·²ç»å®Œå…¨é…ç½®æˆåŠŸäº†ï¼Œå¦‚æœå‡ºç°äº†æŠ¥é”™ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦å®‰è£…nodejs (sudo apt-get install nodejs)ã€‚ å®‰è£…JeKyllç¯å¢ƒ å…ˆå®‰è£…ä¾èµ–åŒ…bundlerï¼š sudo gem install bundler å†å®‰è£…å®‰è£…jekyllï¼š sudo gem install jekyll å®‰è£…å®Œæˆåï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥jekyll --versionï¼Œå‡ºç°å¦‚ä¸‹ç»“æœï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸ å·¥ç¨‹åˆ›å»ºæ˜¯å¦è¿«ä¸åŠå¾…çš„æƒ³çœ‹ä¸‹ç¬¬ä¸€ä¸ªåšå®¢çš„å…·ä½“å†…å®¹ ğŸ‘‰ åœ¨ä½ æ‰“ç®—å­˜æ”¾å·¥ç¨‹ä»£ç çš„ç›®å½•ä¸‹æ‰“å¼€ä¸€ä¸ªç»ˆç«¯åä½¿ç”¨jekyllåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œè¿™é‡Œæˆ‘çš„ç›®å½•ä¸ºï¼š~/work/git/ï¼šjekyll new blogæ“ä½œä¹‹åä¼šç”Ÿæˆå¾ˆå¤šæ–‡ä»¶/æ–‡ä»¶å¤¹ï¼Œè¯¦ç»†è¯´æ˜å¦‚ä¸‹ï¼š _config.ymlï¼šJekyllé…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨é…ç½®æ•°æ® _draftsï¼šè‰ç¨¿ç›®å½•ï¼Œå¯æ‰‹åŠ¨åˆ›å»º _includesï¼šåŒ…å«ä¸€äº›æ¨¡æ¿ï¼Œå¯ä»¥é‡å¤åˆ©ç”¨ _layoutsï¼šå­˜æ”¾é¡µé¢æ¨¡æ¿çš„åœ°æ–¹ _postsï¼šå­˜æ”¾æ–‡ç« çš„ç›®å½•ï¼Œæ–‡ç« æ ¼å¼ä¸º mardown æ ¼å¼ï¼ˆyear-month-title.markdownï¼‰æˆ–.mdï¼Œæ–‡ä»¶åç¡®å®šäº†å‘è¡¨çš„æ—¥æœŸå’Œæ ‡è®°è¯­è¨€ _dataï¼šå­˜æ”¾yamlæ ¼å¼çš„æ•°æ®æ–‡ä»¶ _siteï¼šä½¿ç”¨Jekyllç¼–è¯‘åçš„é™æ€ç«™ç‚¹å°†å­˜æ”¾äºè¿™ä¸ªç›®å½•ä¸‹ï¼Œå³jekyllç”Ÿæˆçš„ç½‘ç«™ä¼šæ”¾åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œè¯¥ç›®å½•ä¸éœ€è¦pushåˆ°githubï¼Œå¯åœ¨.gitignoreæ–‡ä»¶ä¸­åŠ å…¥è¿™ä¸ªç›®å½• index.htmlï¼šè¯¥æ–‡ä»¶å¸¦æœ‰ yaml å¤´ä¿¡æ¯ï¼Œå¤§æ¦‚å¦‚ä¸‹ï¼š123456---layout: posttitle: &quot;Welcome to Jekyll!&quot;date: 2018-06-27 15:33:17 +0800categories: jekyll update--- ä¸Šè¿°æ“ä½œä¼šç”Ÿæˆä¸ªé»˜è®¤æ–‡ç« ï¼Œä½äº_postsç›®å½•ä¸‹ï¼Œåå­—ç±»ä¼¼ä¸ºï¼š2018-06-27-welcome-to-jekyll.markdown å¯ä»¥å¤åˆ¶2018-06-27-welcome-to-jekyll.markdownåè¿›è¡Œä¿®æ”¹æ¥è¿›è¡Œæ–°çš„åšå®¢ç¼–å†™ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ gitçš„atomç¼–è¾‘å™¨ æ¥ç¼–è¾‘.markdownæ–‡ä»¶ï¼Œå¯ä»¥åœ¨atomå®˜ç½‘è¿›è¡ŒdebåŒ…çš„ä¸‹è½½ï¼Œæ–°é¡µé¢ç”Ÿæˆå’Œç¼–è¾‘å®Œæˆåï¼Œé‡å¯jekyllå†…ç½®æœåŠ¡å™¨ï¼ˆç»ˆç«¯æ‰§è¡Œï¼šjekyll serveï¼‰ï¼Œæ‰“å¼€æˆ–åˆ·æ–°é¡µé¢ï¼šhttp://localhost:4000ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨é¡µé¢çœ‹åˆ°è‡ªå·±æ·»åŠ çš„åšæ–‡äº†ã€‚ GitåŒæ­¥å°†å‰é¢åˆ›å»ºçš„ä»“åº“å…‹éš†åˆ°æœ¬åœ°ï¼Œç„¶åå°†blogç›®å½•ä¸­ç”Ÿæˆçš„æ–‡ä»¶å¤åˆ¶åˆ°githubé¡¹ç›®ç›®å½•ä¸‹ï¼Œæˆ‘è¿™é‡Œé¡¹ç›®åä¸º eightplus.github.ioã€‚ git clone https://github.com/yourname/yourname.github.io.git git add . git commit -m &quot;init&quot; git push -u origin master è‡³æ­¤ï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥https://yourname.github.ioï¼Œæ¯”å¦‚ï¼šhttps://eightplus.github.io/ï¼Œå³å¯çœ‹åˆ°ä¸‹å›¾ï¼Œåšå®¢æ­å»ºå®Œæˆ ç½‘é¡µæµè§ˆæ•ˆæœå›¾","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://eightplus.github.io/categories/å·¥å…·/"}],"tags":[{"name":"Jekyll","slug":"Jekyll","permalink":"https://eightplus.github.io/tags/Jekyll/"}]}]}